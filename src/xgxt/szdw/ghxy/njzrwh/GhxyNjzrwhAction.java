/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package xgxt.szdw.ghxy.njzrwh;

import java.lang.reflect.InvocationTargetException;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.beanutils.BeanUtils;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.actions.DispatchAction;

import xgxt.action.Base;
import xgxt.action.BaseAction;
import xgxt.dtjs.czxx.tyxx.TyxxService;
import xgxt.dtjs.czxx.tyxx.TyxxbcModel;
import xgxt.dtjs.gdby.tyxx.GdbyTyxxForm;
import xgxt.dtjs.gdby.tyxx.GdbyTyxxModel;
import xgxt.form.SaveForm;
import xgxt.rcsw.kqgl.xskq.RcswKqglXskqService;
import xgxt.utils.FormModleCommon;

/** 
 * MyEclipse Struts
 * author 裘力俊
 * 硅湖学院年级组长维护
 * Creation date: 08-05-2010
 * 
 * XDoclet definition:
 * @struts.action validate="true"
 */
public class GhxyNjzrwhAction extends BaseAction {
	/*
	 * Generated Methods
	 */
	protected static final String QUERY = "qry";//页面查询操作判断标志
	
	protected static final String DELETE = "del";//页面删除操作判断标志
	
	protected static final String VIEW = "view";//页面单个显示详细操作判断标志
	
	protected static final String MODIFY = "modi";//页面修改操作判断标志

	protected static final String SAVE = "save";//页面保存操作判断标志
	
	protected static final String TABNAME = "fdyxxb";//页面保存操作判断标志
	
	protected static final String VIEWNAME = "view_ghxy_njzr";//页面保存操作判断标志
	/** 
	 * Method resultFdy
	 * 查询辅导员信息
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws InvocationTargetException 
	 * @throws IllegalAccessException 
	 */
	public ActionForward resultFdy(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception {
		GhxyNjzrwhForm  ghxyNjzrwhForm=(GhxyNjzrwhForm)form;
		GhxyNjzrwhModel ghxyNjzrwhModel=new GhxyNjzrwhModel();
		GhxyNjzrwhService service = new GhxyNjzrwhService();
		String nj=request.getParameter("nj");
		String doType = request.getParameter("doType");
		if(SAVE.equalsIgnoreCase(doType)){
			//进行数据操作 的表名
			String realTable ="ghxy_njfdyb";
			
			//保存查询出的所有信息的XH主键
			String[] zgh = ghxyNjzrwhForm.getPrimarykey_cbv();
			//保存已选择的信息的主键
			String[] checkVal = ghxyNjzrwhForm.getPrimarykey_cbv();
			
			//判断操作是否成功
			boolean reslut = false;
			
			//批量增加及取消
			if (checkVal != null && checkVal.length > 0) {
				String pk = "zgh";
				String[] arrzd = new String[] {"zgh","nj"};
				String[] sxh = new String[checkVal.length];
				int m = 0;
				for (int i = 0; i < checkVal.length; i++) {
					if (zgh != null && zgh.length > 0) {
						for (int j = 0; j < zgh.length; j++) {
							if (zgh[j].equalsIgnoreCase(checkVal[i])) {
								sxh[i] = checkVal[i];
								m++;
								break;
							}else{
								sxh[i]="";
							}
						}
					}
				}
				
				String[] xhArr = new String[m];
				String[] njs=new String[m];
				int f = 0;
				for(int i=0; i<sxh.length;i++){
					if(!Base.isNull(sxh[i])){
						xhArr[f] = sxh[i];
						njs[f]=nj;
						f++;
					}
				}
				SaveForm saveForm = new SaveForm();
				saveForm.setTableName(realTable);
				saveForm.setPk(pk);
				saveForm.setPkValue(checkVal);
				saveForm.setArrzd(arrzd);
				
			
				ghxyNjzrwhModel.setZgh(xhArr);
				ghxyNjzrwhModel.setNj(njs);
				reslut = service.saveTyxx(saveForm, ghxyNjzrwhModel);
				request.setAttribute("result", reslut);
			}
		}
		request.setAttribute("path", "ghxyNjzrwh.do?method=resultFdy");
		FormModleCommon.commonRequestSet(request);
		String[]outputColumn={"zgh","xm","xb","bmmc","zwmc","nj"};
		this.selectPageDataByPagination(request, form, TABNAME, VIEWNAME, outputColumn);
		service.getXxbmdm(request);
		FormModleCommon.setNjXyZyBjListForFdyBzr(request);
		return mapping.findForward("resultFdy");
	}
}