/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package xgxt.jygl.action;

import java.util.HashMap;
import java.util.List;

import xgxt.DAO.DAO;
import xgxt.action.Base;
import xgxt.jygl.form.JyglForm;
import xgxt.jygl.model.JyglModel;
import xgxt.jygl.service.JyglService;
import xgxt.xljk.lrh_Util.model.stu_info_model;
import xgxt.xljk.lrh_Util.util.stu_info_util;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.actions.DispatchAction;
import org.apache.commons.beanutils.BeanUtils;;

/** 
 * MyEclipse Struts
 * Creation date: 11-27-2008
 * 
 * XDoclet definition:
 * @struts.action path="/jyglInfo" name="commanForm" parameter="method" scope="request" validate="true"
 */
public class JyglInfoAction extends DispatchAction {
	/*
	 * Generated Methods
	 */
	String writeAble = "";
	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception {
		HttpSession session=request.getSession(false);
		ActionForward actfor = Base.chkSessionTimeOut(session);
		if (actfor != null) {
			return actfor;
		}else{
//			String userType = session.getAttribute("userType").toString();
//			boolean isStu = (userType.equalsIgnoreCase("stu"));
//			String sUName = session.getAttribute("userName").toString();
//			String path = request.getParameter("path");
			String methodName = request.getParameter("method");
			if(methodName==null || methodName.equals("")){
				request.setAttribute("errMsg", "method参数为空或不存在！");
				return new ActionForward("/errMsg.do", false);
			}
			writeAble   = request.getParameter("writeAble");
			if(writeAble ==null || writeAble.equals("")){
				//int p = Base.chkUPower(sUName, path, isStu);
				writeAble ="yes";
			}
			request.setAttribute("writeAble", writeAble);
			return dispatchMethod(mapping, form,request,response,methodName);
		}
		//return super.execute(mapping, form, request, response);
	}
	
	/** 
	 * Method searchHyxx 就业促进会会员信息
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward searchHyxx(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception{
		JyglForm cform = (JyglForm) form;
		JyglService service = new JyglService();
		JyglModel model = new JyglModel();
		DAO dao = DAO.getInstance();
		String tableName = "view_jyglhyxx";
		String doType = request.getParameter("doType");
		String again = request.getAttribute("again")==null?"":request.getAttribute("again").toString();
		if((doType != null && doType.equals("Search")) || again.equals("again")){
			BeanUtils.copyProperties(model, form);
			service.deal_toGBK(cform);
			String[] cols = { "HYBH", "XM", "XB", "HYXH", "XYMC", "BJMC","sjhm" };
			List<HashMap<String,String>> Titlelist = service.getTableTop_ser(tableName, cols);
			List<String[]> rs = service.getHyxx_ser(model);
			request.setAttribute("topTr", Titlelist);
			request.setAttribute("rs",rs );
			request.setAttribute("rsNum", rs == null ?"0":rs.size());
		}
		request.setAttribute("sexList", dao.getSexList());
		request.setAttribute("xyList", dao.getXyList());
		request.setAttribute("bjList", dao.getBjList(cform.getXydm(), cform.getZydm()));
		return mapping.findForward("hyxx");
	}
	
	/** 
	 * Method add_hyxx 就业促进会会员增加
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward add_hyxx(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception{
		JyglForm cform = (JyglForm) form;
		JyglService service = new JyglService();
		JyglModel model = new JyglModel();
		String doType = request.getParameter("doType");
		stu_info_model stu_mod = new stu_info_model();
		stu_info_util stu_util = new stu_info_util();
		String xh = cform.getXh();
		service.deal_toGBK(cform);
		if (doType != null && !doType.equalsIgnoreCase("")) {
			if (doType.equals("add")) {
				BeanUtils.copyProperties(model, cform);
				String message = service.addHyxx_ser(model);
				request.setAttribute("message", message);
			} else {
				if (xh != null && !xh.equalsIgnoreCase("")) {
					stu_mod = stu_util.stu_find_byxh(xh);
					cform = service.copy_value(stu_mod);
					request.setAttribute("rs", cform);
				} 
			}
		} else {
			cform.setXb("");			
		}
		request.setAttribute("rs", cform);
		return mapping.findForward("member_insert");
	}
	
	/** 
	 * Method modi_hyxx 就业促进会会员修改
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward modi_hyxx(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception{
		JyglForm cform = (JyglForm) form;
		String tableName = "view_jyglhyxx";
		String pk = request.getParameter("pk");
		cform.setXn_id(pk);
		JyglService service = new JyglService();
		JyglModel model = new JyglModel();
		String doType = request.getParameter("doType");
		HashMap<String,String> rs = service.oneRecord_ser(tableName, "xn_id", pk);
		if (doType != null && doType.equals("modi")) {
			service.deal_toGBK(cform);
			BeanUtils.copyProperties(model, cform);
			String message = service.modiHyxx_ser(model);
			request.setAttribute("message", message);		
		} 
		request.setAttribute("rs", rs);
		request.setAttribute("pk", pk);
		return mapping.findForward("member_modi");
	}
	
	/** 
	 * Method view_hyxx 就业促进会会员查看
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward view_hyxx(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception{
		String tableName = "view_jyglhyxx";
		String pk = request.getParameter("pk");
		JyglService service = new JyglService();
		HashMap<String,String> rs = service.oneRecord_ser(tableName, "xn_id", pk);
		request.setAttribute("rs", rs);
		return mapping.findForward("member_detail");
	}
	/** 
	 * Method delete_hyxx 就业促进会会员删除
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward delete_hyxx(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception{
		String value = request.getParameter("pk");
		JyglService service = new JyglService();
		boolean flag = service.delete_ser("jygl_hyxx", "xn_id", value);
		request.setAttribute("result", flag);
		request.setAttribute("again", "again");
		return searchHyxx(mapping, form, request, response);
	}
	/** 
	 * Method searchHdqk 就业促进会活动情况
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward searchHdqk(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception {
		JyglForm cform = (JyglForm) form;
		JyglService service = new JyglService();
		String tableName = "jygl_hdqk";
		String doType = request.getParameter("doType");
		String again = request.getAttribute("again")==null?"":request.getAttribute("again").toString();
		if(doType != null && doType.equals("search") || again.equals("again")){
			String[] cols = { "RQ", "ZT", "CYXS", "RS", "HDXS", "ZCR", "XS" };
			List<HashMap<String,String>> Titlelist = service.getTableTop_ser(tableName, cols);
			List<String[]> rs = service.getHdqk_ser(cform.getRq());
			request.setAttribute("topTr", Titlelist);
			request.setAttribute("rs",rs );
			request.setAttribute("rsNum", rs == null ?"0":rs.size());
		}
		return mapping.findForward("hdqk_index");
	}
	/** 
	 * Method add_hdqk 就业促进会活动情况新增
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward add_hdqk(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception{
		JyglForm cform = (JyglForm) form;
		JyglService service = new JyglService();
		JyglModel model = new JyglModel();
		String doType = request.getParameter("doType");
		List hdxsList = service.getHdxs_ser("jycjh_hdxs", "dm", "mc");
		if (doType != null && doType.equalsIgnoreCase("add")) {
			service.deal_toGBK(cform);
			BeanUtils.copyProperties(model, cform);
			boolean flag = service.addHdqk_ser(model);
			request.setAttribute("flag", flag);
		} 
		request.setAttribute("rs", cform);
		request.setAttribute("hdxsList", hdxsList);
		return mapping.findForward("hdqk_add");
	}
	
	/** 
	 * Method modi_hdqk 就业促进会活动修改
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward modi_hdqk(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception{
		JyglForm cform = (JyglForm) form;
		String tableName = "jygl_hdqk";
		String pk = request.getParameter("pk");
		cform.setXn_id(pk);
		JyglService service = new JyglService();
		JyglModel model = new JyglModel();
		String doType = request.getParameter("doType");
		HashMap<String,String> rs = service.oneRecord_ser(tableName, "xn_id", pk);
		List hdxsList = service.getHdxs_ser("jycjh_hdxs", "dm", "mc");
		if (doType != null && doType.equals("modi")) {
			service.deal_toGBK(cform);
			BeanUtils.copyProperties(model, cform);
			boolean flag = service.modiHdqk_ser(model);
			request.setAttribute("flag", flag);		
		} 
		request.setAttribute("rs", rs);
		request.setAttribute("pk", pk);
		request.setAttribute("hdxsList", hdxsList);
		return mapping.findForward("hdqk_modi");
	}
	/** 
	 * Method view_hdqk 就业促进会活动查看
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward view_hdqk(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception{
		String tableName = "jygl_hdqk";
		String pk = request.getParameter("pk");
		JyglService service = new JyglService();
		List hdxsList = service.getHdxs_ser("jycjh_hdxs", "dm", "mc");
		HashMap<String,String> rs = service.oneRecord_ser(tableName, "xn_id", pk);
		request.setAttribute("rs", rs);
		request.setAttribute("hdxsList", hdxsList);
		return mapping.findForward("hdqk_view");
	}
	/** 
	 * Method delete_hdqk 就业促进会活动删除
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward delete_hdqk(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception{
		String value = request.getParameter("pk");
		JyglService service = new JyglService();
		boolean flag = service.delete_ser("jygl_hdqk", "xn_id", value);
		request.setAttribute("result", flag);
		request.setAttribute("again", "again");
		return searchHdqk(mapping, form, request, response);
	}
}