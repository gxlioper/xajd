/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package xgxt.xsgygl.ynys.qsz;

import java.util.HashMap;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import xgxt.action.Base;
import xgxt.action.BaseAction;
import xgxt.utils.FormModleCommon;
import xgxt.xsgygl.GyglTyDAO;

/** 
 * MyEclipse Struts
 * Creation date: 09-06-2010
 * 
 * XDoclet definition:
 * @struts.action validate="true"
 */
public class YnysQszAction extends BaseAction {
	/*
	 * Generated Methods
	 */

	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward qszWh(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception {
		
		GyglTyDAO gydao = new GyglTyDAO();
		YnysQszService service=new YnysQszService();
		YnysQszForm qszForm=(YnysQszForm)form;
		String lddm=request.getParameter("queryequals_lddm");
		String cs=request.getParameter("cs");
		String doType=request.getParameter("doType");
		
		String viewName="view_ynys_qsxx";
		
		lddm=Base.isNull(lddm)? "" : lddm ;
		cs=Base.isNull(cs)? "" : cs;
		
		if("delete".equalsIgnoreCase(doType)){
			service.deleteQsz(request,qszForm);
			doType="qry";
		}
		if("qry".equalsIgnoreCase(doType)){
			String[]outputColumn={"pk","xqmc","ldmc","cs","qsh","qsz"};
			this.selectPageDataByPagination(request, form, "", viewName, outputColumn);
		}
		
		List<HashMap<String, String>> xqdmList = gydao.getGyglList("dm_zju_xq", "dm", "xqmc", "", "", "");// 校区
		List<HashMap<String, String>> yqList = gydao.getGyglList("view_bjlh_ldxx", "yqdm", "yqmc", "", "", "");// 园区
		List<HashMap<String, String>> ldList = gydao.getGyglList("view_bjlh_ldxx", "lddm", "ldmc", "", "", "");// 楼栋
		List<HashMap<String, String>> csList = gydao.getCsList(lddm);	//层数
		List<HashMap<String, String>> qsList = gydao.getQsList(lddm, cs, "");// 寝室
		request.setAttribute("xqdmList", xqdmList);
		request.setAttribute("yqList", yqList);
		request.setAttribute("ldList", ldList);
		request.setAttribute("csList", csList);
		request.setAttribute("qsList", qsList);	
		request.setAttribute("path", "ynysQsz.do?method=qszWh");
		FormModleCommon.commonRequestSet(request);
		return mapping.findForward("qszWh");
	}
	
	/**
	 * qszSz
	 * 寝室长设置
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return
	 * @throws Exception 
	 */
	public ActionForward qscyXx(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception {
		
		YnysQszService service=new YnysQszService();
		YnysQszForm qszForm=(YnysQszForm)form;
		
	    String doType=request.getParameter("doType");
		String pkValue=request.getParameter("pkValue");
		if("save".equalsIgnoreCase(doType)){
			service.saveQsz(request, qszForm);
		}
		//寝室成员信息
		service.getQscyXx(request, pkValue);

		return mapping.findForward("qscyXx");
	}
	
	/**
	 * 荣誉称号信息导出
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * */
	public ActionForward expDate(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String tabName="";
		String viewName="view_ynys_qsxx";
		try {
			
			this.expPageData(request, response, tabName, viewName, null);
		
		} catch (Exception e) {
		
			e.printStackTrace();
		
		}			
		
		return mapping.findForward("success");
	}
}