/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package xgxt.xsgygl.ghxy.qyfdywh;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.actions.DispatchAction;

import xgxt.action.Base;
import xgxt.action.BaseAction;
import xgxt.form.SaveForm;
import xgxt.szdw.ghxy.njzrwh.GhxyNjzrwhForm;
import xgxt.szdw.ghxy.njzrwh.GhxyNjzrwhModel;
import xgxt.szdw.ghxy.njzrwh.GhxyNjzrwhService;
import xgxt.utils.FormModleCommon;

/** 
 * MyEclipse Struts
 * Creation date: 08-05-2010
 * 
 * XDoclet definition:
 * @struts.action validate="true"
 */
public class GhxyQyfdywhAction extends BaseAction {
	/*
	 * Generated Methods
	 */
	protected static final String QUERY = "qry";//页面查询操作判断标志
	
	protected static final String DELETE = "del";//页面删除操作判断标志
	
	protected static final String VIEW = "view";//页面单个显示详细操作判断标志
	
	protected static final String MODIFY = "modi";//页面修改操作判断标志

	protected static final String SAVE = "save";//页面保存操作判断标志
	
	protected static final String TABNAME = "fdyxxb";//页面保存操作判断标志
	
	protected static final String VIEWNAME = "view_ghxy_qyfdyb";//页面保存操作判断标志
	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward resultQyfdy(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception {
		
		GhxyQyfdywhService ghxyQyfdywhService=new GhxyQyfdywhService();
		
		String xqqdm=request.getParameter("xqqdm");
		String doType = request.getParameter("doType");
		
		if(SAVE.equalsIgnoreCase(doType)){
			GhxyQyfdywhForm  ghxyQyfdywhForm=(GhxyQyfdywhForm)form;
			GhxyQyfdywhModel ghxyQyfdywhModel=new GhxyQyfdywhModel();
			GhxyNjzrwhService service = new GhxyNjzrwhService();
			//进行数据操作 的表名
			String realTable ="ghxy_qyfdyb";
			
			//保存查询出的所有信息的XH主键
			String[] zgh = ghxyQyfdywhForm.getPrimarykey_cbv();
			//保存已选择的信息的主键
			String[] checkVal = ghxyQyfdywhForm.getPrimarykey_cbv();
			//判断操作是否成功
			boolean reslut = false;
			
			//批量增加及取消
			if (checkVal != null && checkVal.length > 0) {
				String pk = "zgh";
				String[] arrzd = new String[] {"zgh","yqqdm"};
				String[] sxh = new String[checkVal.length];
				int m = 0;
				for (int i = 0; i < checkVal.length; i++) {
					if (zgh != null && zgh.length > 0) {
						for (int j = 0; j < zgh.length; j++) {
							if (zgh[j].equalsIgnoreCase(checkVal[i])) {
								sxh[i] = checkVal[i];
								m++;
								break;
							}else{
								sxh[i]="";
							}
						}
					}
				}
				
				String[] xhArr = new String[m];
				String[] xqqdms=new String[m];
				int f = 0;
				for(int i=0; i<sxh.length;i++){
					if(!Base.isNull(sxh[i])){
						xhArr[f] = sxh[i];
						xqqdms[f]=xqqdm;
						f++;
					}
				}
				SaveForm saveForm = new SaveForm();
				saveForm.setTableName(realTable);
				saveForm.setPk(pk);
				saveForm.setPkValue(checkVal);
				saveForm.setArrzd(arrzd);
				
			
				ghxyQyfdywhModel.setZgh(xhArr);
				ghxyQyfdywhModel.setYqqdm(xqqdms);
				reslut = service.saveTyxx(saveForm, ghxyQyfdywhModel);
				request.setAttribute("result", reslut);
			}
		}
		
		request.setAttribute("path", "ghxyQyfdywh.do?method=resultQyfdy");
		FormModleCommon.commonRequestSet(request);
		GhxyNjzrwhService service=new GhxyNjzrwhService();
		String[]outputColumn={"zgh","xm","xb","bmmc","zwmc","yqqmc"};
		this.selectPageDataByPagination(request, form, TABNAME, VIEWNAME, outputColumn);
		service.getXxbmdm(request);
		ghxyQyfdywhService.yqList(request);
		FormModleCommon.setNjXyZyBjListForFdyBzr(request);
		return mapping.findForward("resultQyfdy");
	}
}