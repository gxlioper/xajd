/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package xgxt.xszz.portallet;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.beanutils.BeanUtils;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import xgxt.action.Base;
import xgxt.action.BaseAction;
import xgxt.form.CommanForm;
import xgxt.shgz.model.common.CommonModel;
import xgxt.utils.FormModleCommon;

/**
 * <p>Title: 学生工作管理系统</p>
 * <p>Description: 学生资助提供Portal查询Action</p>
 * <p>Copyright: Copyright (c) 2008</p>
 * <p>Company: zfsoft</p>
 * <p>Author: 周觅</p>
 * <p>Version: 1.0</p>
 * <p>Time: 2009-04-08</p>
 */
public class XszzForPortalletAction extends BaseAction {
	
	/** 
	 * 学生资助情况信息查询
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward zzxxPortal(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		HttpSession session = request.getSession();
		XszzForPortalletService service = new XszzForPortalletService();
		String userName = session.getAttribute("userName").toString();
		
		List list = service.getXszz(userName);
		
		request.setAttribute("topTr", service.getXszzTortr());
		request.setAttribute("rs", list);
		request.setAttribute("rsNum", list.size());
		return mapping.findForward("zzxxPortal");
	}
	
	/** 
	 * 国家助学贷款信息查询
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward zxdkPortal(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		HttpSession session = request.getSession();
		XszzForPortalletService service = new XszzForPortalletService();
		String userName = session.getAttribute("userName").toString();
		
		List list = service.getGjzxdk(userName);
		
		request.setAttribute("topTr", service.getGjzxdkTortr());
		request.setAttribute("rs", list);
		request.setAttribute("rsNum", list.size());
		return mapping.findForward("zxdkPortal");
	}
	
	
	public ActionForward szzqk(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception {
		
		HttpSession session = request.getSession();
		
		String userType = session.getAttribute("userType").toString();
		String userName = session.getAttribute("userName").toString();
		String userDep = session.getAttribute("userDep").toString();
		
		CommonModel model = new CommonModel();
		CommanForm commanForm = (CommanForm) form;
		XszzForPortalletService service = new XszzForPortalletService();
		
		String doType = request.getParameter("doType");
		List<String[]> rs = new ArrayList<String[]>();
		String[] topTr = new String[] { "学号", "姓名", Base.YXPZXY_KEY, "班级", "勤工助学","评奖评优","助学贷款","国家助学金", "国家奖学金" ,"外设助学金","困难生补助","总金额"};
		
		BeanUtils.copyProperties(model, commanForm);
		
		if ("xy".equals(userType)) {
			model.setXydm(userDep);
		} else if ("stu".equals(userType)) {
			model.setXh(userName);
		}
		
		if (!Base.isNull(doType) && "query".equals(doType)) {
			rs = service.getSzzqk(model);
			if (null != rs) {
				request.setAttribute("num", rs.size());
			}
		}
		
		request.setAttribute("path", "zjlg_szzqk.do");
		request.setAttribute("topTr", topTr);
		request.setAttribute("rs", rs);
		FormModleCommon.commonRequestSet(request);
		FormModleCommon.setNdXnXqList(request);
		FormModleCommon.setNjXyZyBjList(request);
		return mapping.findForward("szzqk");
	}


	
	public ActionForward szzqkShow(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception {
		
		XszzForPortalletService service = new XszzForPortalletService();
		String pkValue = request.getParameter("pk");
		
		HashMap<String, String> stuIfno = service.getStuInfo(pkValue);
		
		request.setAttribute("annexTerm", " and xh = '"+pkValue +"'");
		//酬金发放
		this.selectPageData(request, "xscjffb", "view_xscjff", new String[] {"xn","nd","xqmc","cjje"});
		request.setAttribute("cjffTitle", request.getAttribute("topTr"));
		request.setAttribute("cjffRs", request.getAttribute("rs"));
		
		//评奖评优
		this.selectPageData(request, "xsjxjb", "view_xsjxjb", new String[] {"xn","nd","xq","jlje"});
		request.setAttribute("jxjTitle", request.getAttribute("topTr"));
		request.setAttribute("jxjRs", request.getAttribute("rs"));
		
		
		//国家助学金
		this.selectPageData(request, "xszz_com_gjzxj3", "view_xszz_com_gjzxj3", new String[] {"xn","zxjdj","zxjje"});
		request.setAttribute("zzzxjTitle", request.getAttribute("topTr"));
		request.setAttribute("zzzxjRs", request.getAttribute("rs"));
		
		//外设助学金
		this.selectPageData(request, "xszz_com_wszxj1", "xszz_com_wszxj1", new String[] {"xn","zxjmc","sqje","sqsj"});
		request.setAttribute("wszxjTitle", request.getAttribute("topTr"));
		request.setAttribute("wszxjRs", request.getAttribute("rs"));
		
		//国家奖学金
		this.selectPageData(request, "xszz_com_gjjxj1", "view_xszz_com_gjjxj1", new String[] {"xn","yjjl","xjjl","sjjl"});
		request.setAttribute("zzjxjTitle", request.getAttribute("topTr"));
		request.setAttribute("zzjxjRs", request.getAttribute("rs"));
		
		//助学贷款
		this.selectPageData(request, "xszz_zzlg_zxdk", "VIEW_XSZZ_ZZLG_ZXDK", new String[] {"dkhth","dkje","hkfs","hkzh"});
		request.setAttribute("zxjTitle", request.getAttribute("topTr"));
		request.setAttribute("zxjRs", request.getAttribute("rs"));
		
		//困难生补助贷款
		this.selectPageData(request, "xszz_com_knslsbz1", "view_xszz_com_knslsbz1", new String[] {"xn","nd","kndj","sqje"});
		request.setAttribute("knbzTitle", request.getAttribute("topTr"));
		request.setAttribute("knbzRs", request.getAttribute("rs"));
		
		//国家励志贷款
		this.selectPageData(request, "xszz_com_gjlzjxj1", "view_xszz_com_gjlzjxj1", new String[] {"xn","xxsh"});
		request.setAttribute("gjlzTitle", request.getAttribute("topTr"));
		request.setAttribute("gjlzRs", request.getAttribute("rs"));
		
		request.setAttribute("stuIfno", stuIfno);
		request.setAttribute("path", "zjlg_szzqk.do");
		FormModleCommon.commonRequestSet(request);
		return mapping.findForward("szzqkShow");
	}
}