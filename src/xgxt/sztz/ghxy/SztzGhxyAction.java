/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package xgxt.sztz.ghxy;

import java.util.HashMap;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import xgxt.action.BaseAction;
import xgxt.utils.FormModleCommon;

/** 
 * MyEclipse Struts
 * Creation date: 08-26-2010
 * 
 * XDoclet definition:
 * @struts.action validate="true"
 */
public class SztzGhxyAction extends BaseAction {
	/*
	 * Generated Methods
	 */

	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * @throws Exception 
	 */
	public ActionForward sztzSh(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws Exception {
		
		HttpSession session=request.getSession();
		SztzGhxyForm ghxyForm=(SztzGhxyForm)form;
		SztzGhxyService service=new SztzGhxyService();
		
		String doType=request.getParameter("doType");
		String userName=session.getAttribute("userName").toString();
		String userType=session.getAttribute("userType").toString();
		String shjg=request.getParameter("shjg");
		
		if("save".equalsIgnoreCase(doType)){
			HashMap<String,String>valueMap=service.setShzd(shjg, userType);
			HashMap<String, String[]> primaryMap = getValueArrayMap(request, PRIFIX_PRIMARY_KEY);
			this.auditingBatchOperation(request, primaryMap, valueMap, "csmz_tzcgb");
			doType="qry";
		}
		
		if("qry".equalsIgnoreCase(doType)){
			service.setDisabled(request, userType, userName);
			String []outputColumn={"pkValue","disabled",
					"xh", "xm", "xn", "xqmc",
					"xmmc", "kmmc", "xmjb", "cyjs","sqbmmc","bmsh","xxsh"};
			this.selectPageDataByPagination(request, form, "csmz_tzcgb", "view_csmz_cgsbxx", outputColumn);
		}
		
		if(!"xx".equalsIgnoreCase(userType)){
			//²¿ÃÅ´úÂë
			ghxyForm.setBmdm(service.getBmdm(userName));
		}
		
		request.setAttribute("path", "csmz_sztz.do?method=data_search&act=cgsbcheck");
		FormModleCommon.commonRequestSet(request);
		request.setAttribute("bmList", service.bmList());
		FormModleCommon.setNdXnXqList(request);
		FormModleCommon.setNjXyZyBjListForFdyBzr(request);
		return mapping.findForward("sztzSh");
	}
}