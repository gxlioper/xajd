/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package xgxt.studentInfo.action;

import java.io.IOException;
import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.actions.DispatchAction;

import xgxt.base.DealString;
import xgxt.base.Excel2Oracle;
import xgxt.daoActionLogic.StandardOperation;
import xgxt.studentInfo.service.StuGropInfoService;

/**
 * <p>Title: 学生工作管理系统</p>
 * <p>Description: 学生集体信息Action</p>
 * <p>Copyright: Copyright (c) 2008</p>
 * <p>Company: zfsoft</p>
 * <p>Author: 李容</p>
 * <p>Version: 1.0</p>
 * <p>Time: 2008-07-16</p>
 */
public class StuGroupInfoAction extends DispatchAction {
	

	/** 
	 * Method execute
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward  StuinfoByBjmc(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String bjmc = DealString.toGBK(request.getParameter("bjmc"));
		String xxdm = StandardOperation.getXxdm();
		StuGropInfoService service = new StuGropInfoService();
		List list = service.getStuinfoByBjmc(bjmc);
		
		request.setAttribute("topTr", service.getTopTr());
		request.setAttribute("rs", list);
		request.setAttribute("rsNum", list.size());
		request.setAttribute("bjmc", bjmc);
		request.setAttribute("xxdm", xxdm);
		return mapping.findForward("success");
	}
	
	
	public ActionForward  expData(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String bjmc = DealString.toGBK(request.getParameter("bjmc"));
		String sql = "select xh,xm,xb,sfzh,xz,xymc,zymc,bjmc,xjlb,jg,zzmmmc from view_xsxxb where bjmc='" + bjmc + "'";
		
		response.reset();
		response.setContentType("application/vnd.ms-excel");		
		try {
			Excel2Oracle.exportData(sql, "view_xsxxb", response .getOutputStream());
		} catch (IOException e) {
			// TODO 自动生成 catch 块
			e.printStackTrace();
		} catch (Exception e) {
			// TODO 自动生成 catch 块
			e.printStackTrace();
		}
		return mapping.findForward("");
	}
}