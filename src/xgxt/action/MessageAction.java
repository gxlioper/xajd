/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package xgxt.action;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;
import org.apache.struts.actions.DispatchAction;

import xgxt.DAO.DAO;
import xgxt.base.DealString;
import xgxt.daoActionLogic.StandardOperation;

/**
 * <p>Title: 学生工作管理系统</p>
 * <p>Description: 消息管理Action</p>
 * <p>Copyright: Copyright (c) 2008</p>
 * <p>Company: zfsoft</p>
 * <p>Author: 李容</p>
 * <p>Version: 1.0</p>
 * <p>Time: 2008-07-23</p>
 */
public class MessageAction extends DispatchAction {
	
	/** 
	 * Method 显示消息页面
	 * @param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 */
	public ActionForward showMessage(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String sql = "select fbsj,fbr,fbnr from xtwh_message";
		DAO dao = DAO.getInstance();
		
		request.setAttribute("content", dao.getMap(sql,new String[]{}, new String[]{"fbsj","fbr","fbnr"}));
		return mapping.findForward("success");
	}
	
	/**
	 * 显示修改消息的页面
	 *@param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * */
	public ActionForward modiMessage(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String sql = "select fbsj,fbr,fbnr from xtwh_message";
		DAO dao = DAO.getInstance();
		
		request.setAttribute("content", dao.getMap(sql,new String[]{}, new String[]{"fbsj","fbr","fbnr"}));
		return mapping.findForward("page");
	}
	
	/**
	 * 保存消息
	 *@param mapping
	 * @param form
	 * @param request
	 * @param response
	 * @return ActionForward
	 * */
	public ActionForward saveMessage(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String fbnr = DealString.toGBK(request.getParameter("fbnr").toString());
		String fbr = request.getSession().getAttribute("userName").toString();
		DAO dao = DAO.getInstance();
		String sql = "";
		boolean flag = false;
		sql = "select count(*) count from xtwh_message";
		if(Integer.parseInt(dao.getOneRs(sql, new String[]{}, "count"))>0){
			//update
			try {
				flag = StandardOperation.update("xtwh_message", "update xtwh_message set fbsj=to_char(sysdate,'yyyy-mm-dd'), fbnr='"+fbnr+"', fbr='" + fbr + "'", request);
			} catch (Exception e) {
				// TODO 自动生成 catch 块
				e.printStackTrace();
			}
		}else{
			//insert
			flag = StandardOperation.insert("xtwh_message", new String[]{"fbnr","fbr"}, new String[]{fbnr,fbr}, request);
		}
		request.setAttribute("result", flag);
		return this.modiMessage(mapping, form, request, response);
	}
	
	
}