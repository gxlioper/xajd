/*
 * 创建日期 2007-1-12 bat_zzj
 *
 */
package xgxt.action;

import java.io.OutputStream;
import java.sql.SQLException;
import java.util.*;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import common.Globals;

import xgxt.DAO.DAO;
import xgxt.DAO.XszzDao;
import xgxt.daoActionLogic.StandardOperation;
import xgxt.form.XszzForm;
import xgxt.utils.Check_Input_Value;
import xgxt.utils.ToolClass;
import xgxt.utils.String.StringUtils;
import xgxt.xszz.commonN05.XszzCommonN05Service;
import xgxt.xszz.nbty.jtjjknsbz.NbtyJtjjknsService;
import xgxt.xszz.ynys.XszzYnysService;
import xgxt.base.*;

/** 学生资助 */
public class XszzAction extends Action {
	StandardOperation so = new StandardOperation();

	private boolean isNull(String str) {
		return ((str == null) || str.equalsIgnoreCase("") || str
				.equalsIgnoreCase("all"));
	}
	
	public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		String userType;

		String sUName;
		HttpSession session = request.getSession();
		try {
			/** 在线检测 */
			int i = Base.chkTimeOut(session);
			if (i <= 2) {
				request.setAttribute("errMsg", "登陆超时，请重新登陆！");
				return new ActionForward("/login.jsp", false);
			}

			boolean isStu = true;
			userType = session.getAttribute("userType").toString();
			isStu = (userType.equalsIgnoreCase("stu"));
			sUName = session.getAttribute("userName").toString();
			// userDep = session.getAttribute("userDep").toString();
			String writeAble;
			int p = -1;

			ActionForward myActFwd = null;
			String act = mapping.getParameter();
			String power = "";
			if (act.equalsIgnoreCase("assisConf")) {
				/** 奖助学金参数设置页面生成 */
				power = "assisConf.do";
				p = Base.chkUPower(sUName, power, isStu);
				if (p == -1) {
					request.setAttribute("errMsg", "无权访问该页面！");
					return new ActionForward("/errMsg.do", false);
				}
				myActFwd = assisConf(mapping, form, request, response, p);
			} else if (act.equalsIgnoreCase("zzConfig")) {
				/** 各种补助参数设定 */
				power = "zzConfig.do";
				p = Base.chkUPower(sUName, power, isStu);
				if (p == -1) {
					request.setAttribute("errMsg", "无权访问该页面！");
					return new ActionForward("/errMsg.do", false);
				}
				myActFwd = zzConfig(mapping, form, request, response, p);
			} else if (act.equalsIgnoreCase("assisRefreshNum")) {
				/** 刷新人数 */
				power = "assisConf.do";
				p = Base.chkUPower(sUName, power, isStu);
				if (p == -1) {
					request.setAttribute("errMsg", "无权访问该页面！");
					return new ActionForward("/errMsg.do", false);
				}
				myActFwd = assisRefreshNum(mapping, form, request, response, p);
			} else if (act.equalsIgnoreCase("modiConf")) {
				/** 修改奖助学金参数 */
				power = "assisConf.do";
				p = Base.chkUPower(sUName, power, isStu);
				if (p == -1) {
					request.setAttribute("errMsg", "无权访问该页面！");
					return new ActionForward("/errMsg.do", false);
				}
				myActFwd = modiConf(mapping, form, request, response, p);
			} else if (act.equalsIgnoreCase("modiZzConf")) {
				/** 修改学生补助，外设助学金参数 */
				power = "zzConfig.do";
				p = Base.chkUPower(sUName, power, isStu);
				if (p == -1) {
					request.setAttribute("errMsg", "无权访问该页面！");
					return new ActionForward("/errMsg.do", false);
				}
				myActFwd = modiZzConf(mapping, form, request, response, p);
			} else if (act.equalsIgnoreCase("knsSh")) {
				/** 困难生审核 */
				power = "knsSh.do";
				p = Base.chkUPower(sUName, power, isStu);
				if (p == -1) {
					request.setAttribute("errMsg", "无权访问该页面！");
					return new ActionForward("/errMsg.do", false);
				}
				myActFwd = knsSh(mapping, form, request, response, p);
			} else if (act.equalsIgnoreCase("gjjxjzxj")) {
				/** 学生国家奖学金助学金申请 */
				myActFwd = xsjxjzxjSq(mapping, form, request, response, p);
			} else if (act.equalsIgnoreCase("szfjxjzxj")) {
				/** 学生省(市)政府奖学金助学金申请 */
				power = "szfjxjzxj.do?jxjlbType=szfjzxj";
				myActFwd = xsjxjzxjSq(mapping, form, request, response, p);
			} else if (act.equalsIgnoreCase("gjjzxjsqb")) {// 国家奖助学金申请表
				myActFwd = gjjzxjsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("szfjzxjsqb")) {// 省政府奖助学金申请表
				myActFwd = szfjzxjsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xpjjsq")) {// 心平基金申请
				myActFwd = xpjjSq(mapping, form, request, response, p);
			} else if (act.equalsIgnoreCase("xpjjdksqb")) {// 心平基金贷款申请表
				myActFwd = xpjjdksqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("knbz")) {// 困难补助申请
				myActFwd = knbzSq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xfbz")) {// 学费补助申请
				myActFwd = xfbzSq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("wszxj")) {// 外设助学金申请
				myActFwd = wszxjSq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("bzsqb")) {// 补助申请表
				myActFwd = xfbzsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("wszxjsqb")) {// 外设助学金申请表
				myActFwd = wszxjsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xndxjsq")) {// 校内贷学金申请
				myActFwd = xndxjSq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("lyjszxjsq")) {// 龙元建设助学金申请
				myActFwd = lyjszxjsq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("lyjszxjsqb")) {// 龙元建设助学金申请表
				myActFwd = lyjszxjsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("lstdsq")) {// 绿色通道申请
				myActFwd = lstdsq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("lstdsqb")) {// 绿色通道申请表
				myActFwd = lstdsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xsxfjmsq")) {// 学生学费减免申请
				myActFwd = xsxfjmSq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xsxfjmsqb")) {// 学生学费减免申请表
				myActFwd = xsxfjmsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("zxdksq")) {// 助学贷款申请
				myActFwd = zxdkSq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("zxdksqb")) {// 助学贷款申请表
				myActFwd = zxdksqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("txsqb")) {// 贴息申请表
				myActFwd = txsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("txsq")) {// 贴息申请
				myActFwd = txsq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("inputStu")) {// 导入学生信息库
				myActFwd = inputStu(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xszz_xzcd_open")) {// 选择菜单
				myActFwd = xzcd(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("zxdk_fkxx")) {// 放款信息
				myActFwd = zxdk_fkxx(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("fsbz_zdff")) {// 副食补助_自动发放
				myActFwd = fsbz_zdff(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("fsbz")) {// 副食补助
				myActFwd = fsbz(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("lsbz_zdff")) {// 临时补助_自动发放
				myActFwd = lsbz_zdff(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("stu_temp_subsidy")) { // 学生临时补助
				myActFwd = StuTempSubsidy(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("stu_lsbz_info")) { // 临时补助信息
				myActFwd = StuLsbzInfo(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xslxxx")) {// 离校信息
				myActFwd = xslxxx(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("hkxysd")) {// 还款协议设定
				myActFwd = hkxysd(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("hkxy")) {// 还款协议
				myActFwd = hkxy(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("hkxysqb")) {// 还款协议申请表
				myActFwd = hkxysqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("zlqrs")) {// 资料确认书
				myActFwd = zlqrs(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("bzcx")) {// 补助查询
				myActFwd = bzcx(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xnmz_lstd")) {// 西南民族大学-绿色通道申请表
				myActFwd = xnmz_lstd(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("zjys_dkxx")) { // 浙江艺术学院-贷款系统
				myActFwd = zjys_dkxx(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("zjys_dkxx_info")) { // 浙江艺术学院-贷款信息
				myActFwd = zjys_dkxx_info(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("jsxx_gjzxdk")) {// 江苏信息职业技术学院-国家助学贷款
				myActFwd = jsxx_gjzxdk(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("jsxx_gjzxdksqb")) {// 江苏信息职业技术学院-国家助学贷款申请表
				myActFwd = jsxx_gjzxdksqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("jsxx_knsxx")) {// 江苏信息职业技术学院-困难生申请
				myActFwd = jsxx_knsxx(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("jsxx_knssqb")) {// 江苏信息职业技术学院-困难生申请表
				myActFwd = jsxx_knssqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("stuResultQuery")) { // 学生查询申请结果
				myActFwd = stuResultQuery(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("stuResultQueryCommon")) {// 学生查询申请结果
				myActFwd = stuResultQueryCommon(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("jsxx_sbknbz")) {// 江苏信息职业技术学院-伤、病困难补助申请
				myActFwd = jsxx_sbknbz(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("jsxx_sbknbzsqb")) {// 江苏信息职业技术学院-伤、病困难补助申请表
				myActFwd = jsxx_sbknbzsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("zzsf_xsxfjm")) {// 漳州师范学院-学生学费减免
				myActFwd = zzsf_xsxfjm(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("zzsf_xsxfjmsqb")) {// 漳州师范学院-学生学费减免申请表
				myActFwd = zzsf_xsxfjmsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xnmz_knssq")) {// 西南民族大学-困难生申请
				myActFwd = xnmz_knssq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xnmz_knssqb")) {// 西南民族大学-困难生申请表
				myActFwd = xnmz_knssqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("bjly_knssq")) {// 北京林业大学-困难生申请
				myActFwd = bjly_knssq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("bjly_knssqb")) {// 北京林业大学-困难生申请表
				myActFwd = bjly_knssqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("szxx_gjjxjsq")) {// 深圳信息职业技术学院-国家奖学金申请
				myActFwd = szxx_gjjxjsq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("szxx_gjjxjsqb")) {// 深圳信息职业技术学院-国家奖学金申请表
				myActFwd = szxx_gjjxjsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("szxx_gjzxjsq")) {// 深圳信息职业技术学院-国家助学金申请
				myActFwd = szxx_gjzxjsq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("szxx_gjzxjsqb")) {// 深圳信息职业技术学院-国家助学金申请表
				myActFwd = szxx_gjzxjsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("szxx_wszxjsq")) {// 深圳信息职业技术学院-外设助学金申请
				myActFwd = szxx_wszxjsq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("szxx_wszxjsqb")) {// 深圳信息职业技术学院-外设助学金申请表
				myActFwd = szxx_wszxjsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("szxx_xnzxjsq")) {// 深圳信息职业技术学院-校内助学金申请
				myActFwd = szxx_xnzxjsq(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("szxx_xnzxjsqb")) {// 深圳信息职业技术学院-校内助学金申请表
				myActFwd = szxx_xnzxjsqb(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xx_plsh")) {// 学校审核批量通过
				myActFwd = xx_plsh(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_gjjzxj")) {// 公共报表-国家奖助学金审核
				myActFwd = auditing_gjjzxj(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_gjjzxj_one")) {// 公共报表-国家奖助学金单个审核
				myActFwd = auditing_gjjzxj_one(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_szfjzxj")) {// 公共报表-省(市)政府奖助学金审核
				myActFwd = auditing_szfjzxj(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_szfjzxj_one")) {// 公共报表-省(市)政府奖助学金单个审核
				myActFwd = auditing_szfjzxj_one(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_kns")) {// 公共报表-困难生审核
				myActFwd = auditing_kns(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_kns_one")) {// 公共报表-困难生单个审核
				myActFwd = auditing_kns_one(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_lstd")) {// 公共报表-绿色通道审核
				myActFwd = auditing_lstd(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_lstd_one")) {// 公共报表-绿色通道单个审核
				myActFwd = auditing_lstd_one(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_wszxj")) {// 公共报表-外设助学金审核
				myActFwd = auditing_wszxj(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_wszxj_one")) {// 公共报表-外设助学金单个审核
				myActFwd = auditing_wszxj_one(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_xndxj")) {// 公共报表-校内贷学金审核
				myActFwd = auditing_xndxj(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_xndxj_one")) {// 公共报表-校内贷学金单个审核
				myActFwd = auditing_xndxj_one(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_xfbz")) {// 公共报表-学费补助审核
				myActFwd = auditing_xfbz(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("auditing_xfbz_one")) {// 公共报表-学费补助单个审核
				myActFwd = auditing_xfbz_one(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xszzhz")) {// 资助汇总
				myActFwd = xszzhz(mapping, form, request, response);
			} else if (act.equalsIgnoreCase("xszzhz_output")) {// 资助汇总输出
				myActFwd = xszzhz_output(mapping, form, request, response);
			}
			writeAble = (p == 1) ? "yes" : "no";
			request.setAttribute("writeAble", writeAble);
			return myActFwd;
		} catch (Exception e) {
			e.printStackTrace();
			request.setAttribute("errMsg", "出现灾难性故障，" + e.toString());
			return new ActionForward("/errMsg.do", false);
		}
	}

	/** 参数设置页面生成 */
	private ActionForward assisConf(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response, int power)
	throws Exception {

		String userType;

		String userDep;

		// String sUName;

		// String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		// sUName = session.getAttribute("userName").toString();
		userDep = session.getAttribute("userDep").toString();

		String sql;
		String sql1;
		String[] inputSQL;
		ActionForward myAct = mapping.findForward("success");
		// String xxmc = ToolClass.getXxmc();

		if (userType.equalsIgnoreCase("xx")
				|| userType.equalsIgnoreCase("admin")) {
			String xydm = request.getParameter("xyToView");
			if (Base.isNull(xydm)) {
				sql = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
					+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
					+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
					+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
					+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
					+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
					+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
					+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszzsjb where sfxy='Y' order by zydm";
				sql1 = "select '' zydm,'合计' bmmc, sum(xyrs) xyrs,sum(knsrsxz) knsrsxz,"
					+ "'' kssja1,'' kssja2,'' kssja3,'' kssja4,'' jssja1,'' jssja2,"
					+ "'' jssja3,'' jssja4,'' kssjb1,'' kssjb2,'' kssjb3,'' kssjb4,"
					+ "'' jssjb1,'' jssjb2,'' jssjb3,'' jssjb4,'' kssjc1,'' kssjc2,"
					+ "'' kssjc3,'' kssjc4,'' jssjc1,'' jssjc2,'' jssjc3,'' jssjc4,"
					+ "'' kssjd1,'' kssjd2,'' kssjd3,'' kssjd4,'' jssjd1,'' jssjd2,"
					+ "'' jssjd3,'' jssjd4,'' kssje1,'' kssje2,'' kssje3,'' kssje4,"
					+ "'' jssje1,'' jssje2,'' jssje3,'' jssje4,'' kssjf1,'' kssjf2,"
					+ "'' kssjf3,'' kssjf4,'' jssjf1,'' jssjf2,'' jssjf3,'' jssjf4,"
					+ "'' kssjg1,'' kssjg2,'' kssjg3,'' kssjg4,'' jssjg1,'' jssjg2,"
					+ "'' jssjg3,'' jssjg4,'' kssjh1,'' kssjh2,'' kssjh3,'' kssjh4,"
					+ "'' jssjh1,'' jssjh2,'' jssjh3,'' jssjh4 "
					+ "from view_xszzsjb where sfxy='Y'";
				inputSQL = new String[] {};
			} else {
				sql = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
					+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
					+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
					+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
					+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
					+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
					+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
					+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszzsjb where xydm=? and sfxy='N' order by zydm";
				sql1 = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
					+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
					+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
					+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
					+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
					+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
					+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
					+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszzsjb where sfxy='Y' and xydm=?";
				inputSQL = new String[] { xydm };
				myAct = new ActionForward("/xszz/viewXyConf.jsp", false);
			}
		} else {
			sql = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
				+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
				+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
				+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
				+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
				+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
				+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
				+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
				+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
				+ "from view_xszzsjb where xydm=? and sfxy='N' order by zydm";
			sql1 = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
				+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
				+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
				+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
				+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
				+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
				+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
				+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
				+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
				+ "from view_xszzsjb where sfxy='Y' and xydm=?";
			inputSQL = new String[] { userDep };
		}

		String[] rst = { "zydm", "bmmc", "kssja1", "kssja2", "xyrs", "knsrsxz",
				"kssja3", "kssja4", "jssja1", "jssja2", "jssja3", "jssja4",
				"kssjb1", "kssjb2", "kssjb3", "kssjb4", "jssjb1", "jssjb2",
				"jssjb3", "jssjb4", "kssjc1", "kssjc2", "kssjc3", "kssjc4",
				"jssjc1", "jssjc2", "jssjc3", "jssjc4", "kssjd1", "kssjd2",
				"kssjd3", "kssjd4", "jssjd1", "jssjd2", "jssjd3", "jssjd4",
				"kssje1", "kssje2", "kssje3", "kssje4", "jssje1", "jssje2",
				"jssje3", "jssje4", "kssjf1", "kssjf2", "kssjf3", "kssjf4",
				"jssjf1", "jssjf2", "jssjf3", "jssjf4", "kssjg1", "kssjg2",
				"kssjg3", "kssjg4", "jssjg1", "jssjg2", "jssjg3", "jssjg4",
				"kssjh1", "kssjh2", "kssjh3", "kssjh4", "jssjh1", "jssjh2",
				"jssjh3", "jssjh4" };
		List rs = dao.getList(sql, inputSQL, rst);
		List rs1 = dao.getList(sql1, inputSQL, rst);
		// if (userType.equalsIgnoreCase("xx")
		// || userType.equalsIgnoreCase("admin")){
		// request.setAttribute("writeAble", "yes");}
		String xxdm = StandardOperation.getXxdm();
		if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
			request.setAttribute("isSHGC", "is");
		} else {
			request.setAttribute("isSHGC", "no");
		}
		request.setAttribute("rs", rs);
		request.setAttribute("rs1", rs1);
		return myAct;
	}

	private ActionForward zzConfig(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response, int power)
	throws Exception {

		String userType;

		String userDep;

		// String sUName;

		// String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		// sUName = session.getAttribute("userName").toString();
		userDep = session.getAttribute("userDep").toString();

		String sql;
		String sql1;
		String[] inputSQL;
		ActionForward myAct = mapping.findForward("success");

		if (userType.equalsIgnoreCase("xx")
				|| userType.equalsIgnoreCase("admin")) {
			String xydm = request.getParameter("xyToView");
			if (Base.isNull(xydm)) {
				sql = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
					+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
					+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
					+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, "
					+ "jssjd4, kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, "
					+ "jssje3, jssje4, kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, "
					+ "jssjf2, jssjf3, jssjf4, kssjg1, kssjg2, kssjg3, kssjg4, "
					+ "jssjg1, jssjg2, jssjg3, jssjg4, kssjh1, kssjh2, kssjh3, "
					+ "kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszxbzszsjb where sfxy='Y' order by zydm";
				sql1 = "select '' zydm,'合计' bmmc, sum(xyrs) xyrs,sum(knsrsxz) knsrsxz, "
					+ "'' kssja1,'' kssja2,'' kssja3,'' kssja4,'' jssja1,'' jssja2,"
					+ "'' jssja3,'' jssja4,'' kssjb1,'' kssjb2,'' kssjb3,'' kssjb4,"
					+ "'' jssjb1,'' jssjb2,'' jssjb3,'' jssjb4,'' kssjc1,'' kssjc2,"
					+ "'' kssjc3,'' kssjc4,'' jssjc1,'' jssjc2,'' jssjc3,'' jssjc4,"
					+ "'' kssjd1,'' kssjd2,'' kssjd3,'' kssjd4,'' jssjd1,'' jssjd2,"
					+ "'' jssjd3,'' jssjd4,'' kssje1,'' kssje2,'' kssje3,'' kssje4,"
					+ "'' jssje1,'' jssje2,'' jssje3,'' jssje4,'' kssjf1,'' kssjf2,"
					+ "'' kssjf3,'' kssjf4,'' jssjf1,'' jssjf2,'' jssjf3,'' jssjf4,"
					+ "'' kssjg1,'' kssjg2,'' kssjg3,'' kssjg4,'' jssjg1,'' jssjg2,"
					+ "'' jssjg3,'' jssjg4,'' kssjh1,'' kssjh2,'' kssjh3,'' kssjh4,"
					+ "'' jssjh1,'' jssjh2,'' jssjh3,'' jssjh4 "
					+ "from view_xszxbzszsjb where sfxy='Y'";
				inputSQL = new String[] {};
			} else {
				sql = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
					+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
					+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
					+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
					+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
					+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
					+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
					+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszxbzszsjb where xydm=? and sfxy='N' order by zydm";
				sql1 = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
					+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
					+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
					+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
					+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
					+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
					+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
					+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszxbzszsjb where sfxy='Y' and xydm=?";
				inputSQL = new String[] { xydm };
				myAct = new ActionForward("/xszz/xyConfig.jsp", false);
			}
		} else {
			sql = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
				+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
				+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
				+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
				+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
				+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
				+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
				+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
				+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
				+ "from view_xszxbzszsjb where xydm=? and sfxy='N' order by zydm";
			sql1 = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
				+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
				+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
				+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
				+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
				+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
				+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
				+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
				+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
				+ "from view_xszxbzszsjb where sfxy='Y' and xydm=?";
			inputSQL = new String[] { userDep };
		}

		String[] rst = { "zydm", "bmmc", "kssja1", "kssja2", "xyrs", "knsrsxz",
				"kssja3", "kssja4", "jssja1", "jssja2", "jssja3", "jssja4",
				"kssjb1", "kssjb2", "kssjb3", "kssjb4", "jssjb1", "jssjb2",
				"jssjb3", "jssjb4", "kssjc1", "kssjc2", "kssjc3", "kssjc4",
				"jssjc1", "jssjc2", "jssjc3", "jssjc4", "kssjd1", "kssjd2",
				"kssjd3", "kssjd4", "jssjd1", "jssjd2", "jssjd3", "jssjd4",
				"kssje1", "kssje2", "kssje3", "kssje4", "jssje1", "jssje2",
				"jssje3", "jssje4", "kssjf1", "kssjf2", "kssjf3", "kssjf4",
				"jssjf1", "jssjf2", "jssjf3", "jssjf4", "kssjg1", "kssjg2",
				"kssjg3", "kssjg4", "jssjg1", "jssjg2", "jssjg3", "jssjg4",
				"kssjh1", "kssjh2", "kssjh3", "kssjh4", "jssjh1", "jssjh2",
				"jssjh3", "jssjh4" };
		List rs = dao.getList(sql, inputSQL, rst);
		List rs1 = dao.getList(sql1, inputSQL, rst);
		// if (userType.equalsIgnoreCase("xx")
		// || userType.equalsIgnoreCase("admin")){
		// request.setAttribute("writeAble", "yes");}
		request.setAttribute("rs", rs);
		request.setAttribute("rs1", rs1);
		return myAct;
	}

	/** 刷新人数 */
	private ActionForward assisRefreshNum(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response, int power) throws Exception {

		String userType;

		String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		userDep = session.getAttribute("userDep").toString();

		if (power == 0) {
			request.setAttribute("errMsg", "无权做此操作！");
			return new ActionForward("/errMsg.do", false);
		}

		String sql;
		String[] inputSQL;

		boolean res = false;
		String[] xydmTemp;
		String[] xyrsTemp;
		String[] zydmTemp;

		if (userType.equalsIgnoreCase("xx")
				|| userType.equalsIgnoreCase("admin")) {
			sql = "select a.xydm xydm from "
				+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
				+ "view_xsjbxx group by zydm,zymc,xydm union "
				+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
				+ "view_xsjbxx group by xydm,xymc) a "
				+ "group by a.xydm order by a.xydm";
			xydmTemp = dao.getRs(sql, new String[] {}, "xydm");
			sql = "select max(a.xyrs) xyrs from "
				+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
				+ "view_xsjbxx group by zydm,zymc,xydm union "
				+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
				+ "view_xsjbxx group by xydm,xymc) a "
				+ "group by a.xydm order by a.xydm";
			xyrsTemp = dao.getRs(sql, new String[] {}, "xyrs");
			String[] sqlT = new String[xydmTemp.length];
			for (int i = 0; i < xydmTemp.length; i++) {
				sql = "select xydm,zydm,sfxy,xyrs,knsrsxz from xszhsjb where zydm=?";
				String[] temp = dao.getOneRs(sql, new String[] { xydmTemp[i] },
						new String[] { "xydm", "zydm", "sfxy", "xyrs",
				"knsrsxz" });
				if (temp == null) {
					sqlT[i] = "insert into xszhsjb(xydm,zydm,sfxy,xyrs,knsrsxz) values('"+xydmTemp[i]+"','"+xydmTemp[i]+"','Y','"+xyrsTemp[i]+"','"+xyrsTemp[i]+"')";
				}
			}
			dao.runBatch(sqlT);
			sql = "update xszhsjb a set a.xyrs=(select count(*) from "
				+ "view_xsjbxx b where b.xydm=a.zydm) where a.sfxy='Y'";
			inputSQL = new String[] {};
		} else {
			sql = "select a.zydm zydm from "
				+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
				+ "view_xsjbxx group by zydm,zymc,xydm union "
				+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
				+ "view_xsjbxx group by xydm,xymc) a "
				+ "where a.xydm=? and a.xydm <> a.zydm";
			zydmTemp = dao.getRs(sql, new String[] { userDep }, "zydm");
			sql = "select max(a.xyrs) xyrs from "
				+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
				+ "view_xsjbxx group by zydm,zymc,xydm union "
				+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
				+ "view_xsjbxx group by xydm,xymc) a "
				+ "where a.xydm=? and a.xydm <> a.zydm";
			xyrsTemp = dao.getRs(sql, new String[] { userDep }, "xyrs");
			String[] sqlT = new String[zydmTemp.length];
			for (int i = 0; i < zydmTemp.length; i++) {
				sql = "select xydm,zydm,sfxy,xyrs,knsrsxz from xszhsjb where zydm=?";
				String[] temp = dao.getOneRs(sql, new String[] { zydmTemp[i] },
						new String[] { "xydm", "zydm", "sfxy", "xyrs","knsrsxz" });
				if (temp == null) {
					sqlT[i] = "insert into xszhsjb(xydm,zydm,sfxy,xyrs,knsrsxz) values('"+userDep+"','"+zydmTemp[i]+"','N','"+xyrsTemp[i]+"','"+xyrsTemp[i]+"')";
				}
			}
			dao.runBatch(sqlT);
			sql = "update xszhsjb a set a.xyrs=(select count(*) from "
				+ "view_xsjbxx b where b.zydm=a.zydm) where a.sfxy='N' and a.xydm=?";
			inputSQL = new String[] { userDep };
		}

		res = dao.runUpdate(sql, inputSQL);

		if (!res) {
			request.setAttribute("errMsg", "数据更新失败！");
			return new ActionForward("/errMsg.do", false);
		}
		logMsg = "刷新学生资助参数表中的部门人数";
		Base.log(request, logMsg, sUName);
		request.setAttribute("ok", "ok");
		return mapping.findForward("success");
	}

	/** 修改困难生，奖助学金参数 */
	private ActionForward modiConf(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response, int power)
	throws Exception {
		String userType;

		String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		userDep = session.getAttribute("userDep").toString();

		if (power == 0) {
			request.setAttribute("errMsg", "无权做此操作！");
			return new ActionForward("/errMsg.do", false);
		}

		String bmdm = request.getParameter("bmdm");
		String act = request.getParameter("act");
		String doType = request.getParameter("doType");
		String sql;
		String[] inputSQL;

		String xxdm = StandardOperation.getXxdm();

		/** 保存 */
		if (!Base.isNull(act) && act.equalsIgnoreCase("save")) {
			if (power == 0) {
				request.setAttribute("errMsg", "无权修改该数据！");
				return new ActionForward("/errMsg.do", false);
			}

			boolean ok = false;
			String kssja = request.getParameter("kssqsja");
			String jssja = request.getParameter("jssqsja");
			String kssjb = request.getParameter("kssqsjb");
			String jssjb = request.getParameter("jssqsjb");
			String kssjc = request.getParameter("kssqsjc");
			String jssjc = request.getParameter("jssqsjc");
			String kssjd = request.getParameter("kssqsjd");
			String jssjd = request.getParameter("jssqsjd");
			String kssje = request.getParameter("kssqsje");
			String jssje = request.getParameter("jssqsje");
			String kssjf = request.getParameter("kssqsjf");
			String jssjf = request.getParameter("jssqsjf");
			String kssjg = request.getParameter("kssqsjg");
			String jssjg = request.getParameter("jssqsjg");
			String kssjh = request.getParameter("kssqsjh");
			String jssjh = request.getParameter("jssqsjh");
			String rsxz = request.getParameter("rsxz");
			String[] xydmTemp;
			String[] xyrsTemp;
			String[] zydmTemp;

			if (userType.equalsIgnoreCase("xx")
					|| userType.equalsIgnoreCase("admin")) {
				if (bmdm.equalsIgnoreCase("all")) {
					sql = "select a.xydm xydm from "
						+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by zydm,zymc,xydm union "
						+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by xydm,xymc) a "
						+ "group by a.xydm order by a.xydm";
					xydmTemp = dao.getRs(sql, new String[] {}, "xydm");
					sql = "select max(a.xyrs) xyrs from "
						+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by zydm,zymc,xydm union "
						+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by xydm,xymc) a "
						+ "group by a.xydm order by a.xydm";
					xyrsTemp = dao.getRs(sql, new String[] {}, "xyrs");
					String[] sqlT = new String[xydmTemp.length];
					for (int i = 0; i < xydmTemp.length; i++) {
						sql = "select xydm,zydm,sfxy,xyrs,knsrsxz from xszhsjb where zydm=?";
						String[] temp = dao.getOneRs(sql,
								new String[] { xydmTemp[i] }, new String[] {
								"xydm", "zydm", "sfxy", "xyrs",
						"knsrsxz" });
						if (temp == null) {
							sqlT[i] = "insert into xszhsjb(xydm,zydm,sfxy,xyrs,knsrsxz) values('"+xydmTemp[i]+"','"+xydmTemp[i]+"','Y','"+xyrsTemp[i]+"','"+xyrsTemp[i]+"')";
						}
					}
					dao.runBatch(sqlT);
					sql = "update xszhsjb set knssqkssj=?,knssqjssj=?,zxdksqkssj=?,"
						+ "zxdksqjssj=?,GJJXJSQKSSJ=?,GJJXJSQJSSJ=?,"
						+ "GJZXJSQKSSJ=?,GJZXJSQJSSJ=?,"
						+ "SZFJXJSQKSSJ=?,SZFJXJSQJSSJ=?,"
						+ "SZFZXJSQKSSJ=?,SZFZXJSQJSSJ=?,"
						+ "zxdkgjzxjsqkssj=?,zxdkgjzxjsqjssj=?,"
						+ "KNBZSQKSSJ=?,KNBZSQJSSJ=?,"
						+ "knsrsxz=floatToInt((xyrs/100)*?) where sfxy='Y'";
					inputSQL = new String[] { kssja, jssja, kssjb, jssjb,
							kssjc, jssjc, kssjd, jssjd, kssje, jssje, kssjf,
							jssjf, kssjg, jssjg, kssjh, jssjh, rsxz };
					logMsg = "批量重置学生资助参数。";
				} else {
					sql = "select xydm,zydm,sfxy,xyrs,knsrsxz from xszhsjb where zydm=?";
					String[] temp = dao.getOneRs(sql, new String[] { bmdm },
							new String[] { "xydm", "zydm", "sfxy", "xyrs",
					"knsrsxz" });
					if (temp == null) {
						sql = "select a.xydm xydm,max(a.xyrs) xyrs from "
							+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
							+ "view_xsjbxx group by zydm,zymc,xydm union "
							+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
							+ "view_xsjbxx group by xydm,xymc) a "
							+ "group by a.xydm having a.xydm=? order by a.xydm";
						temp = dao.getOneRs(sql, new String[] { bmdm },
								new String[] { "xydm", "xyrs" });
						sql = "insert into xszhsjb(xydm,zydm,sfxy,xyrs,knsrsxz) values(?,?,?,?,?)";
						String[] inputTemp;
						if (temp != null) {
							inputTemp = new String[] { temp[0], temp[0], "Y",
									temp[1], temp[1] };
						} else {
							inputTemp = new String[] { bmdm, bmdm, "Y", "0",
							"0" };
						}
						StandardOperation.insert("xszhsjb", new String[] {
								"xydm", "zydm", "sfxy", "xyrs", "knsrsxz" },
								inputTemp, request);
					}

					sql = "update xszhsjb set knssqkssj=?,knssqjssj=?,zxdksqkssj=?,"
						+ "zxdksqjssj=?,GJJXJSQKSSJ=?,GJJXJSQJSSJ=?,"
						+ "GJZXJSQKSSJ=?,GJZXJSQJSSJ=?,"
						+ "SZFJXJSQKSSJ=?,SZFJXJSQJSSJ=?,"
						+ "SZFZXJSQKSSJ=?,SZFZXJSQJSSJ=?,"
						+ "zxdkgjzxjsqkssj=?,zxdkgjzxjsqjssj=?,"
						+ "KNBZSQKSSJ=?,KNBZSQJSSJ=?,"
						+ "knsrsxz=? where sfxy='Y' and zydm=?";
					inputSQL = new String[] { kssja, jssja, kssjb, jssjb,
							kssjc, jssjc, kssjd, jssjd, kssje, jssje, kssjf,
							jssjf, kssjg, jssjg, kssjh, jssjh, rsxz, bmdm };
					logMsg = "重置了部门编号为：" + bmdm + "的学生资助参数。";
				}
			} else {
				if (bmdm.equalsIgnoreCase("all")) {
					sql = "select a.zydm zydm from "
						+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by zydm,zymc,xydm union "
						+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by xydm,xymc) a "
						+ "where a.xydm=? and a.xydm <> a.zydm";
					zydmTemp = dao.getRs(sql, new String[] { userDep }, "zydm");
					sql = "select max(a.xyrs) xyrs from "
						+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by zydm,zymc,xydm union "
						+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by xydm,xymc) a "
						+ "where a.xydm=? and a.xydm <> a.zydm";
					xyrsTemp = dao.getRs(sql, new String[] { userDep }, "xyrs");
					String[] sqlT = new String[zydmTemp.length];
					for (int i = 0; i < zydmTemp.length; i++) {
						sql = "select xydm,zydm,sfxy,xyrs,knsrsxz from xszhsjb where zydm=?";
						String[] temp = dao.getOneRs(sql,
								new String[] { zydmTemp[0] }, new String[] {
								"xydm", "zydm", "sfxy", "xyrs",
						"knsrsxz" });
						if (temp == null) {
							sqlT[i] = "insert into xszhsjb(xydm,zydm,sfxy,xyrs,knsrsxz) values('"+userDep+"','"+zydmTemp[i]+"','N','"+xyrsTemp[i]+"','"+xyrsTemp[i]+"')";
						}
					}
					dao.runBatch(sqlT);
					sql = "update xszhsjb set knssqkssj=?,knssqjssj=?,zxdksqkssj=?,"
						+ "zxdksqjssj=?,GJJXJSQKSSJ=?,GJJXJSQJSSJ=?,"
						+ "GJZXJSQKSSJ=?,GJZXJSQJSSJ=?,"
						+ "SZFJXJSQKSSJ=?,SZFJXJSQJSSJ=?,"
						+ "SZFZXJSQKSSJ=?,SZFZXJSQJSSJ=?,"
						+ "zxdkgjzxjsqkssj=?,zxdkgjzxjsqjssj=?,"
						+ "KNBZSQKSSJ=?,KNBZSQJSSJ=?,"
						+ "knsrsxz=floatToInt((xyrs/100)*?) where sfxy='N' and xydm=?";
					inputSQL = new String[] { kssja, jssja, kssjb, jssjb,
							kssjc, jssjc, kssjd, jssjd, kssje, jssje, kssjf,
							jssjf, kssjg, jssjg, kssjh, jssjh, rsxz, userDep };
					logMsg = "批量重置学生资助参数。";
				} else {
					sql = "select xydm,zydm,sfxy,xyrs,knsrsxz from xszhsjb where xydm=? and zydm=?";
					String[] temp = dao.getOneRs(sql, new String[] { userDep,
							bmdm }, new String[] { "xydm", "zydm", "sfxy",
							"xyrs", "knsrsxz" });
					if (temp == null) {
						sql = "select a.xydm xydm,a.zydm zydm,a.xyrs xyrs from "
							+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
							+ "view_xsjbxx group by zydm,zymc,xydm union "
							+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
							+ "view_xsjbxx group by xydm,xymc) a "
							+ "where a.xydm=? and a.zydm=? and a.xydm <> a.zydm";
						temp = dao.getOneRs(sql,
								new String[] { userDep, bmdm }, new String[] {
								"xydm", "zydm", "xyrs" });
						sql = "insert into xszhsjb(xydm,zydm,sfxy,xyrs,knsrsxz) values(?,?,?,?,?)";
						String[] inputTemp;
						if (temp != null) {
							inputTemp = new String[] { temp[0], temp[1], "N",
									temp[2], temp[2] };
						} else {
							inputTemp = new String[] { userDep, bmdm, "N", "0",
							"0" };
						}
						StandardOperation.insert("xszhsjb", new String[] {
								"xydm", "zydm", "sfxy", "xyrs", "knsrsxz" },
								inputTemp, request);
					}

					sql = "update xszhsjb set knssqkssj=?,knssqjssj=?,zxdksqkssj=?,"
						+ "zxdksqjssj=?,GJJXJSQKSSJ=?,GJJXJSQJSSJ=?,"
						+ "GJZXJSQKSSJ=?,GJZXJSQJSSJ=?,"
						+ "SZFJXJSQKSSJ=?,SZFJXJSQJSSJ=?,"
						+ "SZFZXJSQKSSJ=?,SZFZXJSQJSSJ=?,"
						+ "zxdkgjzxjsqkssj=?,zxdkgjzxjsqjssj=?,"
						+ "KNBZSQKSSJ=?,KNBZSQJSSJ=?,"
						+ "knsrsxz=? where sfxy='N' and xydm=? and zydm=?";
					inputSQL = new String[] { kssja, jssja, kssjb, jssjb,
							kssjc, jssjc, kssjd, jssjd, kssje, jssje, kssjf,
							jssjf, kssjg, jssjg, kssjh, jssjh, rsxz, userDep,
							bmdm };
					logMsg = "重置了部门编号为：" + bmdm + "的学生资助参数。";
				}
			}

			ok = dao.runUpdate(sql, inputSQL);

			if (ok) {
				Base.log(request, logMsg, sUName);
				request.setAttribute("ok", "ok");
			} else {
				request.setAttribute("ok", "no");
			}
		}

		String[] rst = { "zydm", "bmmc", "kssja1", "kssja2", "xyrs", "knsrsxz",
				"kssja3", "kssja4", "jssja1", "jssja2", "jssja3", "jssja4",
				"kssjb1", "kssjb2", "kssjb3", "kssjb4", "jssjb1", "jssjb2",
				"jssjb3", "jssjb4", "kssjc1", "kssjc2", "kssjc3", "kssjc4",
				"jssjc1", "jssjc2", "jssjc3", "jssjc4", "kssjd1", "kssjd2",
				"kssjd3", "kssjd4", "jssjd1", "jssjd2", "jssjd3", "jssjd4",
				"kssje1", "kssje2", "kssje3", "kssje4", "jssje1", "jssje2",
				"jssje3", "jssje4", "kssjf1", "kssjf2", "kssjf3", "kssjf4",
				"jssjf1", "jssjf2", "jssjf3", "jssjf4", "kssjg1", "kssjg2",
				"kssjg3", "kssjg4", "jssjg1", "jssjg2", "jssjg3", "jssjg4",
				"kssjh1", "kssjh2", "kssjh3", "kssjh4", "jssjh1", "jssjh2",
				"jssjh3", "jssjh4" };
		String[] rs;

		if (!Base.isNull(doType) && doType.equalsIgnoreCase("one")) {
			if (userType.equalsIgnoreCase("xx")
					|| userType.equalsIgnoreCase("admin")) {
				sql = "select zydm, nvl(bmmc,'未设置') bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
					+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
					+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
					+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
					+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
					+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
					+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
					+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszzsjb where sfxy='Y' and zydm=? order by zydm";
				inputSQL = new String[] { bmdm };
			} else {
				sql = "select zydm, nvl(bmmc,'未设置') bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
					+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
					+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
					+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
					+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
					+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
					+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
					+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszzsjb where xydm=? and zydm=? and sfxy='N' order by zydm";
				inputSQL = new String[] { userDep, bmdm };
			}
		} else {
			if (userType.equalsIgnoreCase("xx")
					|| userType.equalsIgnoreCase("admin")) {
				sql = "select 'all' zydm,'统一设置' bmmc, sum(xyrs) xyrs,"
					+ "round(sum(knsrsxz)*100/sum(xyrs)) knsrsxz, "
					+ "min(kssja1) kssja1,min(kssja2) kssja2,min(kssja3) kssja3,min(kssja4) kssja4,"
					+ "min(jssja1) jssja1,min(jssja2) jssja2,min(jssja3) jssja3,min(jssja4) jssja4,"
					+ "min(kssjb1) kssjb1,min(kssjb2) kssjb2,min(kssjb3) kssjb3,min(kssjb4) kssjb4,"
					+ "min(jssjb1) jssjb1,min(jssjb2) jssjb2,min(jssjb3) jssjb3,min(jssjb4) jssjb4,"
					+ "min(kssjc1) kssjc1,min(kssjc2) kssjc2,min(kssjc3) kssjc3,min(kssjc4) kssjc4,"
					+ "min(jssjc1) jssjc1,min(jssjc2) jssjc2,min(jssjc3) jssjc3,min(jssjc4) jssjc4,"
					+ "min(kssjd1) kssjd1,min(kssjd2) kssjd2,min(kssjd3) kssjd3,min(kssjd4) kssjd4,"
					+ "min(jssjd1) jssjd1,min(jssjd2) jssjd2,min(jssjd3) jssjd3,min(jssjd4) jssjd4,"
					+ "min(kssje1) kssje1,min(kssje2) kssje2,min(kssje3) kssje3,min(kssje4) kssje4,"
					+ "min(jssje1) jssje1,min(jssje2) jssje2,min(jssje3) jssje3,min(jssje4) jssje4,"
					+ "min(kssjf1) kssjf1,min(kssjf2) kssjf2,min(kssjf3) kssjf3,min(kssjf4) kssjf4,"
					+ "min(jssjf1) jssjf1,min(jssjf2) jssjf2,min(jssjf3) jssjf3,min(jssjf4) jssjf4,"
					+ "min(kssjg1) kssjg1,min(kssjg2) kssjg2,min(kssjg3) kssjg3,min(kssjg4) kssjg4,"
					+ "min(jssjg1) jssjg1,min(jssjg2) jssjg2,min(jssjg3) jssjg3,min(jssjg4) jssjg4,"
					+ "min(kssjh1) kssjh1,min(kssjh2) kssjh2,min(kssjh3) kssjh3,min(kssjh4) kssjh4,"
					+ "min(jssjh1) jssjh1,min(jssjh2) jssjh2,min(jssjh3) jssjh3,min(jssjh4) jssjh4 "
					+ "from view_xszzsjb where sfxy='Y'";
				inputSQL = new String[] {};
			} else {
				sql = "select 'all' zydm, nvl(bmmc,'未设置') bmmc, xyrs, round(knsrsxz*100/xyrs) knsrsxz,"
					+ "kssja1, kssja2, kssja3, kssja4, jssja1, jssja2, jssja3, jssja4, "
					+ "kssjb1, kssjb2, kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, "
					+ "kssjc1, kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
					+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
					+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
					+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
					+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszzsjb where sfxy='Y' and xydm=?";
				inputSQL = new String[] { userDep };
			}
		}
		rs = dao.getOneRs(sql, inputSQL, rst);
		if (rs != null) {
			for (int i = 0; i < rs.length; i++) {
				request.setAttribute(rst[i], rs[i]);
			}
		} else {
			request.setAttribute("errMsg", "读取数据错误，请刷新页面后重试！");
			return new ActionForward("/errMsg.do", false);
		}
		if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
			request.setAttribute("isSHGC", "is");
		} else {
			request.setAttribute("isSHGC", "no");
		}
		return mapping.findForward("success");
	}

	/** 补助及外设助学金参数设置 */
	private ActionForward modiZzConf(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response, int power)
	throws Exception {
		String userType;

		String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		userDep = session.getAttribute("userDep").toString();
		if (power == 0) {
			request.setAttribute("errMsg", "无权做此操作！");
			return new ActionForward("/errMsg.do", false);
		}

		String bmdm = request.getParameter("bmdm");
		String act = request.getParameter("act");
		String doType = request.getParameter("doType");
		String sql;
		String[] inputSQL;

		/** 保存 */
		if (!Base.isNull(act) && act.equalsIgnoreCase("save")) {
			if (power == 0) {
				request.setAttribute("errMsg", "无权修改该数据！");
				return new ActionForward("/errMsg.do", false);
			}

			boolean ok = false;
			String kssja = request.getParameter("kssqsja");
			String jssja = request.getParameter("jssqsja");
			String kssjb = request.getParameter("kssqsjb");
			String jssjb = request.getParameter("jssqsjb");
			String kssjc = request.getParameter("kssqsjc");
			String jssjc = request.getParameter("jssqsjc");
			String kssjd = request.getParameter("kssqsjd");
			String jssjd = request.getParameter("jssqsjd");
			String kssje = request.getParameter("kssqsje");
			String jssje = request.getParameter("jssqsje");
			String kssjf = request.getParameter("kssqsjf");
			String jssjf = request.getParameter("jssqsjf");
			String kssjg = request.getParameter("kssqsjg");
			String jssjg = request.getParameter("jssqsjg");
			String kssjh = request.getParameter("kssqsjh");
			String jssjh = request.getParameter("jssqsjh");
			String rsxz = request.getParameter("rsxz");
			String[] xydmTemp;
			String[] xyrsTemp;
			String[] zydmTemp;

			if (userType.equalsIgnoreCase("xx")
					|| userType.equalsIgnoreCase("admin")) {
				if (bmdm.equalsIgnoreCase("all")) {
					sql = "select a.xydm xydm from "
						+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by zydm,zymc,xydm union "
						+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by xydm,xymc) a "
						+ "group by a.xydm order by a.xydm";
					xydmTemp = dao.getRs(sql, new String[] {}, "xydm");
					sql = "select max(a.xyrs) xyrs from "
						+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by zydm,zymc,xydm union "
						+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by xydm,xymc) a "
						+ "group by a.xydm order by a.xydm";
					xyrsTemp = dao.getRs(sql, new String[] {}, "xyrs");
					String[] sqlT = new String[xydmTemp.length];
					for (int i = 0; i < xydmTemp.length; i++) {
						sql = "select xydm,zydm,sfxy,xyrs,knsrsxz from xszhsjb where zydm=?";
						String[] temp = dao.getOneRs(sql,
								new String[] { xydmTemp[i] }, new String[] {
								"xydm", "zydm", "sfxy", "xyrs",
						"knsrsxz" });
						if (temp == null) {
							sqlT[i] = "insert into xszhsjb(xydm,zydm,sfxy,xyrs,knsrsxz) values('"+xydmTemp[i]+"','"+xydmTemp[i]+"','Y','"+xyrsTemp[i]+"','"+xyrsTemp[i]+"')";
						}
					}
					dao.runBatch(sqlT);
					sql = "update xszhsjb set XPJJDKSQKSSJ=?,XPJJDKSQjSSJ=?,XFBZSQKSSJ=?,"
						+ "XFBZSQjSSJ=?,XXKNBZSQKSSJ=?,XXKNBZSQjSSJ=?,"
						+ "WSZXJSQKSSJ=?,WSZXJSQjSSJ=?,LYJSZXJKSSJ=?,LYJSZXJJSSJ=?,"
						+ "LSTDSQKSSJ=?,LSTDSQJSSJ=?,XSXFJMSQKSSJ=?,XSXFJMSQjSSJ=?,"
						+ "GAJJSQKSSJ=?,GAJJSQJSSJ=?,"
						+ "knsrsxz=floatToInt((xyrs/100)*?) where sfxy='Y'";
					inputSQL = new String[] { kssja, jssja, kssjb, jssjb,
							kssjc, jssjc, kssjd, jssjd, kssje, jssje, kssjf,
							jssjf, kssjg, jssjg, kssjh, jssjh, rsxz };
					logMsg = "批量重置学生资助参数。";
				} else {
					sql = "select xydm,zydm,sfxy,xyrs,knsrsxz from xszhsjb where zydm=?";
					String[] temp = dao.getOneRs(sql, new String[] { bmdm },
							new String[] { "xydm", "zydm", "sfxy", "xyrs",
					"knsrsxz" });
					if (temp == null) {
						sql = "select a.xydm xydm,max(a.xyrs) xyrs from "
							+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
							+ "view_xsjbxx group by zydm,zymc,xydm union "
							+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
							+ "view_xsjbxx group by xydm,xymc) a "
							+ "group by a.xydm having a.xydm=? order by a.xydm";
						temp = dao.getOneRs(sql, new String[] { bmdm },
								new String[] { "xydm", "xyrs" });
						sql = "insert into xszhsjb(xydm,zydm,sfxy,xyrs,knsrsxz) values(?,?,?,?,?)";
						String[] inputTemp;
						if (temp != null) {
							inputTemp = new String[] { temp[0], temp[0], "Y",
									temp[1], temp[1] };
						} else {
							inputTemp = new String[] { bmdm, bmdm, "Y", "0",
							"0" };
						}
						StandardOperation.insert("xszhsjb",
								new String[] { "xydm", "zydm", "sfxy",
								"xyrs", "knsrsxz" }, inputTemp, request);
					}

					sql = "update xszhsjb set XPJJDKSQKSSJ=?,XPJJDKSQjSSJ=?,XFBZSQKSSJ=?,"
						+ "XFBZSQjSSJ=?,XXKNBZSQKSSJ=?,XXKNBZSQjSSJ=?,"
						+ "WSZXJSQKSSJ=?,WSZXJSQjSSJ=?,LYJSZXJKSSJ=?,LYJSZXJJSSJ=?,"
						+ "LSTDSQKSSJ=?,LSTDSQJSSJ=?,XSXFJMSQKSSJ=?,XSXFJMSQjSSJ=?,"
						+ "GAJJSQKSSJ=?,GAJJSQJSSJ=?,"
						+ "knsrsxz=? where sfxy='Y' and zydm=?";
					inputSQL = new String[] { kssja, jssja, kssjb, jssjb,
							kssjc, jssjc, kssjd, jssjd, kssje, jssje, kssjf,
							jssjf, kssjg, jssjg, kssjh, jssjh, rsxz, bmdm };
					logMsg = "重置了部门编号为：" + bmdm + "的学生资助参数。";
				}
			} else {
				if (bmdm.equalsIgnoreCase("all")) {
					sql = "select a.zydm zydm from "
						+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by zydm,zymc,xydm union "
						+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by xydm,xymc) a "
						+ "where a.xydm=? and a.xydm <> a.zydm";
					zydmTemp = dao.getRs(sql, new String[] { userDep }, "zydm");
					sql = "select max(a.xyrs) xyrs from "
						+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by zydm,zymc,xydm union "
						+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
						+ "view_xsjbxx group by xydm,xymc) a "
						+ "where a.xydm=? and a.xydm <> a.zydm";
					xyrsTemp = dao.getRs(sql, new String[] { userDep }, "xyrs");
					String[] sqlT = new String[zydmTemp.length];
					for (int i = 0; i < zydmTemp.length; i++) {
						sql = "select xydm,zydm,sfxy,xyrs,knsrsxz from xszhsjb where zydm=?";
						String[] temp = dao.getOneRs(sql,
								new String[] { zydmTemp[0] }, new String[] {
								"xydm", "zydm", "sfxy", "xyrs",
						"knsrsxz" });
						if (temp == null) {
							sqlT[i] = "insert into xszhsjb(xydm,zydm,sfxy,xyrs,knsrsxz) values('"+userDep+"','"+zydmTemp[i]+"','N','"+xyrsTemp[i]+"','"+xyrsTemp[i]+"')";
						}
					}
					dao.runBatch(sqlT);
					sql = "update xszhsjb set XPJJDKSQKSSJ=?,XPJJDKSQjSSJ=?,XFBZSQKSSJ=?,"
						+ "XFBZSQjSSJ=?,XXKNBZSQKSSJ=?,XXKNBZSQjSSJ=?,"
						+ "WSZXJSQKSSJ=?,WSZXJSQjSSJ=?,LYJSZXJKSSJ=?,LYJSZXJJSSJ=?,"
						+ "LSTDSQKSSJ=?,LSTDSQJSSJ=?,XSXFJMSQKSSJ=?,XSXFJMSQjSSJ=?,"
						+ "GAJJSQKSSJ=?,GAJJSQJSSJ=?,"
						+ "knsrsxz=floatToInt((xyrs/100)*?) where sfxy='N' and xydm=?";
					inputSQL = new String[] { kssja, jssja, kssjb, jssjb,
							kssjc, jssjc, kssjd, jssjd, kssje, jssje, kssjf,
							jssjf, kssjg, jssjg, kssjh, jssjh, rsxz, userDep };
					logMsg = "批量重置学生资助参数。";
				} else {
					sql = "select xydm,zydm,sfxy,xyrs,knsrsxz from xszhsjb where xydm=? and zydm=?";
					String[] temp = dao.getOneRs(sql, new String[] { userDep,
							bmdm }, new String[] { "xydm", "zydm", "sfxy",
							"xyrs", "knsrsxz" });
					if (temp == null) {
						sql = "select a.xydm xydm,a.zydm zydm,a.xyrs xyrs from "
							+ "(select xydm,zydm,zymc bmmc,count(*) xyrs from "
							+ "view_xsjbxx group by zydm,zymc,xydm union "
							+ "select xydm bmdm,xydm bmdm,xymc bmmc,count(*) xyrs from "
							+ "view_xsjbxx group by xydm,xymc) a "
							+ "where a.xydm=? and a.zydm=? and a.xydm <> a.zydm";
						temp = dao.getOneRs(sql,
								new String[] { userDep, bmdm }, new String[] {
								"xydm", "zydm", "xyrs" });
						sql = "insert into xszhsjb(xydm,zydm,sfxy,xyrs,knsrsxz) values(?,?,?,?,?)";
						String[] inputTemp;
						if (temp != null) {
							inputTemp = new String[] { temp[0], temp[1], "N",
									temp[2], temp[2] };
						} else {
							inputTemp = new String[] { userDep, bmdm, "N", "0",
							"0" };
						}
						StandardOperation.insert("xszhsjb",
								new String[] { "xydm", "zydm", "sfxy",
								"xyrs", "knsrsxz" }, inputTemp, request);
					}

					sql = "update xszhsjb set XPJJDKSQKSSJ=?,XPJJDKSQjSSJ=?,XFBZSQKSSJ=?,"
						+ "XFBZSQjSSJ=?,XXKNBZSQKSSJ=?,XXKNBZSQjSSJ=?,"
						+ "WSZXJSQKSSJ=?,WSZXJSQjSSJ=?,LYJSZXJKSSJ=?,LYJSZXJJSSJ=?,"
						+ "LSTDSQKSSJ=?,LSTDSQJSSJ=?,XSXFJMSQKSSJ=?,XSXFJMSQjSSJ=?,"
						+ "GAJJSQKSSJ=?,GAJJSQJSSJ=?,"
						+ "knsrsxz=? where sfxy='N' and xydm=? and zydm=?";
					inputSQL = new String[] { kssja, jssja, kssjb, jssjb,
							kssjc, jssjc, kssjd, jssjd, kssje, jssje, kssjf,
							jssjf, kssjg, jssjg, kssjh, jssjh, rsxz, userDep, bmdm };
					logMsg = "重置了部门编号为：" + bmdm + "的学生资助参数。";
				}
			}
			ok = dao.runUpdate(sql, inputSQL);

			if (ok) {
				Base.log(request, logMsg, sUName);
				request.setAttribute("ok", "ok");
			} else {
				request.setAttribute("ok", "no");
			}
		}

		String[] rst = { "zydm", "bmmc", "kssja1", "kssja2", "xyrs", "knsrsxz",
				"kssja3", "kssja4", "jssja1", "jssja2", "jssja3", "jssja4",
				"kssjb1", "kssjb2", "kssjb3", "kssjb4", "jssjb1", "jssjb2",
				"jssjb3", "jssjb4", "kssjc1", "kssjc2", "kssjc3", "kssjc4",
				"jssjc1", "jssjc2", "jssjc3", "jssjc4", "kssjd1", "kssjd2",
				"kssjd3", "kssjd4", "jssjd1", "jssjd2", "jssjd3", "jssjd4",
				"kssje1", "kssje2", "kssje3", "kssje4", "jssje1", "jssje2",
				"jssje3", "jssje4", "kssjf1", "kssjf2", "kssjf3", "kssjf4",
				"jssjf1", "jssjf2", "jssjf3", "jssjf4", "kssjg1", "kssjg2",
				"kssjg3", "kssjg4", "jssjg1", "jssjg2", "jssjg3", "jssjg4",
				"kssjh1", "kssjh2", "kssjh3", "kssjh4", "jssjh1", "jssjh2",
				"jssjh3", "jssjh4" };
		String[] rs;

		if (!Base.isNull(doType) && doType.equalsIgnoreCase("one")) {
			if (userType.equalsIgnoreCase("xx")
					|| userType.equalsIgnoreCase("admin")) {
				sql = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
					+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
					+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
					+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
					+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
					+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
					+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
					+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszxbzszsjb where sfxy='Y' and zydm=? order by zydm";
				inputSQL = new String[] { bmdm };
			} else {
				sql = "select zydm, bmmc, xyrs, knsrsxz, kssja1, kssja2, kssja3, "
					+ "kssja4, jssja1, jssja2, jssja3, jssja4, kssjb1, kssjb2, "
					+ "kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, kssjc1, "
					+ "kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
					+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
					+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
					+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
					+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszxbzszsjb where xydm=? and zydm=? and sfxy='N' order by zydm";
				inputSQL = new String[] { userDep, bmdm };
			}
		} else {
			if (userType.equalsIgnoreCase("xx")
					|| userType.equalsIgnoreCase("admin")) {
				sql = "select 'all' zydm,'统一设置' bmmc, sum(xyrs) xyrs,"
					+ "round(sum(knsrsxz)*100/sum(xyrs)) knsrsxz, "
					+ "min(kssja1) kssja1,min(kssja2) kssja2,min(kssja3) kssja3,min(kssja4) kssja4,"
					+ "min(jssja1) jssja1,min(jssja2) jssja2,min(jssja3) jssja3,min(jssja4) jssja4,"
					+ "min(kssjb1) kssjb1,min(kssjb2) kssjb2,min(kssjb3) kssjb3,min(kssjb4) kssjb4,"
					+ "min(jssjb1) jssjb1,min(jssjb2) jssjb2,min(jssjb3) jssjb3,min(jssjb4) jssjb4,"
					+ "min(kssjc1) kssjc1,min(kssjc2) kssjc2,min(kssjc3) kssjc3,min(kssjc4) kssjc4,"
					+ "min(jssjc1) jssjc1,min(jssjc2) jssjc2,min(jssjc3) jssjc3,min(jssjc4) jssjc4,"
					+ "min(kssjd1) kssjd1,min(kssjd2) kssjd2,min(kssjd3) kssjd3,min(kssjd4) kssjd4,"
					+ "min(jssjd1) jssjd1,min(jssjd2) jssjd2,min(jssjd3) jssjd3,min(jssjd4) jssjd4,"
					+ "min(kssje1) kssje1,min(kssje2) kssje2,min(kssje3) kssje3,min(kssje4) kssje4,"
					+ "min(jssje1) jssje1,min(jssje2) jssje2,min(jssje3) jssje3,min(jssje4) jssje4,"
					+ "min(kssjf1) kssjf1,min(kssjf2) kssjf2,min(kssjf3) kssjf3,min(kssjf4) kssjf4,"
					+ "min(jssjf1) jssjf1,min(jssjf2) jssjf2,min(jssjf3) jssjf3,min(jssjf4) jssjf4,"
					+ "min(kssjg1) kssjg1,min(kssjg2) kssjg2,min(kssjg3) kssjg3,min(kssjg4) kssjg4,"
					+ "min(jssjg1) jssjg1,min(jssjg2) jssjg2,min(jssjg3) jssjg3,min(jssjg4) jssjg4,"
					+ "min(kssjh1) kssjh1,min(kssjh2) kssjh2,min(kssjh3) kssjh3,min(kssjh4) kssjh4,"
					+ "min(jssjh1) jssjh1,min(jssjh2) jssjh2,min(jssjh3) jssjh3,min(jssjh4) jssjh4 "
					+ "from view_xszxbzszsjb where sfxy='Y'";
				inputSQL = new String[] {};
			} else {
				sql = "select 'all' zydm, bmmc, xyrs, round(knsrsxz*100/xyrs) knsrsxz, "
					+ "kssja1, kssja2, kssja3, kssja4, jssja1, jssja2, jssja3, jssja4, "
					+ "kssjb1, kssjb2, kssjb3, kssjb4, jssjb1, jssjb2, jssjb3, jssjb4, "
					+ "kssjc1, kssjc2, kssjc3, kssjc4, jssjc1, jssjc2, jssjc3, jssjc4, "
					+ "kssjd1, kssjd2, kssjd3, kssjd4, jssjd1, jssjd2, jssjd3, jssjd4, "
					+ "kssje1, kssje2, kssje3, kssje4, jssje1, jssje2, jssje3, jssje4, "
					+ "kssjf1, kssjf2, kssjf3, kssjf4, jssjf1, jssjf2, jssjf3, jssjf4, "
					+ "kssjg1, kssjg2, kssjg3, kssjg4, jssjg1, jssjg2, jssjg3, jssjg4, "
					+ "kssjh1, kssjh2, kssjh3, kssjh4, jssjh1, jssjh2, jssjh3, jssjh4 "
					+ "from view_xszxbzszsjb where sfxy='Y' and xydm=?";
				inputSQL = new String[] { userDep };
			}
		}
		rs = dao.getOneRs(sql, inputSQL, rst);
		if (rs != null) {
			for (int i = 0; i < rs.length; i++) {
				request.setAttribute(rst[i], rs[i]);
			}
		} else {
			request.setAttribute("errMsg", "读取数据错误，请刷新页面后重试！");
			return new ActionForward("/errMsg.do", false);
		}
		return mapping.findForward("success");
	}

	/** 困难生审核 */
	private ActionForward knsSh(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response, int power)
	throws Exception {
		// if (power == 0) {
		// request.setAttribute("errMsg", "无权做此操作！");
		// return new ActionForward("/errMsg.do", false);
		// }
		String userType;

		String userDep;

		String sUName;

		// String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;
		String sql;
		String[] inputSQL;
		String[] outputSQL;
		String[] colCN;

		String tips;
		String xn = Base.chgNull(xszzForm.getXn(), "%", 0);
		String nd = Base.chgNull(xszzForm.getNd(), "%", 0);
		String xq = Base.chgNull(xszzForm.getXq(), "%", 0);
		String bmdm = Base.chgNull(xszzForm.getXydm(), "%", 0);
		String zydm = Base.chgNull(xszzForm.getZydm(), "%", 0);
		String nj = Base.chgNull(xszzForm.getNj(), "%", 0);

		if (userType.equalsIgnoreCase("xy")) {
			bmdm = userDep;
			sql = "select zydm,zymc,count(decode(xysh ,'通过' ,xh)) tg,"
				+ "count(decode(xysh ,'不通过' ,xh)) btg,"
				+ "count(decode(xysh ,'未审核' ,xh)) wsh,count(*) tot from "
				+ "view_knsxx where xydm like ? and nj like ? and xn like ? and nd "
				+ "like ? and xq like ? group by zydm,zymc order by wsh desc ";
			inputSQL = new String[] { bmdm, nj, xn, nd, xq };
			outputSQL = new String[] { "zydm", "zymc", "tot", "tg", "btg",
			"wsh" };
			colCN = new String[] { "专业代码", "专业名称", "总申请数", "审核通过", "审核不通过",
			"未审核" };
			tips = "学生资助 - 基础数据管理 - 困难生审核";
		} else if (userType.equalsIgnoreCase("xx")
				|| userType.equalsIgnoreCase("admin")) {
			sql = "select xydm,xymc,count(decode(xysh ,'通过' ,xh)) tg,"
				+ "count(decode(xysh ,'不通过' ,xh)) btg,"
				+ "count(decode(xysh ,'未审核' ,xh)) wsh,count(*) tot,"
				+ "count(decode(xxsh ,'通过' ,xh)) tg1,"
				+ "count(decode(xxsh ,'不通过' ,xh)) btg1,"
				+ "count(decode(xxsh ,'未审核' ,xh)) wsh1 from "
				+ "view_knsxx where nj like ? and xn like ? and nd "
				+ "like ? and xq like ? and xydm like ? group by xydm,"
				+ "xymc order by wsh desc ";
			inputSQL = new String[] { nj, xn, nd, xq, bmdm };
			outputSQL = new String[] { "xydm", "xymc", "tot", "tg", "btg",
					"wsh", "tg1", "btg1", "wsh1" };
			colCN = new String[] { Base.YXPZXY_KEY+"代码", Base.YXPZXY_KEY+"名称", "总申请数", Base.YXPZXY_KEY+"通过", Base.YXPZXY_KEY+"不通过",
					Base.YXPZXY_KEY+"未审核", "学校通过", "学校不通过", "学校未审核" };
			tips = "学生资助 - 基础数据管理 - 困难生审核";
		} else {
			sql = "select * from view_knsxx where xh=? order by xn,nd xq";
			inputSQL = new String[] { sUName };
			outputSQL = new String[] { "xn", "nd", "xq", "xh", "xm", "xb",
					"sqsj", "xysh", "xxsh" };
			colCN = dao.getColumnNameCN(outputSQL, "view_knsxx");
			tips = "学生资助 - 困难生申请";
		}

		ArrayList rs = dao.rsToVator(sql, inputSQL, outputSQL);
		List topTr = dao.arrayToList(outputSQL, colCN);

		bmdm = bmdm==null ? "":bmdm;
		zydm = zydm==null ? "":zydm;
		nj = nj==null ? "":nj;
		String bjKey = bmdm+"!!"+zydm+"!!"+nj;
		xszzForm.setXydm(bmdm);
		request.setAttribute("xnndList", Base.getXnndList());
		request.setAttribute("xqList", Base.getXqList());
		request.setAttribute("njList", Base.getNjList());
		request.setAttribute("xyList", Base.getXyList());
		request.setAttribute("zyList", Base.getZyMap().get(bmdm));// 发送专业列表
		request.setAttribute("bjList", Base.getBjMap().get(bjKey));// 发送班级列表
		request.setAttribute("shztList", dao.getChkList(3));
		request.setAttribute("topTr", topTr);
		request.setAttribute("tips", tips);
		request.setAttribute("rs", rs);
		request.setAttribute("rsNum", rs.size());
		return mapping.findForward("success");
	}

	private ActionForward xsjxjzxjSq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response, int power)
	throws Exception {

		String userType;
		String sUName;
		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		XszzForm xszzForm = (XszzForm) form;
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();

		String xxdm = StandardOperation.getXxdm();
		String doType = request.getParameter("doType");// 操作类型
		String jxjlbType = request.getParameter("jxjlbType");// 奖学金类别：是国家的还是省政府的(gjjzxj
		String titName = request.getParameter("titName");// 访问助学金还是奖学金

		String[] colName1 = null;
		String jzxjmc = "";
		String sfksq = "-1";// 国家奖学金是否可申请参数，-1表示不可以，1表示可以。

		String[] pages = null;
		String[] titNames = null;
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		
		if (jxjlbType.equalsIgnoreCase("gjjzxj")) {// /是国家奖助学金
			if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
				pages = new String[] { "国家奖学金", "国家助学金", "国家励志奖学金" };
				titNames = new String[] { "gjjxj", "gjzxj", "gjlzjxj" };
			} else if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY) || xxdm.equalsIgnoreCase(Globals.XXDM_BJLHDX)){
				pages = new String[] { "国家奖学金" };
				titNames = new String[] { "gjjxj" };
			} else {
				pages = new String[] { "国家奖学金", "国家助学金" };
				titNames = new String[] { "gjjxj", "gjzxj" };
			}
		} else if (jxjlbType.equalsIgnoreCase("szfjzxj")) {
			pages = new String[] { "省(市)政府奖学金", "省(市)政府助学金" };
			titNames = new String[] { "szfjxj", "szfzxj" };
		} else if(jxjlbType.equalsIgnoreCase("gjjxj")){//国家奖学金
			pages = new String[] { "国家奖学金" };
			titNames = new String[] { "gjjxj" };
		} else if(jxjlbType.equalsIgnoreCase("gjzxj")){//国家助学金
			pages = new String[] { "国家助学金" };
			titNames = new String[] { "gjzxj" };
		}

		if (null == titName)
			titName = titNames[0];
		boolean isJSXX = false;
		if (xxdm.equalsIgnoreCase(Globals.XXDM_JSXX)) {
			isJSXX = true;
		}

		if (xxdm.equalsIgnoreCase(Globals.XXDM_ZBDX)) {
			if (!("".equalsIgnoreCase(sUName) || sUName == null)) {
				if (!(userType.equalsIgnoreCase("stu"))) {
					String xh_lrh = xszzForm.getXh();
					if (null != xh_lrh && "" != xh_lrh) {
						String sql_lrh = "select * from view_knsxx where  xxsh='通过' and xh=?";
						String tag = dao.returntag(sql_lrh,
								new String[] { xh_lrh });
						if ("empty".equalsIgnoreCase(tag)) {
							request.setAttribute("IsKns", "no");
							return mapping.findForward("notKns");
						}
					}
				} else {
					String xh_lrh = xszzForm.getXh();
					if (null != xh_lrh && "" != xh_lrh) {
						String sql_lrh = "select * from view_knsxx where  xxsh='通过' and xh=?";
						String tag = dao.returntag(sql_lrh,
								new String[] { xh_lrh });
						if ("empty".equalsIgnoreCase(tag)) {
							request.setAttribute("IsKns", "no");
							return mapping.findForward("notKns");
						}
					}
				}
			}
		}

		request.setAttribute("xxdm", xxdm);
		request.setAttribute("titName", titName);
		List pagesList = dao.arrayToList(titNames, pages);
		request.setAttribute("pages", pagesList);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间
		String[] outString = new String[] {};
		sql = "select xh,nd,csny,rxny,byny,lxdh,jzxjzwmc,xm,sfzh,xb,bjmc,xy,xmc,xydm,zydm,bjdm,nj,mzmc,zzmmmc,kh,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xxmc,xysh,xxsh,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdysh,fdyshyj,sxncj,xsjbqkjj "
				+ "from view_xsjxjzxjsq where 1=2";
		outString = dao.getColumnName(sql);// 获得view_xsjxjzxjsq的列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
		String xh = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;
			String gnmkmc = "";
			if (titName.equalsIgnoreCase("gjjxj") || titName.equalsIgnoreCase("gjzxj")) {
				gnmkmc = "国家助学、奖学金";
			} else if (titName.equalsIgnoreCase("szfjxj") || titName.equalsIgnoreCase("szfzxj")) {
				gnmkmc = "省(市)政府助学、奖学金";
			}
			
			if(xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)){
				if (titName.equalsIgnoreCase("gjjxj")) {
					gnmkmc = "国家奖学金";
				}
				if (titName.equalsIgnoreCase("gjzxj")) {
					gnmkmc = "国家助学金";
				}
			}

			sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
				+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc=? and b.xh=? ";
			jxjksjssj = dao.getOneRs(sql1, new String[] { gnmkmc,xh }, new String[] {
				"kssj", "jssj" });
			if (jxjksjssj != null
				&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
				&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String csny = DealString.toGBK(request.getParameter("csny")
							.toString());
					String rxny = DealString.toGBK(request.getParameter("rxny")
							.toString());
					String jlxx = DealString.toGBK(
							request.getParameter("jlxx").toString());
					String radJthk = DealString.toGBK(request.getParameter(
					"radJthk").toString());
					String hkrs = DealString.toGBK(request.getParameter("hkrs")
							.toString());
					String jtyzsr = DealString.toGBK(request.getParameter(
					"jtyzsr").toString());
					String jtrjsr = DealString.toGBK(request.getParameter(
					"jtrjsr").toString());
					String jtsrly = DealString.toGBK(request.getParameter(
					"jtsrly").toString());
					String yzbm = DealString.toGBK(request.getParameter("yzbm")
							.toString());
					String jtzz = DealString.toGBK(
							request.getParameter("jtzz").toString());
					String JTCY1_XM = DealString.toGBK(request.getParameter(
					"JTCY1_XM").toString());
					String JTCY1_nl = DealString.toGBK(request.getParameter(
					"JTCY1_nl").toString());
					String JTCY1_GX = DealString.toGBK(request.getParameter(
					"JTCY1_GX").toString());
					String JTCY1_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY1_GZDZ").toString());
					String JTCY2_XM = DealString.toGBK(request.getParameter(
					"JTCY2_XM").toString());
					String JTCY2_nl = DealString.toGBK(request.getParameter(
					"JTCY2_nl").toString());
					String JTCY2_GX = DealString.toGBK(request.getParameter(
					"JTCY2_GX").toString());
					String JTCY2_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY2_GZDZ").toString());
					String JTCY3_XM = DealString.toGBK(request.getParameter(
					"JTCY3_XM").toString());
					String JTCY3_nl = DealString.toGBK(request.getParameter(
					"JTCY3_nl").toString());
					String JTCY3_GX = DealString.toGBK(request.getParameter(
					"JTCY3_GX").toString());
					String JTCY3_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY3_GZDZ").toString());
					String JTCY4_XM = DealString.toGBK(request.getParameter(
					"JTCY4_XM").toString());
					String JTCY4_nl = DealString.toGBK(request.getParameter(
					"JTCY4_nl").toString());
					String JTCY4_GX = DealString.toGBK(request.getParameter(
					"JTCY4_GX").toString());
					String JTCY4_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY4_GZDZ").toString());
					String JTCY5_XM = DealString.toGBK(request.getParameter(
					"JTCY5_XM").toString());
					String JTCY5_nl = DealString.toGBK(request.getParameter(
					"JTCY5_nl").toString());
					String JTCY5_GX = DealString.toGBK(request.getParameter(
					"JTCY5_GX").toString());
					String JTCY5_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY5_GZDZ").toString());
					String sqly = DealString.toGBK(
							request.getParameter("sqly").toString());

					if (titName.equalsIgnoreCase("gjjxj")) {
						jzxjmc = "国家奖学金";
					} else if (titName.equalsIgnoreCase("gjzxj")) {
						jzxjmc = "国家助学金";
					} else if (titName.equalsIgnoreCase("szfjxj")) {
						jzxjmc = "省(市)政府奖学金";
					} else if (titName.equalsIgnoreCase("szfzxj")) {
						jzxjmc = "省(市)政府助学金";
					} else if (titName.equalsIgnoreCase("gjlzjxj")) {
						jzxjmc = "国家励志奖学金";
					}
					String pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd + titName;
					}
					sql = "select xxsh from xsjxjzxjsqb where lower(xh||nd||jzxjmc)=?";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal }, new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("xsjxjzxjsqb", "lower(xh||nd||jzxjmc)", pkVal, request);

					String[] valueForOut;
					if (isJSXX) {
						String gkfs = DealString.toGBK(request.getParameter(
						"gkfs").toString());
						String bygz = DealString.toGBK(request.getParameter(
						"bygz").toString());
						String kc1_mc = DealString.toGBK(request.getParameter(
						"kc1_mc").toString());
						String kc1_cj = DealString.toGBK(request.getParameter(
						"kc1_cj").toString());
						String kc2_mc = DealString.toGBK(request.getParameter(
						"kc2_mc").toString());
						String kc2_cj = DealString.toGBK(request.getParameter(
						"kc2_cj").toString());
						String kc3_mc = DealString.toGBK(request.getParameter(
						"kc3_mc").toString());
						String kc3_cj = DealString.toGBK(request.getParameter(
						"kc3_cj").toString());
						String kc4_mc = DealString.toGBK(request.getParameter(
						"kc4_mc").toString());
						String kc4_cj = DealString.toGBK(request.getParameter(
						"kc4_cj").toString());
						String kc5_mc = DealString.toGBK(request.getParameter(
						"kc5_mc").toString());
						String kc5_cj = DealString.toGBK(request.getParameter(
						"kc5_cj").toString());
						String kc6_mc = DealString.toGBK(request.getParameter(
						"kc6_mc").toString());
						String kc6_cj = DealString.toGBK(request.getParameter(
						"kc6_cj").toString());
						String kc7_mc = DealString.toGBK(request.getParameter(
						"kc7_mc").toString());
						String kc7_cj = DealString.toGBK(request.getParameter(
						"kc7_cj").toString());
						String kc8_mc = DealString.toGBK(request.getParameter(
						"kc8_mc").toString());
						String kc8_cj = DealString.toGBK(request.getParameter(
						"kc8_cj").toString());
						String kc9_mc = DealString.toGBK(request.getParameter(
						"kc9_mc").toString());
						String kc9_cj = DealString.toGBK(request.getParameter(
						"kc9_cj").toString());
						String kc10_mc = DealString.toGBK(request.getParameter(
						"kc10_mc").toString());
						String kc10_cj = DealString.toGBK(request.getParameter(
						"kc10_cj").toString());
						String kc11_mc = DealString.toGBK(request.getParameter(
						"kc11_mc").toString());
						String kc11_cj = DealString.toGBK(request.getParameter(
						"kc11_cj").toString());
						String kc12_mc = DealString.toGBK(request.getParameter(
						"kc12_mc").toString());
						String kc12_cj = DealString.toGBK(request.getParameter(
						"kc12_cj").toString());

						colName1 = new String[] { "xh", "csny", "rxny",
									"jlxx", "radJthk", "hkrs", "jtyzsr",
									"jtrjsr", "jtsrly", "yzbm", "jtzz",
									"JTCY1_XM", "JTCY1_nl", "JTCY1_GX",
									"JTCY1_GZDZ", "JTCY2_XM", "JTCY2_nl",
									"JTCY2_GX", "JTCY2_GZDZ", "JTCY3_XM",
									"JTCY3_nl", "JTCY3_GX", "JTCY3_GZDZ",
									"JTCY4_XM", "JTCY4_nl", "JTCY4_GX",
									"JTCY4_GZDZ", "JTCY5_XM", "JTCY5_nl",
									"JTCY5_GX", "JTCY5_GZDZ", "sqly", "JZXJMC",
									"jzxjzwmc", "nd", "gkfs", "bygz", "kc1_mc",
									"kc1_cj", "kc2_mc", "kc2_cj", "kc3_mc",
									"kc3_cj", "kc4_mc", "kc4_cj", "kc5_mc",
									"kc5_cj", "kc6_mc", "kc6_cj", "kc7_mc",
									"kc7_cj", "kc8_mc", "kc8_cj", "kc9_mc",
									"kc9_cj", "kc10_mc", "kc10_cj", "kc11_mc",
									"kc11_cj", "kc12_mc", "kc12_cj" };

						valueForOut = new String[] { xh, csny, rxny, jlxx,
								radJthk, hkrs, jtyzsr, jtrjsr, jtsrly, yzbm,
								jtzz, JTCY1_XM, JTCY1_nl, JTCY1_GX, JTCY1_GZDZ,
								JTCY2_XM, JTCY2_nl, JTCY2_GX, JTCY2_GZDZ,
								JTCY3_XM, JTCY3_nl, JTCY3_GX, JTCY3_GZDZ,
								JTCY4_XM, JTCY4_nl, JTCY4_GX, JTCY4_GZDZ,
								JTCY5_XM, JTCY5_nl, JTCY5_GX, JTCY5_GZDZ, sqly,
								titName, jzxjmc, nd, gkfs, bygz, kc1_mc,
								kc1_cj, kc2_mc, kc2_cj, kc3_mc, kc3_cj, kc4_mc,
								kc4_cj, kc5_mc, kc5_cj, kc6_mc, kc6_cj, kc7_mc,
								kc7_cj, kc8_mc, kc8_cj, kc9_mc, kc9_cj,
								kc10_mc, kc10_cj, kc11_mc, kc11_cj, kc12_mc,
								kc12_cj };
					} else if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
						String sxncj = DealString.toGBK(request.getParameter(
							"sxncj").toString());
						String lxdh = DealString.toGBK(request.getParameter(
							"lxdh").toString());
						String jb = DealString.toGBK(request.getParameter(
						"jb"));
						colName1 = new String[] { "xh", "csny", "rxny",
								"jlxx", "radJthk", "hkrs", "jtyzsr",
								"jtrjsr", "jtsrly", "yzbm", "jtzz",
								"JTCY1_XM", "JTCY1_nl", "JTCY1_GX",
								"JTCY1_GZDZ", "JTCY2_XM", "JTCY2_nl",
								"JTCY2_GX", "JTCY2_GZDZ", "JTCY3_XM",
								"JTCY3_nl", "JTCY3_GX", "JTCY3_GZDZ",
								"JTCY4_XM", "JTCY4_nl", "JTCY4_GX",
								"JTCY4_GZDZ", "JTCY5_XM", "JTCY5_nl",
								"JTCY5_GX", "JTCY5_GZDZ", "sqly", "JZXJMC",
								"jzxjzwmc", "nd", "sxncj", "lxdh","jb" };

					valueForOut = new String[] { xh, csny, rxny, jlxx,
							radJthk, hkrs, jtyzsr, jtrjsr, jtsrly, yzbm,
							jtzz, JTCY1_XM, JTCY1_nl, JTCY1_GX, JTCY1_GZDZ,
							JTCY2_XM, JTCY2_nl, JTCY2_GX, JTCY2_GZDZ,
							JTCY3_XM, JTCY3_nl, JTCY3_GX, JTCY3_GZDZ,
							JTCY4_XM, JTCY4_nl, JTCY4_GX, JTCY4_GZDZ,
							JTCY5_XM, JTCY5_nl, JTCY5_GX, JTCY5_GZDZ, sqly,
							titName, jzxjmc, nd, sxncj, lxdh,jb };
					} else if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
						String xsjbqkjj = DealString.toGBK(request.getParameter(
							"xsjbqkjj").toString());
						colName1 = new String[] { "xh", "csny", "rxny",
								"jlxx", "radJthk", "hkrs", "jtyzsr",
								"jtrjsr", "jtsrly", "yzbm", "jtzz",
								"JTCY1_XM", "JTCY1_nl", "JTCY1_GX",
								"JTCY1_GZDZ", "JTCY2_XM", "JTCY2_nl",
								"JTCY2_GX", "JTCY2_GZDZ", "JTCY3_XM",
								"JTCY3_nl", "JTCY3_GX", "JTCY3_GZDZ",
								"JTCY4_XM", "JTCY4_nl", "JTCY4_GX",
								"JTCY4_GZDZ", "JTCY5_XM", "JTCY5_nl",
								"JTCY5_GX", "JTCY5_GZDZ", "sqly", "JZXJMC",
								"jzxjzwmc", "nd", "xsjbqkjj" };

					valueForOut = new String[] { xh, csny, rxny, jlxx,
							radJthk, hkrs, jtyzsr, jtrjsr, jtsrly, yzbm,
							jtzz, JTCY1_XM, JTCY1_nl, JTCY1_GX, JTCY1_GZDZ,
							JTCY2_XM, JTCY2_nl, JTCY2_GX, JTCY2_GZDZ,
							JTCY3_XM, JTCY3_nl, JTCY3_GX, JTCY3_GZDZ,
							JTCY4_XM, JTCY4_nl, JTCY4_GX, JTCY4_GZDZ,
							JTCY5_XM, JTCY5_nl, JTCY5_GX, JTCY5_GZDZ, sqly,
							titName, jzxjmc, nd, xsjbqkjj };
					} else {
						colName1 = new String[] { "xh", "csny", "rxny",
									"jlxx", "radJthk", "hkrs", "jtyzsr",
									"jtrjsr", "jtsrly", "yzbm", "jtzz",
									"JTCY1_XM", "JTCY1_nl", "JTCY1_GX",
									"JTCY1_GZDZ", "JTCY2_XM", "JTCY2_nl",
									"JTCY2_GX", "JTCY2_GZDZ", "JTCY3_XM",
									"JTCY3_nl", "JTCY3_GX", "JTCY3_GZDZ",
									"JTCY4_XM", "JTCY4_nl", "JTCY4_GX",
									"JTCY4_GZDZ", "JTCY5_XM", "JTCY5_nl",
									"JTCY5_GX", "JTCY5_GZDZ", "sqly", "JZXJMC",
									"jzxjzwmc", "nd" };

						valueForOut = new String[] { xh, csny, rxny, jlxx,
								radJthk, hkrs, jtyzsr, jtrjsr, jtsrly, yzbm,
								jtzz, JTCY1_XM, JTCY1_nl, JTCY1_GX, JTCY1_GZDZ,
								JTCY2_XM, JTCY2_nl, JTCY2_GX, JTCY2_GZDZ,
								JTCY3_XM, JTCY3_nl, JTCY3_GX, JTCY3_GZDZ,
								JTCY4_XM, JTCY4_nl, JTCY4_GX, JTCY4_GZDZ,
								JTCY5_XM, JTCY5_nl, JTCY5_GX, JTCY5_GZDZ, sqly,
								titName, jzxjmc, nd };
					}

					boolean ok = false;
					ok = StandardOperation.insert("xsjxjzxjsqb", colName1, valueForOut, request);
					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String csny = DealString.toGBK(request.getParameter("csny")
						.toString());
				String rxny = DealString.toGBK(request.getParameter("rxny")
						.toString());
				String jlxx = DealString.toGBK(
						request.getParameter("jlxx").toString());
				String radJthk = DealString.toGBK(request.getParameter(
				"radJthk").toString());
				String hkrs = DealString.toGBK(request.getParameter("hkrs")
						.toString());
				String jtyzsr = DealString.toGBK(request.getParameter("jtyzsr")
						.toString());
				String jtrjsr = DealString.toGBK(request.getParameter("jtrjsr")
						.toString());
				String jtsrly = DealString.toGBK(request.getParameter("jtsrly")
						.toString());
				String yzbm = DealString.toGBK(request.getParameter("yzbm")
						.toString());
				String jtzz = DealString.toGBK(
						request.getParameter("jtzz").toString());
				String JTCY1_XM = DealString.toGBK(request.getParameter(
				"JTCY1_XM").toString());
				String JTCY1_nl = DealString.toGBK(request.getParameter(
				"JTCY1_nl").toString());
				String JTCY1_GX = DealString.toGBK(request.getParameter(
				"JTCY1_GX").toString());
				String JTCY1_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY1_GZDZ").toString());
				String JTCY2_XM = DealString.toGBK(request.getParameter(
				"JTCY2_XM").toString());
				String JTCY2_nl = DealString.toGBK(request.getParameter(
				"JTCY2_nl").toString());
				String JTCY2_GX = DealString.toGBK(request.getParameter(
				"JTCY2_GX").toString());
				String JTCY2_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY2_GZDZ").toString());
				String JTCY3_XM = DealString.toGBK(request.getParameter(
				"JTCY3_XM").toString());
				String JTCY3_nl = DealString.toGBK(request.getParameter(
				"JTCY3_nl").toString());
				String JTCY3_GX = DealString.toGBK(request.getParameter(
				"JTCY3_GX").toString());
				String JTCY3_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY3_GZDZ").toString());
				String JTCY4_XM = DealString.toGBK(request.getParameter(
				"JTCY4_XM").toString());
				String JTCY4_nl = DealString.toGBK(request.getParameter(
				"JTCY4_nl").toString());
				String JTCY4_GX = DealString.toGBK(request.getParameter(
				"JTCY4_GX").toString());
				String JTCY4_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY4_GZDZ").toString());
				String JTCY5_XM = DealString.toGBK(request.getParameter(
				"JTCY5_XM").toString());
				String JTCY5_nl = DealString.toGBK(request.getParameter(
				"JTCY5_nl").toString());
				String JTCY5_GX = DealString.toGBK(request.getParameter(
				"JTCY5_GX").toString());
				String JTCY5_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY5_GZDZ").toString());
				String sqly = DealString.toGBK(
						request.getParameter("sqly").toString());

				if (titName.equalsIgnoreCase("gjjxj")) {
					jzxjmc = "国家奖学金";
				} else if (titName.equalsIgnoreCase("gjzxj")) {
					jzxjmc = "国家助学金";
				} else if (titName.equalsIgnoreCase("szfjxj")) {
					jzxjmc = "省(市)政府奖学金";
				} else if (titName.equalsIgnoreCase("szfzxj")) {
					jzxjmc = "省(市)政府助学金";
				} else if (titName.equalsIgnoreCase("gjlzjxj")) {
					jzxjmc = "国家励志奖学金";
				}
				String pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = xh + nd + titName;
				}
				sql = "select xxsh from xsjxjzxjsqb where lower(xh||nd||jzxjmc)=?";
				String[] temp = dao.getOneRs(sql, new String[] { pkVal }, new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("xsjxjzxjsqb", "lower(xh||nd||jzxjmc)", pkVal, request);


				String[] valueForOut;
				if (isJSXX) {
					String gkfs = DealString.toGBK(request.getParameter(
					"gkfs").toString());
					String bygz = DealString.toGBK(request.getParameter(
					"bygz").toString());
					String kc1_mc = DealString.toGBK(request.getParameter(
					"kc1_mc").toString());
					String kc1_cj = DealString.toGBK(request.getParameter(
					"kc1_cj").toString());
					String kc2_mc = DealString.toGBK(request.getParameter(
					"kc2_mc").toString());
					String kc2_cj = DealString.toGBK(request.getParameter(
					"kc2_cj").toString());
					String kc3_mc = DealString.toGBK(request.getParameter(
					"kc3_mc").toString());
					String kc3_cj = DealString.toGBK(request.getParameter(
					"kc3_cj").toString());
					String kc4_mc = DealString.toGBK(request.getParameter(
					"kc4_mc").toString());
					String kc4_cj = DealString.toGBK(request.getParameter(
					"kc4_cj").toString());
					String kc5_mc = DealString.toGBK(request.getParameter(
					"kc5_mc").toString());
					String kc5_cj = DealString.toGBK(request.getParameter(
					"kc5_cj").toString());
					String kc6_mc = DealString.toGBK(request.getParameter(
					"kc6_mc").toString());
					String kc6_cj = DealString.toGBK(request.getParameter(
					"kc6_cj").toString());
					String kc7_mc = DealString.toGBK(request.getParameter(
					"kc7_mc").toString());
					String kc7_cj = DealString.toGBK(request.getParameter(
					"kc7_cj").toString());
					String kc8_mc = DealString.toGBK(request.getParameter(
					"kc8_mc").toString());
					String kc8_cj = DealString.toGBK(request.getParameter(
					"kc8_cj").toString());
					String kc9_mc = DealString.toGBK(request.getParameter(
					"kc9_mc").toString());
					String kc9_cj = DealString.toGBK(request.getParameter(
					"kc9_cj").toString());
					String kc10_mc = DealString.toGBK(request.getParameter(
					"kc10_mc").toString());
					String kc10_cj = DealString.toGBK(request.getParameter(
					"kc10_cj").toString());
					String kc11_mc = DealString.toGBK(request.getParameter(
					"kc11_mc").toString());
					String kc11_cj = DealString.toGBK(request.getParameter(
					"kc11_cj").toString());
					String kc12_mc = DealString.toGBK(request.getParameter(
					"kc12_mc").toString());
					String kc12_cj = DealString.toGBK(request.getParameter(
					"kc12_cj").toString());

					colName1 = new String[] { "xh", "csny", "rxny",
								"jlxx", "radJthk", "hkrs", "jtyzsr",
								"jtrjsr", "jtsrly", "yzbm", "jtzz",
								"JTCY1_XM", "JTCY1_nl", "JTCY1_GX",
								"JTCY1_GZDZ", "JTCY2_XM", "JTCY2_nl",
								"JTCY2_GX", "JTCY2_GZDZ", "JTCY3_XM",
								"JTCY3_nl", "JTCY3_GX", "JTCY3_GZDZ",
								"JTCY4_XM", "JTCY4_nl", "JTCY4_GX",
								"JTCY4_GZDZ", "JTCY5_XM", "JTCY5_nl",
								"JTCY5_GX", "JTCY5_GZDZ", "sqly", "JZXJMC",
								"jzxjzwmc", "nd", "gkfs", "bygz", "kc1_mc",
								"kc1_cj", "kc2_mc", "kc2_cj", "kc3_mc",
								"kc3_cj", "kc4_mc", "kc4_cj", "kc5_mc",
								"kc5_cj", "kc6_mc", "kc6_cj", "kc7_mc",
								"kc7_cj", "kc8_mc", "kc8_cj", "kc9_mc",
								"kc9_cj", "kc10_mc", "kc10_cj", "kc11_mc",
								"kc11_cj", "kc12_mc", "kc12_cj" };

					valueForOut = new String[] { xh, csny, rxny, jlxx,
							radJthk, hkrs, jtyzsr, jtrjsr, jtsrly, yzbm,
							jtzz, JTCY1_XM, JTCY1_nl, JTCY1_GX, JTCY1_GZDZ,
							JTCY2_XM, JTCY2_nl, JTCY2_GX, JTCY2_GZDZ,
							JTCY3_XM, JTCY3_nl, JTCY3_GX, JTCY3_GZDZ,
							JTCY4_XM, JTCY4_nl, JTCY4_GX, JTCY4_GZDZ,
							JTCY5_XM, JTCY5_nl, JTCY5_GX, JTCY5_GZDZ, sqly,
							titName, jzxjmc, nd, gkfs, bygz, kc1_mc,
							kc1_cj, kc2_mc, kc2_cj, kc3_mc, kc3_cj, kc4_mc,
							kc4_cj, kc5_mc, kc5_cj, kc6_mc, kc6_cj, kc7_mc,
							kc7_cj, kc8_mc, kc8_cj, kc9_mc, kc9_cj,
							kc10_mc, kc10_cj, kc11_mc, kc11_cj, kc12_mc,
							kc12_cj };
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
					String sxncj = DealString.toGBK(request.getParameter(
						"sxncj").toString());
					String lxdh = DealString.toGBK(request.getParameter(
						"lxdh").toString());
					//============= luojw 2009/8/26 begin =================
					String jb = DealString.toGBK(request.getParameter(
					"jb"));
					colName1 = new String[] { "xh", "csny", "rxny",
							"jlxx", "radJthk", "hkrs", "jtyzsr",
							"jtrjsr", "jtsrly", "yzbm", "jtzz",
							"JTCY1_XM", "JTCY1_nl", "JTCY1_GX",
							"JTCY1_GZDZ", "JTCY2_XM", "JTCY2_nl",
							"JTCY2_GX", "JTCY2_GZDZ", "JTCY3_XM",
							"JTCY3_nl", "JTCY3_GX", "JTCY3_GZDZ",
							"JTCY4_XM", "JTCY4_nl", "JTCY4_GX",
							"JTCY4_GZDZ", "JTCY5_XM", "JTCY5_nl",
							"JTCY5_GX", "JTCY5_GZDZ", "sqly", "JZXJMC",
							"jzxjzwmc", "nd", "sxncj", "lxdh","jb" };

				valueForOut = new String[] { xh, csny, rxny, jlxx,
						radJthk, hkrs, jtyzsr, jtrjsr, jtsrly, yzbm,
						jtzz, JTCY1_XM, JTCY1_nl, JTCY1_GX, JTCY1_GZDZ,
						JTCY2_XM, JTCY2_nl, JTCY2_GX, JTCY2_GZDZ,
						JTCY3_XM, JTCY3_nl, JTCY3_GX, JTCY3_GZDZ,
						JTCY4_XM, JTCY4_nl, JTCY4_GX, JTCY4_GZDZ,
						JTCY5_XM, JTCY5_nl, JTCY5_GX, JTCY5_GZDZ, sqly,
						titName, jzxjmc, nd, sxncj, lxdh,jb };
				//============= luojw 2009/8/26 end =================
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
					String xsjbqkjj = DealString.toGBK(request.getParameter(
						"xsjbqkjj").toString());
					colName1 = new String[] { "xh", "csny", "rxny",
							"jlxx", "radJthk", "hkrs", "jtyzsr",
							"jtrjsr", "jtsrly", "yzbm", "jtzz",
							"JTCY1_XM", "JTCY1_nl", "JTCY1_GX",
							"JTCY1_GZDZ", "JTCY2_XM", "JTCY2_nl",
							"JTCY2_GX", "JTCY2_GZDZ", "JTCY3_XM",
							"JTCY3_nl", "JTCY3_GX", "JTCY3_GZDZ",
							"JTCY4_XM", "JTCY4_nl", "JTCY4_GX",
							"JTCY4_GZDZ", "JTCY5_XM", "JTCY5_nl",
							"JTCY5_GX", "JTCY5_GZDZ", "sqly", "JZXJMC",
							"jzxjzwmc", "nd", "xsjbqkjj" };

				valueForOut = new String[] { xh, csny, rxny, jlxx,
						radJthk, hkrs, jtyzsr, jtrjsr, jtsrly, yzbm,
						jtzz, JTCY1_XM, JTCY1_nl, JTCY1_GX, JTCY1_GZDZ,
						JTCY2_XM, JTCY2_nl, JTCY2_GX, JTCY2_GZDZ,
						JTCY3_XM, JTCY3_nl, JTCY3_GX, JTCY3_GZDZ,
						JTCY4_XM, JTCY4_nl, JTCY4_GX, JTCY4_GZDZ,
						JTCY5_XM, JTCY5_nl, JTCY5_GX, JTCY5_GZDZ, sqly,
						titName, jzxjmc, nd, xsjbqkjj };
				} else {
					colName1 = new String[] { "xh", "csny", "rxny",
								"jlxx", "radJthk", "hkrs", "jtyzsr",
								"jtrjsr", "jtsrly", "yzbm", "jtzz",
								"JTCY1_XM", "JTCY1_nl", "JTCY1_GX",
								"JTCY1_GZDZ", "JTCY2_XM", "JTCY2_nl",
								"JTCY2_GX", "JTCY2_GZDZ", "JTCY3_XM",
								"JTCY3_nl", "JTCY3_GX", "JTCY3_GZDZ",
								"JTCY4_XM", "JTCY4_nl", "JTCY4_GX",
								"JTCY4_GZDZ", "JTCY5_XM", "JTCY5_nl",
								"JTCY5_GX", "JTCY5_GZDZ", "sqly", "JZXJMC",
								"jzxjzwmc", "nd" };

					valueForOut = new String[] { xh, csny, rxny, jlxx,
							radJthk, hkrs, jtyzsr, jtrjsr, jtsrly, yzbm,
							jtzz, JTCY1_XM, JTCY1_nl, JTCY1_GX, JTCY1_GZDZ,
							JTCY2_XM, JTCY2_nl, JTCY2_GX, JTCY2_GZDZ,
							JTCY3_XM, JTCY3_nl, JTCY3_GX, JTCY3_GZDZ,
							JTCY4_XM, JTCY4_nl, JTCY4_GX, JTCY4_GZDZ,
							JTCY5_XM, JTCY5_nl, JTCY5_GX, JTCY5_GZDZ, sqly,
							titName, jzxjmc, nd };
				}

				boolean ok = false;
				ok = StandardOperation.insert("xsjxjzxjsqb", colName1, valueForOut, request);
				if (ok) {
					logMsg = "申请" + titName;
					Base.log(request, logMsg, sUName);
					request.setAttribute("ok", "ok");
				} else {
					request.setAttribute("ok", "no");
				}
			}
		}
		}

		String pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd + titName;
		}
//		============= luojw 2009/8/26 begin =================
		sql = "select xh,nd,csny,rxny,byny,lxdh,jzxjzwmc,xm,sfzh,xb,bjmc,xy,xmc,xydm,zydm,bjdm,nj,mzmc,zzmmmc,jb,kh,JTCY1_XM,JTCY1_NL,JTCY1_GX,JTCY1_GZDZ,JTCY2_XM,JTCY2_NL,JTCY2_GX,JTCY2_GZDZ,JTCY3_XM,JTCY3_NL,JTCY3_GX,JTCY3_GZDZ,JTCY4_XM,JTCY4_NL,JTCY4_GX,JTCY4_GZDZ,JTCY5_XM,JTCY5_NL,JTCY5_GX,JTCY5_GZDZ,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,jtzz,sqly,xyshyj,xxshyj,yzbm,radJthk,xxmc,xysh,xxsh,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdysh,fdyshyj,sxncj,xsjbqkjj "
			+ "from view_xsjxjzxjsq where lower(xh||nd||jzxjmc)=?";
		outString = new String[] { "xh", "nd", "csny", "rxny", "byny", "lxdh",
				"jzxjzwmc", "xm", "sfzh", "xb", "bjmc", "xy", "xmc", "xydm",
				"zydm", "bjdm", "nj", "mzmc", "zzmmmc", "kh", "JTCY1_XM",
				"JTCY1_nl", "JTCY1_GX", "JTCY1_GZDZ", "JTCY2_XM", "JTCY2_nl",
				"JTCY2_GX", "JTCY2_GZDZ", "JTCY3_XM", "JTCY3_nl", "JTCY3_GX",
				"JTCY3_GZDZ", "JTCY4_XM", "JTCY4_nl", "JTCY4_GX", "JTCY4_GZDZ",
				"JTCY5_XM", "JTCY5_nl", "JTCY5_GX", "JTCY5_GZDZ", "sfkns",
				"sqsj", "jzxjmc", "jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly",
				"jtzz", "sqly", "xyshyj", "xxshyj", "yzbm", "radJthk", "xxmc",
				"xysh", "xxsh", "gkfs", "bygz", "kc1_mc", "kc1_cj", "kc2_mc",
				"kc2_cj", "kc3_mc", "kc3_cj", "kc4_mc", "kc4_cj", "kc5_mc",
				"kc5_cj", "kc6_mc", "kc6_cj", "kc7_mc", "kc7_cj", "kc8_mc",
				"kc8_cj", "kc9_mc", "kc9_cj", "kc10_mc", "kc10_cj", "kc11_mc",
				"kc11_cj", "kc12_mc", "kc12_cj", "zzdjdm", "zzdjmc", "zzdjje",
				"xyshryhm", "xyshrxm", "xyzzfzryj", "fdysh", "fdyshyj",
				"sxncj", "xsjbqkjj","jb" };
//		============= luojw 2009/8/26 end =================
		outValue = dao.getOneRs(sql, new String[] { pkVal },
				outString);

		boolean isSHGC = false;
		boolean isKNS = false;
		if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
			isSHGC = true;
		}
		if (null == outValue) {
			if (isSHGC) {
				if (xh != null) {
					sql = "select a.*,(select b.kh from view_xsxxb b "
						+ "where a.xh=b.xh group by b.xh,b.kh) kh from "
						+ "(select v.xh,v.xm,v.xb,v.bjmc,"
						+ "v.xymc,q.MZMC mz,v.zymc xi,x.xxmc,v.jtfk,"
						+ "v.jtfkrs,v.jtyzsr,v.jtrjsr,v.jtsrly,v.yzbm,v.jtzz,"
						+ "v.jtcy1_xm,v.jtcy1_gx,v.jtcy1_nl,v.jtcy1_gzdw,"
						+ "v.jtcy2_xm,v.jtcy2_gx,v.jtcy2_nl,v.jtcy2_gzdw,"
						+ "v.jtcy3_xm,v.jtcy3_gx,v.jtcy3_nl,v.jtcy3_gzdw,"
						+ "v.jtcy4_xm,v.jtcy4_gx,v.jtcy4_nl,v.jtcy4_gzdw,"
						+ "v.jtcy5_xm,v.jtcy5_gx,v.jtcy5_nl,v.jtcy5_gzdw,"
						+ "(select j.rxny from bks_xsjbxx j where j.xh=v.xh) rxny,"
						+ "q.csrq csny from view_knsxx v,view_stu_details q,"
						+ "xtszb x where v.xh = q.xh and "
						+ "v.xxsh = '通过' "
						+ "and v.xh=?) a";
					String[] temp = new String[] { "xh", "xm", "xb", "bjmc",
							"xymc", "mz", "xi", "xxmc", "jtfk", "jtfkrs",
							"jtyzsr", "jtrjsr", "jtsrly", "yzbm", "jtzz",
							"jtcy1_xm", "jtcy1_gx", "jtcy1_nl", "jtcy1_gzdw",
							"jtcy2_xm", "jtcy2_gx", "jtcy2_nl", "jtcy2_gzdw",
							"jtcy3_xm", "jtcy3_gx", "jtcy3_nl", "jtcy3_gzdw",
							"jtcy4_xm", "jtcy4_gx", "jtcy4_nl", "jtcy4_gzdw",
							"jtcy5_xm", "jtcy5_gx", "jtcy5_nl", "jtcy5_gzdw",
							"rxny", "csny", "kh" };
					String[] outValT = dao.getOneRs(sql, new String[] { xh },
							temp);
					if (null == outValT) {

						sql = "select a.*,(select b.kh from view_xsxxb b "
							+ "where a.xh=b.xh group by b.xh,b.kh) kh from (select v.xh,v.xm,v.xb,v.bjmc,"
							+ "v.xymc,q.MZMC mz,v.zymc xi,x.xxmc,(select j.rxny from bks_xsjbxx j where v.xh=j.xh) rxny,q.csrq csny from "
							+ "view_xsjbxx v,view_stu_details q,xtszb x where "
							+ "v.xh = q.xh and v.xh=?) a";
						String[] colName = new String[] { "xh", "xm", "xb",
								"bjmc", "xymc", "mz", "xi", "xxmc", "rxny",
								"csny", "kh" };
						String[] outVal = dao.getOneRs(sql,
								new String[] { xh }, colName);
						if (null == outVal) {

						} else {
							colName = new String[] { "xh", "xm", "xb", "bjmc",
									"xy", "mzmc", "xmc", "xxmc", "rxny",
									"csny", "kh" };
							for (int i = 0; i < colName.length; i++) {
								if (null != outVal[i]) {
									map.put(colName[i], outVal[i]);
								} else {
									map.put(colName[i], "");
								}
							}
						}
					} else {
						isKNS = true;
						temp = new String[] { "xh", "xm", "xb", "bjmc", "xy",
								"mzmc", "xmc", "xxmc", "radJthk", "hkrs",
								"jtyzsr", "jtrjsr", "jtsrly", "yzbm", "jtzz",
								"JTCY1_XM", "JTCY1_GX", "JTCY1_nl",
								"JTCY1_GZDZ", "JTCY2_XM", "JTCY2_GX",
								"JTCY2_nl", "JTCY2_GZDZ", "JTCY3_XM",
								"JTCY3_GX", "JTCY3_nl", "JTCY3_GZDZ",
								"JTCY4_XM", "JTCY4_GX", "JTCY4_nl",
								"JTCY4_GZDZ", "JTCY5_XM", "JTCY5_GX",
								"JTCY5_nl", "JTCY5_GZDZ", "rxny", "csny", "kh" };
						for (int i = 0; i < temp.length; i++) {
							if (null != outValT[i]) {
								map.put(temp[i], outValT[i]);
							} else {
								map.put(temp[i], "");
							}
						}
					}
				}
			} else if(xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
				if (null != xh) {
					boolean bk = dao.isKns(xh);
					if (bk) {
						sql = "select a.*,(select b.kh from view_xsxxb b "
								+ "where a.xh=b.xh group by b.xh,b.kh) kh from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,"
								+ "q.MZMC mz,q.zzmmmc,q.sfzh,v.zymc xi,x.xxmc,(select j.rxny from bks_xsjbxx j where j.xh=v.xh) rxny,q.csrq csny from "
								+ "view_xsjbxx v,view_stu_details q,xtszb x where "
								+ "v.xh = q.xh and v.xh=?) a";
						String[] colName = new String[] { "xh", "xm", "xb",
								"bjmc", "xymc", "mz", "zzmmmc", "sfzh", "xi",
								"xxmc", "rxny", "csny", "kh" };
						String[] outVal = dao.getOneRs(sql,
								new String[] { xh }, colName);
						if (outVal == null) {

						} else {
							colName = new String[] { "xh", "xm", "xb", "bjmc",
									"xy", "mzmc", "zzmmmc", "sfzh", "xmc",
									"xxmc", "rxny", "csny", "kh" };
							for (int i = 0; i < colName.length; i++) {
								if (null != outVal[i]) {
									map.put(colName[i], outVal[i]);
								} else {
									map.put(colName[i], "");
								}
							}
						}
					}
				} else {
					request.setAttribute("kns", "no");
				}
			} else {
				if (null != xh) {
					sql = "select a.*,(select b.kh from view_xsxxb b "
						+ "where a.xh=b.xh group by b.xh,b.kh) kh from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,"
						+ "q.MZMC mz,q.zzmmmc,q.sfzh,v.zymc xi,x.xxmc,(select j.rxny from bks_xsjbxx j where j.xh=v.xh) rxny,q.csrq csny from "
						+ "view_xsjbxx v,view_stu_details q,xtszb x where "
						+ "v.xh = q.xh and v.xh=?) a";
					String[] colName = new String[] { "xh", "xm", "xb", "bjmc",
							"xymc", "mz", "zzmmmc", "sfzh", "xi", "xxmc", "rxny", "csny", "kh" };
					String[] outVal = dao.getOneRs(sql, new String[] { xh },
							colName);
					if (outVal == null) {

					} else {
						colName = new String[] { "xh", "xm", "xb", "bjmc",
								"xy", "mzmc", "zzmmmc", "sfzh", "xmc", "xxmc", "rxny", "csny", "kh" };
						for (int i = 0; i < colName.length; i++) {
							if (null != outVal[i]) {
								map.put(colName[i], outVal[i]);
							} else {
								map.put(colName[i], "");
							}
						}
					}
				}
			}
		} else {

			int len1 = outString.length;
			int len2 = outValue.length;
			int max = 0;
			if (len1 >= len2) {
				max = len2;
			} else {
				max = len1;
			}
			for (int i = 0; i < max; i++) {
				if (null != outValue[i]) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}

		if (isSHGC && isKNS) {
			request.setAttribute("isSHGCKNS", "is");
		} else {
			request.setAttribute("isSHGCKNS", "no");
		}
		if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)){
			request.setAttribute("jbList", dao.getJxjDj());
			request.setAttribute("isYNYS", "is");
		} else {
			request.setAttribute("isYNYS", "no");
		}
		if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)){
			request.setAttribute("isCSMZ", "is");
		} else {
			request.setAttribute("isCSMZ", "no");
		}
		request.setAttribute("rs", map);
		request.setAttribute("jxjlbType", jxjlbType);//奖助学金类别
		if (isJSXX) {
			return new ActionForward("/xszz/jsxx_xsjxjzxjsq.jsp", false);
		} else {
			return mapping.findForward("success");
		}
	}

	private ActionForward gjjzxjsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String titleName = request.getParameter("titName");
		String sqlb = "";

		String xxmc = ToolClass.getXxmc();
		String xxdm = StandardOperation.getXxdm();
		String jxjmc = "";
		boolean isJSXX = false;
		if (xxdm.equalsIgnoreCase(Globals.XXDM_JSXX)) {
			isJSXX = true;
		}
		if (titleName.equalsIgnoreCase("gjjxj")) {
			sqlb = "国家奖学金";
			jxjmc = "国家奖学金";
		} else {
			sqlb = "国家助学金";
			jxjmc = "国家助学金";
		}

		if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
			request.setAttribute("isZZSF", "is");
		} else {
			request.setAttribute("isZZSF", "no");
		}
		if (titleName.equalsIgnoreCase("gjjxj")) {
			request.setAttribute("isZXJ", "no");
		} else {
			request.setAttribute("isZXJ", "is");
		}

		String xh = DealString.toGBK(request.getParameter("xh"));
		String xm = DealString.toGBK(request.getParameter("xm"));
		String csny = DealString.toGBK(request.getParameter("csny"));
		String xb = DealString.toGBK(request.getParameter("xb"));
		String rxny = DealString.toGBK(request.getParameter("rxny"));
		String mzmc = DealString.toGBK(request.getParameter("mzmc"));
		xxmc = DealString.toGBK(request.getParameter("xxmc"));
		String xy = DealString.toGBK(request.getParameter("xy"));
		String xmc = DealString.toGBK(request.getParameter("xmc"));
		String bjmc = DealString.toGBK(request.getParameter("bjmc"));
		String jlxx = DealString.toGBK(request.getParameter("jlxx"));
		String radjthk = DealString.toGBK(request.getParameter("radJthk"));
		String hkrs = DealString.toGBK(request.getParameter("hkrs"));
		String jtyzsr = DealString.toGBK(request.getParameter("jtyzsr"));
		String jtrjsr = DealString.toGBK(request.getParameter("jtrjsr"));
		String jtsrly = DealString.toGBK(request.getParameter("jtsrly"));
		String yzbm = DealString.toGBK(request.getParameter("yzbm"));
		String jtzz = DealString.toGBK(request.getParameter("jtzz"));
		String jtcy1_xm = DealString.toGBK(request.getParameter("JTCY1_XM"));
		String jtcy1_nl = DealString.toGBK(request.getParameter("JTCY1_nl"));
		String jtcy1_gx = DealString.toGBK(request.getParameter("JTCY1_GX"));
		String jtcy1_gzdz = DealString
		.toGBK(request.getParameter("JTCY1_GZDZ"));
		String jtcy2_xm = DealString.toGBK(request.getParameter("JTCY2_XM"));
		String jtcy2_nl = DealString.toGBK(request.getParameter("JTCY2_nl"));
		String jtcy2_gx = DealString.toGBK(request.getParameter("JTCY2_GX"));
		String jtcy2_gzdz = DealString
		.toGBK(request.getParameter("JTCY2_GZDZ"));
		String jtcy3_xm = DealString.toGBK(request.getParameter("JTCY3_XM"));
		String jtcy3_nl = DealString.toGBK(request.getParameter("JTCY3_nl"));
		String jtcy3_gx = DealString.toGBK(request.getParameter("JTCY3_GX"));
		String jtcy3_gzdz = DealString
		.toGBK(request.getParameter("JTCY3_GZDZ"));
		String jtcy4_xm = DealString.toGBK(request.getParameter("JTCY4_XM"));
		String jtcy4_nl = DealString.toGBK(request.getParameter("JTCY4_nl"));
		String jtcy4_gx = DealString.toGBK(request.getParameter("JTCY4_GX"));
		String jtcy4_gzdz = DealString
		.toGBK(request.getParameter("JTCY4_GZDZ"));
		String jtcy5_xm = DealString.toGBK(request.getParameter("JTCY5_XM"));
		String jtcy5_nl = DealString.toGBK(request.getParameter("JTCY5_nl"));
		String jtcy5_gx = DealString.toGBK(request.getParameter("JTCY5_GX"));
		String jtcy5_gzdz = DealString
		.toGBK(request.getParameter("JTCY5_GZDZ"));
		String sqly = DealString.toGBK(request.getParameter("sqly"));
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue;
		String[] outString;
		if (isJSXX) {
			String gkfs = DealString.toGBK(request.getParameter("gkfs"));
			String bygz = DealString.toGBK(request.getParameter("bygz"));
			String kc1_mc = DealString.toGBK(request.getParameter("kc1_mc"));
			String kc1_cj = DealString.toGBK(request.getParameter("kc1_cj"));
			String kc2_mc = DealString.toGBK(request.getParameter("kc2_mc"));
			String kc2_cj = DealString.toGBK(request.getParameter("kc2_cj"));
			String kc3_mc = DealString.toGBK(request.getParameter("kc3_mc"));
			String kc3_cj = DealString.toGBK(request.getParameter("kc3_cj"));
			String kc4_mc = DealString.toGBK(request.getParameter("kc4_mc"));
			String kc4_cj = DealString.toGBK(request.getParameter("kc4_cj"));
			String kc5_mc = DealString.toGBK(request.getParameter("kc5_mc"));
			String kc5_cj = DealString.toGBK(request.getParameter("kc5_cj"));
			String kc6_mc = DealString.toGBK(request.getParameter("kc6_mc"));
			String kc6_cj = DealString.toGBK(request.getParameter("kc6_cj"));
			String kc7_mc = DealString.toGBK(request.getParameter("kc7_mc"));
			String kc7_cj = DealString.toGBK(request.getParameter("kc7_cj"));
			String kc8_mc = DealString.toGBK(request.getParameter("kc8_mc"));
			String kc8_cj = DealString.toGBK(request.getParameter("kc8_cj"));
			String kc9_mc = DealString.toGBK(request.getParameter("kc9_mc"));
			String kc9_cj = DealString.toGBK(request.getParameter("kc9_cj"));
			String kc10_mc = DealString.toGBK(request.getParameter("kc10_mc"));
			String kc10_cj = DealString.toGBK(request.getParameter("kc10_cj"));
			String kc11_mc = DealString.toGBK(request.getParameter("kc11_mc"));
			String kc11_cj = DealString.toGBK(request.getParameter("kc11_cj"));
			String kc12_mc = DealString.toGBK(request.getParameter("kc12_mc"));
			String kc12_cj = DealString.toGBK(request.getParameter("kc12_cj"));

			outValue = new String[] { xh, xm, rxny, xb, bjmc, xy, mzmc, xxmc,
					jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdz, jtcy2_xm,
					jtcy2_nl, jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_nl,
					jtcy3_gx, jtcy3_gzdz, jtcy4_xm, jtcy4_nl, jtcy4_gx,
					jtcy4_gzdz, jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_gzdz, jlxx,
					hkrs, jtyzsr, jtrjsr, jtsrly, jtzz, sqly, xyshyj, xxshyj,
					yzbm, radjthk, csny, xmc, gkfs, bygz, kc1_mc, kc1_cj,
					kc2_mc, kc2_cj, kc3_mc, kc3_cj, kc4_mc, kc4_cj, kc5_mc,
					kc5_cj, kc6_mc, kc6_cj, kc7_mc, kc7_cj, kc8_mc, kc8_cj,
					kc9_mc, kc9_cj, kc10_mc, kc10_cj, kc11_mc, kc11_cj,
					kc12_mc, kc12_cj, jxjmc };
			outString = new String[] { "xh", "xm", "rxny", "xb", "bjmc", "xy",
					"mzmc", "xxmc", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
					"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
					"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
					"jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
					"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
					"jtcy5_gzdz", "jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly",
					"jtzz", "sqly", "xyshyj", "xxshyj", "yzbm", "radjthk",
					"csny", "xmc", "gkfs", "bygz", "kc1_mc", "kc1_cj",
					"kc2_mc", "kc2_cj", "kc3_mc", "kc3_cj", "kc4_mc", "kc4_cj",
					"kc5_mc", "kc5_cj", "kc6_mc", "kc6_cj", "kc7_mc", "kc7_cj",
					"kc8_mc", "kc8_cj", "kc9_mc", "kc9_cj", "kc10_mc",
					"kc10_cj", "kc11_mc", "kc11_cj", "kc12_mc", "kc12_cj",
			"jxjmc" };
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
			DAO dao = DAO.getInstance();
			String lxdh = DealString.toGBK(request.getParameter("lxdh"));
			String sxncj = DealString.toGBK(request.getParameter("sxncj"));
			String zzmmmc = DealString.toGBK(request.getParameter("zzmmmc"));
			String sfzh = DealString.toGBK(request.getParameter("sfzh"));
			String jb = DealString.toGBK(request.getParameter("jb"));
			String jbmc = dao.getOneRs("select mc jbmc from ynys_zzdjb where dm =?", new String[]{jb}, "jbmc");
			outValue = new String[] { xh, xm, rxny, xb, bjmc, xy, mzmc, xxmc,
					jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdz, jtcy2_xm,
					jtcy2_nl, jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_nl,
					jtcy3_gx, jtcy3_gzdz, jtcy4_xm, jtcy4_nl, jtcy4_gx,
					jtcy4_gzdz, jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_gzdz, jlxx,
					hkrs, jtyzsr, jtrjsr, jtsrly, jtzz, sqly, xyshyj, xxshyj,
					yzbm, radjthk, csny, xmc, lxdh, sxncj, zzmmmc, sfzh,jbmc };
			outString = new String[] { "xh", "xm", "rxny", "xb", "bjmc", "xy",
					"mzmc", "xxmc", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
					"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
					"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
					"jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
					"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
					"jtcy5_gzdz", "jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly",
					"jtzz", "sqly", "xyshyj", "xxshyj", "yzbm", "radjthk",
					"csny", "xmc", "lxdh", "sxncj", "zzmmmc", "sfzh","jbmc" };
			request.setAttribute("isYNYS", "is");
		} else {
			outValue = new String[] { xh, xm, rxny, xb, bjmc, xy, mzmc, xxmc,
					jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdz, jtcy2_xm,
					jtcy2_nl, jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_nl,
					jtcy3_gx, jtcy3_gzdz, jtcy4_xm, jtcy4_nl, jtcy4_gx,
					jtcy4_gzdz, jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_gzdz, jlxx,
					hkrs, jtyzsr, jtrjsr, jtsrly, jtzz, sqly, xyshyj, xxshyj,
					yzbm, radjthk, csny, xmc };
			outString = new String[] { "xh", "xm", "rxny", "xb", "bjmc", "xy",
					"mzmc", "xxmc", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
					"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
					"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
					"jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
					"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
					"jtcy5_gzdz", "jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly",
					"jtzz", "sqly", "xyshyj", "xxshyj", "yzbm", "radjthk",
					"csny", "xmc" };
			request.setAttribute("isYNYS", "no");
		}
		// System.out.println(outString[35]+outValue[35]);
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				// System.out.println("i="+i+" "+outString[i]);
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		if (isJSXX) {
			return new ActionForward("/xszz/jsxx_gjjxjsqb.jsp", false);
		} else {
			return mapping.findForward("success");
		}
	}

	private ActionForward szfjzxjsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {

		String titName = request.getParameter("titName");
		String sqlb = "";

		String xxmc = ToolClass.getXxmc();
		String xxdm = StandardOperation.getXxdm();
		String jxjmc = "";
		if (titName.equalsIgnoreCase("szfjxj")) {
			sqlb = "省政府奖学金";
			jxjmc = "省政府奖学金";
		} else {
			sqlb = "省政府助学金";
			jxjmc = "省政府奖学金";
		}
		boolean isJSXX = false;
		if (xxdm.equalsIgnoreCase(Globals.XXDM_JSXX)) {
			isJSXX = true;
		}
		String xh = DealString.toGBK(request.getParameter("xh"));
		String xm = DealString.toGBK(request.getParameter("xm"));
		String csny = DealString.toGBK(request.getParameter("csny"));
		String xb = DealString.toGBK(request.getParameter("xb"));
		String rxny = DealString.toGBK(request.getParameter("rxny"));
		String mzmc = DealString.toGBK(request.getParameter("mzmc"));
		xxmc = DealString.toGBK(request.getParameter("xxmc"));
		String xy = DealString.toGBK(request.getParameter("xy"));
		String xmc = DealString.toGBK(request.getParameter("xmc"));
		String bjmc = DealString.toGBK(request.getParameter("bjmc"));
		String jlxx = DealString.toGBK(request.getParameter("jlxx"));
		String radjthk = DealString.toGBK(request.getParameter("radJthk"));
		String hkrs = DealString.toGBK(request.getParameter("hkrs"));
		String jtyzsr = DealString.toGBK(request.getParameter("jtyzsr"));
		String jtrjsr = DealString.toGBK(request.getParameter("jtrjsr"));
		String jtsrly = DealString.toGBK(request.getParameter("jtsrly"));
		String yzbm = DealString.toGBK(request.getParameter("yzbm"));
		String jtzz = DealString.toGBK(request.getParameter("jtzz"));
		String jtcy1_xm = DealString.toGBK(request.getParameter("JTCY1_XM"));
		String jtcy1_nl = DealString.toGBK(request.getParameter("JTCY1_nl"));
		String jtcy1_gx = DealString.toGBK(request.getParameter("JTCY1_GX"));
		String jtcy1_gzdz = DealString
		.toGBK(request.getParameter("JTCY1_GZDZ"));
		String jtcy2_xm = DealString.toGBK(request.getParameter("JTCY2_XM"));
		String jtcy2_nl = DealString.toGBK(request.getParameter("JTCY2_nl"));
		String jtcy2_gx = DealString.toGBK(request.getParameter("JTCY2_GX"));
		String jtcy2_gzdz = DealString
		.toGBK(request.getParameter("JTCY2_GZDZ"));
		String jtcy3_xm = DealString.toGBK(request.getParameter("JTCY3_XM"));
		String jtcy3_nl = DealString.toGBK(request.getParameter("JTCY3_nl"));
		String jtcy3_gx = DealString.toGBK(request.getParameter("JTCY3_GX"));
		String jtcy3_gzdz = DealString
		.toGBK(request.getParameter("JTCY3_GZDZ"));
		String jtcy4_xm = DealString.toGBK(request.getParameter("JTCY4_XM"));
		String jtcy4_nl = DealString.toGBK(request.getParameter("JTCY4_nl"));
		String jtcy4_gx = DealString.toGBK(request.getParameter("JTCY4_GX"));
		String jtcy4_gzdz = DealString
		.toGBK(request.getParameter("JTCY4_GZDZ"));
		String jtcy5_xm = DealString.toGBK(request.getParameter("JTCY5_XM"));
		String jtcy5_nl = DealString.toGBK(request.getParameter("JTCY5_nl"));
		String jtcy5_gx = DealString.toGBK(request.getParameter("JTCY5_GX"));
		String jtcy5_gzdz = DealString
		.toGBK(request.getParameter("JTCY5_GZDZ"));
		String sqly = DealString.toGBK(request.getParameter("sqly"));
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue;
		String[] outString;
		if (isJSXX) {
			String gkfs = DealString.toGBK(request.getParameter("gkfs"));
			String bygz = DealString.toGBK(request.getParameter("bygz"));
			String kc1_mc = DealString.toGBK(request.getParameter("kc1_mc"));
			String kc1_cj = DealString.toGBK(request.getParameter("kc1_cj"));
			String kc2_mc = DealString.toGBK(request.getParameter("kc2_mc"));
			String kc2_cj = DealString.toGBK(request.getParameter("kc2_cj"));
			String kc3_mc = DealString.toGBK(request.getParameter("kc3_mc"));
			String kc3_cj = DealString.toGBK(request.getParameter("kc3_cj"));
			String kc4_mc = DealString.toGBK(request.getParameter("kc4_mc"));
			String kc4_cj = DealString.toGBK(request.getParameter("kc4_cj"));
			String kc5_mc = DealString.toGBK(request.getParameter("kc5_mc"));
			String kc5_cj = DealString.toGBK(request.getParameter("kc5_cj"));
			String kc6_mc = DealString.toGBK(request.getParameter("kc6_mc"));
			String kc6_cj = DealString.toGBK(request.getParameter("kc6_cj"));
			String kc7_mc = DealString.toGBK(request.getParameter("kc7_mc"));
			String kc7_cj = DealString.toGBK(request.getParameter("kc7_cj"));
			String kc8_mc = DealString.toGBK(request.getParameter("kc8_mc"));
			String kc8_cj = DealString.toGBK(request.getParameter("kc8_cj"));
			String kc9_mc = DealString.toGBK(request.getParameter("kc9_mc"));
			String kc9_cj = DealString.toGBK(request.getParameter("kc9_cj"));
			String kc10_mc = DealString.toGBK(request.getParameter("kc10_mc"));
			String kc10_cj = DealString.toGBK(request.getParameter("kc10_cj"));
			String kc11_mc = DealString.toGBK(request.getParameter("kc11_mc"));
			String kc11_cj = DealString.toGBK(request.getParameter("kc11_cj"));
			String kc12_mc = DealString.toGBK(request.getParameter("kc12_mc"));
			String kc12_cj = DealString.toGBK(request.getParameter("kc12_cj"));

			outValue = new String[] { xh, xm, rxny, xb, bjmc, xy, mzmc, xxmc,
					jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdz, jtcy2_xm,
					jtcy2_nl, jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_nl,
					jtcy3_gx, jtcy3_gzdz, jtcy4_xm, jtcy4_nl, jtcy4_gx,
					jtcy4_gzdz, jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_gzdz, jlxx,
					hkrs, jtyzsr, jtrjsr, jtsrly, jtzz, sqly, xyshyj, xxshyj,
					yzbm, radjthk, csny, xmc, gkfs, bygz, kc1_mc, kc1_cj,
					kc2_mc, kc2_cj, kc3_mc, kc3_cj, kc4_mc, kc4_cj, kc5_mc,
					kc5_cj, kc6_mc, kc6_cj, kc7_mc, kc7_cj, kc8_mc, kc8_cj,
					kc9_mc, kc9_cj, kc10_mc, kc10_cj, kc11_mc, kc11_cj,
					kc12_mc, kc12_cj, jxjmc };
			outString = new String[] { "xh", "xm", "rxny", "xb", "bjmc", "xy",
					"mzmc", "xxmc", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
					"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
					"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
					"jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
					"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
					"jtcy5_gzdz", "jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly",
					"jtzz", "sqly", "xyshyj", "xxshyj", "yzbm", "radjthk",
					"csny", "xmc", "gkfs", "bygz", "kc1_mc", "kc1_cj",
					"kc2_mc", "kc2_cj", "kc3_mc", "kc3_cj", "kc4_mc", "kc4_cj",
					"kc5_mc", "kc5_cj", "kc6_mc", "kc6_cj", "kc7_mc", "kc7_cj",
					"kc8_mc", "kc8_cj", "kc9_mc", "kc9_cj", "kc10_mc",
					"kc10_cj", "kc11_mc", "kc11_cj", "kc12_mc", "kc12_cj",
			"jxjmc" };
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
			String lxdh = DealString.toGBK(request.getParameter("lxdh"));
			String sxncj = DealString.toGBK(request.getParameter("sxncj"));
			String sfzh = DealString.toGBK(request.getParameter("sfzh"));
			String zzmmmc = DealString.toGBK(request.getParameter("zzmmmc"));
			outValue = new String[] { xh, xm, rxny, xb, bjmc, xy, mzmc, xxmc,
					jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdz, jtcy2_xm,
					jtcy2_nl, jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_nl,
					jtcy3_gx, jtcy3_gzdz, jtcy4_xm, jtcy4_nl, jtcy4_gx,
					jtcy4_gzdz, jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_gzdz, jlxx,
					hkrs, jtyzsr, jtrjsr, jtsrly, jtzz, sqly, xyshyj, xxshyj,
					yzbm, radjthk, csny, xmc, lxdh, sxncj, sfzh, zzmmmc };
			outString = new String[] { "xh", "xm", "rxny", "xb", "bjmc", "xy",
					"mzmc", "xxmc", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
					"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
					"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
					"jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
					"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
					"jtcy5_gzdz", "jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly",
					"jtzz", "sqly", "xyshyj", "xxshyj", "yzbm", "radjthk",
					"csny", "xmc", "lxdh", "sxncj", "sfzh", "zzmmmc" };
			request.setAttribute("isYNYS", "is");
		} else {
			outValue = new String[] { xh, xm, rxny, xb, bjmc, xy, mzmc, xxmc,
					jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdz, jtcy2_xm,
					jtcy2_nl, jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_nl,
					jtcy3_gx, jtcy3_gzdz, jtcy4_xm, jtcy4_nl, jtcy4_gx,
					jtcy4_gzdz, jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_gzdz, jlxx,
					hkrs, jtyzsr, jtrjsr, jtsrly, jtzz, sqly, xyshyj, xxshyj,
					yzbm, radjthk, csny, xmc };
			outString = new String[] { "xh", "xm", "rxny", "xb", "bjmc", "xy",
					"mzmc", "xxmc", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
					"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
					"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
					"jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
					"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
					"jtcy5_gzdz", "jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly",
					"jtzz", "sqly", "xyshyj", "xxshyj", "yzbm", "radjthk",
					"csny", "xmc" };
			request.setAttribute("isYNYS", "no");
		}

		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !outValue[i].equals("")) {
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		if (isJSXX) {
			return new ActionForward("/xszz/jsxx_gjjxjsqb.jsp", false);
		} else {
			return mapping.findForward("success");
		}
	}

	private ActionForward xpjjSq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response, int power)
	throws Exception {
		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String titName = "XPJJZXDKSQB";
		String doType = request.getParameter("doType");// 操作类型
		HashMap<String, String> map = new HashMap<String, String>();
		String sql = "";
		request.setAttribute("titName", titName);
		String[] colName1 = null;
		sql = "select dqnd nd from xtszb";
		String nd = Base.currNd;
		String xh = "";
		boolean sfksq = true;
		String pkVal = "";

		if (userType != "stu") {
			xh = xszzForm.getXh();
		} else if (userType == "stu") {
			xh = sUName;
		}

		if (xh != null && (!xh.equalsIgnoreCase(""))) {
			sql = "select to_char(sysdate,'yyyymmddhh24miss') rithtNow from dual";
			String rightNow = dao.getOneRs(sql, new String[] {},
					new String[] { "rithtNow" })[0];
			sql = "select xpjjdksqkssj,xpjjdksqjssj from xszhsjb a where "
				+ "exists(select 1 from view_xsjbxx b where a.zydm=b.xydm and b.xh=?)";
			String[] deadline = dao.getOneRs(sql, new String[] { xh },
					new String[] { "xpjjdksqkssj", "xpjjdksqjssj" });
			if (deadline[0].compareToIgnoreCase(rightNow) < 0
					&& deadline[1].compareToIgnoreCase(rightNow) > 0) {
				if (doType != null && doType.equalsIgnoreCase("save")) {
					String csrq = DealString
					.toGBK(request.getParameter("csrq"));
					String sqdkje = DealString.toGBK(request
							.getParameter("sqdkje"));
					String dkqx = DealString
					.toGBK(request.getParameter("dkqx"));
					String szzq = DealString
					.toGBK(request.getParameter("szzq"));
					String sxq = DealString.toGBK(request.getParameter("sxq"));
					String yzbm = DealString
					.toGBK(request.getParameter("yzbm"));
					String jtdh = DealString
					.toGBK(request.getParameter("jtdh"));
					String jhr1_xm = DealString.toGBK(request
							.getParameter("jhr1_xm"));
					String jhr1_zy = DealString.toGBK(request
							.getParameter("jhr1_zy"));
					String jhr1_sfzh = DealString.toGBK(request
							.getParameter("jhr1_sfzh"));
					String jhr1_gzdw = DealString.toGBK(request
							.getParameter("jhr1_gzdw"));
					String jhr2_xm = DealString.toGBK(request
							.getParameter("jhr2_xm"));
					String jhr2_zy = DealString.toGBK(request
							.getParameter("jhr2_zy"));
					String jhr2_sfzh = DealString.toGBK(request
							.getParameter("jhr2_sfzh"));
					String jhr2_gzdw = DealString.toGBK(request
							.getParameter("jhr2_gzdw"));
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}

					sql = "select xxsh from XPJJZXDKSQB where xh||nd=? ";
					String[] tempt = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xxsh" });
					if ((tempt != null)
							&& ("通过".equalsIgnoreCase(tempt[0]) || "已通过"
									.equalsIgnoreCase(tempt[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("XPJJZXDKSQB", "xh||nd", pkVal, request);

						colName1 = new String[] { "xh", "csrq", "sqdkje",
								"dkqx", "szzq", "sxq", "yzbm", "jtdh",
								"jhr1_xm", "jhr1_zy", "jhr1_sfzh", "jhr1_gzdw",
								"jhr2_xm", "jhr2_zy", "jhr2_sfzh", "jhr2_gzdw",
								"nd" };
						String[] input = new String[] { xh, csrq, sqdkje, dkqx,
								szzq, sxq, yzbm, jtdh, jhr1_xm, jhr1_zy,
								jhr1_sfzh, jhr1_gzdw, jhr2_xm, jhr2_zy,
								jhr2_sfzh, jhr2_gzdw, nd };
						boolean doresult = StandardOperation.insert(
								"XPJJZXDKSQB", colName1, input, request);

						if (doresult) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("doresult", "yes");
						} else {
							request.setAttribute("doresult", "no");
						}
					}
				}
			} else {
				sfksq = false;
			}
		}
		request.setAttribute("sfksq", sfksq);

		sql = "select * from view_xpjjzxdksq ";// +" where xh=? and nd=? ";
		String[] outString = dao.getColumnName(sql + " where 1=2 ");
		String[] outValue = dao.getOneRs(sql + " where xh||nd=? ",
				new String[] { pkVal }, outString);

		if (outValue == null) {
			if (xh != null) {
				sql = "select v.xh,v.xm,v.xb,x.sfzh,v.nj,v.xy,v.zymc,v.qsdh,v.xz,q.csrq "
					+ "from bks_xsjbxx x,VIEW_XSJBXX v,view_stu_details q ";// + "
				// where
				// x.xh = v.xh
				// and v.xh=?";
				String[] colName = dao.getColumnName(sql + " where 1=2 ");
				String[] outVal = dao.getOneRs(sql
						+ " where x.xh = v.xh and q.xh = x.xh and v.xh=?",
						new String[] { xh }, colName);
				if (outVal != null) {
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i].toLowerCase(), outVal[i]);
						} else {
							map.put(colName[i].toLowerCase(), "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i].toLowerCase(), outValue[i]);
				} else {
					map.put(outString[i].toLowerCase(), "");
				}
			}
		}

		request.setAttribute("rs", map);
		return mapping.findForward("success");

	}

	private ActionForward xpjjdksqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {

		DAO dao = DAO.getInstance();
		HashMap<String, String> map = new HashMap<String, String>();
		String xh = DealString.toGBK(request.getParameter("xh"));
		String xm = DealString.toGBK(request.getParameter("xm"));
		String xb = DealString.toGBK(request.getParameter("xb"));
		String csrq = DealString.toGBK(request.getParameter("csrq"));
		String sfzh = DealString.toGBK(request.getParameter("sfzh"));
		String nj = DealString.toGBK(request.getParameter("nj"));
		String xy = DealString.toGBK(request.getParameter("xy"));
		String zymc = DealString.toGBK(request.getParameter("zymc"));
		String qsdh = DealString.toGBK(request.getParameter("qsdh"));
		String xz = DealString.toGBK(request.getParameter("xz"));
		String sqdkje = DealString.toGBK(request.getParameter("sqdkje"));
		String dkqx = DealString.toGBK(request.getParameter("dkqx"));
		String szzq = DealString.toGBK(request.getParameter("szzq"));
		String sxq = DealString.toGBK(request.getParameter("sxq"));
		String yzbm = DealString.toGBK(request.getParameter("yzbm"));
		String jtdh = DealString.toGBK(request.getParameter("jtdh"));
		String jhr1_xm = DealString.toGBK(request.getParameter("jhr1_xm"));
		String jhr1_zy = DealString.toGBK(request.getParameter("jhr1_zy"));
		String jhr1_sfzh = DealString.toGBK(request.getParameter("jhr1_sfzh"));
		String jhr1_gzdw = DealString.toGBK(request.getParameter("jhr1_gzdw"));
		String jhr2_xm = DealString.toGBK(request.getParameter("jhr2_xm"));
		String jhr2_zy = DealString.toGBK(request.getParameter("jhr2_zy"));
		String jhr2_sfzh = DealString.toGBK(request.getParameter("jhr2_sfzh"));
		String jhr2_gzdw = DealString.toGBK(request.getParameter("jhr2_gzdw"));

		String[] outValue = { xh, xm, xb, csrq, sfzh, nj, xy, zymc, qsdh, xz,
				sqdkje, dkqx, szzq, sxq, yzbm, jtdh, jhr1_xm, jhr1_zy,
				jhr1_sfzh, jhr1_gzdw, jhr2_xm, jhr2_zy, jhr2_sfzh, jhr2_gzdw };
		String[] outString = { "xh", "xm", "xb", "csrq", "sfzh", "nj", "xy",
				"zymc", "qsdh", "xz", "sqdkje", "dkqx", "szzq", "sxq", "yzbm",
				"jtdh", "jhr1_xm", "jhr1_zy", "jhr1_sfzh", "jhr1_gzdw",
				"jhr2_xm", "jhr2_zy", "jhr2_sfzh", "jhr2_gzdw" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null) {
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		String xxmc = dao.getOneRs("select xxmc from xtszb where rownum=1",
				new String[] {}, new String[] { "xxmc" })[0];
		map.put("xxmc", xxmc);
		request.setAttribute("xb", xb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");

	}

	private ActionForward xfbzSq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {// //学费补助申请

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm zzForm = (XszzForm) form;
		HashMap<String, String> map = new HashMap<String, String>();
		String doType = request.getParameter("doType");// 操作方式
		String tips = "当前所在位置：学生资助 - 申请 - 学费补助";
		boolean ksq = true;
		String sql = "";
		sql = "select dqnd nd from xtszb";
		String nd = Base.currNd;// 获得当前年度
		String bzdm = "0000000001";
		String pkVal = "";
		String[] colName1 = null;		
		// String bzdm = dao.getOneRs(
		// "select knbzdm from knbzdmb where knbzmc like '学费%'",
		// new String[] {}, new String[] { "knbzdm" })[0];

		String xn = Base.currXn;
		request.setAttribute("tips", tips);
		String xh = "";
		if (userType != "stu") {
			xh = zzForm.getXh();
		} else if (userType == "stu") {
			xh = sUName;
		}
		if (xh != null && (!xh.equalsIgnoreCase(""))) {
			sql = "select to_char(sysdate,'yyyy-mm-dd') rithtNow from dual";
			String rightNow = dao.getOneRs(sql, new String[] {},
					new String[] { "rithtNow" })[0];
			String[] jxjksjssj = null;

			sql = "select a.kssj,a.jssj from NBLG_SJB a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='学费补助' and b.xh=? ";
			jxjksjssj = dao.getOneRs(sql, new String[] { xh }, new String[] {
					"kssj", "jssj" });
			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
				if (doType != null && doType.equalsIgnoreCase("save")) {
					String bysj = DealString
					.toGBK(request.getParameter("bysj"));
					String jtdz = DealString
					.toGBK(request.getParameter("jtdz"));
					String yzbm = DealString
					.toGBK(request.getParameter("yzbm"));
					String jtcy1_xm = DealString.toGBK(request
							.getParameter("jtcy1_xm"));
					String jtcy1_gx = DealString.toGBK(request
							.getParameter("jtcy1_gx"));
					String jtcy1_gzdw = DealString.toGBK(request
							.getParameter("jtcy1_gzdw"));
					String jtcy1_ysr = DealString.toGBK(request
							.getParameter("jtcy1_ysr"));
					String jtcy2_xm = DealString.toGBK(request
							.getParameter("jtcy2_xm"));
					String jtcy2_gx = DealString.toGBK(request
							.getParameter("jtcy2_gx"));
					String jtcy2_gzdw = DealString.toGBK(request
							.getParameter("jtcy2_gzdw"));
					String jtcy2_ysr = DealString.toGBK(request
							.getParameter("jtcy2_ysr"));
					String jtcy3_xm = DealString.toGBK(request
							.getParameter("jtcy3_xm"));
					String jtcy3_gx = DealString.toGBK(request
							.getParameter("jtcy3_gx"));
					String jtcy3_gzdw = DealString.toGBK(request
							.getParameter("jtcy3_gzdw"));
					String jtcy3_ysr = DealString.toGBK(request
							.getParameter("jtcy3_ysr"));
					String jtcy4_xm = DealString.toGBK(request
							.getParameter("jtcy4_xm"));
					String jtcy4_gx = DealString.toGBK(request
							.getParameter("jtcy4_gx"));
					String jtcy4_gzdw = DealString.toGBK(request
							.getParameter("jtcy4_gzdw"));
					String jtcy4_ysr = DealString.toGBK(request
							.getParameter("jtcy4_ysr"));
					String jtcy5_xm = DealString.toGBK(request
							.getParameter("jtcy5_xm"));
					String jtcy5_gx = DealString.toGBK(request
							.getParameter("jtcy5_gx"));
					String jtcy5_gzdw = DealString.toGBK(request
							.getParameter("jtcy5_gzdw"));
					String jtcy5_ysr = DealString.toGBK(request
							.getParameter("jtcy5_ysr"));
					String jttgje = DealString.toGBK(request
							.getParameter("jttgje"));
					String zxje = DealString
					.toGBK(request.getParameter("zxje"));
					String jxje = DealString
					.toGBK(request.getParameter("jxje"));
					String qgzxje = DealString.toGBK(request
							.getParameter("qgzxje"));
					String xnwxdkje = DealString.toGBK(request
							.getParameter("xnwxdkje"));
					String qtsrje = DealString.toGBK(request
							.getParameter("qtsrje"));
					String zxdkje = DealString.toGBK(request
							.getParameter("zxdkje"));
					String zxdksj = DealString.toGBK(request
							.getParameter("zxdksj"));
					String yffzxdkje = DealString.toGBK(request
							.getParameter("yffzxdkje"));
					String yffzxdksj = DealString.toGBK(request
							.getParameter("yffzxdksj"));
					String sqzzly = DealString.toGBK(request.getParameter(
					"sqzzly"));
					String zzff1 = DealString.toGBK(request
							.getParameter("zzff1"));
					String zzff1qsje = DealString.toGBK(request
							.getParameter("zzff1qsje"));
					String zzff1jsje = DealString.toGBK(request
							.getParameter("zzff1jsje"));
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + bzdm + nd;
					}
					sql = "select xxsh from xsbzb where xh||bzdm||nd=?";
					String[] tempt = dao.getOneRs(sql, new String[] { pkVal }, new String[] { "xxsh" });
					if ((tempt != null)
							&& ("通过".equalsIgnoreCase(tempt[0]) || "已通过"
									.equalsIgnoreCase(tempt[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("xsbzb", "xh||bzdm||nd", pkVal, request);
						colName1 = new String[] { "bzdm", "bzmc", "xn", "nd",
								"xh", "bysj", "jtdz", "yzbm", "jtcy1_xm",
								"jtcy1_gx", "jtcy1_gzdw", "jtcy1_ysr",
								"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw",
								"jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
								"jtcy3_gzdw", "jtcy3_ysr", "jtcy4_xm",
								"jtcy4_gx", "jtcy4_gzdw", "jtcy4_ysr",
								"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw",
								"jtcy5_ysr", "jttgje", "zxje", "jxje",
								"qgzxje", "xnwxdkje", "qtsrje", "zxdkje",
								"zxdksj", "yffzxdkje", "yffzxdksj", "sqzzly",
								"zzff1", "zzff1qsje", "zzff1jsje" };
						String[] input = new String[] { bzdm, "学费补助", xn, nd,
								xh, bysj, jtdz, yzbm, jtcy1_xm, jtcy1_gx,
								jtcy1_gzdw, jtcy1_ysr, jtcy2_xm, jtcy2_gx,
								jtcy2_gzdw, jtcy2_ysr, jtcy3_xm, jtcy3_gx,
								jtcy3_gzdw, jtcy3_ysr, jtcy4_xm, jtcy4_gx,
								jtcy4_gzdw, jtcy4_ysr, jtcy5_xm, jtcy5_gx,
								jtcy5_gzdw, jtcy5_ysr, jttgje, zxje, jxje,
								qgzxje, xnwxdkje, qtsrje, zxdkje, zxdksj,
								yffzxdkje, yffzxdksj, sqzzly, zzff1, zzff1qsje,
								zzff1jsje };
						boolean ok = StandardOperation.insert("xsbzb",
								colName1, input, request);
						if (ok) {
							logMsg = "申请 xsbzb-学费补助";
							Base.log(request, logMsg, sUName);
							request.setAttribute("doresult", "yes");
						} else {
							request.setAttribute("doresult", "no");
						}
					}
				}
			} else {
				ksq = false;
			}
		}
		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + bzdm + nd;
		}
		request.setAttribute("sfksq", ksq);
		sql = "select * from view_xsbzxx ";// +" where xh=? and nd=? ";
		String[] outString = dao.getColumnName(sql + " where 1=2 ");
		String[] outValue = dao.getOneRs(sql
				+ " where xh||bzdm||nd=? ", new String[] { pkVal }, outString);
		if (outValue == null) {
			if (xh != null) {
				sql = "select v.xh,v.xm,v.xb,q.mzmc,v.sfzh,"
					+ "v.zymc||v.nj zynj,v.ssbh qsh,v.qsdh,v.sfzh "
					+ "from view_stu_details q,VIEW_XSJBXX v ";// +"
				// where
				// x.xh
				// =
				// v.xh;";
				String[] colName = dao.getColumnName(sql + " where 1=2 ");
				String[] outVal = dao
				.getOneRs(
						sql
						+ " where q.xh = v.xh and v.xh=?",
						new String[] { xh }, colName);
				if (outVal != null) {
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i].toLowerCase(), outVal[i]);
						} else {
							map.put(colName[i].toLowerCase(), "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i].toLowerCase(), outValue[i]);
				} else {
					map.put(outString[i].toLowerCase(), "");
				}
			}
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward knbzSq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {// /困难补助申请

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		String doType = request.getParameter("doType");
		String bzlb = request.getParameter("bzlb");
		XszzForm zzForm = (XszzForm) form;
		String tips = "当前所在位置：学生资助 - 申请 - 困难补助";
		request.setAttribute("tips", tips);
		String[] colName1 = null;
		boolean ksq = true;
		String sql = "";
		String pkVal = "";
		sql = "select dqnd nd from xtszb";
		String nd = Base.currNd;// 获得当前年度

		if (bzlb == null || bzlb.equalsIgnoreCase(" ")) {
			bzlb = "lsknbz";
		}

		String bzdm = dao.getOneRs(
				"select knbzdm from knbzdmb where knbzmc like '临时%'",
				new String[] {}, new String[] { "knbzdm" })[0];
		String bzmc = "临时困难补助";

		HashMap<String, String> map = new HashMap<String, String>();
		String xh = "";
		if (userType != "stu") {
			xh = zzForm.getXh();
		} else if (userType == "stu") {
			xh = sUName;
		}
		if (xh != null && (!xh.equalsIgnoreCase(""))) {
			sql = "select to_char(sysdate,'yyyymmddhh24miss') rithtNow from dual";
			String rightNow = dao.getOneRs(sql, new String[] {},
					new String[] { "rithtNow" })[0];
			sql = "select XXKNBZSQKSSJ,XXKNBZSQJSSJ from xszhsjb a where "
				+ "exists(select 1 from view_xsjbxx b where a.zydm=b.xydm and b.xh=?)";
			String[] knbzksjssj = dao.getOneRs(sql, new String[] { xh },
					new String[] { "XXKNBZSQKSSJ", "XXKNBZSQJSSJ" });
			if (knbzksjssj[0].compareToIgnoreCase(rightNow) < 0
					&& knbzksjssj[1].compareToIgnoreCase(rightNow) > 0) {
				if (doType != null && doType.equalsIgnoreCase("save")) {
					String xn = Base.currXn;

					String bysj = DealString
					.toGBK(request.getParameter("bysj"));
					String jtdz = DealString
					.toGBK(request.getParameter("jtdz"));
					String yzbm = DealString
					.toGBK(request.getParameter("yzbm"));
					String jtcy1_xm = DealString.toGBK(request
							.getParameter("jtcy1_xm"));
					String jtcy1_gx = DealString.toGBK(request
							.getParameter("jtcy1_gx"));
					String jtcy1_gzdw = DealString.toGBK(request
							.getParameter("jtcy1_gzdw"));
					String jtcy1_ysr = DealString.toGBK(request
							.getParameter("jtcy1_ysr"));
					String jtcy2_xm = DealString.toGBK(request
							.getParameter("jtcy2_xm"));
					String jtcy2_gx = DealString.toGBK(request
							.getParameter("jtcy2_gx"));
					String jtcy2_gzdw = DealString.toGBK(request
							.getParameter("jtcy2_gzdw"));
					String jtcy2_ysr = DealString.toGBK(request
							.getParameter("jtcy2_ysr"));
					String jtcy3_xm = DealString.toGBK(request
							.getParameter("jtcy3_xm"));
					String jtcy3_gx = DealString.toGBK(request
							.getParameter("jtcy3_gx"));
					String jtcy3_gzdw = DealString.toGBK(request
							.getParameter("jtcy3_gzdw"));
					String jtcy3_ysr = DealString.toGBK(request
							.getParameter("jtcy3_ysr"));
					String jtcy4_xm = DealString.toGBK(request
							.getParameter("jtcy4_xm"));
					String jtcy4_gx = DealString.toGBK(request
							.getParameter("jtcy4_gx"));
					String jtcy4_gzdw = DealString.toGBK(request
							.getParameter("jtcy4_gzdw"));
					String jtcy4_ysr = DealString.toGBK(request
							.getParameter("jtcy4_ysr"));
					String jtcy5_xm = DealString.toGBK(request
							.getParameter("jtcy5_xm"));
					String jtcy5_gx = DealString.toGBK(request
							.getParameter("jtcy5_gx"));
					String jtcy5_gzdw = DealString.toGBK(request
							.getParameter("jtcy5_gzdw"));
					String jtcy5_ysr = DealString.toGBK(request
							.getParameter("jtcy5_ysr"));
					String jttgje = DealString.toGBK(request
							.getParameter("jttgje"));
					String zxje = DealString
					.toGBK(request.getParameter("zxje"));
					String jxje = DealString
					.toGBK(request.getParameter("jxje"));
					String qgzxje = DealString.toGBK(request
							.getParameter("qgzxje"));
					String xnwxdkje = DealString.toGBK(request
							.getParameter("xnwxdkje"));
					String qtsrje = DealString.toGBK(request
							.getParameter("qtsrje"));
					String zxdkje = DealString.toGBK(request
							.getParameter("zxdkje"));
					String zxdksj = DealString.toGBK(request
							.getParameter("zxdksj"));
					String yffzxdkje = DealString.toGBK(request
							.getParameter("yffzxdkje"));
					String yffzxdksj = DealString.toGBK(request
							.getParameter("yffzxdksj"));
					String sqzzly = DealString.toGBK(request
							.getParameter("sqzzly"));
					String zzff1 = DealString.toGBK(request
							.getParameter("zzff1"));
					String zzff1qsje = DealString.toGBK(request
							.getParameter("zzff1qsje"));
					String zzff1jsje = DealString.toGBK(request
							.getParameter("zzff1jsje"));
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd + bzdm;
					}

					sql = "select xxsh from xsbzb where xh||nd||bzdm=? ";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal }, new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						sql = "delete from xsbzb where xh||nd||bzdm=? ";
						StandardOperation.delete("xsbzb", "xh||nd||bzdm", pkVal, request);

						colName1 = new String[] { "bzdm", "bzmc", "xn", "nd",
								"xh", "bysj", "jtdz", "yzbm", "jtcy1_xm",
								"jtcy1_gx", "jtcy1_gzdw", "jtcy1_ysr",
								"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw",
								"jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
								"jtcy3_gzdw", "jtcy3_ysr", "jtcy4_xm",
								"jtcy4_gx", "jtcy4_gzdw", "jtcy4_ysr",
								"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw",
								"jtcy5_ysr", "jttgje", "zxje", "jxje",
								"qgzxje", "xnwxdkje", "qtsrje", "zxdkje",
								"zxdksj", "yffzxdkje", "yffzxdksj", "sqzzly",
								"zzff1", "zzff1qsje", "zzff1jsje" };

						String[] input = new String[] { bzdm, bzmc, xn, nd, xh,
								bysj, jtdz, yzbm, jtcy1_xm, jtcy1_gx,
								jtcy1_gzdw, jtcy1_ysr, jtcy2_xm, jtcy2_gx,
								jtcy2_gzdw, jtcy2_ysr, jtcy3_xm, jtcy3_gx,
								jtcy3_gzdw, jtcy3_ysr, jtcy4_xm, jtcy4_gx,
								jtcy4_gzdw, jtcy4_ysr, jtcy5_xm, jtcy5_gx,
								jtcy5_gzdw, jtcy5_ysr, jttgje, zxje, jxje,
								qgzxje, xnwxdkje, qtsrje, zxdkje, zxdksj,
								yffzxdkje, yffzxdksj, sqzzly, zzff1, zzff1qsje,
								zzff1jsje };
						boolean ok = StandardOperation.insert("xsbzb",
								colName1, input, request);
						if (ok) {
							logMsg = "申请 xsbzb-临时困难补助";
							Base.log(request, logMsg, sUName);
							request.setAttribute("doresult", "yes");
						} else {
							request.setAttribute("doresult", "no");
						}
					}
				}

			} else {
				ksq = false;
			}
		}
		request.setAttribute("sfksq", ksq);
		sql = "select * from view_xsbzxx ";// +" where xh=? and nd=? ";
		String[] outString = dao.getColumnName(sql + " where 1=2 ");

		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd + bzdm;
		}
		String[] outValue = dao.getOneRs(sql
				+ " where xh||nd||bzdm=? ", new String[] { pkVal }, outString);
		if (outValue == null) {
			if (xh != null) {
				sql = "select v.xh,v.xm,v.xb,q.mzmc,"
					+ "v.zymc||v.nj zynj,v.ssbh qsh,v.qsdh,v.sfzh "
					+ "from view_stu_details q,VIEW_XSJBXX v ";// +"
				// where
				// x.xh
				// =
				// v.xh;";
				String[] colName = dao.getColumnName(sql + " where 1=2 ");
				String[] outVal = dao
				.getOneRs(
						sql
						+ " where and q.xh = v.xh and v.xh=?",
						new String[] { xh }, colName);
				if (outVal != null) {
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i].toLowerCase(), outVal[i]);
						} else {
							map.put(colName[i].toLowerCase(), "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i].toLowerCase(), outValue[i]);
				} else {
					map.put(outString[i].toLowerCase(), "");
				}
			}
		}
		request.setAttribute("bzlb", bzlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward wszxjSq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm thisForm = (XszzForm) form;
		String doType = request.getParameter("doType");
		String tips = "当前所在位置：学生资助 - 申请 - 外设助学金申请";
		String sfksq = "";
		boolean ksq = false;
		String sql = "";
		String sql1 = "";
		String[] colName1 = null;

		List wszxjList = dao.getList(
				"select ZXJDM wszxjdm,ZXJMC wszxjmc from wszxjdmb",
				new String[] {}, new String[] { "wszxjdm", "wszxjmc" });

		sql = "select dqnd nd from xtszb";
		String thisXn = Base.currXn;
		String thisNd = Base.currNd;// 获得当前年度
		String ndT = request.getParameter("ndT");
		if((null != ndT) && (!"".equalsIgnoreCase(ndT))){
			thisNd = ndT;
		}
		
		sql1 = "select to_char(sysdate,'yyyy-mm-dd') rithtNow from dual";
		String rightNow = dao.getOneRs(sql1, new String[] {},
				new String[] { "rithtNow" })[0];// 获得当前时间
		HashMap<String, String> map = new HashMap<String, String>();

		request.setAttribute("tips", tips);
		request.setAttribute("wszxjList", wszxjList);

		if (doType == null || doType.equalsIgnoreCase(" ")
				|| doType.equalsIgnoreCase("query")) {// 进入页面
			if (userType.equalsIgnoreCase("stu")) {// 学生用户
				String xh = sUName;
				String[] jxjksjssj = null;
				sql = "select a.kssj,a.jssj from NBLG_SJB a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='外设助学金' and b.xh=? ";
				jxjksjssj = dao.getOneRs(sql, new String[] { xh }, new String[] {
					"kssj", "jssj" });
				if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
					sfksq = "yes";// 可申请
					request.setAttribute("sfksq", sfksq);
					ksq = true;
				} else {
					sfksq = "no";// 不可申请
					request.setAttribute("errMsg", "非申请时间!");
				}
				if (ksq) {
					sql = "select xh,xm,bzdm from wszxjsqb where xh=? and nd=? and bzdm "
						+ "in (select bzdm from wszxjdmb)";
					String[] result = dao.getOneRs(sql, new String[] { xh,
							thisNd }, new String[] { "xh", "xm", "bzdm" });
					if (result == null) {// 没有申请过
						String sql2 = "select bzdm,bzmc,xn,nd,"
							+ "xh,xm,xb,mzmc,qsh,qsdh,jtdz,yzbm,"
							+ "jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_nl,jtcy1_ysr,"
							+ "jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_nl,jtcy2_ysr,"
							+ "jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_nl,jtcy3_ysr,"
							+ "jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_nl,jtcy4_ysr,"
							+ "jtcy5_xm,jtcy5_gx,jtcy5_gzdw,jtcy5_nl,jtcy5_ysr,"
							+ "sqzzly,csny,jg,jcqk,zzmm,drshgzqk,brcn,xyshyj,"
							+ "xxshyj,xz from view_xswszxjsqxx where xh=?";
						String[] outString = { "bzdm", "bzmc", "xn", "nd",
								"xh", "xm", "xb", "mzmc", "qsh", "qsdh",
								"jtdz", "yzbm", "jtcy1_xm", "jtcy1_gx",
								"jtcy1_gzdw", "jtcy1_nl", "jtcy1_ysr",
								"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw",
								"jtcy2_nl", "jtcy2_ysr", "jtcy3_xm",
								"jtcy3_gx", "jtcy3_gzdw", "jtcy3_nl",
								"jtcy3_ysr", "jtcy4_xm", "jtcy4_gx",
								"jtcy4_gzdw", "jtcy4_nl", "jtcy4_ysr",
								"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw",
								"jtcy5_nl", "jtcy5_ysr", "sqzzly", "csny",
								"jg", "jcqk", "zzmm", "drshgzqk", "brcn",
								"xyshyj", "xxshyj", "xz" };

						String[] outValue = dao.getOneRs(sql2,
								new String[] { xh }, outString);
						if (outValue == null) {
							sql2 = "select b.bzdm,b.bzmc,b.xn,b.nd,a.xh,a.xm,"
								+ "a.xb,b.mzmc,a.ssbh qsh ,a.qsdh,b.jtdz,b.yzbm,"
								+ "b.jtcy1_xm,b.jtcy1_gx,b.jtcy1_gzdw,b.jtcy1_nl,b.jtcy1_ysr,"
								+ "b.jtcy2_xm,b.jtcy2_gx,b.jtcy2_gzdw,b.jtcy2_nl,b.jtcy2_ysr,"
								+ "b.jtcy3_xm,b.jtcy3_gx,b.jtcy3_gzdw,b.jtcy3_nl,b.jtcy3_ysr,"
								+ "b.jtcy4_xm,b.jtcy4_gx,b.jtcy4_gzdw,b.jtcy4_nl,b.jtcy4_ysr,"
								+ "b.jtcy5_xm,b.jtcy5_gx,b.jtcy5_gzdw,b.jtcy5_nl,b.jtcy5_ysr,"
								+ "b.sqzzly,b.csny,b.jg,b.jcqk,b.zzmm,b.drshgzqk,b.brcn,"
								+ "b.xyshyj,b.xxshyj,a.xz from view_xsjbxx a left join "
								+ "wszxjsqb b on a.xh=b.xh where a.xh=?";

							outValue = dao.getOneRs(sql2, new String[] { xh },
									outString);

						}

						for (int i = 0; i < outValue.length; i++) {
							if (outValue[i] != null) {
								map.put(outString[i], outValue[i]);
							} else
								map.put(outString[i], "");
						}
						request.setAttribute("rs", map);

					} else {// 申请过
						String bzdm = result[2];
						String pkValue = xh + bzdm + thisNd;
						String sql2 = "select bzdm,bzmc,xn,nd,"
							+ "xh,xm,xb,mzmc,qsh,qsdh,jtdz,yzbm,"
							+ "jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_nl,jtcy1_ysr,"
							+ "jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_nl,jtcy2_ysr,"
							+ "jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_nl,jtcy3_ysr,"
							+ "jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_nl,jtcy4_ysr,"
							+ "jtcy5_xm,jtcy5_gx,jtcy5_gzdw,jtcy5_nl,jtcy5_ysr,"
							+ "sqzzly,csny,jg,jcqk,zzmm,drshgzqk,brcn,xyshyj,"
							+ "xxshyj,xz from view_xswszxjsqxx where xh||bzdm||nd=?";
						String[] outString = { "bzdm", "bzmc", "xn", "nd",
								"xh", "xm", "xb", "mzmc", "qsh", "qsdh",
								"jtdz", "yzbm", "jtcy1_xm", "jtcy1_gx",
								"jtcy1_gzdw", "jtcy1_nl", "jtcy1_ysr",
								"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw",
								"jtcy2_nl", "jtcy2_ysr", "jtcy3_xm",
								"jtcy3_gx", "jtcy3_gzdw", "jtcy3_nl",
								"jtcy3_ysr", "jtcy4_xm", "jtcy4_gx",
								"jtcy4_gzdw", "jtcy4_nl", "jtcy4_ysr",
								"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw",
								"jtcy5_nl", "jtcy5_ysr", "sqzzly", "csny",
								"jg", "jcqk", "zzmm", "drshgzqk", "brcn",
								"xyshyj", "xxshyj", "xz" };
						String[] outValue = dao.getOneRs(sql2,
								new String[] { pkValue }, outString);
						for (int i = 0; i < outValue.length; i++) {
							if (outValue[i] != null) {
								map.put(outString[i], outValue[i]);
							} else
								map.put(outString[i], "");
						}

						request.setAttribute("rs", map);
					}
					return mapping.findForward("success");
				}
			} else {// 学院或学校用户
				String pkValue = request.getParameter("pkVal");
				
				String sql2 = "select bzdm,bzmc,xn,nd,"
					+ "xh,xm,xb,mzmc,qsh,qsdh,jtdz,yzbm,"
					+ "jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_nl,jtcy1_ysr,"
					+ "jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_nl,jtcy2_ysr,"
					+ "jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_nl,jtcy3_ysr,"
					+ "jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_nl,jtcy4_ysr,"
					+ "jtcy5_xm,jtcy5_gx,jtcy5_gzdw,jtcy5_nl,jtcy5_ysr,"
					+ "sqzzly,csny,jg,jcqk,zzmm,drshgzqk,brcn,xyshyj,"
					+ "xxshyj,xz from view_xswszxjsqxx where xh||bzdm||nd=?";
				String[] outString = { "bzdm", "bzmc", "xn", "nd",
						"xh", "xm", "xb", "mzmc", "qsh", "qsdh",
						"jtdz", "yzbm", "jtcy1_xm", "jtcy1_gx",
						"jtcy1_gzdw", "jtcy1_nl", "jtcy1_ysr",
						"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw",
						"jtcy2_nl", "jtcy2_ysr", "jtcy3_xm",
						"jtcy3_gx", "jtcy3_gzdw", "jtcy3_nl",
						"jtcy3_ysr", "jtcy4_xm", "jtcy4_gx",
						"jtcy4_gzdw", "jtcy4_nl", "jtcy4_ysr",
						"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw",
						"jtcy5_nl", "jtcy5_ysr", "sqzzly", "csny",
						"jg", "jcqk", "zzmm", "drshgzqk", "brcn",
						"xyshyj", "xxshyj", "xz" };
				String[] outValue = dao.getOneRs(sql2,
						new String[] { pkValue }, outString);
				if (outValue != null) {
					for (int i = 0; i < outValue.length; i++) {
						if (outValue[i] != null) {
							map.put(outString[i], outValue[i]);
						} else
							map.put(outString[i], "");
					}
				}

				request.setAttribute("writeable", "yes");
				request.setAttribute("rs", map);
				return mapping.findForward("success");
			}
		} else if (doType.equalsIgnoreCase("save")) {// 执行保存操作
			String bzdm = thisForm.getWszxjdm();
			String bzmc = dao.getOneRs(
					"select zxjmc from wszxjdmb where zxjdm=?",
					new String[] { bzdm }, new String[] { "zxjmc" })[0];

			String xh = DealString.toGBK(request.getParameter("xh"));
			String xm = DealString.toGBK(request.getParameter("xm"));
			String csny = DealString.toGBK(request.getParameter("csny"));
			String xb = DealString.toGBK(request.getParameter("xb"));
			String jg = DealString.toGBK(request.getParameter("jg"));
			String mzmc = DealString.toGBK(request.getParameter("mzmc"));
			String qsh = DealString.toGBK(request.getParameter("qsh"));
			String qsdh = DealString.toGBK(request.getParameter("qsdh"));
			String xz = DealString.toGBK(request.getParameter("xz"));
			String jcqk = DealString.toGBK(request.getParameter("jcqk"));
			String zzmm = DealString.toGBK(request.getParameter("zzmm"));
			String yzbm = DealString.toGBK(request.getParameter("yzbm"));
			String jtdz = DealString.toGBK(request.getParameter("jtdz"));
			String jtcy1_xm = DealString
			.toGBK(request.getParameter("jtcy1_xm"));
			String jtcy1_nl = DealString
			.toGBK(request.getParameter("jtcy1_nl"));
			String jtcy1_gx = DealString
			.toGBK(request.getParameter("jtcy1_gx"));
			String jtcy1_gzdw = DealString.toGBK(request
					.getParameter("jtcy1_gzdw"));
			String jtcy1_ysr = DealString.toGBK(request
					.getParameter("jtcy1_ysr"));
			String jtcy2_xm = DealString
			.toGBK(request.getParameter("jtcy2_xm"));
			String jtcy2_nl = DealString
			.toGBK(request.getParameter("jtcy2_nl"));
			String jtcy2_gx = DealString
			.toGBK(request.getParameter("jtcy2_gx"));
			String jtcy2_gzdw = DealString.toGBK(request
					.getParameter("jtcy2_gzdw"));
			String jtcy2_ysr = DealString.toGBK(request
					.getParameter("jtcy2_ysr"));
			String jtcy3_xm = DealString
			.toGBK(request.getParameter("jtcy3_xm"));
			String jtcy3_nl = DealString
			.toGBK(request.getParameter("jtcy3_nl"));
			String jtcy3_gx = DealString
			.toGBK(request.getParameter("jtcy3_gx"));
			String jtcy3_gzdw = DealString.toGBK(request
					.getParameter("jtcy3_gzdw"));
			String jtcy3_ysr = DealString.toGBK(request
					.getParameter("jtcy3_ysr"));
			String jtcy4_xm = DealString
			.toGBK(request.getParameter("jtcy4_xm"));
			String jtcy4_nl = DealString
			.toGBK(request.getParameter("jtcy4_nl"));
			String jtcy4_gx = DealString
			.toGBK(request.getParameter("jtcy4_gx"));
			String jtcy4_gzdw = DealString.toGBK(request
					.getParameter("jtcy4_gzdw"));
			String jtcy4_ysr = DealString.toGBK(request
					.getParameter("jtcy4_ysr"));
			String jtcy5_xm = DealString
			.toGBK(request.getParameter("jtcy5_xm"));
			String jtcy5_nl = DealString
			.toGBK(request.getParameter("jtcy5_nl"));
			String jtcy5_gx = DealString
			.toGBK(request.getParameter("jtcy5_gx"));
			String jtcy5_gzdw = DealString.toGBK(request
					.getParameter("jtcy5_gzdw"));
			String jtcy5_ysr = DealString.toGBK(request
					.getParameter("jtcy5_ysr"));
			String drshgzqk = DealString.toGBK(request.getParameter("drshgzqk")
					);
			String sqzzly = DealString.toGBK(request.getParameter("sqzzly")
					);
			String brcn = DealString.toGBK(request.getParameter("brcn"));
			String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
			String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));

			HashMap<String, String> map1 = new HashMap<String, String>();

			String pkValue = xh + bzdm + thisNd;
			boolean ok = false;
			String[] resTest = dao.getOneRs(
					"select xh,bzdm,nd from wszxjsqb where xh||bzdm||nd=?",
					new String[] { pkValue },
					new String[] { "xh", "bzdm", "nd" });
			if (resTest == null) {// 库中没有相应的学生信息
				colName1 = new String[] { "bzdm", "bzmc", "xn", "nd", "xh",
						"xm", "xb", "mzmc", "qsh", "qsdh", "jtdz", "yzbm",
						"jtcy1_xm", "jtcy1_gx", "jtcy1_gzdw", "jtcy1_nl",
						"jtcy1_ysr", "jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw",
						"jtcy2_nl", "jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
						"jtcy3_gzdw", "jtcy3_nl", "jtcy3_ysr", "jtcy4_xm",
						"jtcy4_gx", "jtcy4_gzdw", "jtcy4_nl", "jtcy4_ysr",
						"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw", "jtcy5_nl",
						"jtcy5_ysr", "sqzzly", "csny", "jg", "jcqk", "zzmm",
						"drshgzqk", "brcn", "xyshyj", "xxshyj", "xz" };
				ok = StandardOperation.insert("wszxjsqb", colName1,
						new String[] { bzdm, bzmc, thisXn, thisNd, xh, xm, xb,
								mzmc, qsh, qsdh, jtdz, yzbm, jtcy1_xm,
								jtcy1_gx, jtcy1_gzdw, jtcy1_nl, jtcy1_ysr,
								jtcy2_xm, jtcy2_gx, jtcy2_gzdw, jtcy2_nl,
								jtcy2_ysr, jtcy3_xm, jtcy3_gx, jtcy3_gzdw,
								jtcy3_nl, jtcy3_ysr, jtcy4_xm, jtcy4_gx,
								jtcy4_gzdw, jtcy4_nl, jtcy4_ysr, jtcy5_xm,
								jtcy5_gx, jtcy5_gzdw, jtcy5_nl, jtcy5_ysr,
								sqzzly, csny, jg, jcqk, zzmm, drshgzqk, brcn,
								xyshyj, xxshyj, xz }, request);
				if(ok){
					logMsg = "申请 wszxjsqb";
					Base.log(request, logMsg, sUName);
				}
				request.setAttribute("ok", ok);

			} else {
				sql = "select xxsh from wszxjsqb where xh||bzdm||nd=?";
				String[] temp = dao.getOneRs(sql, new String[] { pkValue },
						new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					boolean del = false;
					del = StandardOperation.delete("wszxjsqb", "xh||bzdm||nd", pkValue, request);
					if (del) {
						colName1 = new String[] { "bzdm", "bzmc", "xn", "nd",
								"xh", "xm", "xb", "mzmc", "qsh", "qsdh",
								"jtdz", "yzbm", "jtcy1_xm", "jtcy1_gx",
								"jtcy1_gzdw", "jtcy1_nl", "jtcy1_ysr",
								"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw",
								"jtcy2_nl", "jtcy2_ysr", "jtcy3_xm",
								"jtcy3_gx", "jtcy3_gzdw", "jtcy3_nl",
								"jtcy3_ysr", "jtcy4_xm", "jtcy4_gx",
								"jtcy4_gzdw", "jtcy4_nl", "jtcy4_ysr",
								"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw",
								"jtcy5_nl", "jtcy5_ysr", "sqzzly", "csny",
								"jg", "jcqk", "zzmm", "drshgzqk", "brcn",
								"xyshyj", "xxshyj", "xz" };
						ok = StandardOperation.insert("wszxjsqb", colName1,
								new String[] { bzdm, bzmc, thisXn, thisNd, xh,
										xm, xb, mzmc, qsh, qsdh, jtdz, yzbm,
										jtcy1_xm, jtcy1_gx, jtcy1_gzdw,
										jtcy1_nl, jtcy1_ysr, jtcy2_xm,
										jtcy2_gx, jtcy2_gzdw, jtcy2_nl,
										jtcy2_ysr, jtcy3_xm, jtcy3_gx,
										jtcy3_gzdw, jtcy3_nl, jtcy3_ysr,
										jtcy4_xm, jtcy4_gx, jtcy4_gzdw,
										jtcy4_nl, jtcy4_ysr, jtcy5_xm,
										jtcy5_gx, jtcy5_gzdw, jtcy5_nl,
										jtcy5_ysr, sqzzly, csny, jg, jcqk,
										zzmm, drshgzqk, brcn, xyshyj, xxshyj,
										xz }, request);
						request.setAttribute("ok", ok);
					}
				}
			}
			String[] outValue = new String[] { bzdm, xh, xm, xb, mzmc, qsh,
					qsdh, jtdz, yzbm, jtcy1_xm, jtcy1_gx, jtcy1_gzdw, jtcy1_nl,
					jtcy1_ysr, jtcy2_xm, jtcy2_gx, jtcy2_gzdw, jtcy2_nl,
					jtcy2_ysr, jtcy3_xm, jtcy3_gx, jtcy3_gzdw, jtcy3_nl,
					jtcy3_ysr, jtcy4_xm, jtcy4_gx, jtcy4_gzdw, jtcy4_nl,
					jtcy4_ysr, jtcy5_xm, jtcy5_gx, jtcy5_gzdw, jtcy5_nl,
					jtcy5_ysr, sqzzly, csny, jg, jcqk, zzmm, drshgzqk, brcn,
					xyshyj, xxshyj, xz };
			String[] outString = new String[] { "bzdm", "xh", "xm", "xb",
					"mzmc", "qsh", "qsdh", "jtdz", "yzbm", "jtcy1_xm",
					"jtcy1_gx", "jtcy1_gzdw", "jtcy1_nl", "jtcy1_ysr",
					"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw", "jtcy2_nl",
					"jtcy2_ysr", "jtcy3_xm", "jtcy3_gx", "jtcy3_gzdw",
					"jtcy3_nl", "jtcy3_ysr", "jtcy4_xm", "jtcy4_gx",
					"jtcy4_gzdw", "jtcy4_nl", "jtcy4_ysr", "jtcy5_xm",
					"jtcy5_gx", "jtcy5_gzdw", "jtcy5_nl", "jtcy5_ysr",
					"sqzzly", "csny", "jg", "jcqk", "zzmm", "drshgzqk", "brcn",
					"xyshyj", "xxshyj", "xz" };
			for (int i = 0; i < outValue.length; i++) {
				if (outValue[i] != null) {
					map1.put(outString[i], outValue[i]);
				} else
					map1.put(outString[i], "");
			}
			request.setAttribute("rs", map1);
			return mapping.findForward("success");
		}

		return new ActionForward("/errMsg.do", false);
	}

	private ActionForward xfbzsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {

		HashMap<String, String> map = new HashMap<String, String>();
		String bzlb = DealString.toGBK(request.getParameter("bzlb"));
		String xh = DealString.toGBK(request.getParameter("xh"));
		String xm = DealString.toGBK(request.getParameter("xm"));
		String xb = DealString.toGBK(request.getParameter("xb"));
		String mzmc = DealString.toGBK(request.getParameter("mzmc"));
		String bysj = DealString.toGBK(request.getParameter("bysj"));
		String zynj = DealString.toGBK(request.getParameter("zynj"));
		String qsh = DealString.toGBK(request.getParameter("qsh"));
		String qsdh = DealString.toGBK(request.getParameter("qsdh"));
		String jtdz = DealString.toGBK(request.getParameter("jtdz"));
		String yzbm = DealString.toGBK(request.getParameter("yzbm"));
		String sfzh = DealString.toGBK(request.getParameter("sfzh"));
		String jtcy1_xm = DealString.toGBK(request.getParameter("jtcy1_xm"));
		String jtcy1_gx = DealString.toGBK(request.getParameter("jtcy1_gx"));
		String jtcy1_gzdw = DealString
		.toGBK(request.getParameter("jtcy1_gzdw"));
		String jtcy1_ysr = DealString.toGBK(request.getParameter("jtcy1_ysr"));
		String jtcy2_xm = DealString.toGBK(request.getParameter("jtcy2_xm"));
		String jtcy2_gx = DealString.toGBK(request.getParameter("jtcy2_gx"));
		String jtcy2_gzdw = DealString
		.toGBK(request.getParameter("jtcy2_gzdw"));
		String jtcy2_ysr = DealString.toGBK(request.getParameter("jtcy2_ysr"));
		String jtcy3_xm = DealString.toGBK(request.getParameter("jtcy3_xm"));
		String jtcy3_gx = DealString.toGBK(request.getParameter("jtcy3_gx"));
		String jtcy3_gzdw = DealString
		.toGBK(request.getParameter("jtcy3_gzdw"));
		String jtcy3_ysr = DealString.toGBK(request.getParameter("jtcy3_ysr"));
		String jtcy4_xm = DealString.toGBK(request.getParameter("jtcy4_xm"));
		String jtcy4_gx = DealString.toGBK(request.getParameter("jtcy4_gx"));
		String jtcy4_gzdw = DealString
		.toGBK(request.getParameter("jtcy4_gzdw"));
		String jtcy4_ysr = DealString.toGBK(request.getParameter("jtcy4_ysr"));
		String jtcy5_xm = DealString.toGBK(request.getParameter("jtcy5_xm"));
		String jtcy5_gx = DealString.toGBK(request.getParameter("jtcy5_gx"));
		String jtcy5_gzdw = DealString
		.toGBK(request.getParameter("jtcy5_gzdw"));
		String jtcy5_ysr = DealString.toGBK(request.getParameter("jtcy5_ysr"));
		String zxje = DealString.toGBK(request.getParameter("zxje"));
		String jttgje = DealString.toGBK(request.getParameter("jttgje"));
		String jxje = DealString.toGBK(request.getParameter("jxje"));
		String qgzxje = DealString.toGBK(request.getParameter("qgzxje"));
		String xnwxdkje = DealString.toGBK(request.getParameter("xnwxdkje"));
		String qtsrje = DealString.toGBK(request.getParameter("qtsrje"));
		String zxdkje = DealString.toGBK(request.getParameter("zxdkje"));
		String zxdksj = DealString.toGBK(request.getParameter("zxdksj"));
		String yffzxdkje = DealString.toGBK(request.getParameter("yffzxdkje"));
		String yffzxdksj = DealString.toGBK(request.getParameter("yffzxdksj"));
		String sqzzly = DealString.toGBK(request.getParameter("sqzzly"));
		String zzff1qsje = DealString.toGBK(request.getParameter("zzff1qsje"));
		String zzff1jsje = DealString.toGBK(request.getParameter("zzff1jsje"));

		String[] outValue = new String[] { xh, xm, xb, mzmc, bysj, zynj, qsh,
				qsdh, jtdz, yzbm, sfzh, jtcy1_xm, jtcy1_gx, jtcy1_gzdw,
				jtcy1_ysr, jtcy2_xm, jtcy2_gx, jtcy2_gzdw, jtcy2_ysr, jtcy3_xm,
				jtcy3_gx, jtcy3_gzdw, jtcy3_ysr, jtcy4_xm, jtcy4_gx,
				jtcy4_gzdw, jtcy4_ysr, jtcy5_xm, jtcy5_gx, jtcy5_gzdw,
				jtcy5_ysr, zxje, jttgje, jxje, qgzxje, xnwxdkje, qtsrje,
				zxdkje, zxdksj, yffzxdkje, yffzxdksj, sqzzly, zzff1qsje,
				zzff1jsje };
		String[] outString = new String[] { "xh", "xm", "xb", "mzmc", "bysj",
				"zynj", "qsh", "qsdh", "jtdz", "yzbm", "sfzh", "jtcy1_xm",
				"jtcy1_gx", "jtcy1_gzdw", "jtcy1_ysr", "jtcy2_xm", "jtcy2_gx",
				"jtcy2_gzdw", "jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
				"jtcy3_gzdw", "jtcy3_ysr", "jtcy4_xm", "jtcy4_gx",
				"jtcy4_gzdw", "jtcy4_ysr", "jtcy5_xm", "jtcy5_gx",
				"jtcy5_gzdw", "jtcy5_ysr", "zxje", "jttgje", "jxje", "qgzxje",
				"xnwxdkje", "qtsrje", "zxdkje", "zxdksj", "yffzxdkje",
				"yffzxdksj", "sqzzly", "zzff1qsje", "zzff1jsje" };

		/*
		 * String sql ="select xh,xm,xb,mzmc,bysj,zynj,qsh,qsdh,jtdz,yzbm,sfzh," +
		 * "jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr," +
		 * "jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr," +
		 * "jtcy5_xm,jtcy5_gx,jtcy5_gzdw,jtcy5_ysr," +
		 * "zxje,jttgje,jxje,qgzxje,xnwxdkje,qtsr," +
		 * "zxdkje,zxdksj,yffzxdkje,yffzxdksj,sqzzly,zzff1qsje,zzff1jsje from ";
		 */

		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null) {
				map.put(outString[i], outValue[i]);
			} else
				map.put(outString[i], "");
		}
		String xxmc = ToolClass.getXxmc();
		map.put("xxmc", xxmc);
		request.setAttribute("bzlb", bzlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");

	}

	private ActionForward wszxjsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {

		HashMap<String, String> map = new HashMap<String, String>();
		String xh = DealString.toGBK(request.getParameter("xh"));
		String xm = DealString.toGBK(request.getParameter("xm"));
		String csny = DealString.toGBK(request.getParameter("csny"));
		String xb = DealString.toGBK(request.getParameter("xb"));
		String jg = DealString.toGBK(request.getParameter("jg"));
		String mzmc = DealString.toGBK(request.getParameter("mzmc"));
		String xz = DealString.toGBK(request.getParameter("xz"));
		String qsh = DealString.toGBK(request.getParameter("qsh"));
		String qsdh = DealString.toGBK(request.getParameter("qsdh"));
		String jcqk = DealString.toGBK(request.getParameter("jcqk"));
		String zzmm = DealString.toGBK(request.getParameter("zzmm"));
		String yzbm = DealString.toGBK(request.getParameter("yzbm"));
		String jtdz = DealString.toGBK(request.getParameter("jtdz"));
		String jtcy1_xm = DealString.toGBK(request.getParameter("jtcy1_xm"));
		String jtcy1_nl = DealString.toGBK(request.getParameter("jtcy1_nl"));
		String jtcy1_gx = DealString.toGBK(request.getParameter("jtcy1_gx"));
		String jtcy1_ysr = DealString.toGBK(request.getParameter("jtcy1_ysr"));
		String jtcy1_gzdw = DealString
				.toGBK(request.getParameter("jtcy1_gzdw"));
		String jtcy2_xm = DealString.toGBK(request.getParameter("jtcy2_xm"));
		String jtcy2_nl = DealString.toGBK(request.getParameter("jtcy2_nl"));
		String jtcy2_gx = DealString.toGBK(request.getParameter("jtcy2_gx"));
		String jtcy2_ysr = DealString.toGBK(request.getParameter("jtcy2_ysr"));
		String jtcy2_gzdw = DealString
				.toGBK(request.getParameter("jtcy2_gzdw"));
		String jtcy3_xm = DealString.toGBK(request.getParameter("jtcy3_xm"));
		String jtcy3_nl = DealString.toGBK(request.getParameter("jtcy3_nl"));
		String jtcy3_gx = DealString.toGBK(request.getParameter("jtcy3_gx"));
		String jtcy3_ysr = DealString.toGBK(request.getParameter("jtcy3_ysr"));
		String jtcy3_gzdw = DealString
				.toGBK(request.getParameter("jtcy3_gzdw"));
		String jtcy4_xm = DealString.toGBK(request.getParameter("jtcy4_xm"));
		String jtcy4_nl = DealString.toGBK(request.getParameter("jtcy4_nl"));
		String jtcy4_gx = DealString.toGBK(request.getParameter("jtcy4_gx"));
		String jtcy4_ysr = DealString.toGBK(request.getParameter("jtcy4_ysr"));
		String jtcy4_gzdw = DealString
				.toGBK(request.getParameter("jtcy4_gzdw"));
		String jtcy5_xm = DealString.toGBK(request.getParameter("jtcy5_xm"));
		String jtcy5_nl = DealString.toGBK(request.getParameter("jtcy5_nl"));
		String jtcy5_gx = DealString.toGBK(request.getParameter("jtcy5_gx"));
		String jtcy5_ysr = DealString.toGBK(request.getParameter("jtcy5_ysr"));
		String jtcy5_gzdw = DealString
				.toGBK(request.getParameter("jtcy5_gzdw"));
		String drshgzqk = DealString.toGBK(request.getParameter("drshgzqk"));
		String sqzzly = DealString.toGBK(request.getParameter("sqzzly"));
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));

		String[] outValue = new String[] { xh, xm, csny, xb, jg, mzmc, xz, qsh,
				qsdh, jcqk, zzmm, yzbm, jtdz, jtcy1_xm, jtcy1_nl, jtcy1_gx,
				jtcy1_ysr, jtcy1_gzdw, jtcy2_xm, jtcy2_nl, jtcy2_gx, jtcy2_ysr,
				jtcy2_gzdw, jtcy3_xm, jtcy3_nl, jtcy3_gx, jtcy3_ysr,
				jtcy3_gzdw, jtcy4_xm, jtcy4_nl, jtcy4_gx, jtcy4_ysr,
				jtcy4_gzdw, jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_ysr,
				jtcy5_gzdw, drshgzqk, sqzzly, xyshyj, xxshyj };
		String[] outString = new String[] { "xh", "xm", "csny", "xb", "jg",
				"mzmc", "xz", "qsh", "qsdh", "jcqk", "zzmm", "yzbm", "jtdz",
				"jtcy1_xm", "jtcy1_nl", "jtcy1_gx", "jtcy1_ysr", "jtcy1_gzdw",
				"jtcy2_xm", "jtcy2_nl", "jtcy2_gx", "jtcy2_ysr", "jtcy2_gzdw",
				"jtcy3_xm", "jtcy3_nl", "jtcy3_gx", "jtcy3_ysr", "jtcy3_gzdw",
				"jtcy4_xm", "jtcy4_nl", "jtcy4_gx", "jtcy4_ysr", "jtcy4_gzdw",
				"jtcy5_xm", "jtcy5_nl", "jtcy5_gx", "jtcy5_ysr", "jtcy5_gzdw",
				"drshgzqk", "sqzzly", "xyshyj", "xxshyj" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null) {
				map.put(outString[i], outValue[i]);
			} else
				map.put(outString[i], "");
		}
		String xxmc = ToolClass.getXxmc();
		map.put("xxmc", xxmc);
		request.setAttribute("rs", map);
		return mapping.findForward("success");

	}

	private ActionForward xndxjSq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {// 校内贷学金申请

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm zzForm = (XszzForm) form;
		String doType = request.getParameter("doType");// 操作方式
		String tips = "当前所在位置：学生资助 - 申请 - 校内贷学金申请";
		String sfksq = "";
		String[] colName1 = null;
		String sql = "";
		String sql1 = "";
		String thisNd = Base.currNd;// 获得当前年度
		sql1 = "select to_char(sysdate,'yyyy-mm-dd') rithtNow from dual";
		String rightNow = dao.getOneRs(sql1, new String[] {},
				new String[] { "rithtNow" })[0];// 获得当前时间
		String xndxjCode = "0000000005";
		String thisXn = Base.currXn;// 当前学年
		HashMap<String, String> map = new HashMap<String, String>();
		request.setAttribute("tips", tips);
		String xh = request.getParameter("xh");
		String pkT = request.getParameter("pkVal");
		String pkValue = xh + xndxjCode + thisNd;

		if (doType == null || doType.equalsIgnoreCase(" ")
				|| doType.equalsIgnoreCase("query")) {
			if (userType.equalsIgnoreCase("stu")) {// 学生用户
				xh = sUName;
				String[] jxjksjssj = null;

				sql = "select a.kssj,a.jssj from NBLG_SJB a,"
						+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='校内贷学金' and b.xh=? ";
				jxjksjssj = dao.getOneRs(sql, new String[] { xh }, new String[] {
						"kssj", "jssj" });
				if (jxjksjssj != null
						&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
						&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
					sfksq = "yes";
				} else {
					sfksq = "no";
				}
					sql = "select * from XSBZB where xh||bzdm||nd=?";
					String[] result = dao.getOneRs(sql,
							new String[] { pkValue }, new String[] { "xh" });
					if (result == null) {// 学生第一次申请
						sql = "select a.xh,a.xm,a.xb,a.nj,a.ssbh qsh,a.qsdh,a.lxdzxx,"
							+ "a.lxdh,nvl(b.bz,a.bz) bz,b.bzdm,b.bzmc,b.xn,b.nd,"
							+ "(select b.mzmc from view_stu_details b where "
							+ "b.xh=a.xh) mzmc,"
							+ "b.bysj,a.zymc||a.nj zynj,b.jtdz,b.yzbm,"
							+ "a.sfzh,"
							+ "b.jtcy1_xm,b.jtcy1_gx,b.jtcy1_gzdw,b.jtcy1_ysr,"
							+ "b.jtcy2_xm,b.jtcy2_gx,b.jtcy2_gzdw,b.jtcy2_ysr,"
							+ "b.jtcy3_xm,b.jtcy3_gx,b.jtcy3_gzdw,b.jtcy3_ysr,"
							+ "b.jtcy4_xm,b.jtcy4_gx,b.jtcy4_gzdw,b.jtcy4_ysr,"
							+ "b.jtcy5_xm,b.jtcy5_gx,b.jtcy5_gzdw,b.jtcy5_ysr,"
							+ "b.jttgje,b.zxje,b.jxje,b.qgzxje,b.xnwxdkje,b.qtsrje,"
							+ "b.zxdkje,b.zxdksj,b.yffzxdkje,b.yffzxdksj,b.sqzzly,"
							+ "b.zzff1,b.zzff1qsje,b.zzff1jsje from view_xsjbxx a "
							+ "left join xsbzb b on a.xh=b.xh where a.xh=?";
						String[] outString = new String[] { "xh", "xm", "xb",
								"nj", "qsh", "qsdh", "lxdzxx", "lxdh", "bz",
								"bzdm", "bzmc", "xn", "nd", "mzmc", "bysj",
								"zynj", "jtdz", "yzbm", "sfzh", "jtcy1_xm",
								"jtcy1_gx", "jtcy1_gzdw", "jtcy1_ysr",
								"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw",
								"jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
								"jtcy3_gzdw", "jtcy3_ysr", "jtcy4_xm",
								"jtcy4_gx", "jtcy4_gzdw", "jtcy4_ysr",
								"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw",
								"jtcy5_ysr", "jttgje", "zxje", "jxje",
								"qgzxje", "xnwxdkje", "qtsrje", "zxdkje",
								"zxdksj", "yffzxdkje", "yffzxdksj", "sqzzly",
								"zzff1", "zzff1qsje", "zzff1jsje" };
						String[] outValue = dao.getOneRs(sql,
								new String[] { xh }, outString);
						for (int i = 0; i < outValue.length; i++) {
							if (outValue[i] != null) {
								map.put(outString[i], outValue[i]);
							} else {
								map.put(outString[i], " ");
							}
						}

					} else {// 学生已经申请过，已经填入信息
						sql = "select a.xh,a.xm,a.xb,a.nj,a.ssbh qsh,a.qsdh,a.lxdzxx,"
							+ "a.lxdh,nvl(b.bz,a.bz) bz,b.bzdm,b.bzmc,b.xn,b.nd,"
							+ "(select b.mzmc from view_stu_details b where "
							+ "b.xh=a.xh) mzmc,b.bysj,"
							+ "a.zymc||a.nj zynj,b.jtdz,b.yzbm,"
							+ "a.sfzh,"
							+ "b.jtcy1_xm,b.jtcy1_gx,b.jtcy1_gzdw,b.jtcy1_ysr,"
							+ "b.jtcy2_xm,b.jtcy2_gx,b.jtcy2_gzdw,b.jtcy2_ysr,"
							+ "b.jtcy3_xm,b.jtcy3_gx,b.jtcy3_gzdw,b.jtcy3_ysr,"
							+ "b.jtcy4_xm,b.jtcy4_gx,b.jtcy4_gzdw,b.jtcy4_ysr,"
							+ "b.jtcy5_xm,b.jtcy5_gx,b.jtcy5_gzdw,b.jtcy5_ysr,"
							+ "b.jttgje,b.zxje,b.jxje,b.qgzxje,b.xnwxdkje,b.qtsrje,"
							+ "b.zxdkje,b.zxdksj,b.yffzxdkje,b.yffzxdksj,b.sqzzly,"
							+ "b.zzff1,b.zzff1qsje,b.zzff1jsje from view_xsjbxx a "
							+ "left join xsbzb b on a.xh=b.xh where a.xh||b.bzdm||b.nd=?";
						String[] outString = new String[] { "xh", "xm", "xb",
								"nj", "qsh", "qsdh", "lxdzxx", "lxdh", "bz",
								"bzdm", "bzmc", "xn", "nd", "mzmc", "bysj",
								"zynj", "jtdz", "yzbm", "sfzh", "jtcy1_xm",
								"jtcy1_gx", "jtcy1_gzdw", "jtcy1_ysr",
								"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw",
								"jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
								"jtcy3_gzdw", "jtcy3_ysr", "jtcy4_xm",
								"jtcy4_gx", "jtcy4_gzdw", "jtcy4_ysr",
								"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw",
								"jtcy5_ysr", "jttgje", "zxje", "jxje",
								"qgzxje", "xnwxdkje", "qtsrje", "zxdkje",
								"zxdksj", "yffzxdkje", "yffzxdksj", "sqzzly",
								"zzff1", "zzff1qsje", "zzff1jsje" };
						String[] outValue = dao.getOneRs(sql,
								new String[] { pkValue }, outString);
						for (int i = 0; i < outValue.length; i++) {
							if (outValue[i] != null) {
								map.put(outString[i], outValue[i]);
							} else {
								map.put(outString[i], " ");
							}
						}
					}
					request.setAttribute("rs", map);
				request.setAttribute("sfksq", sfksq);
				return mapping.findForward("success");

			} else {// 学院或学校用户不受时间限制
				if((null != pkT) && (!"".equalsIgnoreCase(pkT))){
					pkT = DealString.toGBK(pkT);
					pkValue = pkT;
				}
				sql = "select a.xh,a.xm,a.xb,a.nj,a.ssbh qsh,a.qsdh,a.lxdzxx,"
					+ "a.lxdh,nvl(b.bz,a.bz) bz,b.bzdm,b.bzmc,b.xn,b.nd,"
					+ "(select b.mzmc from view_stu_details b where "
					+ "b.xh=a.xh) mzmc,b.bysj,"
					+ "a.zymc||a.nj zynj,b.jtdz,b.yzbm,"
					+ "a.sfzh,"
					+ "b.jtcy1_xm,b.jtcy1_gx,b.jtcy1_gzdw,b.jtcy1_ysr,"
					+ "b.jtcy2_xm,b.jtcy2_gx,b.jtcy2_gzdw,b.jtcy2_ysr,"
					+ "b.jtcy3_xm,b.jtcy3_gx,b.jtcy3_gzdw,b.jtcy3_ysr,"
					+ "b.jtcy4_xm,b.jtcy4_gx,b.jtcy4_gzdw,b.jtcy4_ysr,"
					+ "b.jtcy5_xm,b.jtcy5_gx,b.jtcy5_gzdw,b.jtcy5_ysr,"
					+ "b.jttgje,b.zxje,b.jxje,b.qgzxje,b.xnwxdkje,b.qtsrje,"
					+ "b.zxdkje,b.zxdksj,b.yffzxdkje,b.yffzxdksj,b.sqzzly,"
					+ "b.zzff1,b.zzff1qsje,b.zzff1jsje from view_xsjbxx a "
					+ "left join xsbzb b on a.xh=b.xh where a.xh||b.bzdm||b.nd=?";
				String[] outString = new String[] { "xh", "xm", "xb",
						"nj", "qsh", "qsdh", "lxdzxx", "lxdh", "bz",
						"bzdm", "bzmc", "xn", "nd", "mzmc", "bysj",
						"zynj", "jtdz", "yzbm", "sfzh", "jtcy1_xm",
						"jtcy1_gx", "jtcy1_gzdw", "jtcy1_ysr",
						"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw",
						"jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
						"jtcy3_gzdw", "jtcy3_ysr", "jtcy4_xm",
						"jtcy4_gx", "jtcy4_gzdw", "jtcy4_ysr",
						"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw",
						"jtcy5_ysr", "jttgje", "zxje", "jxje",
						"qgzxje", "xnwxdkje", "qtsrje", "zxdkje",
						"zxdksj", "yffzxdkje", "yffzxdksj", "sqzzly",
						"zzff1", "zzff1qsje", "zzff1jsje" };
				String[] outValue = dao.getOneRs(sql,
						new String[] { pkValue }, outString);
				if (outValue != null) {
					for (int i = 0; i < outValue.length; i++) {
						if (outValue[i] != null) {
							map.put(outString[i], outValue[i]);
						} else {
							map.put(outString[i], " ");
						}
					}
				} else {
					for (int i = 0; i < outString.length; i++) {
						map.put(outString[i], " ");
					}
				}
				request.setAttribute("sfksq", "yes");
				request.setAttribute("rs", map);
				return mapping.findForward("success");
			}
		} else if (doType.equalsIgnoreCase("save")) {
			HashMap<String, String> map2 = new HashMap<String, String>();
			String xm = DealString.toGBK(request.getParameter("xm"));
			String xb = DealString.toGBK(request.getParameter("xb"));
			String mzmc = DealString.toGBK(request.getParameter("mzmc"));
			String bysj = DealString.toGBK(request.getParameter("bysj"));
			String zynj = DealString.toGBK(request.getParameter("zynj"));
			String qsh = DealString.toGBK(request.getParameter("qsh"));
			String qsdh = DealString.toGBK(request.getParameter("qsdh"));
			String jtdz = DealString.toGBK(request.getParameter("jtdz"));
			String yzbm = DealString.toGBK(request.getParameter("yzbm"));
			String sfzh = DealString.toGBK(request.getParameter("sfzh"));
			String jtcy1_xm = DealString
			.toGBK(request.getParameter("jtcy1_xm"));
			String jtcy1_gx = DealString
			.toGBK(request.getParameter("jtcy1_gx"));
			String jtcy1_gzdw = DealString.toGBK(request
					.getParameter("jtcy1_gzdw"));
			String jtcy1_ysr = DealString.toGBK(request
					.getParameter("jtcy1_ysr"));
			String jtcy2_xm = DealString
			.toGBK(request.getParameter("jtcy2_xm"));
			String jtcy2_gx = DealString
			.toGBK(request.getParameter("jtcy2_gx"));
			String jtcy2_gzdw = DealString.toGBK(request
					.getParameter("jtcy2_gzdw"));
			String jtcy2_ysr = DealString.toGBK(request
					.getParameter("jtcy2_ysr"));
			String jtcy3_xm = DealString
			.toGBK(request.getParameter("jtcy3_xm"));
			String jtcy3_gx = DealString
			.toGBK(request.getParameter("jtcy3_gx"));
			String jtcy3_gzdw = DealString.toGBK(request
					.getParameter("jtcy3_gzdw"));
			String jtcy3_ysr = DealString.toGBK(request
					.getParameter("jtcy3_ysr"));
			String jtcy4_xm = DealString
			.toGBK(request.getParameter("jtcy4_xm"));
			String jtcy4_gx = DealString
			.toGBK(request.getParameter("jtcy4_gx"));
			String jtcy4_gzdw = DealString.toGBK(request
					.getParameter("jtcy4_gzdw"));
			String jtcy4_ysr = DealString.toGBK(request
					.getParameter("jtcy4_ysr"));
			String jtcy5_xm = DealString
			.toGBK(request.getParameter("jtcy5_xm"));
			String jtcy5_gx = DealString
			.toGBK(request.getParameter("jtcy5_gx"));
			String jtcy5_gzdw = DealString.toGBK(request
					.getParameter("jtcy5_gzdw"));
			String jtcy5_ysr = DealString.toGBK(request
					.getParameter("jtcy5_ysr"));
			String jttgje = DealString.toGBK(request.getParameter("jttgje"));
			String zxje = DealString.toGBK(request.getParameter("zxje"));
			String jxje = DealString.toGBK(request.getParameter("jxje"));
			String qgzxje = DealString.toGBK(request.getParameter("qgzxje"));
			String xnwxdkje = DealString
			.toGBK(request.getParameter("xnwxdkje"));
			String qtsrje = DealString.toGBK(request.getParameter("qtsrje"));
			String zxdkje = DealString.toGBK(request.getParameter("zxdkje"));
			String zxdksj = DealString.toGBK(request.getParameter("zxdksj"));
			String yffzxdkje = DealString.toGBK(request
					.getParameter("yffzxdkje"));
			String yffzxdksj = DealString.toGBK(request
					.getParameter("yffzxdksj"));
			String sqzzly = DealString.toGBK(request.getParameter("sqzzly"));
			String zzff1 = DealString.toGBK(request.getParameter("zzff1"));
			String zzff1qsje = DealString.toGBK(request
					.getParameter("zzff1qsje"));
			String zzff1jsje = DealString.toGBK(request
					.getParameter("zzff1jsje"));
			boolean ok = false;
			xh = zzForm.getXh();
			sql = "select * from XSBZB where xh||bzdm||nd=?";
			String xndxjmc = dao.getOneRs(
					"select knbzmc from knbzdmb where knbzdm=?",
					new String[] { xndxjCode }, new String[] { "knbzmc" })[0];
			pkValue = xh + xndxjCode + thisNd;
			String[] result = dao.getOneRs(sql, new String[] { pkValue },
					new String[] { "xh" });
			String[] outString = new String[] { "xh", "xm", "xb", "mzmc",
					"bysj", "zynj", "qsh", "qsdh", "jtdz", "yzbm", "sfzh",
					"jtcy1_xm", "jtcy1_gx", "jtcy1_gzdw", "jtcy1_ysr",
					"jtcy2_xm", "jtcy2_gx", "jtcy1_gzdw", "jtcy2_ysr",
					"jtcy3_xm", "jtcy3_gx", "jtcy3_gzdw", "jtcy3_ysr",
					"jtcy4_xm", "jtcy4_gx", "jtcy4_gzdw", "jtcy4_ysr",
					"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw", "jtcy5_ysr",
					"jttgje", "zxje", "jxje", "qgzxje", "xnwxdkje", "qtsrje",
					"zxdkje", "zxdksj", "yffzxdkje", "yffzxdksj", "sqzzly",
					"zzff1", "zzff1qsje", "zzff1jsje" };
			String[] outValue = new String[] { xh, xm, xb, mzmc, bysj, zynj,
					qsh, qsdh, jtdz, yzbm, sfzh, jtcy1_xm, jtcy1_gx,
					jtcy1_gzdw, jtcy1_ysr, jtcy2_xm, jtcy2_gx, jtcy1_gzdw,
					jtcy2_ysr, jtcy3_xm, jtcy3_gx, jtcy3_gzdw, jtcy3_ysr,
					jtcy4_xm, jtcy4_gx, jtcy4_gzdw, jtcy4_ysr, jtcy5_xm,
					jtcy5_gx, jtcy5_gzdw, jtcy5_ysr, jttgje, zxje, jxje,
					qgzxje, xnwxdkje, qtsrje, zxdkje, zxdksj, yffzxdkje,
					yffzxdksj, sqzzly, zzff1, zzff1qsje, zzff1jsje };
			if (result == null) {
				colName1 = new String[] { "bzdm", "bzmc", "xn", "nd", "xh",
						"bysj", "jtdz", "yzbm", "jtcy1_xm", "jtcy1_gx",
						"jtcy1_gzdw", "jtcy1_ysr", "jtcy2_xm", "jtcy2_gx",
						"jtcy2_gzdw", "jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
						"jtcy3_gzdw", "jtcy3_ysr", "jtcy4_xm", "jtcy4_gx",
						"jtcy4_gzdw", "jtcy4_ysr", "jtcy5_xm", "jtcy5_gx",
						"jtcy5_gzdw", "jtcy5_ysr", "jttgje", "zxje", "jxje",
						"qgzxje", "xnwxdkje", "qtsrje", "zxdkje", "zxdksj",
						"yffzxdkje", "yffzxdksj", "sqzzly", "zzff1",
						"zzff1qsje", "zzff1jsje" };
				ok = StandardOperation.insert("xsbzb", colName1, new String[] {
						xndxjCode, xndxjmc, thisXn, thisNd, xh, bysj, jtdz,
						yzbm, jtcy1_xm, jtcy1_gx, jtcy1_gzdw, jtcy1_ysr,
						jtcy2_xm, jtcy2_gx, jtcy2_gzdw, jtcy2_ysr, jtcy3_xm,
						jtcy3_gx, jtcy3_gzdw, jtcy3_ysr, jtcy4_xm, jtcy4_gx,
						jtcy4_gzdw, jtcy4_ysr, jtcy5_xm, jtcy5_gx, jtcy5_gzdw,
						jtcy5_ysr, jttgje, zxje, jxje, qgzxje, xnwxdkje,
						qtsrje, zxdkje, zxdksj, yffzxdkje, yffzxdksj, sqzzly,
						zzff1, zzff1qsje, zzff1jsje }, request);

				for (int i = 0; i < outString.length; i++) {
					map2.put(outString[i], (outValue[i] != null ? outValue[i]
					                                                       : ""));
				}
				if(ok){
					logMsg = "申请 xsbzb-校内贷学金申请";
					Base.log(request, logMsg, sUName);
				}
				request.setAttribute("rs", map2);
				request.setAttribute("ok", ok);
				request.setAttribute("sfksq", "yes");
			} else {
				sql = "select xxsh from xsbzb where xh||bzdm||nd=?";
				String[] temp = dao.getOneRs(sql, new String[] { pkValue },
						new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					boolean del = false;
					StandardOperation.delete("xsbzb", "xh||bzdm||nd", pkValue, request);
					if (del) {
						colName1 = new String[] { "bzdm", "bzmc", "xn", "nd",
								"xh", "bysj", "jtdz", "yzbm", "jtcy1_xm",
								"jtcy1_gx", "jtcy1_gzdw", "jtcy1_ysr",
								"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw",
								"jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
								"jtcy3_gzdw", "jtcy3_ysr", "jtcy4_xm",
								"jtcy4_gx", "jtcy4_gzdw", "jtcy4_ysr",
								"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw",
								"jtcy5_ysr", "jttgje", "zxje", "jxje",
								"qgzxje", "xnwxdkje", "qtsrje", "zxdkje",
								"zxdksj", "yffzxdkje", "yffzxdksj", "sqzzly",
								"zzff1", "zzff1qsje", "zzff1jsje" };
						ok = StandardOperation.insert("xsbzb", colName1,
								new String[] { xndxjCode, xndxjmc, thisXn,
										thisNd, xh, bysj, jtdz, yzbm, jtcy1_xm,
										jtcy1_gx, jtcy1_gzdw, jtcy1_ysr,
										jtcy2_xm, jtcy2_gx, jtcy2_gzdw,
										jtcy2_ysr, jtcy3_xm, jtcy3_gx,
										jtcy3_gzdw, jtcy3_ysr, jtcy4_xm,
										jtcy4_gx, jtcy4_gzdw, jtcy4_ysr,
										jtcy5_xm, jtcy5_gx, jtcy5_gzdw,
										jtcy5_ysr, jttgje, zxje, jxje, qgzxje,
										xnwxdkje, qtsrje, zxdkje, zxdksj,
										yffzxdkje, yffzxdksj, sqzzly, zzff1,
										zzff1qsje, zzff1jsje }, request);
						for (int i = 0; i < outString.length; i++) {
							map2.put(outString[i],
									(outValue[i] != null ? outValue[i] : ""));
						}
						if(ok){
							logMsg = "申请 xsbzb-校内贷学金申请";
							Base.log(request, logMsg, sUName);
						}
						request.setAttribute("rs", map2);
						request.setAttribute("ok", ok);
						request.setAttribute("sfksq", "yes");
					}
					request.setAttribute("ok", ok);
					request.setAttribute("sfksq", "yes");
				}
			}
			return mapping.findForward("success");
		}
		return mapping.findForward("false");
	}

	private ActionForward lyjszxjsq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {// 龙元建设助学金申请

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		// String xxmc = ToolClass.getXxmc();
		String doType = request.getParameter("doType");// 操作类型
		String titName = request.getParameter("titName");// 访问助学金还是奖学金

		String jzxjmc = "";
		String sfksq = "-1";// 是否可申请参数，-1表示不可以，1表示可以。

		String[] pages = null;
		String[] titNames = null;
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyymmddhh24miss') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		String[] colName1 = null;
		pages = new String[] { "龙元建设助学金" };
		titNames = new String[] { "lyjszxjsq" };

		if (titName == null)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		List pagesList = dao.arrayToList(titNames, pages);
		request.setAttribute("pages", pagesList);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间
		String[] outString = new String[] {};
		sql = "select x.xh,x.xm,x.nd,x.csny,x.rxny,x.byny,x.lxdh,x.sfzh,x.xb,x.bjmc,x.xy,x.mzmc,"
			+ "x.JTCY1_XM,x.JTCY1_NL,x.JTCY1_GX,x.JTCY1_GZDZ,x.JTCY2_XM,x.JTCY2_NL,"
			+ "x.JTCY2_GX,x.JTCY2_GZDZ,x.JTCY3_XM,x.JTCY3_NL,x.JTCY3_GX,x.JTCY3_GZDZ,"
			+ "x.JTCY4_XM,x.JTCY4_NL,x.JTCY4_GX,x.JTCY4_GZDZ,x.JTCY5_XM,x.JTCY5_NL,"
			+ "x.JTCY5_GX,x.JTCY5_GZDZ,x.sfkns,x.sqsj,x.jzxjmc,x.jlxx,x.hkrs,x.jtyzsr,"
			+ "x.jtrjsr,x.jtsrly,x.jtzz,x.sqly,x.xyshyj,x.xxshyj,x.yzbm,x.radjthk,x.XM,"
			+ "x.xxmc,x.xysh,x.xxsh,x.xydm,x.zydm,x.bjdm,x.nj,g.kh from view_xsjxjzxjsq x,"
			+ "(select a.kh from view_xsxxb a where 1=2) g where 1=2";
		outString = dao.getColumnName(sql);// 获得view_xsjxjzxjsq的列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
		String pkVal = "";
		String xh = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;
			if (titName.equalsIgnoreCase("gjjxj")) {
				sql1 = "select gjjxjsqkssj,gjjxjsqjssj from xszhsjb a,"
					+ "view_xsjbxx b where a.zydm=b.xydm and b.xh=? ";// ,nd
				// and
				// substr(gjjxjsqkssj,1,4)=?
				jxjksjssj = dao.getOneRs(sql1, new String[] { xh },
						new String[] { "gjjxjsqkssj", "gjjxjsqjssj" });
			} else if (titName.equalsIgnoreCase("gjzxj")) {
				sql1 = "select gjzxjsqkssj,gjzxjsqjssj from xszhsjb a,"
					+ "view_xsjbxx b where a.XYDM=b.xydm and b.xh=? ";// and
				// substr(gjjxjsqkssj,1,4)=?
				jxjksjssj = dao.getOneRs(sql1, new String[] { xh },
						new String[] { "gjzxjsqkssj", "gjzxjsqjssj" });
			} else if (titName.equalsIgnoreCase("szfjxj")) {
				sql1 = "select szfjxjsqkssj,szfjxjsqjssj from xszhsjb a,"
					+ "view_xsjbxx b where a.XYDM=b.xydm and b.xh=? ";// and
				// substr(gjjxjsqkssj,1,4)=?
				jxjksjssj = dao.getOneRs(sql1, new String[] { xh },
						new String[] { "szfjxjsqkssj", "szfjxjsqjssj" });
			} else if (titName.equalsIgnoreCase("szfzxj")) {
				sql1 = "select szfzxjsqkssj,szfzxjsqjssj from xszhsjb a,"
					+ "view_xsjbxx b where a.XYDM=b.xydm and b.xh=? ";// and
				// substr(gjjxjsqkssj,1,4)=?
				jxjksjssj = dao.getOneRs(sql1, new String[] { xh },
						new String[] { "szfzxjsqkssj", "szfzxjsqjssj" });
			} else if (titName.equalsIgnoreCase("lyjszxjsq")) {
				sql1 = "select lyjszxjkssj,lyjszxjjssj from xszhsjb a,"
					+ "view_xsjbxx b where a.XYDM=b.xydm and b.xh=? ";// and
				// substr(gjjxjsqkssj,1,4)=?
				jxjksjssj = dao.getOneRs(sql1, new String[] { xh },
						new String[] { "lyjszxjkssj", "lyjszxjjssj" });
			}

			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) < 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) > 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String csny = DealString.toGBK(request.getParameter("csny")
							.toString());
					String rxny = DealString.toGBK(request.getParameter("rxny")
							.toString());
					String byny = DealString.toGBK(request.getParameter("byny")
							.toString());
					String lxdh = DealString.toGBK(request.getParameter("lxdh")
							.toString());
					String jlxx = DealString.toGBK(
							request.getParameter("jlxx").toString());
					String radJthk = DealString.toGBK(request.getParameter(
					"radJthk").toString());
					String hkrs = DealString.toGBK(request.getParameter("hkrs")
							.toString());
					String jtyzsr = DealString.toGBK(request.getParameter(
					"jtyzsr").toString());
					String jtrjsr = DealString.toGBK(request.getParameter(
					"jtrjsr").toString());
					String jtsrly = DealString.toGBK(request.getParameter(
					"jtsrly").toString());
					String yzbm = DealString.toGBK(request.getParameter("yzbm")
							.toString());
					String jtzz = DealString.toGBK(
							request.getParameter("jtzz").toString());
					String JTCY1_XM = DealString.toGBK(request.getParameter(
					"JTCY1_XM").toString());
					String JTCY1_nl = DealString.toGBK(request.getParameter(
					"JTCY1_nl").toString());
					String JTCY1_GX = DealString.toGBK(request.getParameter(
					"JTCY1_GX").toString());
					String JTCY1_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY1_GZDZ").toString());
					String JTCY2_XM = DealString.toGBK(request.getParameter(
					"JTCY2_XM").toString());
					String JTCY2_nl = DealString.toGBK(request.getParameter(
					"JTCY2_nl").toString());
					String JTCY2_GX = DealString.toGBK(request.getParameter(
					"JTCY2_GX").toString());
					String JTCY2_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY2_GZDZ").toString());
					String JTCY3_XM = DealString.toGBK(request.getParameter(
					"JTCY3_XM").toString());
					String JTCY3_nl = DealString.toGBK(request.getParameter(
					"JTCY3_nl").toString());
					String JTCY3_GX = DealString.toGBK(request.getParameter(
					"JTCY3_GX").toString());
					String JTCY3_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY3_GZDZ").toString());
					String JTCY4_XM = DealString.toGBK(request.getParameter(
					"JTCY4_XM").toString());
					String JTCY4_nl = DealString.toGBK(request.getParameter(
					"JTCY4_nl").toString());
					String JTCY4_GX = DealString.toGBK(request.getParameter(
					"JTCY4_GX").toString());
					String JTCY4_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY4_GZDZ").toString());
					String JTCY5_XM = DealString.toGBK(request.getParameter(
					"JTCY5_XM").toString());
					String JTCY5_nl = DealString.toGBK(request.getParameter(
					"JTCY5_nl").toString());
					String JTCY5_GX = DealString.toGBK(request.getParameter(
					"JTCY5_GX").toString());
					String JTCY5_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY5_GZDZ").toString());
					String sqly = DealString.toGBK(
							request.getParameter("sqly").toString());
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd + titName;
					}

					sql = "select xxsh from xsjxjzxjsqb where xh||nd||jzxjmc=?";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal }, new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("xsjxjzxjsqb",
								"xh||nd||jxjmc", pkVal, request);

						jzxjmc = "龙元建设助学金";
						colName1 = new String[] { "xh", "csny", "rxny", "byny",
								"lxdh", "jlxx", "radJthk", "hkrs", "jtyzsr",
								"jtrjsr", "jtsrly", "yzbm", "jtzz", "JTCY1_XM",
								"JTCY1_nl", "JTCY1_GX", "JTCY1_GZDZ",
								"JTCY2_XM", "JTCY2_nl", "JTCY2_GX",
								"JTCY2_GZDZ", "JTCY3_XM", "JTCY3_nl",
								"JTCY3_GX", "JTCY3_GZDZ", "JTCY4_XM",
								"JTCY4_nl", "JTCY4_GX", "JTCY4_GZDZ",
								"JTCY5_XM", "JTCY5_nl", "JTCY5_GX",
								"JTCY5_GZDZ", "sqly", "JZXJMC", "jzxjzwmc",
								"nd" };

						String[] valueForOut = new String[] { xh, csny, rxny,
								byny, lxdh, jlxx, radJthk, hkrs, jtyzsr,
								jtrjsr, jtsrly, yzbm, jtzz, JTCY1_XM, JTCY1_nl,
								JTCY1_GX, JTCY1_GZDZ, JTCY2_XM, JTCY2_nl,
								JTCY2_GX, JTCY2_GZDZ, JTCY3_XM, JTCY3_nl,
								JTCY3_GX, JTCY3_GZDZ, JTCY4_XM, JTCY4_nl,
								JTCY4_GX, JTCY4_GZDZ, JTCY5_XM, JTCY5_nl,
								JTCY5_GX, JTCY5_GZDZ, sqly, titName, jzxjmc, nd };

						boolean ok = false;
						ok = StandardOperation.insert("xsjxjzxjsqb", colName1,
								valueForOut, request);
						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String csny = DealString.toGBK(request.getParameter("csny")
						.toString());
				String rxny = DealString.toGBK(request.getParameter("rxny")
						.toString());
				String byny = DealString.toGBK(request.getParameter("byny")
						.toString());
				String lxdh = DealString.toGBK(request.getParameter("lxdh")
						.toString());
				String jlxx = DealString.toGBK(
						request.getParameter("jlxx").toString());
				String radJthk = DealString.toGBK(request.getParameter(
				"radJthk").toString());
				String hkrs = DealString.toGBK(request.getParameter("hkrs")
						.toString());
				String jtyzsr = DealString.toGBK(request.getParameter("jtyzsr")
						.toString());
				String jtrjsr = DealString.toGBK(request.getParameter("jtrjsr")
						.toString());
				String jtsrly = DealString.toGBK(request.getParameter("jtsrly")
						.toString());
				String yzbm = DealString.toGBK(request.getParameter("yzbm")
						.toString());
				String jtzz = DealString.toGBK(
						request.getParameter("jtzz").toString());
				String JTCY1_XM = DealString.toGBK(request.getParameter(
				"JTCY1_XM").toString());
				String JTCY1_nl = DealString.toGBK(request.getParameter(
				"JTCY1_nl").toString());
				String JTCY1_GX = DealString.toGBK(request.getParameter(
				"JTCY1_GX").toString());
				String JTCY1_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY1_GZDZ").toString());
				String JTCY2_XM = DealString.toGBK(request.getParameter(
				"JTCY2_XM").toString());
				String JTCY2_nl = DealString.toGBK(request.getParameter(
				"JTCY2_nl").toString());
				String JTCY2_GX = DealString.toGBK(request.getParameter(
				"JTCY2_GX").toString());
				String JTCY2_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY2_GZDZ").toString());
				String JTCY3_XM = DealString.toGBK(request.getParameter(
				"JTCY3_XM").toString());
				String JTCY3_nl = DealString.toGBK(request.getParameter(
				"JTCY3_nl").toString());
				String JTCY3_GX = DealString.toGBK(request.getParameter(
				"JTCY3_GX").toString());
				String JTCY3_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY3_GZDZ").toString());
				String JTCY4_XM = DealString.toGBK(request.getParameter(
				"JTCY4_XM").toString());
				String JTCY4_nl = DealString.toGBK(request.getParameter(
				"JTCY4_nl").toString());
				String JTCY4_GX = DealString.toGBK(request.getParameter(
				"JTCY4_GX").toString());
				String JTCY4_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY4_GZDZ").toString());
				String JTCY5_XM = DealString.toGBK(request.getParameter(
				"JTCY5_XM").toString());
				String JTCY5_nl = DealString.toGBK(request.getParameter(
				"JTCY5_nl").toString());
				String JTCY5_GX = DealString.toGBK(request.getParameter(
				"JTCY5_GX").toString());
				String JTCY5_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY5_GZDZ").toString());
				String sqly = DealString.toGBK(
						request.getParameter("sqly").toString());
				pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = xh + nd + titName;
				}

				sql = "select xxsh from xsjxjzxjsqb where xh||nd||jzxjmc=?";
				String[] temp = dao.getOneRs(sql, new String[] { pkVal }, new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("xsjxjzxjsqb", "xh||nd||jxjmc", pkVal, request);

					jzxjmc = "龙元建设助学金";
					colName1 = new String[] { "xh", "csny", "rxny", "byny",
							"lxdh", "jlxx", "radJthk", "hkrs", "jtyzsr",
							"jtrjsr", "jtsrly", "yzbm", "jtzz", "JTCY1_XM",
							"JTCY1_nl", "JTCY1_GX", "JTCY1_GZDZ",
							"JTCY2_XM", "JTCY2_nl", "JTCY2_GX",
							"JTCY2_GZDZ", "JTCY3_XM", "JTCY3_nl",
							"JTCY3_GX", "JTCY3_GZDZ", "JTCY4_XM",
							"JTCY4_nl", "JTCY4_GX", "JTCY4_GZDZ",
							"JTCY5_XM", "JTCY5_nl", "JTCY5_GX",
							"JTCY5_GZDZ", "sqly", "JZXJMC", "jzxjzwmc",
							"nd" };

					String[] valueForOut = new String[] { xh, csny, rxny,
							byny, lxdh, jlxx, radJthk, hkrs, jtyzsr,
							jtrjsr, jtsrly, yzbm, jtzz, JTCY1_XM, JTCY1_nl,
							JTCY1_GX, JTCY1_GZDZ, JTCY2_XM, JTCY2_nl,
							JTCY2_GX, JTCY2_GZDZ, JTCY3_XM, JTCY3_nl,
							JTCY3_GX, JTCY3_GZDZ, JTCY4_XM, JTCY4_nl,
							JTCY4_GX, JTCY4_GZDZ, JTCY5_XM, JTCY5_nl,
							JTCY5_GX, JTCY5_GZDZ, sqly, titName, jzxjmc, nd };

					boolean ok = false;
					ok = StandardOperation.insert("xsjxjzxjsqb", colName1,
							valueForOut, request);
					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		}

		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd + titName;
		}
		sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
			+ "from (select x.xh,x.xm,x.nd,x.csny,x.rxny,x.byny,"
			+ "x.lxdh,x.sfzh,x.xb,x.bjmc,x.xy,x.mzmc,x.JTCY1_XM,x.JTCY1_NL,"
			+ "x.JTCY1_GX,x.JTCY1_GZDZ,x.JTCY2_XM,x.JTCY2_NL,x.JTCY2_GX,"
			+ "x.JTCY2_GZDZ,x.JTCY3_XM,x.JTCY3_NL,x.JTCY3_GX,x.JTCY3_GZDZ,"
			+ "x.JTCY4_XM,x.JTCY4_NL,x.JTCY4_GX,x.JTCY4_GZDZ,x.JTCY5_XM,"
			+ "x.JTCY5_NL,x.JTCY5_GX,x.JTCY5_GZDZ,x.sfkns,x.sqsj,x.jzxjmc,"
			+ "x.jlxx,x.hkrs,x.jtyzsr,x.jtrjsr,x.jtsrly,x.jtzz,x.sqly,x.xyshyj,"
			+ "x.xxshyj,x.yzbm,x.radjthk,x.XMC,x.xxmc,x.xysh,x.xxsh,x.xydm,"
			+ "x.zydm,x.bjdm,x.nj from view_xsjxjzxjsq x where x.xh||x.nd||x.jzxjmc=?) a";
		outValue = dao.getOneRs(sql, new String[] { pkVal },
				outString);
		outString = new String[] { "xh", "xm", "nd", "csny", "rxny", "byny",
				"lxdh", "sfzh", "xb", "bjmc", "xy", "mzmc", "JTCY1_XM",
				"JTCY1_nl", "JTCY1_GX", "JTCY1_GZDZ", "JTCY2_XM", "JTCY2_nl",
				"JTCY2_GX", "JTCY2_GZDZ", "JTCY3_XM", "JTCY3_nl", "JTCY3_GX",
				"JTCY3_GZDZ", "JTCY4_XM", "JTCY4_nl", "JTCY4_GX", "JTCY4_GZDZ",
				"JTCY5_XM", "JTCY5_nl", "JTCY5_GX", "JTCY5_GZDZ", "sfkns",
				"sqsj", "jxjmc", "jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly",
				"jtzz", "sqly", "xyshyj", "xxshyj", "yzbm", "radJthk", "xmc",
				"xxmc", "xysh", "xxsh", "kh" };

		boolean isSHGC = false;
		boolean isKNS = false;
		String xxdm = StandardOperation.getXxdm();
		if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
			isSHGC = true;
		}
		if (outValue == null) {
			if (xh != null) {
				if (isSHGC) {
					sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
						+ "from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,q.MZMC mz,"
						+ "v.zymc xi,x.xxmc,v.jtfk,v.jtfkrs,v.jtyzsr,v.jtrjsr,v.jtsrly,v.yzbm,v.jtzz,"
						+ "v.jtcy1_xm,v.jtcy1_gx,v.jtcy1_nl,v.jtcy1_gzdw,"
						+ "v.jtcy2_xm,v.jtcy2_gx,v.jtcy2_nl,v.jtcy2_gzdw,"
						+ "v.jtcy3_xm,v.jtcy3_gx,v.jtcy3_nl,v.jtcy3_gzdw,"
						+ "v.jtcy4_xm,v.jtcy4_gx,v.jtcy4_nl,v.jtcy4_gzdw,"
						+ "v.jtcy5_xm,v.jtcy5_gx,v.jtcy5_nl,v.jtcy5_gzdw,q.csrq csny,"
						+ "(select j.rxny from bks_xsjbxx j where j.xh=v.xh) rxny "
						+ "from view_knsxx v,view_stu_details q,xtszb x "
						+ "where v.xh = q.xh and "
						+ "v.xxsh = '通过' and v.xh=?) a";
					String[] temp = new String[] { "xh", "xm", "xb", "bjmc",
							"xymc", "mz", "xi", "xxmc", "jtfk", "jtfkrs",
							"jtyzsr", "jtrjsr", "jtsrly", "yzbm", "jtzz",
							"jtcy1_xm", "jtcy1_gx", "jtcy1_nl", "jtcy1_gzdw",
							"jtcy2_xm", "jtcy2_gx", "jtcy2_nl", "jtcy2_gzdw",
							"jtcy3_xm", "jtcy3_gx", "jtcy3_nl", "jtcy3_gzdw",
							"jtcy4_xm", "jtcy4_gx", "jtcy4_nl", "jtcy4_gzdw",
							"jtcy5_xm", "jtcy5_gx", "jtcy5_nl", "jtcy5_gzdw",
							"csny", "rxny", "kh" };
					String[] outValT = dao.getOneRs(sql, new String[] { xh },
							temp);

					if (outValT == null) {

						sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
							+ "from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,"
							+ "q.MZMC mz,v.zymc xi,x.xxmc,q.csrq csny,"
							+ "(select j.rxny from bks_xsjbxx j where j.xh=v.xh) rxny from "
							+ "view_xsjbxx v,view_stu_details q,xtszb x where "
							+ "v.xh = q.xh and v.xh=?) a ";
						String[] colName = new String[] { "xh", "xm", "xb",
								"bjmc", "xymc", "mz", "xi", "xxmc", "csny",
								"rxny", "kh" };
						String[] outVal = dao.getOneRs(sql,
								new String[] { xh }, colName);
						if (outVal == null) {

						} else {
							colName = new String[] { "xh", "xm", "xb", "bjmc",
									"xy", "mzmc", "xmc", "xxmc", "csny",
									"rxny", "kh" };
							for (int i = 0; i < colName.length; i++) {
								if (outVal[i] != null) {
									map.put(colName[i], outVal[i]);
								} else {
									map.put(colName[i], "");
								}
							}
						}
					} else {
						isKNS = true;
						temp = new String[] { "xh", "xm", "xb", "bjmc", "xy",
								"mzmc", "xmc", "xxmc", "radJthk", "hkrs",
								"jtyzsr", "jtrjsr", "jtsrly", "yzbm", "jtzz",
								"JTCY1_XM", "JTCY1_GX", "JTCY1_nl",
								"JTCY1_GZDZ", "JTCY2_XM", "JTCY2_GX",
								"JTCY2_nl", "JTCY2_GZDZ", "JTCY3_XM",
								"JTCY3_GX", "JTCY3_nl", "JTCY3_GZDZ",
								"JTCY4_XM", "JTCY4_GX", "JTCY4_nl",
								"JTCY4_GZDZ", "JTCY5_XM", "JTCY5_GX",
								"JTCY5_nl", "JTCY5_GZDZ", "csny", "rxny", "kh" };
						for (int i = 0; i < temp.length; i++) {
							if (outValT[i] != null) {
								map.put(temp[i], outValT[i]);
							} else {
								map.put(temp[i], "");
							}
						}
					}
				} else {
					sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
						+ "from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,"
						+ "q.MZMC mz,v.zymc xi,x.xxmc,q.csrq csny,"
						+ "(select j.rxny from bks_xsjbxx j where j.xh=v.xh) rxny from "
						+ "view_xsjbxx v,view_stu_details q,xtszb x where "
						+ "v.xh = q.xh and v.xh=?) a ";
					String[] colName = new String[] { "xh", "xm", "xb", "bjmc",
							"xymc", "mz", "xi", "xxmc", "csny", "rxny", "kh" };
					String[] outVal = dao.getOneRs(sql, new String[] { xh },
							colName);
					if (outVal == null) {

					} else {
						colName = new String[] { "xh", "xm", "xb", "bjmc",
								"xy", "mzmc", "xmc", "xxmc", "csny", "rxny",
						"kh" };
						for (int i = 0; i < colName.length; i++) {
							if (outVal[i] != null) {
								map.put(colName[i], outVal[i]);
							} else {
								map.put(colName[i], "");
							}
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		if (isSHGC && isKNS) {
			request.setAttribute("isSHGCKNS", "is");
		} else {
			request.setAttribute("isSHGCKNS", "no");
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward lyjszxjsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String titleName = request.getParameter("titName");
		String sqlb = "";
		if (titleName.equalsIgnoreCase("lyjszxjsqb")) {
			sqlb = "龙元建设助学金";
		} else {
			sqlb = "龙元建设助学金";
		}

		String xh = DealString.toGBK(request.getParameter("xh"));
		String xm = request.getParameter("xm");
		String csny = request.getParameter("csny");
		String xb = request.getParameter("xb");
		String rxny = request.getParameter("rxny");
		String byny = request.getParameter("byny");
		String lxdh = request.getParameter("lxdh");
		String mzmc = request.getParameter("mzmc");
		String xxmc = request.getParameter("xxmc");
		String xy = request.getParameter("xy");
		String xmc = request.getParameter("xmc");
		String bjmc = request.getParameter("bjmc");
		String jlxx = request.getParameter("jlxx");
		String radjthk = request.getParameter("radJthk");
		String hkrs = request.getParameter("hkrs");
		String jtyzsr = request.getParameter("jtyzsr");
		String jtrjsr = request.getParameter("jtrjsr");
		String jtsrly = request.getParameter("jtsrly");
		String yzbm = request.getParameter("yzbm");
		String jtzz = request.getParameter("jtzz");
		String jtcy1_xm = request.getParameter("JTCY1_XM");
		String jtcy1_nl = request.getParameter("JTCY1_nl");
		String jtcy1_gx = request.getParameter("JTCY1_GX");
		String jtcy1_gzdz = request.getParameter("JTCY1_GZDZ");
		String jtcy2_xm = request.getParameter("JTCY2_XM");
		String jtcy2_nl = request.getParameter("JTCY2_nl");
		String jtcy2_gx = request.getParameter("JTCY2_GX");
		String jtcy2_gzdz = request.getParameter("JTCY2_GZDZ");
		String jtcy3_xm = request.getParameter("JTCY3_XM");
		String jtcy3_nl = request.getParameter("JTCY3_nl");
		String jtcy3_gx = request.getParameter("JTCY3_GX");
		String jtcy3_gzdz = request.getParameter("JTCY3_GZDZ");
		String jtcy4_xm = request.getParameter("JTCY4_XM");
		String jtcy4_nl = request.getParameter("JTCY4_nl");
		String jtcy4_gx = request.getParameter("JTCY4_GX");
		String jtcy4_gzdz = request.getParameter("JTCY4_GZDZ");
		String jtcy5_xm = request.getParameter("JTCY5_XM");
		String jtcy5_nl = request.getParameter("JTCY5_nl");
		String jtcy5_gx = request.getParameter("JTCY5_GX");
		String jtcy5_gzdz = request.getParameter("JTCY5_GZDZ");
		String sqly = request.getParameter("sqly");
		String xyshyj = request.getParameter("xyshyj");
		String xxshyj = request.getParameter("xxshyj");

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xh, xm, rxny, byny, lxdh, xb, bjmc,
				xy, mzmc, xxmc, jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdz,
				jtcy2_xm, jtcy2_nl, jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_nl,
				jtcy3_gx, jtcy3_gzdz, jtcy4_xm, jtcy4_nl, jtcy4_gx, jtcy4_gzdz,
				jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_gzdz, jlxx, hkrs, jtyzsr,
				jtrjsr, jtsrly, jtzz, sqly, xyshyj, xxshyj, yzbm, radjthk,
				csny, xmc };
		String[] outString = new String[] { "xh", "xm", "rxny", "byny", "lxdh",
				"xb", "bjmc", "xy", "mzmc", "xxmc", "jtcy1_xm", "jtcy1_nl",
				"jtcy1_gx", "jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
				"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx", "jtcy3_gzdz",
				"jtcy4_xm", "jtcy4_nl", "jtcy4_gx", "jtcy4_gzdz", "jtcy5_xm",
				"jtcy5_nl", "jtcy5_gx", "jtcy5_gzdz", "jlxx", "hkrs", "jtyzsr",
				"jtrjsr", "jtsrly", "jtzz", "sqly", "xyshyj", "xxshyj", "yzbm",
				"radjthk", "csny", "xmc" };
		// System.out.println(outString[35]+outValue[35]);
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				// System.out.println("i="+i+" "+outString[i]);
				map.put(outString[i], DealString.toGBK(outValue[i]));
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward lstdsq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {// 绿色通道申请

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;
		String[] colName1 = null;

		String xxdm = StandardOperation.getXxdm();
		if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
			String doType = request.getParameter("doType");// 操作类型
			String titName = request.getParameter("titName");// 访问助学金还是奖学金

			String sfksq = "-1";// 是否可申请参数，-1表示不可以，1表示可以。

			String[] pages = null;
			String[] titNames = null;
			String rightNow = (dao
					.getOneRs(
							"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
							new String[] {}, new String[] { "sdate" }))[0];
			pages = new String[] { "学生及家庭情况调查表" };
			titNames = new String[] { "lstdsq" };

			if (titName == null)
				titName = titNames[0];

			request.setAttribute("titName", titName);
			List pagesList = dao.arrayToList(titNames, pages);
			request.setAttribute("pages", pagesList);
			String sql = "";
			String sql1 = "";// 用于获取设置的申请时间
			String[] outString = new String[] {};
			request.setAttribute("isXNMZ", "is");
			sql = "select xh,xxmc,xymc,xmc,nj,xm,xb,csny,mzmc,sfzh,zzmm,rxqhk,"
				+ "jtrks,byxx,grtc,sfgc,sfdq,sflszn,jtxxtxdz,jtyzbm,jtlxdh,"
				+ "jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdw,jtcy1_zy,jtcy1_nsr,jtcy1_jkzk,"
				+ "jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdw,jtcy2_zy,jtcy2_nsr,jtcy2_jkzk,"
				+ "jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdw,jtcy3_zy,jtcy3_nsr,jtcy3_jkzk,"
				+ "jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdw,jtcy4_zy,jtcy4_nsr,jtcy4_jkzk,"
				+ "jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdw,jtcy5_zy,jtcy5_nsr,jtcy5_jkzk,"
				+ "jtrjnsr,xsyhhjqk,jtzszrzhqk,jtzstfywsj,jtcyndlrqk,jtcysyqk,jtqzqk,"
				+ "qtqk,mzbmxxtxdz,mzbmyzbm,mzbmlxdh from view_xsjtqkdcb where 1=2";
			outString = dao.getColumnName(sql);// 获得lstdsq的列名数组
			String[] outValue = null;
			HashMap<String, String> map = new HashMap<String, String>();
			String xh = "";
			if (userType.equalsIgnoreCase("stu")) {
				xh = sUName;
				String[] jxjksjssj = null;

				sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
						+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='绿色通道' and b.xh=? ";
				jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
						"kssj", "jssj" });
				if (jxjksjssj != null
						&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
						&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
					sfksq = "1";// /可以进行申请
					request.setAttribute("sfksq", sfksq);
					if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
						String xm = DealString.toGBK(request.getParameter("xm")
								.toString());
						String xb = DealString.toGBK(request.getParameter("xb")
								.toString());
						String csny = DealString.toGBK(request.getParameter(
						"csny").toString());
						String mzmc = DealString.toGBK(request.getParameter(
						"mzmc").toString());
						String sfzh = DealString.toGBK(request.getParameter(
						"sfzh").toString());
						String zzmm = DealString.toGBK(request.getParameter(
						"zzmm").toString());
						String rxqhk = DealString.toGBK(request.getParameter(
						"rxqhk").toString());
						String jtrks = DealString.toGBK(request.getParameter(
						"jtrks").toString());
						String byxx = DealString.toGBK(request.getParameter(
						"byxx").toString());
						String grtc = DealString.toGBK(request.getParameter(
						"grtc").toString());
						String sfgc = DealString.toGBK(request.getParameter(
						"sfgc").toString());
						String sfdq = DealString.toGBK(request.getParameter(
						"sfdq").toString());
						String sflszn = DealString.toGBK(request.getParameter(
						"sflszn").toString());
						String jtxxtxdz = DealString.toGBK(request
								.getParameter("jtxxtxdz").toString());
						String jtyzbm = DealString.toGBK(request.getParameter(
						"jtyzbm").toString());
						String jtlxdh = DealString.toGBK(request.getParameter(
						"jtlxdh").toString());
						String jtcy1_xm = DealString.toGBK(request
								.getParameter("jtcy1_xm").toString());
						String jtcy1_nl = DealString.toGBK(request
								.getParameter("jtcy1_nl").toString());
						String jtcy1_gx = DealString.toGBK(request
								.getParameter("jtcy1_gx").toString());
						String jtcy1_gzdw = DealString.toGBK(request
								.getParameter("jtcy1_gzdw").toString());
						String jtcy1_zy = DealString.toGBK(request
								.getParameter("jtcy1_zy").toString());
						String jtcy1_nsr = DealString.toGBK(request
								.getParameter("jtcy1_nsr").toString());
						String jtcy1_jkzk = DealString.toGBK(request
								.getParameter("jtcy1_jkzk").toString());
						String jtcy2_xm = DealString.toGBK(request
								.getParameter("jtcy2_xm").toString());
						String jtcy2_nl = DealString.toGBK(request
								.getParameter("jtcy2_nl").toString());
						String jtcy2_gx = DealString.toGBK(request
								.getParameter("jtcy2_gx").toString());
						String jtcy2_gzdw = DealString.toGBK(request
								.getParameter("jtcy2_gzdw").toString());
						String jtcy2_zy = DealString.toGBK(request
								.getParameter("jtcy2_zy").toString());
						String jtcy2_nsr = DealString.toGBK(request
								.getParameter("jtcy2_nsr").toString());
						String jtcy2_jkzk = DealString.toGBK(request
								.getParameter("jtcy2_jkzk").toString());
						String jtcy3_xm = DealString.toGBK(request
								.getParameter("jtcy3_xm").toString());
						String jtcy3_nl = DealString.toGBK(request
								.getParameter("jtcy3_nl").toString());
						String jtcy3_gx = DealString.toGBK(request
								.getParameter("jtcy3_gx").toString());
						String jtcy3_gzdw = DealString.toGBK(request
								.getParameter("jtcy3_gzdw").toString());
						String jtcy3_zy = DealString.toGBK(request
								.getParameter("jtcy3_zy").toString());
						String jtcy3_nsr = DealString.toGBK(request
								.getParameter("jtcy3_nsr").toString());
						String jtcy3_jkzk = DealString.toGBK(request
								.getParameter("jtcy3_jkzk").toString());
						String jtcy4_xm = DealString.toGBK(request
								.getParameter("jtcy4_xm").toString());
						String jtcy4_nl = DealString.toGBK(request
								.getParameter("jtcy4_nl").toString());
						String jtcy4_gx = DealString.toGBK(request
								.getParameter("jtcy4_gx").toString());
						String jtcy4_gzdw = DealString.toGBK(request
								.getParameter("jtcy4_gzdw").toString());
						String jtcy4_zy = DealString.toGBK(request
								.getParameter("jtcy4_zy").toString());
						String jtcy4_nsr = DealString.toGBK(request
								.getParameter("jtcy4_nsr").toString());
						String jtcy4_jkzk = DealString.toGBK(request
								.getParameter("jtcy4_jkzk").toString());
						String jtcy5_xm = DealString.toGBK(request
								.getParameter("jtcy5_xm").toString());
						String jtcy5_nl = DealString.toGBK(request
								.getParameter("jtcy5_nl").toString());
						String jtcy5_gx = DealString.toGBK(request
								.getParameter("jtcy5_gx").toString());
						String jtcy5_gzdw = DealString.toGBK(request
								.getParameter("jtcy5_gzdw").toString());
						String jtcy5_zy = DealString.toGBK(request
								.getParameter("jtcy5_zy").toString());
						String jtcy5_nsr = DealString.toGBK(request
								.getParameter("jtcy5_nsr").toString());
						String jtcy5_jkzk = DealString.toGBK(request
								.getParameter("jtcy5_jkzk").toString());
						String jtrjnsr = DealString.toGBK(request.getParameter(
						"jtrjnsr").toString());
						String xsyhhjqk = DealString.toGBK(request
								.getParameter("xsyhhjqk").toString());
						String jtzszrzhqk = DealString.toGBK(request
								.getParameter("jtzszrzhqk").toString());
						String jtzstfywsj = DealString.toGBK(request
								.getParameter("jtzstfywsj").toString());
						String jtcyndlrqk = DealString.toGBK(request
								.getParameter("jtcyndlrqk").toString());
						String jtcysyqk = DealString.toGBK(request
								.getParameter("jtcysyqk").toString());
						String jtqzqk = DealString.toGBK(request.getParameter(
						"jtqzqk").toString());
						String qtqk = DealString.toGBK(request.getParameter(
						"qtqk").toString());
						String mzbmxxtxdz = DealString.toGBK(request
								.getParameter("mzbmxxtxdz").toString());
						String mzbmyzbm = DealString.toGBK(request
								.getParameter("mzbmyzbm").toString());
						String mzbmlxdh = DealString.toGBK(request
								.getParameter("mzbmlxdh").toString());

						sql = "select xxsh from xsjtqkdcb where xh=?";
						String[] temp = dao.getOneRs(sql, new String[] { xh },
								new String[] { "xxsh" });
						if ((temp != null)
								&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
										.equalsIgnoreCase(temp[0]))) {
							request.setAttribute("isPASS", "is");
						} else {
							StandardOperation.delete("xsjtqkdcb", "xh", xh,
									request);

							colName1 = new String[] { "xh", "xm", "xb", "csny",
									"mzmc", "sfzh", "zzmm", "rxqhk", "jtrks",
									"byxx", "grtc", "sfgc", "sfdq", "sflszn",
									"jtxxtxdz", "jtyzbm", "jtlxdh", "jtcy1_xm",
									"jtcy1_nl", "jtcy1_gx", "jtcy1_gzdw",
									"jtcy1_zy", "jtcy1_nsr", "jtcy1_jkzk",
									"jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
									"jtcy2_gzdw", "jtcy2_zy", "jtcy2_nsr",
									"jtcy2_jkzk", "jtcy3_xm", "jtcy3_nl",
									"jtcy3_gx", "jtcy3_gzdw", "jtcy3_zy",
									"jtcy3_nsr", "jtcy3_jkzk", "jtcy4_xm",
									"jtcy4_nl", "jtcy4_gx", "jtcy4_gzdw",
									"jtcy4_zy", "jtcy4_nsr", "jtcy4_jkzk",
									"jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
									"jtcy5_gzdw", "jtcy5_zy", "jtcy5_nsr",
									"jtcy5_jkzk", "jtrjnsr", "xsyhhjqk",
									"jtzszrzhqk", "jtzstfywsj", "jtcyndlrqk",
									"jtcysyqk", "jtqzqk", "qtqk", "mzbmxxtxdz",
									"mzbmyzbm", "mzbmlxdh" };

							String[] valueForOut = new String[] { xh, xm, xb,
									csny, mzmc, sfzh, zzmm, rxqhk, jtrks, byxx,
									grtc, sfgc, sfdq, sflszn, jtxxtxdz, jtyzbm,
									jtlxdh, jtcy1_xm, jtcy1_nl, jtcy1_gx,
									jtcy1_gzdw, jtcy1_zy, jtcy1_nsr,
									jtcy1_jkzk, jtcy2_xm, jtcy2_nl, jtcy2_gx,
									jtcy2_gzdw, jtcy2_zy, jtcy2_nsr,
									jtcy2_jkzk, jtcy3_xm, jtcy3_nl, jtcy3_gx,
									jtcy3_gzdw, jtcy3_zy, jtcy3_nsr,
									jtcy3_jkzk, jtcy4_xm, jtcy4_nl, jtcy4_gx,
									jtcy4_gzdw, jtcy4_zy, jtcy4_nsr,
									jtcy4_jkzk, jtcy5_xm, jtcy5_nl, jtcy5_gx,
									jtcy5_gzdw, jtcy5_zy, jtcy5_nsr,
									jtcy5_jkzk, jtrjnsr, xsyhhjqk, jtzszrzhqk,
									jtzstfywsj, jtcyndlrqk, jtcysyqk, jtqzqk,
									qtqk, mzbmxxtxdz, mzbmyzbm, mzbmlxdh };

							boolean ok = false;
							ok = StandardOperation.insert("xsjtqkdcb",
									colName1, valueForOut, request);
							if (ok) {
								logMsg = "申请" + titName;
								Base.log(request, logMsg, sUName);
								request.setAttribute("ok", "ok");
							} else {
								request.setAttribute("ok", "no");
							}
						}
					}
				} else {// 不在申请时间范围内
					sfksq = "-1";
					request.setAttribute("sfksq", sfksq);// 不能申请
				}
			} else if (!(userType.equalsIgnoreCase("stu"))) {
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				xh = xszzForm.getXh();
				if (doType != null && doType.equalsIgnoreCase("add")) {
					xh = DealString
					.toGBK(request.getParameter("xh").toString());
					String xm = DealString.toGBK(request.getParameter("xm")
							.toString());
					String xb = DealString.toGBK(request.getParameter("xb")
							.toString());
					String csny = DealString.toGBK(request.getParameter("csny")
							.toString());
					String mzmc = DealString.toGBK(request.getParameter("mzmc")
							.toString());
					String sfzh = DealString.toGBK(request.getParameter("sfzh")
							.toString());
					String zzmm = DealString.toGBK(request.getParameter("zzmm")
							.toString());
					String rxqhk = DealString.toGBK(request.getParameter(
					"rxqhk").toString());
					String jtrks = DealString.toGBK(request.getParameter(
					"jtrks").toString());
					String byxx = DealString.toGBK(request.getParameter("byxx")
							.toString());
					String grtc = DealString.toGBK(request.getParameter("grtc")
							.toString());
					String sfgc = DealString.toGBK(request.getParameter("sfgc")
							.toString());
					String sfdq = DealString.toGBK(request.getParameter("sfdq")
							.toString());
					String sflszn = DealString.toGBK(request.getParameter(
					"sflszn").toString());
					String jtxxtxdz = DealString.toGBK(request.getParameter(
					"jtxxtxdz").toString());
					String jtyzbm = DealString.toGBK(request.getParameter(
					"jtyzbm").toString());
					String jtlxdh = DealString.toGBK(request.getParameter(
					"jtlxdh").toString());
					String jtcy1_xm = DealString.toGBK(request.getParameter(
					"jtcy1_xm").toString());
					String jtcy1_nl = DealString.toGBK(request.getParameter(
					"jtcy1_nl").toString());
					String jtcy1_gx = DealString.toGBK(request.getParameter(
					"jtcy1_gx").toString());
					String jtcy1_gzdw = DealString.toGBK(request.getParameter(
					"jtcy1_gzdw").toString());
					String jtcy1_zy = DealString.toGBK(request.getParameter(
					"jtcy1_zy").toString());
					String jtcy1_nsr = DealString.toGBK(request.getParameter(
					"jtcy1_nsr").toString());
					String jtcy1_jkzk = DealString.toGBK(request.getParameter(
					"jtcy1_jkzk").toString());
					String jtcy2_xm = DealString.toGBK(request.getParameter(
					"jtcy2_xm").toString());
					String jtcy2_nl = DealString.toGBK(request.getParameter(
					"jtcy2_nl").toString());
					String jtcy2_gx = DealString.toGBK(request.getParameter(
					"jtcy2_gx").toString());
					String jtcy2_gzdw = DealString.toGBK(request.getParameter(
					"jtcy2_gzdw").toString());
					String jtcy2_zy = DealString.toGBK(request.getParameter(
					"jtcy2_zy").toString());
					String jtcy2_nsr = DealString.toGBK(request.getParameter(
					"jtcy2_nsr").toString());
					String jtcy2_jkzk = DealString.toGBK(request.getParameter(
					"jtcy2_jkzk").toString());
					String jtcy3_xm = DealString.toGBK(request.getParameter(
					"jtcy3_xm").toString());
					String jtcy3_nl = DealString.toGBK(request.getParameter(
					"jtcy3_nl").toString());
					String jtcy3_gx = DealString.toGBK(request.getParameter(
					"jtcy3_gx").toString());
					String jtcy3_gzdw = DealString.toGBK(request.getParameter(
					"jtcy3_gzdw").toString());
					String jtcy3_zy = DealString.toGBK(request.getParameter(
					"jtcy3_zy").toString());
					String jtcy3_nsr = DealString.toGBK(request.getParameter(
					"jtcy3_nsr").toString());
					String jtcy3_jkzk = DealString.toGBK(request.getParameter(
					"jtcy3_jkzk").toString());
					String jtcy4_xm = DealString.toGBK(request.getParameter(
					"jtcy4_xm").toString());
					String jtcy4_nl = DealString.toGBK(request.getParameter(
					"jtcy4_nl").toString());
					String jtcy4_gx = DealString.toGBK(request.getParameter(
					"jtcy4_gx").toString());
					String jtcy4_gzdw = DealString.toGBK(request.getParameter(
					"jtcy4_gzdw").toString());
					String jtcy4_zy = DealString.toGBK(request.getParameter(
					"jtcy4_zy").toString());
					String jtcy4_nsr = DealString.toGBK(request.getParameter(
					"jtcy4_nsr").toString());
					String jtcy4_jkzk = DealString.toGBK(request.getParameter(
					"jtcy4_jkzk").toString());
					String jtcy5_xm = DealString.toGBK(request.getParameter(
					"jtcy5_xm").toString());
					String jtcy5_nl = DealString.toGBK(request.getParameter(
					"jtcy5_nl").toString());
					String jtcy5_gx = DealString.toGBK(request.getParameter(
					"jtcy5_gx").toString());
					String jtcy5_gzdw = DealString.toGBK(request.getParameter(
					"jtcy5_gzdw").toString());
					String jtcy5_zy = DealString.toGBK(request.getParameter(
					"jtcy5_zy").toString());
					String jtcy5_nsr = DealString.toGBK(request.getParameter(
					"jtcy5_nsr").toString());
					String jtcy5_jkzk = DealString.toGBK(request.getParameter(
					"jtcy5_jkzk").toString());
					String jtrjnsr = DealString.toGBK(request.getParameter(
					"jtrjnsr").toString());
					String xsyhhjqk = DealString.toGBK(request.getParameter(
					"xsyhhjqk").toString());
					String jtzszrzhqk = DealString.toGBK(request.getParameter(
					"jtzszrzhqk").toString());
					String jtzstfywsj = DealString.toGBK(request.getParameter(
					"jtzstfywsj").toString());
					String jtcyndlrqk = DealString.toGBK(request.getParameter(
					"jtcyndlrqk").toString());
					String jtcysyqk = DealString.toGBK(request.getParameter(
					"jtcysyqk").toString());
					String jtqzqk = DealString.toGBK(request.getParameter(
					"jtqzqk").toString());
					String qtqk = DealString.toGBK(request.getParameter("qtqk")
							.toString());
					String mzbmxxtxdz = DealString.toGBK(request.getParameter(
					"mzbmxxtxdz").toString());
					String mzbmyzbm = DealString.toGBK(request.getParameter(
					"mzbmyzbm").toString());
					String mzbmlxdh = DealString.toGBK(request.getParameter(
					"mzbmlxdh").toString());

					sql = "select xxsh from xsjtqkdcb where xh=?";
					String[] temp = dao.getOneRs(sql, new String[] { xh },
							new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("xsjtqkdcb", "xh", xh,
								request);

						colName1 = new String[] { "xh", "xm", "xb", "csny",
								"mzmc", "sfzh", "zzmm", "rxqhk", "jtrks",
								"byxx", "grtc", "sfgc", "sfdq", "sflszn",
								"jtxxtxdz", "jtyzbm", "jtlxdh", "jtcy1_xm",
								"jtcy1_nl", "jtcy1_gx", "jtcy1_gzdw",
								"jtcy1_zy", "jtcy1_nsr", "jtcy1_jkzk",
								"jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
								"jtcy2_gzdw", "jtcy2_zy", "jtcy2_nsr",
								"jtcy2_jkzk", "jtcy3_xm", "jtcy3_nl",
								"jtcy3_gx", "jtcy3_gzdw", "jtcy3_zy",
								"jtcy3_nsr", "jtcy3_jkzk", "jtcy4_xm",
								"jtcy4_nl", "jtcy4_gx", "jtcy4_gzdw",
								"jtcy4_zy", "jtcy4_nsr", "jtcy4_jkzk",
								"jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
								"jtcy5_gzdw", "jtcy5_zy", "jtcy5_nsr",
								"jtcy5_jkzk", "jtrjnsr", "xsyhhjqk",
								"jtzszrzhqk", "jtzstfywsj", "jtcyndlrqk",
								"jtcysyqk", "jtqzqk", "qtqk", "mzbmxxtxdz",
								"mzbmyzbm", "mzbmlxdh" };

						String[] valueForOut = new String[] { xh, xm, xb,
								csny, mzmc, sfzh, zzmm, rxqhk, jtrks, byxx,
								grtc, sfgc, sfdq, sflszn, jtxxtxdz, jtyzbm,
								jtlxdh, jtcy1_xm, jtcy1_nl, jtcy1_gx,
								jtcy1_gzdw, jtcy1_zy, jtcy1_nsr,
								jtcy1_jkzk, jtcy2_xm, jtcy2_nl, jtcy2_gx,
								jtcy2_gzdw, jtcy2_zy, jtcy2_nsr,
								jtcy2_jkzk, jtcy3_xm, jtcy3_nl, jtcy3_gx,
								jtcy3_gzdw, jtcy3_zy, jtcy3_nsr,
								jtcy3_jkzk, jtcy4_xm, jtcy4_nl, jtcy4_gx,
								jtcy4_gzdw, jtcy4_zy, jtcy4_nsr,
								jtcy4_jkzk, jtcy5_xm, jtcy5_nl, jtcy5_gx,
								jtcy5_gzdw, jtcy5_zy, jtcy5_nsr,
								jtcy5_jkzk, jtrjnsr, xsyhhjqk, jtzszrzhqk,
								jtzstfywsj, jtcyndlrqk, jtcysyqk, jtqzqk,
								qtqk, mzbmxxtxdz, mzbmyzbm, mzbmlxdh };

						boolean ok = false;
						ok = StandardOperation.insert("xsjtqkdcb",
								colName1, valueForOut, request);
						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			}

			sql = "select xh,xxmc,xymc,xmc,nj,xm,xb,csny,mzmc,sfzh,zzmm,rxqhk,"
				+ "jtrks,byxx,grtc,sfgc,sfdq,sflszn,jtxxtxdz,jtyzbm,jtlxdh,"
				+ "jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdw,jtcy1_zy,jtcy1_nsr,jtcy1_jkzk,"
				+ "jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdw,jtcy2_zy,jtcy2_nsr,jtcy2_jkzk,"
				+ "jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdw,jtcy3_zy,jtcy3_nsr,jtcy3_jkzk,"
				+ "jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdw,jtcy4_zy,jtcy4_nsr,jtcy4_jkzk,"
				+ "jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdw,jtcy5_zy,jtcy5_nsr,jtcy5_jkzk,"
				+ "jtrjnsr,xsyhhjqk,jtzszrzhqk,jtzstfywsj,jtcyndlrqk,jtcysyqk,jtqzqk,"
				+ "qtqk,mzbmxxtxdz,mzbmyzbm,mzbmlxdh from view_xsjtqkdcb where xh=? ";
			outValue = dao.getOneRs(sql, new String[] { xh }, outString);
			outString = new String[] { "xh", "xxmc", "xymc", "xmc", "nj", "xm",
					"xb", "csny", "mzmc", "sfzh", "zzmm", "rxqhk", "jtrks",
					"byxx", "grtc", "sfgc", "sfdq", "sflszn", "jtxxtxdz",
					"jtyzbm", "jtlxdh", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
					"jtcy1_gzdw", "jtcy1_zy", "jtcy1_nsr", "jtcy1_jkzk",
					"jtcy2_xm", "jtcy2_nl", "jtcy2_gx", "jtcy2_gzdw",
					"jtcy2_zy", "jtcy2_nsr", "jtcy2_jkzk", "jtcy3_xm",
					"jtcy3_nl", "jtcy3_gx", "jtcy3_gzdw", "jtcy3_zy",
					"jtcy3_nsr", "jtcy3_jkzk", "jtcy4_xm", "jtcy4_nl",
					"jtcy4_gx", "jtcy4_gzdw", "jtcy4_zy", "jtcy4_nsr",
					"jtcy4_jkzk", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
					"jtcy5_gzdw", "jtcy5_zy", "jtcy5_nsr", "jtcy5_jkzk",
					"jtrjnsr", "xsyhhjqk", "jtzszrzhqk", "jtzstfywsj",
					"jtcyndlrqk", "jtcysyqk", "jtqzqk", "qtqk", "mzbmxxtxdz",
					"mzbmyzbm", "mzbmlxdh" };

			if (outValue == null) {
				if (xh != null) {
					sql = "select v.xh,v.xm,v.xb,x.xxmc,v.xymc,v.zymc xmc,v.nj,q.mzmc "
						+ "from view_xsjbxx v,view_stu_details q,xtszb x "
						+ "where v.xh = q.xh and v.xh=?";
					String[] colName = new String[] { "xh", "xm", "xb", "xxmc",
							"xymc", "xmc", "nj", "mzmc" };
					String[] outVal = dao.getOneRs(sql, new String[] { xh },
							colName);
					if (outVal != null) {
						colName = new String[] { "xh", "xm", "xb", "xxmc",
								"xymc", "xmc", "nj", "mzmc" };
						for (int i = 0; i < colName.length; i++) {
							if (outVal[i] != null) {
								map.put(colName[i], outVal[i]);
							} else {
								map.put(colName[i], "");
							}
						}
					}
				}
			} else {
				for (int i = 0; i < outString.length; i++) {
					if (outValue[i] != null) {
						map.put(outString[i], outValue[i]);
					} else {
						map.put(outString[i], "");
					}
				}
			}
			request.setAttribute("rs", map);
			return mapping.findForward("success");
		} else {
			String doType = request.getParameter("doType");// 操作类型
			String titName = request.getParameter("titName");// 访问助学金还是奖学金

			String sfksq = "-1";// 是否可申请参数，-1表示不可以，1表示可以。

			String[] pages = null;
			String[] titNames = null;
			String rightNow = (dao
					.getOneRs(
							"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
							new String[] {}, new String[] { "sdate" }))[0];
			pages = new String[] { "绿色通道" };
			titNames = new String[] { "lstdsq" };
			String pkVal = "";

			if (titName == null)
				titName = titNames[0];

			request.setAttribute("titName", titName);
			List pagesList = dao.arrayToList(titNames, pages);
			request.setAttribute("pages", pagesList);
			String sql = "";
			String sql1 = "";// 用于获取设置的申请时间
			String[] outString = new String[] {};
			request.setAttribute("isXNMZ", "no");
			sql = "select xh,xm,xb,mzmc,lxdh,xymc,xmc,bjmc,nd,sqsj,"
				+ "jtcy1_xm,jtcy1_gx,jtcy1_ysr,jtcy1_gzdz,"
				+ "jtcy2_xm,jtcy2_gx,jtcy2_ysr,jtcy2_gzdz,"
				+ "jtcy3_xm,jtcy3_gx,jtcy3_ysr,jtcy3_gzdz,"
				+ "jtcy4_xm,jtcy4_gx,jtcy4_ysr,jtcy4_gzdz,"
				+ "jtcy5_xm,jtcy5_gx,jtcy5_ysr,jtcy5_gzdz,"
				+ "sqly,xyshyj,xxshyj,xysh,xxsh,sfzh,jtlxdh,jtzz,hjje,hjqx from lstdsq where 1=2";
			outString = dao.getColumnName(sql);// 获得lstdsq的列名数组
			String[] outValue = null;
			HashMap<String, String> map = new HashMap<String, String>();
			String nd = Base.currNd;
			String xh = "";
			if (userType.equalsIgnoreCase("stu")) {
				xh = sUName;
				String[] jxjksjssj = null;
				sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='绿色通道' and b.xh=? ";
				jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
					"kssj", "jssj" });
				if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
					sfksq = "1";// /可以进行申请
					request.setAttribute("sfksq", sfksq);
					if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
						String xm = DealString.toGBK(request.getParameter("xm")
								.toString());
						String xb = DealString.toGBK(request.getParameter("xb")
								.toString());
						String sfzh = DealString.toGBK(request.getParameter("sfzh")
								.toString());
						String jtlxdh = DealString.toGBK(request.getParameter("jtlxdh")
								.toString());
						String jtzz = DealString.toGBK(request.getParameter("jtzz")
								.toString());
						String mzmc = DealString.toGBK(request.getParameter(
						"mzmc").toString());
						String lxdh = DealString.toGBK(request.getParameter(
						"lxdh").toString());
						String xymc = DealString.toGBK(request.getParameter(
						"xymc").toString());
						String xmc = DealString.toGBK(request.getParameter(
						"xmc").toString());
						String bjmc = DealString.toGBK(request.getParameter(
						"bjmc").toString());
						String JTCY1_XM = DealString.toGBK(request
								.getParameter("JTCY1_XM").toString());
						String JTCY1_ysr = DealString.toGBK(request
								.getParameter("JTCY1_ysr").toString());
						String JTCY1_GX = DealString.toGBK(request
								.getParameter("JTCY1_GX").toString());
						String JTCY1_GZDZ = DealString.toGBK(request
								.getParameter("JTCY1_GZDZ").toString());
						String JTCY2_XM = DealString.toGBK(request
								.getParameter("JTCY2_XM").toString());
						String JTCY2_ysr = DealString.toGBK(request
								.getParameter("JTCY2_ysr").toString());
						String JTCY2_GX = DealString.toGBK(request
								.getParameter("JTCY2_GX").toString());
						String JTCY2_GZDZ = DealString.toGBK(request
								.getParameter("JTCY2_GZDZ").toString());
						String JTCY3_XM = DealString.toGBK(request
								.getParameter("JTCY3_XM").toString());
						String JTCY3_ysr = DealString.toGBK(request
								.getParameter("JTCY3_ysr").toString());
						String JTCY3_GX = DealString.toGBK(request
								.getParameter("JTCY3_GX").toString());
						String JTCY3_GZDZ = DealString.toGBK(request
								.getParameter("JTCY3_GZDZ").toString());
						String JTCY4_XM = DealString.toGBK(request
								.getParameter("JTCY4_XM").toString());
						String JTCY4_ysr = DealString.toGBK(request
								.getParameter("JTCY4_ysr").toString());
						String JTCY4_GX = DealString.toGBK(request
								.getParameter("JTCY4_GX").toString());
						String JTCY4_GZDZ = DealString.toGBK(request
								.getParameter("JTCY4_GZDZ").toString());
						String JTCY5_XM = DealString.toGBK(request
								.getParameter("JTCY5_XM").toString());
						String JTCY5_ysr = DealString.toGBK(request
								.getParameter("JTCY5_ysr").toString());
						String JTCY5_GX = DealString.toGBK(request
								.getParameter("JTCY5_GX").toString());
						String JTCY5_GZDZ = DealString.toGBK(request
								.getParameter("JTCY5_GZDZ").toString());
						String sqly = DealString.toGBK(
								request.getParameter("sqly").toString());
						String hjje = DealString.toGBK(
								request.getParameter("hjje").toString());
						String hjqx = DealString.toGBK(
								request.getParameter("hjje").toString());
						pkVal = request.getParameter("pkVal");
						if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
							pkVal = DealString.toGBK(pkVal);
						} else {
							pkVal = xh + nd;
						}

						sql = "select xxsh from lstdsq where xh||nd=?";
						String[] temp = dao.getOneRs(sql,
								new String[] { pkVal },
								new String[] { "xxsh" });
						if ((temp != null)
								&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
										.equalsIgnoreCase(temp[0]))) {
							request.setAttribute("isPASS", "is");
						} else {
							StandardOperation.delete("lstdsq", "xh||nd", pkVal, request);

							colName1 = new String[] { "xh", "xm", "xb", "mzmc",
									"lxdh", "xymc", "xmc", "bjmc", "JTCY1_XM",
									"JTCY1_ysr", "JTCY1_GX", "JTCY1_GZDZ",
									"JTCY2_XM", "JTCY2_ysr", "JTCY2_GX",
									"JTCY2_GZDZ", "JTCY3_XM", "JTCY3_ysr",
									"JTCY3_GX", "JTCY3_GZDZ", "JTCY4_XM",
									"JTCY4_ysr", "JTCY4_GX", "JTCY4_GZDZ",
									"JTCY5_XM", "JTCY5_ysr", "JTCY5_GX",
									"JTCY5_GZDZ", "sqly", "nd", "sfzh",
									"jtlxdh", "jtzz", "hjje", "hjqx" };

							String[] valueForOut = new String[] { xh, xm, xb,
									mzmc, lxdh, xymc, xmc, bjmc, JTCY1_XM,
									JTCY1_ysr, JTCY1_GX, JTCY1_GZDZ, JTCY2_XM,
									JTCY2_ysr, JTCY2_GX, JTCY2_GZDZ, JTCY3_XM,
									JTCY3_ysr, JTCY3_GX, JTCY3_GZDZ, JTCY4_XM,
									JTCY4_ysr, JTCY4_GX, JTCY4_GZDZ, JTCY5_XM,
									JTCY5_ysr, JTCY5_GX, JTCY5_GZDZ, sqly, nd,
									sfzh, jtlxdh, jtzz, hjje, hjqx };

							boolean ok = false;
							ok = StandardOperation.insert("lstdsq", colName1,
									valueForOut, request);
							if (ok) {
								logMsg = "申请" + titName;
								Base.log(request, logMsg, sUName);
								request.setAttribute("ok", "ok");
							} else {
								request.setAttribute("ok", "no");
							}
						}
					}
				} else {// 不在申请时间范围内
					sfksq = "-1";
					request.setAttribute("sfksq", sfksq);// 不能申请
				}
			} else if (!(userType.equalsIgnoreCase("stu"))) {
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				xh = xszzForm.getXh();
				if (doType != null && doType.equalsIgnoreCase("add")) {
					xh = DealString
					.toGBK(request.getParameter("xh").toString());
					String xm = DealString.toGBK(request.getParameter("xm")
							.toString());
					String xb = DealString.toGBK(request.getParameter("xb")
							.toString());
					String mzmc = DealString.toGBK(request.getParameter("mzmc")
							.toString());
					String lxdh = DealString.toGBK(request.getParameter("lxdh")
							.toString());
					String xymc = DealString.toGBK(request.getParameter("xymc")
							.toString());
					String xmc = DealString.toGBK(request.getParameter("xmc")
							.toString());
					String sfzh = DealString.toGBK(request.getParameter("sfzh")
							.toString());
					String jtlxdh = DealString.toGBK(request.getParameter("jtlxdh")
							.toString());
					String jtzz = DealString.toGBK(request.getParameter("jtzz")
							.toString());
					String bjmc = DealString.toGBK(request.getParameter("bjmc")
							.toString());
					String JTCY1_XM = DealString.toGBK(request.getParameter(
					"JTCY1_XM").toString());
					String JTCY1_ysr = DealString.toGBK(request.getParameter(
					"JTCY1_ysr").toString());
					String JTCY1_GX = DealString.toGBK(request.getParameter(
					"JTCY1_GX").toString());
					String JTCY1_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY1_GZDZ").toString());
					String JTCY2_XM = DealString.toGBK(request.getParameter(
					"JTCY2_XM").toString());
					String JTCY2_ysr = DealString.toGBK(request.getParameter(
					"JTCY2_ysr").toString());
					String JTCY2_GX = DealString.toGBK(request.getParameter(
					"JTCY2_GX").toString());
					String JTCY2_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY2_GZDZ").toString());
					String JTCY3_XM = DealString.toGBK(request.getParameter(
					"JTCY3_XM").toString());
					String JTCY3_ysr = DealString.toGBK(request.getParameter(
					"JTCY3_ysr").toString());
					String JTCY3_GX = DealString.toGBK(request.getParameter(
					"JTCY3_GX").toString());
					String JTCY3_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY3_GZDZ").toString());
					String JTCY4_XM = DealString.toGBK(request.getParameter(
					"JTCY4_XM").toString());
					String JTCY4_ysr = DealString.toGBK(request.getParameter(
					"JTCY4_ysr").toString());
					String JTCY4_GX = DealString.toGBK(request.getParameter(
					"JTCY4_GX").toString());
					String JTCY4_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY4_GZDZ").toString());
					String JTCY5_XM = DealString.toGBK(request.getParameter(
					"JTCY5_XM").toString());
					String JTCY5_ysr = DealString.toGBK(request.getParameter(
					"JTCY5_ysr").toString());
					String JTCY5_GX = DealString.toGBK(request.getParameter(
					"JTCY5_GX").toString());
					String JTCY5_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY5_GZDZ").toString());
					String sqly = DealString.toGBK(
							request.getParameter("sqly").toString());
					String hjje = DealString.toGBK(
							request.getParameter("hjje").toString());
					String hjqx = DealString.toGBK(
							request.getParameter("hjje").toString());
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}

					sql = "select xxsh from lstdsq where xh||nd=?";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("lstdsq", "xh||nd", pkVal, request);

						colName1 = new String[] { "xh", "xm", "xb", "mzmc",
								"lxdh", "xymc", "xmc", "bjmc", "JTCY1_XM",
								"JTCY1_ysr", "JTCY1_GX", "JTCY1_GZDZ",
								"JTCY2_XM", "JTCY2_ysr", "JTCY2_GX",
								"JTCY2_GZDZ", "JTCY3_XM", "JTCY3_ysr",
								"JTCY3_GX", "JTCY3_GZDZ", "JTCY4_XM",
								"JTCY4_ysr", "JTCY4_GX", "JTCY4_GZDZ",
								"JTCY5_XM", "JTCY5_ysr", "JTCY5_GX",
								"JTCY5_GZDZ", "sqly", "nd", "sfzh", "jtlxdh",
								"jtzz", "hjje", "hjqx" };

						String[] valueForOut = new String[] { xh, xm, xb,
								mzmc, lxdh, xymc, xmc, bjmc, JTCY1_XM,
								JTCY1_ysr, JTCY1_GX, JTCY1_GZDZ, JTCY2_XM,
								JTCY2_ysr, JTCY2_GX, JTCY2_GZDZ, JTCY3_XM,
								JTCY3_ysr, JTCY3_GX, JTCY3_GZDZ, JTCY4_XM,
								JTCY4_ysr, JTCY4_GX, JTCY4_GZDZ, JTCY5_XM,
								JTCY5_ysr, JTCY5_GX, JTCY5_GZDZ, sqly, nd,
								sfzh, jtlxdh, jtzz, hjje, hjqx };

						boolean ok = false;
						ok = StandardOperation.insert("lstdsq", colName1,
								valueForOut, request);
						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			}

			pkVal = request.getParameter("pkVal");
			if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
				pkVal = DealString.toGBK(pkVal);
			} else {
				pkVal = xh + nd;
			}
			sql = "select xh,xm,xb,mzmc,lxdh,xymc,xmc,bjmc,nd,sqsj,"
				+ "JTCY1_XM,jtcy1_gx,jtcy1_ysr,jtcy1_gzdz,"
				+ "jtcy2_xm,jtcy2_gx,jtcy2_ysr,jtcy2_gzdz,"
				+ "jtcy3_xm,jtcy3_gx,jtcy3_ysr,jtcy3_gzdz,"
				+ "jtcy4_xm,jtcy4_gx,jtcy4_ysr,jtcy4_gzdz,"
				+ "jtcy5_xm,jtcy5_gx,jtcy5_ysr,jtcy5_gzdz,"
				+ "sqly,xyshyj,xxshyj,xysh,xxsh,sfzh,jtlxdh,jtzz,hjje,hjqx from lstdsq where xh||nd=? ";
			outString = new String[] { "xh", "xm", "xb", "mzmc", "lxdh",
					"xymc", "xmc", "bjmc", "nd", "sqsj", "JTCY1_XM",
					"JTCY1_GX", "JTCY1_ysr", "JTCY1_GZDZ", "JTCY2_XM",
					"JTCY2_GX", "JTCY2_ysr", "JTCY2_GZDZ", "JTCY3_XM",
					"JTCY3_GX", "JTCY3_ysr", "JTCY3_GZDZ", "JTCY4_XM",
					"JTCY4_GX", "JTCY4_ysr", "JTCY4_GZDZ", "JTCY5_XM",
					"JTCY5_GX", "JTCY5_ysr", "JTCY5_GZDZ", "sqly", "xyshyj",
					"xxshyj", "xysh", "xxsh", "sfzh", "jtlxdh", "jtzz", "hjje", "hjqx" };
			outValue = dao.getOneRs(sql, new String[] { pkVal }, outString);

			boolean isSHGC = false;
			boolean isKNS = false;
			if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
				isSHGC = true;
			}
			if (outValue == null) {
				if (xh != null) {
					if (isSHGC) {
						sql = "select v.xh,v.xm,v.xb,v.bjmc,v.xymc,m.MZMC mz,v.zymc xi,x.xxmc,"
							+ "v.jtfk,v.jtfkrs,v.jtyzsr,v.jtrjsr,v.jtsrly,v.yzbm,v.jtzz,"
							+ "v.jtcy1_xm,v.jtcy1_gx,v.JTCY1_ysr,v.jtcy1_gzdw,"
							+ "v.jtcy2_xm,v.jtcy2_gx,v.JTCY2_ysr,v.jtcy2_gzdw,"
							+ "v.jtcy3_xm,v.jtcy3_gx,v.JTCY3_ysr,v.jtcy3_gzdw,"
							+ "v.jtcy4_xm,v.jtcy4_gx,v.JTCY4_ysr,v.jtcy4_gzdw,"
							+ "v.jtcy5_xm,v.jtcy5_gx,v.JTCY5_ysr,v.jtcy5_gzdw "
							+ "from view_knsxx v,bks_xsqtxx q,mzdmb m,xtszb x where v.xh = q.xh "
							+ "and q.mzdm = m.mzdm and v.xxsh = '通过' and v.xh=?";
						String[] temp = new String[] { "xh", "xm", "xb",
								"bjmc", "xymc", "mz", "xi", "xxmc", "jtfk",
								"jtfkrs", "jtyzsr", "jtrjsr", "jtsrly", "yzbm",
								"jtzz", "jtcy1_xm", "jtcy1_gx", "JTCY1_ysr",
								"jtcy1_gzdw", "jtcy2_xm", "jtcy2_gx",
								"JTCY2_ysr", "jtcy2_gzdw", "jtcy3_xm",
								"jtcy3_gx", "JTCY3_ysr", "jtcy3_gzdw",
								"jtcy4_xm", "jtcy4_gx", "JTCY4_ysr",
								"jtcy4_gzdw", "jtcy5_xm", "jtcy5_gx",
								"JTCY5_ysr", "jtcy5_gzdw" };
						String[] outValT = dao.getOneRs(sql,
								new String[] { xh }, temp);
						if (outValT == null) {
							sql = "select v.xh,v.xm,v.xb,v.bjmc,v.xymc,q.MZMC mz,v.zymc xi,x.xxmc "
								+ "from view_xsjbxx v,view_stu_details q,xtszb x "
								+ "where v.xh = q.xh and v.xh=?";
							String[] colName = new String[] { "xh", "xm", "xb",
									"bjmc", "xymc", "mz", "xi", "xxmc" };
							String[] outVal = dao.getOneRs(sql,
									new String[] { xh }, colName);
							if (outVal != null) {
								colName = new String[] { "xh", "xm", "xb",
										"bjmc", "xymc", "mzmc", "xmc", "xxmc" };
								for (int i = 0; i < colName.length; i++) {
									if (outVal[i] != null) {
										map.put(colName[i], outVal[i]);
									} else {
										map.put(colName[i], "");
									}
								}
							}
						} else {
							isKNS = true;
							temp = new String[] { "xh", "xm", "xb", "bjmc",
									"xymc", "mzmc", "xmc", "xxmc", "jtfk",
									"jtfkrs", "jtyzsr", "jtrjsr", "jtsrly",
									"yzbm", "jtzz", "JTCY1_XM", "JTCY1_GX",
									"JTCY1_ysr", "JTCY1_GZDZ", "JTCY2_XM",
									"JTCY2_GX", "JTCY2_ysr", "JTCY2_GZDZ",
									"JTCY3_XM", "JTCY3_GX", "JTCY3_ysr",
									"JTCY3_GZDZ", "JTCY4_XM", "JTCY4_GX",
									"JTCY4_ysr", "JTCY4_GZDZ", "JTCY5_XM",
									"JTCY5_GX", "JTCY5_ysr", "JTCY5_GZDZ" };
							for (int i = 0; i < temp.length; i++) {
								if (outValT[i] != null) {
									map.put(temp[i], outValT[i]);
								} else {
									map.put(temp[i], "");
								}
							}
						}
					} else if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
						boolean bk = dao.isKns(xh);
						if (bk) {
							sql = "select v.xh,v.xm,v.xb,v.bjmc,v.xymc,q.MZMC mz,v.zymc xi,x.xxmc,q.sfzh "
									+ "from view_xsjbxx v,view_stu_details q,xtszb x "
									+ "where v.xh = q.xh and v.xh=?";
							String[] colName = new String[] { "xh", "xm", "xb",
									"bjmc", "xymc", "mz", "xi", "xxmc", "sfzh" };
							String[] outVal = dao.getOneRs(sql,
									new String[] { xh }, colName);
							if (outVal == null) {

							} else {
								colName = new String[] { "xh", "xm", "xb",
										"bjmc", "xymc", "mzmc", "xmc", "xxmc",
										"sfzh" };
								for (int i = 0; i < colName.length; i++) {
									if (outVal[i] != null) {
										map.put(colName[i], outVal[i]);
									} else {
										map.put(colName[i], "");
									}
								}
							}
						} else {
							request.setAttribute("kns", "no");
						}
					} else {
						sql = "select v.xh,v.xm,v.xb,v.bjmc,v.xymc,q.MZMC mz,v.zymc xi,x.xxmc,q.sfzh "
							+ "from view_xsjbxx v,view_stu_details q,xtszb x "
							+ "where v.xh = q.xh and v.xh=?";
						String[] colName = new String[] { "xh", "xm", "xb",
								"bjmc", "xymc", "mz", "xi", "xxmc", "sfzh" };
						String[] outVal = dao.getOneRs(sql,
								new String[] { xh }, colName);
						if (outVal != null) {
							colName = new String[] { "xh", "xm", "xb", "bjmc",
									"xymc", "mzmc", "xmc", "xxmc", "sfzh" };
							for (int i = 0; i < colName.length; i++) {
								if (outVal[i] != null) {
									map.put(colName[i], outVal[i]);
								} else {
									map.put(colName[i], "");
								}
							}
						}
					}
				}
			} else {
				for (int i = 0; i < outString.length; i++) {
					if (outValue[i] != null) {
						map.put(outString[i], outValue[i]);
					} else {
						map.put(outString[i], "");
					}
				}
			}
			if (isSHGC && isKNS) {
				request.setAttribute("isSHGCKNS", "is");
			} else {
				request.setAttribute("isSHGCKNS", "no");
			}
			request.setAttribute("rs", map);
			return mapping.findForward("success");
		}
	}

	private ActionForward lstdsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {

		String xxmc = ToolClass.getXxmc();
		String xxdm = StandardOperation.getXxdm();
		if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
			String titleName = request.getParameter("titName");
			String sqlb = "";
			if (titleName.equalsIgnoreCase("lstdsqb")) {
				sqlb = "高等学校学生及家庭情况调查表";
			} else {
				sqlb = "高等学校学生及家庭情况调查表";
			}

			String xh = DealString.toGBK(request.getParameter("xh"));
			String xm = DealString.toGBK(request.getParameter("xm").toString());
			xxmc = DealString.toGBK(request.getParameter("xxmc").toString());
			String xymc = DealString.toGBK(request.getParameter("xymc")
					.toString());
			String xmc = DealString.toGBK(request.getParameter("xmc")
					.toString());
			String nj = DealString.toGBK(request.getParameter("nj").toString());
			String xb = DealString.toGBK(request.getParameter("xb").toString());
			String csny = DealString.toGBK(request.getParameter("csny")
					.toString());
			String mzmc = DealString.toGBK(request.getParameter("mzmc")
					.toString());
			String sfzh = DealString.toGBK(request.getParameter("sfzh")
					.toString());
			String zzmm = DealString.toGBK(request.getParameter("zzmm")
					.toString());
			String rxqhk = DealString.toGBK(request.getParameter("rxqhk")
					.toString());
			String jtrks = DealString.toGBK(request.getParameter("jtrks")
					.toString());
			String byxx = DealString.toGBK(request.getParameter("byxx")
					.toString());
			String grtc = DealString.toGBK(request.getParameter("grtc")
					.toString());
			String sfgc = DealString.toGBK(request.getParameter("sfgc")
					.toString());
			String sfdq = DealString.toGBK(request.getParameter("sfdq")
					.toString());
			String sflszn = DealString.toGBK(request.getParameter("sflszn")
					.toString());
			String jtxxtxdz = DealString.toGBK(request.getParameter("jtxxtxdz")
					.toString());
			String jtyzbm = DealString.toGBK(request.getParameter("jtyzbm")
					.toString());
			String jtlxdh = DealString.toGBK(request.getParameter("jtlxdh")
					.toString());
			String jtcy1_xm = DealString.toGBK(request.getParameter("jtcy1_xm")
					.toString());
			String jtcy1_nl = DealString.toGBK(request.getParameter("jtcy1_nl")
					.toString());
			String jtcy1_gx = DealString.toGBK(request.getParameter("jtcy1_gx")
					.toString());
			String jtcy1_gzdw = DealString.toGBK(request.getParameter(
			"jtcy1_gzdw").toString());
			String jtcy1_zy = DealString.toGBK(request.getParameter("jtcy1_zy")
					.toString());
			String jtcy1_nsr = DealString.toGBK(request.getParameter(
			"jtcy1_nsr").toString());
			String jtcy1_jkzk = DealString.toGBK(request.getParameter(
			"jtcy1_jkzk").toString());
			String jtcy2_xm = DealString.toGBK(request.getParameter("jtcy2_xm")
					.toString());
			String jtcy2_nl = DealString.toGBK(request.getParameter("jtcy2_nl")
					.toString());
			String jtcy2_gx = DealString.toGBK(request.getParameter("jtcy2_gx")
					.toString());
			String jtcy2_gzdw = DealString.toGBK(request.getParameter(
			"jtcy2_gzdw").toString());
			String jtcy2_zy = DealString.toGBK(request.getParameter("jtcy2_zy")
					.toString());
			String jtcy2_nsr = DealString.toGBK(request.getParameter(
			"jtcy2_nsr").toString());
			String jtcy2_jkzk = DealString.toGBK(request.getParameter(
			"jtcy2_jkzk").toString());
			String jtcy3_xm = DealString.toGBK(request.getParameter("jtcy3_xm")
					.toString());
			String jtcy3_nl = DealString.toGBK(request.getParameter("jtcy3_nl")
					.toString());
			String jtcy3_gx = DealString.toGBK(request.getParameter("jtcy3_gx")
					.toString());
			String jtcy3_gzdw = DealString.toGBK(request.getParameter(
			"jtcy3_gzdw").toString());
			String jtcy3_zy = DealString.toGBK(request.getParameter("jtcy3_zy")
					.toString());
			String jtcy3_nsr = DealString.toGBK(request.getParameter(
			"jtcy3_nsr").toString());
			String jtcy3_jkzk = DealString.toGBK(request.getParameter(
			"jtcy3_jkzk").toString());
			String jtcy4_xm = DealString.toGBK(request.getParameter("jtcy4_xm")
					.toString());
			String jtcy4_nl = DealString.toGBK(request.getParameter("jtcy4_nl")
					.toString());
			String jtcy4_gx = DealString.toGBK(request.getParameter("jtcy4_gx")
					.toString());
			String jtcy4_gzdw = DealString.toGBK(request.getParameter(
			"jtcy4_gzdw").toString());
			String jtcy4_zy = DealString.toGBK(request.getParameter("jtcy4_zy")
					.toString());
			String jtcy4_nsr = DealString.toGBK(request.getParameter(
			"jtcy4_nsr").toString());
			String jtcy4_jkzk = DealString.toGBK(request.getParameter(
			"jtcy4_jkzk").toString());
			String jtcy5_xm = DealString.toGBK(request.getParameter("jtcy5_xm")
					.toString());
			String jtcy5_nl = DealString.toGBK(request.getParameter("jtcy5_nl")
					.toString());
			String jtcy5_gx = DealString.toGBK(request.getParameter("jtcy5_gx")
					.toString());
			String jtcy5_gzdw = DealString.toGBK(request.getParameter(
			"jtcy5_gzdw").toString());
			String jtcy5_zy = DealString.toGBK(request.getParameter("jtcy5_zy")
					.toString());
			String jtcy5_nsr = DealString.toGBK(request.getParameter(
			"jtcy5_nsr").toString());
			String jtcy5_jkzk = DealString.toGBK(request.getParameter(
			"jtcy5_jkzk").toString());
			String jtrjnsr = DealString.toGBK(request.getParameter("jtrjnsr")
					.toString());
			String xsyhhjqk = DealString.toGBK(request.getParameter("xsyhhjqk")
					.toString());
			String jtzszrzhqk = DealString.toGBK(request.getParameter(
			"jtzszrzhqk").toString());
			String jtzstfywsj = DealString.toGBK(request.getParameter(
			"jtzstfywsj").toString());
			String jtcyndlrqk = DealString.toGBK(request.getParameter(
			"jtcyndlrqk").toString());
			String jtcysyqk = DealString.toGBK(request.getParameter("jtcysyqk")
					.toString());
			String jtqzqk = DealString.toGBK(request.getParameter("jtqzqk")
					.toString());
			String qtqk = DealString.toGBK(request.getParameter("qtqk")
					.toString());
			String mzbmxxtxdz = DealString.toGBK(request.getParameter(
			"mzbmxxtxdz").toString());
			String mzbmyzbm = DealString.toGBK(request.getParameter("mzbmyzbm")
					.toString());
			String mzbmlxdh = DealString.toGBK(request.getParameter("mzbmlxdh")
					.toString());

			HashMap<String, String> map = new HashMap<String, String>();
			String[] outValue = new String[] { xh, xxmc, xymc, xmc, nj, xm, xb,
					csny, mzmc, sfzh, zzmm, rxqhk, jtrks, byxx, grtc, sfgc,
					sfdq, sflszn, jtxxtxdz, jtyzbm, jtlxdh, jtcy1_xm, jtcy1_nl,
					jtcy1_gx, jtcy1_gzdw, jtcy1_zy, jtcy1_nsr, jtcy1_jkzk,
					jtcy2_xm, jtcy2_nl, jtcy2_gx, jtcy2_gzdw, jtcy2_zy,
					jtcy2_nsr, jtcy2_jkzk, jtcy3_xm, jtcy3_nl, jtcy3_gx,
					jtcy3_gzdw, jtcy3_zy, jtcy3_nsr, jtcy3_jkzk, jtcy4_xm,
					jtcy4_nl, jtcy4_gx, jtcy4_gzdw, jtcy4_zy, jtcy4_nsr,
					jtcy4_jkzk, jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_gzdw,
					jtcy5_zy, jtcy5_nsr, jtcy5_jkzk, jtrjnsr, xsyhhjqk,
					jtzszrzhqk, jtzstfywsj, jtcyndlrqk, jtcysyqk, jtqzqk, qtqk,
					mzbmxxtxdz, mzbmyzbm, mzbmlxdh };
			String[] outString = new String[] { "xh", "xxmc", "xymc", "xmc",
					"nj", "xm", "xb", "csny", "mzmc", "sfzh", "zzmm", "rxqhk",
					"jtrks", "byxx", "grtc", "sfgc", "sfdq", "sflszn",
					"jtxxtxdz", "jtyzbm", "jtlxdh", "jtcy1_xm", "jtcy1_nl",
					"jtcy1_gx", "jtcy1_gzdw", "jtcy1_zy", "jtcy1_nsr",
					"jtcy1_jkzk", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
					"jtcy2_gzdw", "jtcy2_zy", "jtcy2_nsr", "jtcy2_jkzk",
					"jtcy3_xm", "jtcy3_nl", "jtcy3_gx", "jtcy3_gzdw",
					"jtcy3_zy", "jtcy3_nsr", "jtcy3_jkzk", "jtcy4_xm",
					"jtcy4_nl", "jtcy4_gx", "jtcy4_gzdw", "jtcy4_zy",
					"jtcy4_nsr", "jtcy4_jkzk", "jtcy5_xm", "jtcy5_nl",
					"jtcy5_gx", "jtcy5_gzdw", "jtcy5_zy", "jtcy5_nsr",
					"jtcy5_jkzk", "jtrjnsr", "xsyhhjqk", "jtzszrzhqk",
					"jtzstfywsj", "jtcyndlrqk", "jtcysyqk", "jtqzqk", "qtqk",
					"mzbmxxtxdz", "mzbmyzbm", "mzbmlxdh" };
			// System.out.println(outString[35]+outValue[35]);
			for (int i = 0; i < outValue.length; i++) {
				if (outValue[i] != null && !(outValue[i].equals(""))) {
					// System.out.println("i="+i+" "+outString[i]);
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], " ");
				}
			}
			request.setAttribute("sqlb", sqlb);
			request.setAttribute("rs", map);
			ActionForward newFwd = new ActionForward("/xszz/xsjtqkdcb.jsp",
					false);
			return newFwd;
		} else {
			String titleName = request.getParameter("titName");
			String sqlb = "";
			if (titleName.equalsIgnoreCase("lstdsqb")) {
				sqlb = "绿色通道";
			} else {
				sqlb = "绿色通道";
			}

			String xh = DealString.toGBK(request.getParameter("xh"));
			String xm = DealString.toGBK(request.getParameter("xm"));
			String xb = DealString.toGBK(request.getParameter("xb"));
			String lxdh = DealString.toGBK(request.getParameter("lxdh"));
			String mzmc = DealString.toGBK(request.getParameter("mzmc"));
			String xymc = DealString.toGBK(request.getParameter("xymc"));
			String xmc = DealString.toGBK(request.getParameter("xmc"));
			String bjmc = DealString.toGBK(request.getParameter("bjmc"));
			String jtcy1_xm = DealString
					.toGBK(request.getParameter("JTCY1_XM"));
			String jtcy1_ysr = DealString.toGBK(request
					.getParameter("JTCY1_ysr"));
			String jtcy1_gx = DealString
					.toGBK(request.getParameter("JTCY1_GX"));
			String jtcy1_gzdz = DealString.toGBK(request
					.getParameter("JTCY1_GZDZ"));
			String jtcy2_xm = DealString
					.toGBK(request.getParameter("JTCY2_XM"));
			String jtcy2_ysr = DealString.toGBK(request
					.getParameter("JTCY2_ysr"));
			String jtcy2_gx = DealString
					.toGBK(request.getParameter("JTCY2_GX"));
			String jtcy2_gzdz = DealString.toGBK(request
					.getParameter("JTCY2_GZDZ"));
			String jtcy3_xm = DealString
					.toGBK(request.getParameter("JTCY3_XM"));
			String jtcy3_ysr = DealString.toGBK(request
					.getParameter("JTCY3_ysr"));
			String jtcy3_gx = DealString
					.toGBK(request.getParameter("JTCY3_GX"));
			String jtcy3_gzdz = DealString.toGBK(request
					.getParameter("JTCY3_GZDZ"));
			String jtcy4_xm = DealString
					.toGBK(request.getParameter("JTCY4_XM"));
			String jtcy4_ysr = DealString.toGBK(request
					.getParameter("JTCY4_ysr"));
			String jtcy4_gx = DealString
					.toGBK(request.getParameter("JTCY4_GX"));
			String jtcy4_gzdz = DealString.toGBK(request
					.getParameter("JTCY4_GZDZ"));
			String jtcy5_xm = DealString
					.toGBK(request.getParameter("JTCY5_XM"));
			String jtcy5_ysr = DealString.toGBK(request
					.getParameter("JTCY5_ysr"));
			String jtcy5_gx = DealString
					.toGBK(request.getParameter("JTCY5_GX"));
			String jtcy5_gzdz = DealString.toGBK(request
					.getParameter("JTCY5_GZDZ"));
			String sqly = DealString.toGBK(request.getParameter("sqly"));
			String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
			String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));
			String sfzh = DealString.toGBK(request.getParameter("sfzh")
					.toString());
			String jtlxdh = DealString.toGBK(request.getParameter("jtlxdh")
					.toString());
			String jtzz = DealString.toGBK(request.getParameter("jtzz")
					.toString());
			String hjje = DealString.toGBK(
					request.getParameter("hjje").toString());
			String hjqx = DealString.toGBK(
					request.getParameter("hjje").toString());

			HashMap<String, String> map = new HashMap<String, String>();
			String[] outValue = new String[] { xh, xm, lxdh, xb, bjmc, xymc,
					mzmc, jtcy1_xm, jtcy1_ysr, jtcy1_gx, jtcy1_gzdz, jtcy2_xm,
					jtcy2_ysr, jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_ysr,
					jtcy3_gx, jtcy3_gzdz, jtcy4_xm, jtcy4_ysr, jtcy4_gx,
					jtcy4_gzdz, jtcy5_xm, jtcy5_ysr, jtcy5_gx, jtcy5_gzdz,
					sqly, xyshyj, xxshyj, xmc, sfzh, jtlxdh, jtzz, hjje, hjqx };
			String[] outString = new String[] { "xh", "xm", "lxdh", "xb",
					"bjmc", "xymc", "mzmc", "jtcy1_xm", "jtcy1_ysr",
					"jtcy1_gx", "jtcy1_gzdz", "jtcy2_xm", "jtcy2_ysr",
					"jtcy2_gx", "jtcy2_gzdz", "jtcy3_xm", "jtcy3_ysr",
					"jtcy3_gx", "jtcy3_gzdz", "jtcy4_xm", "jtcy4_ysr",
					"jtcy4_gx", "jtcy4_gzdz", "jtcy5_xm", "jtcy5_ysr",
					"jtcy5_gx", "jtcy5_gzdz", "sqly", "xyshyj", "xxshyj",
					"xmc", "sfzh", "jtlxdh", "jtzz", "hjje", "hjqx" };
			// System.out.println(outString[35]+outValue[35]);
			for (int i = 0; i < outValue.length; i++) {
				if (outValue[i] != null && !(outValue[i].equals(""))) {
					// System.out.println("i="+i+" "+outString[i]);
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], " ");
				}
			}
			request.setAttribute("sqlb", sqlb);
			request.setAttribute("rs", map);
			return mapping.findForward("success");
		}
	}

	private ActionForward xsxfjmSq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String doType = request.getParameter("doType");
		String titName = request.getParameter("titName");

		// String xxmc = ToolClass.getXxmc();
		String sfksq = "-1";

		String[] pages = null;
		String[] titNames = null;
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyymmddhh24miss') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		pages = new String[] { "学生学费减免" };
		titNames = new String[] { "xsxfjmsq" };
		String[] colName1 = null;

		if (titName == null)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		List pagesList = dao.arrayToList(titNames, pages);
		request.setAttribute("pages", pagesList);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间
		String[] outString = new String[] {};
		sql = "select XH,XM,ND,CSNY,XRZW,QS,LXDH,SFZH,XB,"
			+ "BJMC,XY,MZMC,ZZMMMC,YXSBZDKQK,ZXCJQGZXQK,"
			+ "JTCY1_XM,JTCY1_NL,JTCY1_GX,JTCY1_YSR,JTCY1_GZDZ,"
			+ "JTCY2_XM,JTCY2_NL,JTCY2_GX,JTCY2_YSR,JTCY2_GZDZ,"
			+ "JTCY3_XM,JTCY3_NL,JTCY3_GX,JTCY3_YSR,JTCY3_GZDZ,"
			+ "JTCY4_XM,JTCY4_NL,JTCY4_GX,JTCY4_YSR,JTCY4_GZDZ,"
			+ "JTCY5_XM,JTCY5_NL,JTCY5_GX,JTCY5_YSR,JTCY5_GZDZ,"
			+ "SQSJ,JTZZ,SQLY,XYSHYJ,XXSHYJ,SFKNS,YZBM,XMC,XXMC,"
			+ "XYSH,XXSH,XYDM,ZYDM,BJDM,NJ from view_xsxfjmsq where 1=2";
		// outString = dao.getColumnName(sql);// 获得列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
		String xh = "";
		String pkVal = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;
			sql1 = "select xsxfjmsqkssj,xsxfjmsqjssj from xszhsjb a,view_xsjbxx b "
				+ "where a.zydm=b.xydm and b.xh=? ";// ,nd
			// substr(gjjxjsqkssj,1,4)=?
			jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
					"xsxfjmsqkssj", "xsxfjmsqjssj" });

			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) < 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) > 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String csny = DealString.toGBK(request.getParameter("csny")
							.toString());
					String lxdh = DealString.toGBK(
							request.getParameter("lxdh").toString());
					String xrzw = DealString.toGBK(request.getParameter("xrzw")
							.toString());
					String qs = DealString.toGBK(request.getParameter("qs")
							.toString());
					String yxsbzdkqk = DealString.toGBK(request.getParameter(
					"yxsbzdkqk").toString());
					String zxcjqgzxqk = DealString.toGBK(request.getParameter(
					"zxcjqgzxqk").toString());
					String yzbm = DealString.toGBK(request.getParameter("yzbm")
							.toString());
					String jtzz = DealString.toGBK(
							request.getParameter("jtzz").toString());
					String JTCY1_XM = DealString.toGBK(request.getParameter(
					"JTCY1_XM").toString());
					String JTCY1_nl = DealString.toGBK(request.getParameter(
					"JTCY1_nl").toString());
					String JTCY1_GX = DealString.toGBK(request.getParameter(
					"JTCY1_GX").toString());
					String JTCY1_YSR = DealString.toGBK(request.getParameter(
					"JTCY1_YSR").toString());
					String JTCY1_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY1_GZDZ").toString());
					String JTCY2_XM = DealString.toGBK(request.getParameter(
					"JTCY2_XM").toString());
					String JTCY2_nl = DealString.toGBK(request.getParameter(
					"JTCY2_nl").toString());
					String JTCY2_GX = DealString.toGBK(request.getParameter(
					"JTCY2_GX").toString());
					String JTCY2_YSR = DealString.toGBK(request.getParameter(
					"JTCY2_YSR").toString());
					String JTCY2_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY2_GZDZ").toString());
					String JTCY3_XM = DealString.toGBK(request.getParameter(
					"JTCY3_XM").toString());
					String JTCY3_nl = DealString.toGBK(request.getParameter(
					"JTCY3_nl").toString());
					String JTCY3_GX = DealString.toGBK(request.getParameter(
					"JTCY3_GX").toString());
					String JTCY3_YSR = DealString.toGBK(request.getParameter(
					"JTCY3_YSR").toString());
					String JTCY3_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY3_GZDZ").toString());
					String JTCY4_XM = DealString.toGBK(request.getParameter(
					"JTCY4_XM").toString());
					String JTCY4_nl = DealString.toGBK(request.getParameter(
					"JTCY4_nl").toString());
					String JTCY4_GX = DealString.toGBK(request.getParameter(
					"JTCY4_GX").toString());
					String JTCY4_YSR = DealString.toGBK(request.getParameter(
					"JTCY4_YSR").toString());
					String JTCY4_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY4_GZDZ").toString());
					String JTCY5_XM = DealString.toGBK(request.getParameter(
					"JTCY5_XM").toString());
					String JTCY5_nl = DealString.toGBK(request.getParameter(
					"JTCY5_nl").toString());
					String JTCY5_GX = DealString.toGBK(request.getParameter(
					"JTCY5_GX").toString());
					String JTCY5_YSR = DealString.toGBK(request.getParameter(
					"JTCY5_YSR").toString());
					String JTCY5_GZDZ = DealString.toGBK(request.getParameter(
					"JTCY5_GZDZ").toString());
					String sqly = DealString.toGBK(
							request.getParameter("sqly").toString());
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}

					sql = "select xxsh from XSXFJMSPB where xh||nd=? ";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("XSXFJMSPB", "xh||nd",
								pkVal, request);

						colName1 = new String[] { "xh", "csny", "XRZW", "QS",
								"jtzz", "yzbm", "lxdh", "YXSBZDKQK",
								"ZXCJQGZXQK", "JTCY1_XM", "JTCY1_nl",
								"JTCY1_GX", "JTCY1_YSR", "JTCY1_GZDZ",
								"JTCY2_XM", "JTCY2_nl", "JTCY2_GX",
								"JTCY2_YSR", "JTCY2_GZDZ", "JTCY3_XM",
								"JTCY3_nl", "JTCY3_GX", "JTCY3_YSR",
								"JTCY3_GZDZ", "JTCY4_XM", "JTCY4_nl",
								"JTCY4_GX", "JTCY4_YSR", "JTCY4_GZDZ",
								"JTCY5_XM", "JTCY5_nl", "JTCY5_GX",
								"JTCY5_YSR", "JTCY5_GZDZ", "sqly", "nd" };

						String[] valueForOut = new String[] { xh, csny, xrzw,
								qs, jtzz, yzbm, lxdh, yxsbzdkqk, zxcjqgzxqk,
								JTCY1_XM, JTCY1_nl, JTCY1_GX, JTCY1_YSR,
								JTCY1_GZDZ, JTCY2_XM, JTCY2_nl, JTCY2_GX,
								JTCY2_YSR, JTCY2_GZDZ, JTCY3_XM, JTCY3_nl,
								JTCY3_GX, JTCY3_YSR, JTCY3_GZDZ, JTCY4_XM,
								JTCY4_nl, JTCY4_GX, JTCY4_YSR, JTCY4_GZDZ,
								JTCY5_XM, JTCY5_nl, JTCY5_GX, JTCY5_YSR,
								JTCY5_GZDZ, sqly, nd };

						boolean ok = false;
						ok = StandardOperation.insert("XSXFJMSPB", colName1,
								valueForOut, request);
						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String csny = DealString.toGBK(request.getParameter("csny")
						.toString());
				String lxdh = DealString.toGBK(
						request.getParameter("lxdh").toString());
				String xrzw = DealString.toGBK(request.getParameter("xrzw")
						.toString());
				String qs = DealString.toGBK(request.getParameter("qs")
						.toString());
				String yxsbzdkqk = DealString.toGBK(request.getParameter(
				"yxsbzdkqk").toString());
				String zxcjqgzxqk = DealString.toGBK(request.getParameter(
				"zxcjqgzxqk").toString());
				String yzbm = DealString.toGBK(request.getParameter("yzbm")
						.toString());
				String jtzz = DealString.toGBK(
						request.getParameter("jtzz").toString());
				String JTCY1_XM = DealString.toGBK(request.getParameter(
				"JTCY1_XM").toString());
				String JTCY1_nl = DealString.toGBK(request.getParameter(
				"JTCY1_nl").toString());
				String JTCY1_GX = DealString.toGBK(request.getParameter(
				"JTCY1_GX").toString());
				String JTCY1_YSR = DealString.toGBK(request.getParameter(
				"JTCY1_YSR").toString());
				String JTCY1_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY1_GZDZ").toString());
				String JTCY2_XM = DealString.toGBK(request.getParameter(
				"JTCY2_XM").toString());
				String JTCY2_nl = DealString.toGBK(request.getParameter(
				"JTCY2_nl").toString());
				String JTCY2_GX = DealString.toGBK(request.getParameter(
				"JTCY2_GX").toString());
				String JTCY2_YSR = DealString.toGBK(request.getParameter(
				"JTCY2_YSR").toString());
				String JTCY2_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY2_GZDZ").toString());
				String JTCY3_XM = DealString.toGBK(request.getParameter(
				"JTCY3_XM").toString());
				String JTCY3_nl = DealString.toGBK(request.getParameter(
				"JTCY3_nl").toString());
				String JTCY3_GX = DealString.toGBK(request.getParameter(
				"JTCY3_GX").toString());
				String JTCY3_YSR = DealString.toGBK(request.getParameter(
				"JTCY3_YSR").toString());
				String JTCY3_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY3_GZDZ").toString());
				String JTCY4_XM = DealString.toGBK(request.getParameter(
				"JTCY4_XM").toString());
				String JTCY4_nl = DealString.toGBK(request.getParameter(
				"JTCY4_nl").toString());
				String JTCY4_GX = DealString.toGBK(request.getParameter(
				"JTCY4_GX").toString());
				String JTCY4_YSR = DealString.toGBK(request.getParameter(
				"JTCY4_YSR").toString());
				String JTCY4_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY4_GZDZ").toString());
				String JTCY5_XM = DealString.toGBK(request.getParameter(
				"JTCY5_XM").toString());
				String JTCY5_nl = DealString.toGBK(request.getParameter(
				"JTCY5_nl").toString());
				String JTCY5_GX = DealString.toGBK(request.getParameter(
				"JTCY5_GX").toString());
				String JTCY5_YSR = DealString.toGBK(request.getParameter(
				"JTCY5_YSR").toString());
				String JTCY5_GZDZ = DealString.toGBK(request.getParameter(
				"JTCY5_GZDZ").toString());
				String sqly = DealString.toGBK(
						request.getParameter("sqly").toString());
				pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = xh + nd;
				}

				sql = "select xxsh from XSXFJMSPB where xh||nd=? ";
				String[] temp = dao.getOneRs(sql, new String[] { pkVal },
						new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("XSXFJMSPB", "xh||nd",
							pkVal, request);

					colName1 = new String[] { "xh", "csny", "XRZW", "QS",
							"jtzz", "yzbm", "lxdh", "YXSBZDKQK",
							"ZXCJQGZXQK", "JTCY1_XM", "JTCY1_nl",
							"JTCY1_GX", "JTCY1_YSR", "JTCY1_GZDZ",
							"JTCY2_XM", "JTCY2_nl", "JTCY2_GX",
							"JTCY2_YSR", "JTCY2_GZDZ", "JTCY3_XM",
							"JTCY3_nl", "JTCY3_GX", "JTCY3_YSR",
							"JTCY3_GZDZ", "JTCY4_XM", "JTCY4_nl",
							"JTCY4_GX", "JTCY4_YSR", "JTCY4_GZDZ",
							"JTCY5_XM", "JTCY5_nl", "JTCY5_GX",
							"JTCY5_YSR", "JTCY5_GZDZ", "sqly", "nd" };

					String[] valueForOut = new String[] { xh, csny, xrzw,
							qs, jtzz, yzbm, lxdh, yxsbzdkqk, zxcjqgzxqk,
							JTCY1_XM, JTCY1_nl, JTCY1_GX, JTCY1_YSR,
							JTCY1_GZDZ, JTCY2_XM, JTCY2_nl, JTCY2_GX,
							JTCY2_YSR, JTCY2_GZDZ, JTCY3_XM, JTCY3_nl,
							JTCY3_GX, JTCY3_YSR, JTCY3_GZDZ, JTCY4_XM,
							JTCY4_nl, JTCY4_GX, JTCY4_YSR, JTCY4_GZDZ,
							JTCY5_XM, JTCY5_nl, JTCY5_GX, JTCY5_YSR,
							JTCY5_GZDZ, sqly, nd };

					boolean ok = false;
					ok = StandardOperation.insert("XSXFJMSPB", colName1,
							valueForOut, request);
					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		}

		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd;
		}
		outString = new String[] { "xh", "xm", "nd", "csny", "xrzw", "qs",
				"lxdh", "sfzh", "xb", "bjmc", "xy", "mzmc", "zzmmmc",
				"yxsbzdkqk", "zxcjqgzxqk", "JTCY1_XM", "JTCY1_nl", "JTCY1_GX",
				"JTCY1_YSR", "JTCY1_GZDZ", "JTCY2_XM", "JTCY2_nl", "JTCY2_GX",
				"JTCY2_YSR", "JTCY2_GZDZ", "JTCY3_XM", "JTCY3_nl", "JTCY3_GX",
				"JTCY3_YSR", "JTCY3_GZDZ", "JTCY4_XM", "JTCY4_nl", "JTCY4_GX",
				"JTCY4_YSR", "JTCY4_GZDZ", "JTCY5_XM", "JTCY5_nl", "JTCY5_GX",
				"JTCY5_YSR", "JTCY5_GZDZ", "sqsj", "jtzz", "sqly", "xyshyj",
				"xxshyj", "sfkns", "yzbm", "xmc", "xxmc", "xysh", "xxsh",
				"njmjedx", "jmjedx", "kh" };
		sql = "select a.*,(select b.kh from view_stu_details b where a.xh=b.xh) kh "
			+ "from (select x.xh,x.xm,x.nd,x.csny,x.xrzw,x.qs,x.lxdh,"
			+ "x.sfzh,x.xb,x.bjmc,x.xy,x.mzmc,x.zzmmmc,x.yxsbzdkqk,x.zxcjqgzxqk,"
			+ "x.JTCY1_XM,x.JTCY1_NL,x.JTCY1_GX,x.JTCY1_YSR,x.JTCY1_GZDZ,"
			+ "x.JTCY2_XM,x.JTCY2_NL,x.JTCY2_GX,x.JTCY2_YSR,x.JTCY2_GZDZ,"
			+ "x.JTCY3_XM,x.JTCY3_NL,x.JTCY3_GX,x.JTCY3_YSR,x.JTCY3_GZDZ,"
			+ "x.JTCY4_XM,x.JTCY4_NL,x.JTCY4_GX,x.JTCY4_YSR,x.JTCY4_GZDZ,"
			+ "x.JTCY5_XM,x.JTCY5_NL,x.JTCY5_GX,x.JTCY5_YSR,x.JTCY5_GZDZ,"
			+ "x.SQSJ,x.JTZZ,x.SQLY,x.XYSHYJ,x.XXSHYJ,x.SFKNS,x.YZBM,x.XMC,"
			+ "x.XXMC,x.XYSH,x.XXSH,x.njmjedx,x.jmjedx from view_xsxfjmsq x "
			+ "where x.xh||x.nd=?) a ";
		outValue = dao.getOneRs(sql, new String[] { pkVal }, outString);

		boolean isSHGC = false;
		boolean isKNS = false;
		String xxdm = StandardOperation.getXxdm();
		if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
			isSHGC = true;
		}
		if (outValue == null) {
			if (xh != null) {
				if (isSHGC) {
					sql = "select a.*,(select b.kh from view_stu_details b where a.xh=b.xh) kh "
						+ "from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,q.MZMC mz,q.zzmmmc,"
						+ "v.zymc xi,x.xxmc,v.jtfk,v.jtfkrs,v.jtyzsr,v.jtrjsr,v.jtsrly,v.yzbm,v.jtzz,"
						+ "v.jtcy1_xm,v.jtcy1_gx,v.jtcy1_nl,v.jtcy1_ysr,v.jtcy1_gzdw,"
						+ "v.jtcy2_xm,v.jtcy2_gx,v.jtcy2_nl,v.jtcy2_ysr,v.jtcy2_gzdw,"
						+ "v.jtcy3_xm,v.jtcy3_gx,v.jtcy3_nl,v.jtcy3_ysr,v.jtcy3_gzdw,"
						+ "v.jtcy4_xm,v.jtcy4_gx,v.jtcy4_nl,v.jtcy4_ysr,v.jtcy4_gzdw,"
						+ "v.jtcy5_xm,v.jtcy5_gx,v.jtcy5_nl,v.jtcy5_ysr,v.jtcy5_gzdw,q.csrq csny "
						+ "from view_knsxx v,view_stu_details q,xtszb x "
						+ "where v.xh = q.xh "
						+ "and v.xxsh = '通过' and v.xh=?) a ";
					String[] temp = new String[] { "xh", "xm", "xb", "bjmc",
							"xymc", "mz", "zzmmmc", "xi", "xxmc", "jtfk",
							"jtfkrs", "jtyzsr", "jtrjsr", "jtsrly", "yzbm",
							"jtzz", "jtcy1_xm", "jtcy1_gx", "jtcy1_nl",
							"jtcy1_ysr", "jtcy1_gzdw", "jtcy2_xm", "jtcy2_gx",
							"jtcy2_nl", "jtcy2_ysr", "jtcy2_gzdw", "jtcy3_xm",
							"jtcy3_gx", "jtcy3_nl", "jtcy3_ysr", "jtcy3_gzdw",
							"jtcy4_xm", "jtcy4_gx", "jtcy4_nl", "jtcy4_ysr",
							"jtcy4_gzdw", "jtcy5_xm", "jtcy5_gx", "jtcy5_nl",
							"jtcy5_ysr", "jtcy5_gzdw", "csny", "kh" };
					String[] outValT = dao.getOneRs(sql, new String[] { xh },
							temp);
					if (outValT == null) {

						sql = "select a.*,(select b.kh from view_stu_details b where a.xh=b.xh "
							+ ") kh from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,q.MZMC mz,"
							+ "q.zzmmmc,v.zymc xi,x.xxmc,q.csrq csny "
							+ "from view_xsjbxx v,view_stu_details q,"
							+ "xtszb x where v.xh = q.xh and "
							+ "v.xh=?) a ";
						String[] colName = new String[] { "xh", "xm", "xb",
								"bjmc", "xymc", "mz", "zzmmmc", "xi", "xxmc",
								"csny", "kh" };
						String[] outVal = dao.getOneRs(sql,
								new String[] { xh }, colName);
						if (outVal == null) {

						} else {
							colName = new String[] { "xh", "xm", "xb", "bjmc",
									"xy", "mzmc", "zzmmmc", "xmc", "xxmc",
									"csny", "kh" };
							for (int i = 0; i < colName.length; i++) {
								if (outVal[i] != null) {
									map.put(colName[i], outVal[i]);
								} else {
									map.put(colName[i], "");
								}
							}
						}
					} else {
						isKNS = true;
						temp = new String[] { "xh", "xm", "xb", "bjmc", "xy",
								"mzmc", "zzmmmc", "xmc", "xxmc", "jtfk",
								"jtfkrs", "jtyzsr", "jtrjsr", "jtsrly", "yzbm",
								"jtzz", "JTCY1_XM", "JTCY1_GX", "JTCY1_nl",
								"JTCY1_YSR", "JTCY1_GZDZ", "JTCY2_XM",
								"JTCY2_GX", "JTCY2_nl", "JTCY2_YSR",
								"JTCY2_GZDZ", "JTCY3_XM", "JTCY3_GX",
								"JTCY3_nl", "JTCY3_YSR", "JTCY3_GZDZ",
								"JTCY4_XM", "JTCY4_GX", "JTCY4_nl",
								"JTCY4_YSR", "JTCY4_GZDZ", "JTCY5_XM",
								"JTCY5_GX", "JTCY5_nl", "JTCY5_YSR",
								"JTCY5_GZDZ", "csny", "kh" };
						for (int i = 0; i < temp.length; i++) {
							if (outValT[i] != null) {
								map.put(temp[i], outValT[i]);
							} else {
								map.put(temp[i], "");
							}
						}
					}
				} else {
					sql = "select a.*,(select b.kh from view_stu_details b where a.xh=b.xh) kh "
						+ "from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,q.MZMC mz,"
						+ "q.zzmmmc,v.zymc xi,x.xxmc,q.csrq csny from view_xsjbxx v,view_stu_details q,"
						+ "xtszb x where v.xh = q.xh and "
						+ "v.xh=?) a ";
					String[] colName = new String[] { "xh", "xm", "xb", "bjmc",
							"xymc", "mz", "zzmmmc", "xi", "xxmc", "csny", "kh" };
					String[] outVal = dao.getOneRs(sql, new String[] { xh },
							colName);
					if (outVal == null) {

					} else {
						colName = new String[] { "xh", "xm", "xb", "bjmc",
								"xy", "mzmc", "zzmmmc", "xmc", "xxmc", "csny",
						"kh" };
						for (int i = 0; i < colName.length; i++) {
							if (outVal[i] != null) {
								map.put(colName[i], outVal[i]);
							} else {
								map.put(colName[i], "");
							}
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		if (isSHGC) {
			request.setAttribute("isSHGC", "is");
		} else {
			request.setAttribute("isSHGC", "no");
		}
		if (isSHGC && isKNS) {
			request.setAttribute("isSHGCKNS", "is");
		} else {
			request.setAttribute("isSHGCKNS", "no");
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward xsxfjmsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String sqlb = "";
		sqlb = "学生学费减免";

		String xh = DealString.toGBK(request.getParameter("xh"));
		String xm = request.getParameter("xm");
		String csny = request.getParameter("csny");
		String xb = request.getParameter("xb");
		String zzmmmc = request.getParameter("zzmmmc");
		String mzmc = request.getParameter("mzmc");
		String qs = request.getParameter("qs");
		String lxdh = request.getParameter("lxdh");
		String xrzw = request.getParameter("xrzw");
		String xy = request.getParameter("xy");
		String bjmc = request.getParameter("bjmc");
		String yzbm = request.getParameter("yzbm");
		String jtzz = request.getParameter("jtzz");
		String yxsbzdkqk = request.getParameter("yxsbzdkqk");
		String zxcjqgzxqk = request.getParameter("zxcjqgzxqk");
		String jtcy1_xm = request.getParameter("JTCY1_XM");
		String jtcy1_nl = request.getParameter("JTCY1_nl");
		String jtcy1_gx = request.getParameter("JTCY1_GX");
		String jtcy1_ysr = request.getParameter("JTCY1_YSR");
		String jtcy1_gzdz = request.getParameter("JTCY1_GZDZ");
		String jtcy2_xm = request.getParameter("JTCY2_XM");
		String jtcy2_nl = request.getParameter("JTCY2_nl");
		String jtcy2_gx = request.getParameter("JTCY2_GX");
		String jtcy2_ysr = request.getParameter("JTCY2_YSR");
		String jtcy2_gzdz = request.getParameter("JTCY2_GZDZ");
		String jtcy3_xm = request.getParameter("JTCY3_XM");
		String jtcy3_nl = request.getParameter("JTCY3_nl");
		String jtcy3_gx = request.getParameter("JTCY3_GX");
		String jtcy3_ysr = request.getParameter("JTCY3_YSR");
		String jtcy3_gzdz = request.getParameter("JTCY3_GZDZ");
		String jtcy4_xm = request.getParameter("JTCY4_XM");
		String jtcy4_nl = request.getParameter("JTCY4_nl");
		String jtcy4_gx = request.getParameter("JTCY4_GX");
		String jtcy4_ysr = request.getParameter("JTCY4_YSR");
		String jtcy4_gzdz = request.getParameter("JTCY4_GZDZ");
		String jtcy5_xm = request.getParameter("JTCY5_XM");
		String jtcy5_nl = request.getParameter("JTCY5_nl");
		String jtcy5_gx = request.getParameter("JTCY5_GX");
		String jtcy5_ysr = request.getParameter("JTCY5_YSR");
		String jtcy5_gzdz = request.getParameter("JTCY5_GZDZ");
		String sqly = request.getParameter("sqly");
		String xyshyj = request.getParameter("xyshyj");
		String xxshyj = request.getParameter("xxshyj");
		String njmje = request.getParameter("njmje");
		String jmje = request.getParameter("jmje");
		String njmjedx = request.getParameter("njmjedx");
		String jmjedx = request.getParameter("jmjedx");

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xh, xm, csny, xb, zzmmmc, mzmc, qs,
				lxdh, xrzw, bjmc, xy, yzbm, jtzz, yxsbzdkqk, zxcjqgzxqk,
				jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_ysr, jtcy1_gzdz, jtcy2_xm,
				jtcy2_nl, jtcy2_gx, jtcy2_ysr, jtcy2_gzdz, jtcy3_xm, jtcy3_nl,
				jtcy3_gx, jtcy3_ysr, jtcy3_gzdz, jtcy4_xm, jtcy4_nl, jtcy4_gx,
				jtcy4_ysr, jtcy4_gzdz, jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_ysr,
				jtcy5_gzdz, sqly, xyshyj, xxshyj, njmje, jmje, njmjedx, jmjedx };
		String[] outString = new String[] { "xh", "xm", "csny", "xb", "zzmmmc",
				"mzmc", "qs", "lxdh", "xrzw", "bjmc", "xy", "yzbm", "jtzz",
				"yxsbzdkqk", "zxcjqgzxqk", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
				"jtcy1_ysr", "jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
				"jtcy2_ysr", "jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
				"jtcy3_ysr", "jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
				"jtcy4_ysr", "jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
				"jtcy5_ysr", "jtcy5_gzdz", "sqly", "xyshyj", "xxshyj", "njmje",
				"jmje", "njmjedx", "jmjedx" };
		// System.out.println(outString[35]+outValue[35]);
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				// System.out.println("i="+i+" "+outString[i]);
				map.put(outString[i], DealString.toGBK(outValue[i]));
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	// 助学贷款申请
	private ActionForward zxdkSq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String xxmc = ToolClass.getXxmc();
		String doType = request.getParameter("doType");// 操作类型
		String titName = request.getParameter("titName");

		String sfksq = "-1";// 国家奖学金是否可申请参数，-1表示不可以，1表示可以。

		String[] pages = null;
		String[] titNames = null;
		String now = dao.getOneRs(
				"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
				new String[] {}, "sdate");
		pages = new String[] { "助学贷款" };
		titNames = new String[] { "zxdksq" };
		String[] colName1 = null;

		if (titName == null)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		List pagesList = dao.arrayToList(titNames, pages);
		request.setAttribute("pages", pagesList);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间
		String[] outString = new String[] {};
		sql = "select xh,xm,xb,csny,xxmc,xymc,xmc,ssdh,xz,xl,dkze,xfdks,"
			+ "shfdks,zsfdks,dkqxkssj,dkqxjssj,jtzz,yzbm,dh,fqxm,fqzy,"
			+ "fqsfzh,mqxm,mqzy,mqsfzh,jtsr,sqsj,nd,xysh,xxsh,xxshyj,"
			+ "xyshyj,jtrjsr from ZXDK_xssqb where 1=2";
		outString = dao.getColumnName(sql);// 获得view_xsjxjzxjsq的列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
		String xh = "";
		String pkVal = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;
			if (titName.equalsIgnoreCase("zxdksq")) {
				sql1 = "select a.kssj,a.jssj from view_shgc_gjzxdk_sjb a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and b.xh=? and a.xmmc='国家助学贷款'";// ,nd
				// and
				// substr(gjjxjsqkssj,1,4)=?
				jxjksjssj = dao.getOneRs(sql1, new String[] { xh },
						new String[] { "kssj", "jssj" });
			} else if (titName.equalsIgnoreCase("txsq")) {
				sql1 = "select zxdktxkssj,zxdktxjssj from xszhsjb a,"
					+ "view_xsjbxx b where a.XYDM=b.xydm and b.xh=? ";// and
				// substr(gjjxjsqkssj,1,4)=?
				jxjksjssj = dao.getOneRs(sql1, new String[] { xh },
						new String[] { "zxdktxkssj", "zxdktxjssj" });
			}

			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(now) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(now) >= 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String xm = DealString.toGBK(request.getParameter("xm")
							.toString());
					String xb = DealString.toGBK(request.getParameter("xb")
							.toString());
					String csny = DealString.toGBK(request.getParameter("csny")
							.toString());
					String xymc = DealString.toGBK(request.getParameter("xymc")
							.toString());
					String xmc = DealString.toGBK(request.getParameter("xmc")
							.toString());
					String ssdh = DealString.toGBK(request.getParameter("ssdh")
							.toString());
					String xz = DealString.toGBK(request.getParameter("xz")
							.toString());
					String xl = DealString.toGBK(request.getParameter("xl")
							.toString());
					String dkze = DealString.toGBK(request.getParameter("dkze")
							.toString());
					String xfdks = DealString.toGBK(request.getParameter(
					"xfdks").toString());
					String fqsfzh = DealString.toGBK(request.getParameter(
					"fqsfzh").toString());
					String mqsfzh = DealString.toGBK(request.getParameter(
					"mqsfzh").toString());
					String shfdks = DealString.toGBK(request.getParameter(
					"shfdks").toString());
					String zsfdks = DealString.toGBK(request.getParameter(
					"zsfdks").toString());
					String jtzz = DealString.toGBK(request.getParameter("jtzz")
							.toString());
					String yzbm = DealString.toGBK(request.getParameter("yzbm")
							.toString());
					String fqxm = DealString.toGBK(request.getParameter("fqxm")
							.toString());
					String fqzy = DealString.toGBK(request.getParameter("fqzy")
							.toString());
					String dh = DealString.toGBK(request.getParameter("dh")
							.toString());
					String mqxm = DealString.toGBK(request.getParameter("mqxm")
							.toString());
					String mqzy = DealString.toGBK(request.getParameter("mqzy")
							.toString());
					String jtsr = DealString.toGBK(request.getParameter("jtsr")
							.toString());
					String dkqxkssj = DealString.toGBK(request.getParameter(
					"dkqxkssj").toString());
					String dkqxjssj = DealString.toGBK(request.getParameter(
					"dkqxjssj").toString());
					String jtrjsr = DealString.toGBK(request.getParameter(
					"jtrjsr").toString());
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}
					String monthBen = dao.getOneRs("select floor(months_between(add_months(to_date(rxny,'yyyy-mm-dd'),120),to_date('"+dkqxjssj+"','yyyy-mm-dd'))) monthBen from bks_xsjbxx where xh=?", new String[]{xh}, "monthBen");
					if(monthBen == null){
						dkqxjssj = dao.getOneRs("select to_char(add_months(to_date(rxny,'yyyy-mm-dd'),120),'yyyy-mm-dd') tenYear from bks_xsjbxx where xh=?", new String[]{xh}, "tenYear");
					}
					if(monthBen != null && Integer.valueOf(monthBen) < 0 ){
						dkqxjssj = dao.getOneRs("select to_char(add_months(to_date(rxny,'yyyy-mm-dd'),120),'yyyy-mm-dd') tenYear from bks_xsjbxx where xh=?", new String[]{xh}, "tenYear");
					}
					

					sql = "select xxsh from ZXDK_XSSQB where xh||nd=? ";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("ZXDK_XSSQB", "xh||nd", pkVal, request);

						colName1 = new String[] { "xh", "xm", "xb", "csny",
								"xxmc", "xymc", "xmc", "ssdh", "xz", "xl",
								"dkze", "xfdks", "shfdks", "zsfdks",
								"dkqxkssj", "dkqxjssj", "jtzz", "yzbm", "dh",
								"fqxm", "fqzy", "fqsfzh", "mqxm", "mqzy",
								"mqsfzh", "jtsr", "nd", "jtrjsr" };

						String[] valueForOut = new String[] { xh, xm, xb, csny,
								xxmc, xymc, xmc, ssdh, xz, xl, dkze, xfdks,
								shfdks, zsfdks, dkqxkssj, dkqxjssj, jtzz, yzbm,
								dh, fqxm, fqzy, fqsfzh, mqxm, mqzy, mqsfzh,
								jtsr, nd, jtrjsr };

						boolean ok = false;
						ok = StandardOperation.insert("ZXDK_XSSQB", colName1,
								valueForOut, request);

						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String xm = DealString.toGBK(request.getParameter("xm")
						.toString());
				String xb = DealString.toGBK(request.getParameter("xb")
						.toString());
				String csny = DealString.toGBK(request.getParameter("csny")
						.toString());
				String xymc = DealString.toGBK(request.getParameter("xymc")
						.toString());
				String xmc = DealString.toGBK(request.getParameter("xmc")
						.toString());
				String ssdh = DealString.toGBK(request.getParameter("ssdh")
						.toString());
				String xz = DealString.toGBK(request.getParameter("xz")
						.toString());
				String xl = DealString.toGBK(request.getParameter("xl")
						.toString());
				String dkze = DealString.toGBK(request.getParameter("dkze")
						.toString());
				String xfdks = DealString.toGBK(request.getParameter("xfdks")
						.toString());
				String fqsfzh = DealString.toGBK(request.getParameter("fqsfzh")
						.toString());
				String mqsfzh = DealString.toGBK(request.getParameter("mqsfzh")
						.toString());
				String shfdks = DealString.toGBK(request.getParameter("shfdks")
						.toString());
				String zsfdks = DealString.toGBK(request.getParameter("zsfdks")
						.toString());
				String jtzz = DealString.toGBK(request.getParameter("jtzz")
						.toString());
				String yzbm = DealString.toGBK(request.getParameter("yzbm")
						.toString());
				String fqxm = DealString.toGBK(request.getParameter("fqxm")
						.toString());
				String fqzy = DealString.toGBK(request.getParameter("fqzy")
						.toString());
				String dh = DealString.toGBK(request.getParameter("dh")
						.toString());
				String mqxm = DealString.toGBK(request.getParameter("mqxm")
						.toString());
				String mqzy = DealString.toGBK(request.getParameter("mqzy")
						.toString());
				String jtsr = DealString.toGBK(request.getParameter("jtsr")
						.toString());
				String dkqxkssj = DealString.toGBK(request.getParameter(
				"dkqxkssj").toString());
				String dkqxjssj = DealString.toGBK(request.getParameter(
				"dkqxjssj").toString());
				String jtrjsr = DealString.toGBK(request.getParameter("jtrjsr")
						.toString());
				pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = xh + nd;
				}
				String monthBen = dao.getOneRs("select floor(months_between(add_months(to_date(rxny,'yyyy-mm-dd'),120),to_date('"+dkqxjssj+"','yyyy-mm-dd'))) monthBen from bks_xsjbxx where xh=?", new String[]{xh}, "monthBen");
				if(monthBen == null){
					dkqxjssj = dao.getOneRs("select to_char(add_months(to_date(rxny,'yyyy-mm-dd'),120),'yyyy-mm-dd') tenYear from bks_xsjbxx where xh=?", new String[]{xh}, "tenYear");
				}
				if(monthBen != null && Integer.valueOf(monthBen) < 0 ){
					dkqxjssj = dao.getOneRs("select to_char(add_months(to_date(rxny,'yyyy-mm-dd'),120),'yyyy-mm-dd') tenYear from bks_xsjbxx where xh=?", new String[]{xh}, "tenYear");
				}

				sql = "select xxsh from ZXDK_XSSQB where xh||nd=? ";
				String[] temp = dao.getOneRs(sql, new String[] { pkVal },
						new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("ZXDK_XSSQB", "xh||nd", pkVal, request);

					colName1 = new String[] { "xh", "xm", "xb", "csny",
							"xxmc", "xymc", "xmc", "ssdh", "xz", "xl",
							"dkze", "xfdks", "shfdks", "zsfdks",
							"dkqxkssj", "dkqxjssj", "jtzz", "yzbm", "dh",
							"fqxm", "fqzy", "fqsfzh", "mqxm", "mqzy",
							"mqsfzh", "jtsr", "nd", "jtrjsr" };

					String[] valueForOut = new String[] { xh, xm, xb, csny,
							xxmc, xymc, xmc, ssdh, xz, xl, dkze, xfdks,
							shfdks, zsfdks, dkqxkssj, dkqxjssj, jtzz, yzbm,
							dh, fqxm, fqzy, fqsfzh, mqxm, mqzy, mqsfzh,
							jtsr, nd, jtrjsr };

					boolean ok = false;
					ok = StandardOperation.insert("ZXDK_XSSQB", colName1,
							valueForOut, request);

					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		}

		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd;
		}
		outString = new String[] { "xh", "xm", "xb", "csny", "xxmc", "xymc",
				"xmc", "ssdh", "xz", "xl", "dkze", "xfdks", "shfdks", "zsfdks",
				"dkqxkssj", "dkqxjssj", "jtzz", "yzbm", "dh", "fqxm", "fqzy",
				"fqsfzh", "mqxm", "mqzy", "mqsfzh", "jtsr", "sqsj", "nd",
				"xysh", "xxsh", "xxshyj", "xyshyj", "kh", "jtrjsr" };

		sql = "select a.*,(select b.kh from view_stu_details b where a.xh=b.xh) kh "
			+ "from (select x.xh,x.xm,x.xb,x.csny,x.xxmc,x.xymc,x.xmc,"
			+ "x.ssdh,x.xz,x.xl,x.dkze,x.xfdks,x.shfdks,x.zsfdks,x.dkqxkssj,x.dkqxjssj,"
			+ "x.jtzz,x.yzbm,x.dh,x.fqxm,x.fqzy,x.fqsfzh,x.mqxm,x.mqzy,x.mqsfzh,x.jtsr,"
			+ "x.sqsj,x.nd,x.xysh,x.xxsh,x.xxshyj,x.xyshyj,x.jtrjsr from ZXDK_XSSQB x "
			+ "where x.xh||x.nd=?) a ";
		outValue = dao.getOneRs(sql, new String[] { pkVal }, outString);

		boolean isSHGC = false;
		boolean isKNS = false;
		String xxdm = StandardOperation.getXxdm();
		if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
			isSHGC = true;
		}
		if (outValue == null) {
			if (xh != null) {
				if (isSHGC) {
					sql = "select v1.rxny,v.xh,v1.ksh,v.xm,v.xb,"
						+ "v.bjmc,v.xymc,q.MZMC,v.zymc xmc,x.xxmc,v1.sfzh,q.csrq csny,"
						+ "v1.xz,v.jtfk,v.jtfkrs,v.jtyzsr,v.jtrjsr,v.jtsrly,v.yzbm,v.jtzz,"
						+ "v.jtcy1_xm,v.jtcy1_gx,v.jtcy1_nl,v.jtcy1_gzdw,"
						+ "v.jtcy2_xm,v.jtcy2_gx,v.jtcy2_nl,v.jtcy2_gzdw,"
						+ "v.jtcy3_xm,v.jtcy3_gx,v.jtcy3_nl,v.jtcy3_gzdw,"
						+ "v.jtcy4_xm,v.jtcy4_gx,v.jtcy4_nl,v.jtcy4_gzdw,"
						+ "v.jtcy5_xm,v.jtcy5_gx,v.jtcy5_nl,v.jtcy5_gzdw,q.kh "
						+ "from view_knsxx v,view_zxdk_xsjbxx v1,view_stu_details q,"
						+ "xtszb x where v.xh = q.xh "
						+ "and v1.xh = v.xh and v.xxsh = '通过' and v.xh=? ";
					String[] temp = new String[] { "rxny", "xh", "ksh", "xm",
							"xb", "bjmc", "xymc", "mzmc", "xmc", "xxmc",
							"sfzh", "csny", "xz", "jtfk", "jtfkrs", "jtyzsr",
							"jtrjsr", "jtsrly", "yzbm", "jtzz", "jtcy1_xm",
							"jtcy1_gx", "jtcy1_nl", "jtcy1_gzdw", "jtcy2_xm",
							"jtcy2_gx", "jtcy2_nl", "jtcy2_gzdw", "jtcy3_xm",
							"jtcy3_gx", "jtcy3_nl", "jtcy3_gzdw", "jtcy4_xm",
							"jtcy4_gx", "jtcy4_nl", "jtcy4_gzdw", "jtcy5_xm",
							"jtcy5_gx", "jtcy5_nl", "jtcy5_gzdw", "kh" };
					String[] outValT = dao.getOneRs(sql, new String[] { xh },
							temp);
					if (outValT == null) {
						sql = "select v.rxny,v.xh,v.ksh,v.xm,"
							+ "v.xb,v.bjmc,v.xymc,q.MZMC,v.zymc xmc,x.xxmc,v.sfzh,"
							+ "q.csrq csny,v.xz,q.kh from view_zxdk_xsjbxx v,view_stu_details q,"
							+ "xtszb x where v.xh = q.xh "
							+ "and v.xh=?";
						String[] colName = new String[] { "rxny", "xh", "ksh",
								"xm", "xb", "bjmc", "xymc", "mzmc", "xmc",
								"xxmc", "sfzh", "csny", "xz", "kh" };
						String[] outVal = dao.getOneRs(sql,
								new String[] { xh }, colName);
						if (outVal == null) {
							sql = "select (select b.rxny from bks_xsjbxx b where q.xh=b.xh) rxny,q.xh,q.xm,"
								+ "q.xb,q.bjmc,q.xymc,q.MZMC,q.zymc xmc,x.xxmc,q.sfzh,"
								+ "q.csrq csny,q.xz,q.kh from view_stu_details q,"
								+ "xtszb x where q.xh=?";
							String[] cName = new String[] { "rxny", "xh",
									"xm", "xb", "bjmc", "xymc", "mzmc", "xmc",
									"xxmc", "sfzh", "csny", "xz", "kh" };
							String[] oVal = dao.getOneRs(sql,
									new String[] { xh }, cName);
							if (oVal != null){
								cName = new String[] { "rxny", "xh", "xm",
										"xb", "bjmc", "xymc", "mzmc", "xmc",
										"xxmc", "sfzh", "csny", "xz", "kh" };
								for (int i = 0; i < cName.length; i++) {
									if (oVal[i] != null) {
										map.put(cName[i], oVal[i]);
									} else {
										map.put(cName[i], "");
									}
								}
								map.put("dkqxkssj", now);
							}
						} else {
							colName = new String[] { "rxny", "xh", "ksh", "xm",
									"xb", "bjmc", "xymc", "mzmc", "xmc",
									"xxmc", "sfzh", "csny", "xz", "kh" };
							for (int i = 0; i < colName.length; i++) {
								if (outVal[i] != null) {
									map.put(colName[i], outVal[i]);
								} else {
									map.put(colName[i], "");
								}
							}
							map.put("dkqxkssj", now);
						}
					} else {
						isKNS = true;
						temp = new String[] { "rxny", "xh", "ksh", "xm", "xb",
								"bjmc", "xymc", "mzmc", "xmc", "xxmc", "sfzh",
								"csny", "xz", "jtfk", "jtfkrs", "jtsr",
								"jtrjsr", "jtsrly", "yzbm", "jtzz", "jtcy1_xm",
								"jtcy1_gx", "jtcy1_nl", "jtcy1_gzdw",
								"jtcy2_xm", "jtcy2_gx", "jtcy2_nl",
								"jtcy2_gzdw", "jtcy3_xm", "jtcy3_gx",
								"jtcy3_nl", "jtcy3_gzdw", "jtcy4_xm",
								"jtcy4_gx", "jtcy4_nl", "jtcy4_gzdw",
								"jtcy5_xm", "jtcy5_gx", "jtcy5_nl",
								"jtcy5_gzdw", "kh" };
						for (int i = 0; i < temp.length; i++) {
							if (outValT[i] != null) {
								map.put(temp[i], outValT[i]);
							} else {
								map.put(temp[i], "");
							}
						}
						map.put("dkqxkssj", now);
					}
				} else {
					sql = "select v.rxny,v.xh,v.ksh,v.xm,"
						+ "v.xb,v.bjmc,v.xymc,q.MZMC,v.zymc xmc,x.xxmc,v.sfzh,"
						+ "q.csrq csny,v.xz,q.kh from view_zxdk_xsjbxx v,view_stu_details q,"
						+ "xtszb x where v.xh = q.xh "
						+ "and v.xh=? ";
					String[] colName = new String[] { "rxny", "xh", "ksh",
							"xm", "xb", "bjmc", "xymc", "mzmc", "xmc", "xxmc",
							"sfzh", "csny", "xz", "kh" };
					String[] outVal = dao.getOneRs(sql, new String[] { xh },
							colName);
					if (outVal == null) {
						sql = "select (select b.rxny from bks_xsjbxx b where q.xh=b.xh) rxny,q.xh,q.xm,"
							+ "q.xb,q.bjmc,q.xymc,q.MZMC,q.zymc xmc,x.xxmc,q.sfzh,"
							+ "q.csrq csny,q.xz,q.kh from view_stu_details q,"
							+ "xtszb x where q.xh=?";
						String[] cName = new String[] { "rxny", "xh",
								"xm", "xb", "bjmc", "xymc", "mzmc", "xmc",
								"xxmc", "sfzh", "csny", "xz", "kh" };
						String[] oVal = dao.getOneRs(sql,
								new String[] { xh }, cName);
						if (oVal != null){
							cName = new String[] { "rxny", "xh", "ksh", "xm",
									"xb", "bjmc", "xymc", "mzmc", "xmc",
									"xxmc", "sfzh", "csny", "xz", "kh" };
							for (int i = 0; i < cName.length; i++) {
								if (oVal[i] != null) {
									map.put(cName[i], oVal[i]);
								} else {
									map.put(cName[i], "");
								}
							}
							map.put("dkqxkssj", now);
						}
					} else {
						colName = new String[] { "rxny", "xh", "ksh", "xm",
								"xb", "bjmc", "xymc", "mzmc", "xmc", "xxmc",
								"sfzh", "csny", "xz", "kh" };
						for (int i = 0; i < colName.length; i++) {
							if (outVal[i] != null) {
								map.put(colName[i], outVal[i]);
							} else {
								map.put(colName[i], "");
							}
						}
						map.put("dkqxkssj", now);
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
			map.put("dkqxkssj", now);
		}
		if (isSHGC && isKNS) {
			request.setAttribute("isSHGCKNS", "is");
		} else {
			request.setAttribute("isSHGCKNS", "no");
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward zxdksqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String sqlb = "";
		sqlb = "中国银行上海市分行国家助学贷款";

		String xh = DealString.toGBK(request.getParameter("xh"));
		String xm = request.getParameter("xm");
		String csny = request.getParameter("csny");
		String xb = request.getParameter("xb");
		String xxmc = request.getParameter("xxmc");
		String xymc = request.getParameter("xymc");
		String sfzh = request.getParameter("sfzh");
		String xmc = request.getParameter("xmc");
		String ssdh = request.getParameter("ssdh");
		String xz = request.getParameter("xz");
		String dkze = request.getParameter("dkze");
		String xfdks = request.getParameter("xfdks");
		String zsfdks = request.getParameter("zsfdks");
		String shfdks = request.getParameter("shfdks");
		String jtzz = request.getParameter("jtzz");
		String yzbm = request.getParameter("yzbm");
		String dh = request.getParameter("dh");
		String fqxm = request.getParameter("fqxm");
		String fqzy = request.getParameter("fqzy");
		String fqsfzh = request.getParameter("fqsfzh");
		String mqxm = request.getParameter("mqxm");
		String mqzy = request.getParameter("mqzy");
		String mqsfzh = request.getParameter("mqsfzh");
		String jtsr = request.getParameter("jtsr");
		String dkqxkssj = request.getParameter("dkqxkssj");
		String dkqxjssj = request.getParameter("dkqxjssj");

		String kssjYear = "";
		String kssjMonth = "";
		String kssjDay = "";
		if (!"".equalsIgnoreCase(dkqxkssj)) {
			kssjYear = dkqxkssj.substring(0, 4);
			kssjMonth = dkqxkssj.substring(5, 7);
			kssjDay = dkqxkssj.substring(8, 10);
		}

		String jssjYear = "";
		String jssjMonth = "";
		String jssjDay = "";
		if (!"".equalsIgnoreCase(dkqxjssj)) {
			jssjYear = dkqxjssj.substring(0, 4);
			jssjMonth = dkqxjssj.substring(5, 7);
			jssjDay = dkqxjssj.substring(8, 10);
		}

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xh, xm, csny, xb, xxmc, xymc, sfzh,
				xmc, ssdh, xz, dkze, xfdks, zsfdks, shfdks, jtzz, yzbm, dh,
				fqxm, fqzy, fqsfzh, mqxm, mqzy, mqsfzh, jtsr, kssjYear,
				kssjMonth, kssjDay, jssjYear, jssjMonth, jssjDay };
		String[] outString = new String[] { "xh", "xm", "csny", "xb", "xxmc",
				"xymc", "sfzh", "xmc", "ssdh", "xz", "dkze", "xfdks", "zsfdks",
				"shfdks", "jtzz", "yzbm", "dh", "fqxm", "fqzy", "fqsfzh",
				"mqxm", "mqzy", "mqsfzh", "jtsr", "kssjYear", "kssjMonth",
				"kssjDay", "jssjYear", "jssjMonth", "jssjDay" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				map.put(outString[i], DealString.toGBK(outValue[i]));
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward txsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String sqlb = "";
		sqlb = "贴息";

		String xh = DealString.toGBK(request.getParameter("xh"));
		String xb = request.getParameter("xb");
		String xm = request.getParameter("xm");
		String sfzh = request.getParameter("sfzh");
		String xxmc = request.getParameter("xxmc");
		String dkyh = request.getParameter("dkyh");
		String dkzje = request.getParameter("dkzje");
		String dkqx = request.getParameter("dkqx");
		String yflx = request.getParameter("yflx");
		String jytx = request.getParameter("jytx");
		String bktx = request.getParameter("bktx");
		String nd = request.getParameter("nd");
		String sqsj = request.getParameter("sqsj");
		String zctx = request.getParameter("zctx");
		String xxshyj = request.getParameter("xxshyj");
		String xyshyj = request.getParameter("xyshyj");

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xh, xb, xm, sfzh, xxmc, dkyh, dkzje,
				dkqx, yflx, bktx, jytx, zctx, nd, sqsj, xxshyj, xyshyj };
		String[] outString = new String[] { "xh", "xb", "xm", "sfzh", "xxmc",
				"dkyh", "dkzje", "dkqx", "yflx", "bktx", "jytx", "zctx", "nd",
				"sqsj", "xxshyj", "xyshyj" };
		// System.out.println(outString[35]+outValue[35]);
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				// System.out.println("i="+i+" "+outString[i]);
				map.put(outString[i], DealString.toGBK(outValue[i]));
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward txsq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String doType = request.getParameter("doType");// 操作类型
		String titName = request.getParameter("titName");// 访问助学金还是奖学金

		String sfksq = "-1";// 国家奖学金是否可申请参数，-1表示不可以，1表示可以。

		String[] pages = null;
		String[] titNames = null;
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyymmddhh24miss') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		pages = new String[] { "贴息申请" };
		titNames = new String[] { "txsq" };
		String[] colName1 = null;

		if (titName == null)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		List pagesList = dao.arrayToList(titNames, pages);
		request.setAttribute("pages", pagesList);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间
		String[] outString = new String[] {};
		sql = "select xh,xb,xm,sfzh,xxmc,dkyh,dkzje,dkqx,yflx,bktx,jytx,zctx,"
			+ "nd,sqsj,xxshyj,xyshyj,xysh,xxsh from xstxsqb where 1=2";
		outString = dao.getColumnName(sql);
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
		String xh = "";
		String pkVal = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;
			sql1 = "select zxdktxsqkssj,zxdktxsqjssj from xszhsjb a,view_xsjbxx b "
				+ "where a.zydm=b.xydm and b.xh=? ";// ,nd
			// and
			// substr(gjjxjsqkssj,1,4)=?
			jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
					"zxdktxsqkssj", "zxdktxsqjssj" });

			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) < 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) > 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String xm = DealString.toGBK(request.getParameter("xm")
							.toString());
					String xb = DealString.toGBK(request.getParameter("xb")
							.toString());
					String sfzh = DealString.toGBK(request.getParameter("sfzh")
							.toString());
					String xxmc = DealString.toGBK(request.getParameter("xxmc")
							.toString());
					String dkyh = DealString.toGBK(request.getParameter("dkyh")
							.toString());
					String dkzje = DealString.toGBK(request.getParameter(
					"dkzje").toString());
					String dkqx = DealString.toGBK(request.getParameter("dkqx")
							.toString());
					String yflx = DealString.toGBK(request.getParameter("yflx")
							.toString());
					String bktx = DealString.toGBK(
							request.getParameter("bktx").toString());
					String jytx = DealString.toGBK(
							request.getParameter("jytx").toString());
					String zctx = DealString.toGBK(
							request.getParameter("zctx").toString());
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}

					sql = "select xxsh from xstxsqb where xh||nd=? ";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("xstxsqb", "xh||nd", pkVal,
								request);

						colName1 = new String[] { "xh", "xb", "xm", "sfzh",
								"xxmc", "dkyh", "dkzje", "dkqx", "yflx",
								"bktx", "jytx", "zctx", "nd" };

						String[] valueForOut = new String[] { xh, xb, xm, sfzh,
								xxmc, dkyh, dkzje, dkqx, yflx, bktx, jytx,
								zctx, nd };

						boolean ok = false;
						ok = StandardOperation.insert("xstxsqb", colName1,
								valueForOut, request);
						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String xm = DealString.toGBK(request.getParameter("xm")
						.toString());
				String xb = DealString.toGBK(request.getParameter("xb")
						.toString());
				String sfzh = DealString.toGBK(request.getParameter("sfzh")
						.toString());
				String xxmc = DealString.toGBK(request.getParameter("xxmc")
						.toString());
				String dkyh = DealString.toGBK(request.getParameter("dkyh")
						.toString());
				String dkzje = DealString.toGBK(request.getParameter("dkzje")
						.toString());
				String dkqx = DealString.toGBK(request.getParameter("dkqx")
						.toString());
				String yflx = DealString.toGBK(request.getParameter("yflx")
						.toString());
				String bktx = DealString.toGBK(
						request.getParameter("bktx").toString());
				String jytx = DealString.toGBK(
						request.getParameter("jytx").toString());
				String zctx = DealString.toGBK(
						request.getParameter("zctx").toString());
				pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = xh + nd;
				}

				sql = "select xxsh from xstxsqb where xh||nd=? ";
				String[] temp = dao.getOneRs(sql, new String[] { pkVal },
						new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("xstxsqb", "xh||nd", pkVal,
							request);

					colName1 = new String[] { "xh", "xb", "xm", "sfzh",
							"xxmc", "dkyh", "dkzje", "dkqx", "yflx",
							"bktx", "jytx", "zctx", "nd" };

					String[] valueForOut = new String[] { xh, xb, xm, sfzh,
							xxmc, dkyh, dkzje, dkqx, yflx, bktx, jytx,
							zctx, nd };

					boolean ok = false;
					ok = StandardOperation.insert("xstxsqb", colName1,
							valueForOut, request);
					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		}
		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd;
		}
		sql = "select xh,xb,xm,sfzh,xxmc,dkyh,dkzje,dkqx,yflx,bktx,jytx,zctx,nd,"
			+ "sqsj,xxshyj,xyshyj,xysh,xxsh from xstxsqb where xh||nd=? ";
		outValue = dao.getOneRs(sql, new String[] { pkVal }, outString);
		outString = new String[] { "xh", "xb", "xm", "sfzh", "xxmc", "dkyh",
				"dkzje", "dkqx", "yflx", "bktx", "jytx", "zctx", "nd", "sqsj",
				"xxshyj", "xyshyj", "xysh", "xxsh" };

		if (outValue == null) {
			if (xh != null) {
				sql = "select v.rxny,v.xh,v.ksh,v.xm,v.xb,v.bjmc,v.xymc,q.MZMC,"
					+ "v.zymc xmc,x.xxmc,v.sfzh,q.csrq,v.xz from "
					+ "view_zxdk_xsjbxx v,view_stu_details q,xtszb x "
					+ "where v.xh = q.xh and v.xh=?";
				String[] colName = new String[] { "rxny", "xh", "ksh", "xm",
						"xb", "bjmc", "xymc", "mzmc", "xmc", "xxmc", "sfzh",
						"csrq", "xz" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {

				} else {
					colName = new String[] { "rxny", "xh", "ksh", "xm", "xb",
							"bjmc", "xymc", "mzmc", "xmc", "xxmc", "sfzh",
							"csrq", "xz" };
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward inputStu(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		boolean ok = false;
		String xxmc = ToolClass.getXxmc();
		DAO dao = DAO.getInstance();

		String logMsg;
		String sUName;
		HttpSession session = request.getSession();
		sUName = session.getAttribute("userName").toString();
		String[] colName1 = null;
		String xh = DealString.toGBK(request.getParameter("XH"));
		
		if((null != xh) && (!"".equalsIgnoreCase(xh))){
		String xm = DealString.toGBK(request.getParameter("XM").toString());
		String xb = DealString.toGBK(request.getParameter("XB").toString());
		String csrq = DealString.toGBK(request.getParameter("CSNY").toString());
		String xz = DealString.toGBK(request.getParameter("XZ").toString());
		String xl = DealString.toGBK(request.getParameter("XL").toString());
		String xymc = DealString.toGBK(request.getParameter("XYMC").toString());
		String xmc = DealString.toGBK(request.getParameter("XMC").toString());
		String ssdh = DealString.toGBK(request.getParameter("SSDH").toString());
		String jtsr = DealString.toGBK(request.getParameter("JTSR").toString());
		String fqsfzh = DealString.toGBK(request.getParameter("FQSFZH")
				.toString());
		String mqsfzh = DealString.toGBK(request.getParameter("MQSFZH")
				.toString());
		String jtzz = DealString.toGBK(request.getParameter("JTZZ").toString());
		// String dkze = DealString.toGBK(request.getParameter("DKZE")
		// .toString());
		// String xfdks = DealString.toGBK(request.getParameter("XFDKS")
		// .toString());
		// String shfdks = DealString.toGBK(request.getParameter("SHFDKS")
		// .toString());
		// String zsfdks = DealString.toGBK(request.getParameter("ZSFDKS")
		// .toString());
		String yzbm = DealString.toGBK(request.getParameter("YZBM").toString());
		String fqxm = DealString.toGBK(request.getParameter("FQXM").toString());
		String fqgzdw = DealString.toGBK(request.getParameter("FQZY")
				.toString());
		String mqxm = DealString.toGBK(request.getParameter("MQXM").toString());
		String mqgzdw = DealString.toGBK(request.getParameter("MQZY")
				.toString());
		String jtrjsr = DealString.toGBK(request.getParameter("JTRJSR"));
		String sql = "select v.rxny,v.ksh,v.bjmc,q.mzmc,v.sfzh "
			+ "from view_zxdk_xsjbxx v,view_stu_details q,xtszb x "
			+ "where v.xh = q.xh and v.xh=?";
		String[] colName = new String[] { "rxny", "ksh", "bjmc", "mzmc", "sfzh" };
		String[] outVal = dao.getOneRs(sql, new String[] { xh }, colName);
		String rxny = "";
		String ksh = "";
		String mzmc = "";
		String sfzh = "";
		if (outVal != null) {
			rxny = outVal[0];
			ksh = outVal[1];
			mzmc = outVal[3];
			sfzh = outVal[4];
		}

		sql = "select ksh,xh,xm,xb,sfzh,mzmc,xymc,xmc,rxny,byny,dkze,xfdks,"
			+ "shfdks,zsfdks,yhdkje,hth1,ht1_jbjrjg,ht1_fzjgmc,ht1_pzrq,"
			+ "ht1_zje,ht1_jby,ht1_pzhz,ht1_hkksrq,ht1_hkjzrq,ht1_zqly,"
			+ "ht1_zqsj,ht1_dkfs,ht1_hkfs,ht1_hkjzmc,ht1_hkjzzh,ht1_tqyhbxje,"
			+ "ht1_tqjzsj,ht1_tqbz,jtzz,yzbm,fqxm,fqgzdw,fqlxdh,mqxm,mqgzdw,"
			+ "mqlxdh,scbyqx,yxlxfs,dqgzdw,dqgzdwdz,dqgzdwyb,dqgzdwdh,hth2,"
			+ "ht2_jbjrjg,ht2_fzjgmc,ht2_pzrq,ht2_zje,ht2_jby,ht2_pzhz,"
			+ "ht2_hkksrq,ht2_hkjzrq,ht2_zqly,ht2_zqsj,ht2_dkfs,ht2_hkfs,"
			+ "ht2_hkjzmc,ht2_hkjzzh,ht2_tqyhbxje,ht2_tqjzsj,ht2_tqbz,hth3,"
			+ "ht3_jbjrjg,ht3_fzjgmc,ht3_pzrq,ht3_zje,ht3_jby,ht3_pzhz,"
			+ "ht3_hkksrq,ht3_hkjzrq,ht3_zqly,ht3_zqsj,ht3_dkfs,ht3_hkfs,"
			+ "ht3_hkjzmc,ht3_hkjzzh,ht3_tqyhbxje,ht3_tqjzsj,ht3_tqbz,hth4,"
			+ "ht4_jbjrjg,ht4_fzjgmc,ht4_pzrq,ht4_zje,ht4_jby,ht4_pzhz,"
			+ "ht4_hkksrq,ht4_hkjzrq,ht4_zqly,ht4_zqsj,ht4_dkfs,ht4_hkfs,"
			+ "ht4_hkjzmc,ht4_hkjzzh,ht4_tqyhbxje,ht4_tqjzsj,ht4_tqbz,bz,"
			+ "xslx,xxmc,nd,sqsj,zxdklx,xxshyj,xyshyj,xysh,xxsh,csrq,xz,"
			+ "fqsfzh,mqsfzh,sedh,jtsr,dkqxkssj,dkqxjssj,(select b.kh from view_stu_details b where a.xh=b.xh) kh from zxdk_xsjbxx a where xh=?";
		colName = new String[] { "ksh", "xh", "xm", "xb", "sfzh", "mzmc",
				"xymc", "xmc", "rxny", "byny", "dkze", "xfdks", "shfdks",
				"zsfdks", "yhdkje", "hth1", "ht1_jbjrjg", "ht1_fzjgmc",
				"ht1_pzrq", "ht1_zje", "ht1_jby", "ht1_pzhz", "ht1_hkksrq",
				"ht1_hkjzrq", "ht1_zqly", "ht1_zqsj", "ht1_dkfs", "ht1_hkfs",
				"ht1_hkjzmc", "ht1_hkjzzh", "ht1_tqyhbxje", "ht1_tqjzsj",
				"ht1_tqbz", "jtzz", "yzbm", "fqxm", "fqgzdw", "fqlxdh", "mqxm",
				"mqgzdw", "mqlxdh", "scbyqx", "yxlxfs", "dqgzdw", "dqgzdwdz",
				"dqgzdwyb", "dqgzdwdh", "hth2", "ht2_jbjrjg", "ht2_fzjgmc",
				"ht2_pzrq", "ht2_zje", "ht2_jby", "ht2_pzhz", "ht2_hkksrq",
				"ht2_hkjzrq", "ht2_zqly", "ht2_zqsj", "ht2_dkfs", "ht2_hkfs",
				"ht2_hkjzmc", "ht2_hkjzzh", "ht2_tqyhbxje", "ht2_tqjzsj",
				"ht2_tqbz", "hth3", "ht3_jbjrjg", "ht3_fzjgmc", "ht3_pzrq",
				"ht3_zje", "ht3_jby", "ht3_pzhz", "ht3_hkksrq", "ht3_hkjzrq",
				"ht3_zqly", "ht3_zqsj", "ht3_dkfs", "ht3_hkfs", "ht3_hkjzmc",
				"ht3_hkjzzh", "ht3_tqyhbxje", "ht3_tqjzsj", "ht3_tqbz", "hth4",
				"ht4_jbjrjg", "ht4_fzjgmc", "ht4_pzrq", "ht4_zje", "ht4_jby",
				"ht4_pzhz", "ht4_hkksrq", "ht4_hkjzrq", "ht4_zqly", "ht4_zqsj",
				"ht4_dkfs", "ht4_hkfs", "ht4_hkjzmc", "ht4_hkjzzh",
				"ht4_tqyhbxje", "ht4_tqjzsj", "ht4_tqbz", "bz", "xslx", "xxmc",
				"nd", "sqsj", "zxdklx", "xxshyj", "xyshyj", "xysh", "xxsh",
				"csrq", "xz", "fqsfzh", "mqsfzh", "sedh", "jtsr", "dkqxkssj",
		"dkqxjssj", "kh" };
		outVal = dao.getOneRs(sql, new String[] { xh }, colName);
		if (outVal == null) {
			colName1 = new String[] { "xh", "ksh", "xm", "xb", "csrq", "xz",
					"xslx", "xxmc", "xymc", "xmc", "sedh", "jtsr", "fqsfzh",
					"mqsfzh", "jtzz", "yzbm", "fqxm", "fqgzdw", "mqxm",
					"mqgzdw", "rxny", "mzmc", "sfzh", "jtrjsr" };
			String[] valueForOut = new String[] { xh, ksh, xm, xb, csrq, xz,
					xl, xxmc, xymc, xmc, ssdh, jtsr, fqsfzh, mqsfzh, jtzz,
					yzbm, fqxm, fqgzdw, mqxm, mqgzdw, rxny, mzmc, sfzh, jtrjsr };
			ok = StandardOperation.insert("zxdk_xsjbxx", colName1, valueForOut,
					request);
			if(ok){
				logMsg = "添加 ZXDK_XSJBXX";
				Base.log(request, logMsg, sUName);
			}
		} else {
			colName1 = new String[] { "ksh", "xm", "xb", "csrq", "xz", "xslx",
					"xxmc", "xymc", "xmc", "sedh", "jtsr", "fqsfzh", "mqsfzh",
					"jtzz", "yzbm", "fqxm", "fqgzdw", "mqxm", "mqgzdw", "rxny",
					"mzmc", "sfzh", "jtrjsr" };
			String[] valueForOut = new String[] { ksh, xm, xb, csrq, xz, xl,
					xxmc, xymc, xmc, ssdh, jtsr, fqsfzh, mqsfzh, jtzz, yzbm,
					fqxm, fqgzdw, mqxm, mqgzdw, rxny, mzmc, sfzh, jtrjsr };
			ok = StandardOperation.update("ZXDK_XSJBXX", colName1, valueForOut,
					"xh", xh, request);
			if(ok){
				logMsg = "修改 ZXDK_XSJBXX";
				Base.log(request, logMsg, sUName);
			}
		}

		if (ok) {
			request.setAttribute("ok", "ok");
		} else {
			request.setAttribute("ok", "no");
		}
		}
		return null;
	}

	//TODO
	//申请表的选择菜单
	@SuppressWarnings("unchecked")
	private ActionForward xzcd(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		// String xxdm = StandardOperation.getXxdm();
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		// String xxmc = ToolClass.getXxmc();
		String xxdm = StandardOperation.getXxdm();
		String sql = "";
		String cdlb = request.getParameter("cdlb");
		String doType = request.getParameter("doType");
		List tempList = null;
		ActionForward myAct;
		String querry = " and 1=1";
		HashMap<String, String> map = new HashMap<String, String>();
		querry += Globals.NotJudgeWhichSchool(xxdm);

		if ("sqcd".equalsIgnoreCase(cdlb)) {
			if ("open".equalsIgnoreCase(doType)) {
				if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
					sql = "select gnmklj,gnmkmc from xszz_gnmkb where xxdm=? and gnmklx='申请' order by xssx";
					tempList = dao.getList(sql, new String[] { xxdm },
							new String[] { "gnmklj", "gnmkmc" });
				} else if (Globals.JudgeWhichSchool(xxdm)) {
					sql = "select a.gnmklj,a.gnmkmc from "
						+ "((select gnmklj,gnmkmc,xssx from xszz_gnmkb where xxdm=? and gnmklx='申请') "
						+ "union all (select gnmklj,gnmkmc,xssx from xszz_gnmkb where "
						+ "xxmc is null and gnmklx='申请' " + querry + ")) a order by xssx";
					tempList = dao.getList(sql, new String[] { xxdm },
							new String[] { "gnmklj", "gnmkmc" });
				} else {
					sql = "select gnmklj,gnmkmc from xszz_gnmkb where xxdm is null and gnmklx='申请' and gnmkmc<>'外设助学金 ' order by xssx";
					tempList = dao.getList(sql, new String[] {}, new String[] {
							"gnmklj", "gnmkmc" });
					String num = dao.getOneRs("select count(*) num from xszz_gnmkb where gnmklj like 'n05_xszz.do?method=wszxj1%'", new String[]{}, "num");
					if (!"0".equalsIgnoreCase(num)) {
						tempList.addAll(dao.getList(
								"select 'n05_xszz.do?method=wszxj1sq&xmdm='||xmdm gnmklj,xmmc gnmkmc from xszz_com_wszxjdmb order by xmdm",
								new String[] {}, new String[] {
										"gnmklj", "gnmkmc" }));
					}
					num = dao.getOneRs("select count(*) num from xszz_gnmkb where gnmklj like 'n05_xszz.do?method=wszxj2%'", new String[]{}, "num");
					if (!"0".equalsIgnoreCase(num)) {
						tempList.addAll(dao.getList(
								"select 'n05_xszz.do?method=wszxj2sq&xmdm='||xmdm gnmklj,xmmc gnmkmc from xszz_com_wszxjdmb order by xmdm",
								new String[] {}, new String[] {
										"gnmklj", "gnmkmc" }));
					}
				}
				request.setAttribute("list", tempList);
				request.setAttribute("rs", map);

				myAct = new ActionForward("/xszz/xzcd_sq.jsp", false);
				return myAct;
			} else if ("query".equalsIgnoreCase(doType)) {
				// userType=stu, pjzq=xn, userOnLine=student,
				// org.apache.struts.action.LOCALE=zh_CN, xxmc=中北大学,
				// userNameReal=程媛, userName=0701014101, userDep=001

				String url = request.getParameter("gnmk");
				if ((url != null) && (!"".equalsIgnoreCase(url))) {
					url = DealString.toGBK(url);
					if ("zbdx_nullForm.do?method=dkqrs".equalsIgnoreCase(url)) {
						String userOnline = session.getAttribute("userOnLine").toString();
						if ("student".equalsIgnoreCase(userOnline)) {
							myAct = new ActionForward("/zbdx_xszz.do?method=getDkqrInfo", false);
							return myAct;
						}
					}

					url = "/" + url;
					myAct = new ActionForward(url, false);
				} else {
					myAct = new ActionForward("/xgxt/xszz_xzcd_open.do?cdlb=sqcd&doType=open",false);
				}
				return myAct;
			}
		} else if ("shcd".equalsIgnoreCase(cdlb)) {
			if ("open".equalsIgnoreCase(doType)) {
				if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
					sql = "select gnmklj,gnmkmc from xszz_gnmkb where xxdm=? and gnmklx='审核' order by xssx";
					tempList = dao.getList(sql, new String[] { xxdm },
							new String[] { "gnmklj", "gnmkmc" });
				} else if (Globals.JudgeWhichSchool(xxdm)) {
					if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY)){
						String userType = session.getAttribute(
								"userType").toString();
						String userName = session.getAttribute(
								"userName").toString();
						ArrayList<String> userBj = new ArrayList<String>();
						userBj = dao.getUserBj(userName);
						if (userType.equalsIgnoreCase("xy") && userBj.size() != 0){
							sql = "select a.gnmklj,a.gnmkmc from "
								+ "(select gnmklj,gnmkmc,xssx from xszz_gnmkb where xxdm=? and gnmklx='审核' and gnmkmc in ('困难生','学费缓缴','国家助学贷款')"
								+ ") a order by xssx";
						} else {
							sql = "select a.gnmklj,a.gnmkmc from "
								+ "((select gnmklj,gnmkmc,xssx from xszz_gnmkb where xxdm=? and gnmklx='审核') "
								+ "union all (select gnmklj,gnmkmc,xssx from xszz_gnmkb where "
								+ "xxdm is null and gnmklx='审核' " + querry
								+ ")) a order by xssx";
						}
					} else {
						sql = "select a.gnmklj,a.gnmkmc from "
								+ "((select gnmklj,gnmkmc,xssx from xszz_gnmkb where xxdm=? and gnmklx='审核') "
								+ "union all (select gnmklj,gnmkmc,xssx from xszz_gnmkb where "
								+ "xxdm is null and gnmklx='审核' " + querry
								+ ")) a order by xssx";
					}
					tempList = dao.getList(sql, new String[] { xxdm },
							new String[] { "gnmklj", "gnmkmc" });
				} else {
					sql = "select gnmklj,gnmkmc from xszz_gnmkb where xxdm is null and gnmklx='审核' and gnmkmc<>'外设助学金 ' order by xssx";
					tempList = dao.getList(sql, new String[] {}, new String[] {
							"gnmklj", "gnmkmc" });
					String num = dao.getOneRs("select count(*) num from xszz_gnmkb where gnmklj like 'n05_xszz.do?method=wszxj1%'", new String[]{}, "num");
					if (!"0".equalsIgnoreCase(num)) {
						tempList.addAll(dao.getList(
								"select 'n05_xszz.do?method=wszxj1sh&xmdm='||xmdm gnmklj,xmmc gnmkmc from xszz_com_wszxjdmb order by xmdm",
								new String[] {}, new String[] {
										"gnmklj", "gnmkmc" }));
					}
					num = dao.getOneRs("select count(*) num from xszz_gnmkb where gnmklj like 'n05_xszz.do?method=wszxj2%'", new String[]{}, "num");
					if (!"0".equalsIgnoreCase(num)) {
						tempList.addAll(dao.getList(
								"select 'n05_xszz.do?method=wszxj2sh&xmdm='||xmdm gnmklj,xmmc gnmkmc from xszz_com_wszxjdmb order by xmdm",
								new String[] {}, new String[] {
										"gnmklj", "gnmkmc" }));
					}
				}
				request.setAttribute("list", tempList);
				request.setAttribute("rs", map);

				myAct = new ActionForward("/xszz/xzcd_sh.jsp", false);
				return myAct;
			} else if ("query".equalsIgnoreCase(doType)) {
				String url = request.getParameter("gnmk");
				if ((url != null) && (!"".equalsIgnoreCase(url))) {
					url = DealString.toGBK(url);
					url = "/" + url;
					myAct = new ActionForward(url, false);
				} else {
					myAct = new ActionForward(
							"/xgxt/xszz_xzcd_open.do?cdlb="+cdlb+"&doType=open",
							false);
				}
				return myAct;
			}
		} else if ("ffje".equalsIgnoreCase(cdlb)) {
			if ("open".equalsIgnoreCase(doType)) {
				if (Globals.JudgeWhichSchool(xxdm)) {
					sql = "select a.gnmklj,a.gnmkmc from "
						+ "((select gnmklj,gnmkmc,xssx from xszz_gnmkb where xxdm=? and gnmklx='发放金额') "
						+ "union all (select gnmklj,gnmkmc,xssx from xszz_gnmkb where "
						+ "xxdm is null and gnmklx='发放金额' " + querry + ")) a order by xssx";
					tempList = dao.getList(sql, new String[] { xxdm },
							new String[] { "gnmklj", "gnmkmc" });
				} else {
					sql = "select gnmklj,gnmkmc from xszz_gnmkb where xxdm is null and gnmklx='发放金额' order by xssx";
					tempList = dao.getList(sql, new String[] {}, new String[] {
							"gnmklj", "gnmkmc" });
				}
				request.setAttribute("list", tempList);
				request.setAttribute("rs", map);

				myAct = new ActionForward("/xszz/xzcd_je.jsp", false);
				return myAct;
			} else if ("query".equalsIgnoreCase(doType)) {
				String url = request.getParameter("gnmk");
				if ((url != null) && (!"".equalsIgnoreCase(url))) {
					url = DealString.toGBK(url);
					url = "/" + url;
					myAct = new ActionForward(url, false);
				} else {
					myAct = new ActionForward(
							"/xgxt/xszz_xzcd_open.do?cdlb="+cdlb+"&doType=open",
							false);
				}
				return myAct;
			}
		}
		return mapping.findForward("success");
	}

	private ActionForward zxdk_fkxx(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		XszzForm xszzForm = (XszzForm) form;

		DAO dao = DAO.getInstance();
		String xxmc = ToolClass.getXxmc();
		String doType = request.getParameter("doType");// 操作类型
		String sUName;
		HttpSession session = request.getSession();
		sUName = session.getAttribute("userName").toString();

		String sql = "";
		String hth = "";
		String logMsg;
		String[] outString = new String[] {};
		sql = "select * from zxdk_fkxx where 1=2";
		outString = dao.getColumnName(sql);
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
//		String[] colName1 = null;
		String xh = "";
		String sxh = "";
		boolean ok = false;
		String doType2 = request.getParameter("doType2");
		sxh = request.getParameter("pk");
		if (doType2 == null) {
			doType2 = "";
		}
		if (sxh == null) {
			sxh = "";
		}
		request.setAttribute("doType2", doType2);
		request.setAttribute("pk", sxh);
		xh = xszzForm.getXh();
		hth = DealString.toGBK(xszzForm.getHth());

		String tempSql = "select ydlb from XSYDLB where xh=?";
		String xszt = "";
		String[] xsztl = dao.getOneRs(tempSql, new String[] { xh },
				new String[] { "ydlb" });
		if ((xsztl == null) || ("复学".equalsIgnoreCase(xsztl[0]))) {
			tempSql = "select ydlb from bks_stu_info_xjydb where xh=?";
			xsztl = dao.getOneRs(tempSql, new String[] { xh },
					new String[] { "ydlb" });
			if (xsztl == null) {
				xszt = "在读";
			} else {
				xszt = xsztl[0];
			}
		} else {
			xszt = xsztl[0];
		}
		if ("del".equalsIgnoreCase(doType2)) {
			sql = "select replace(NVL(fkje,'0'),' ','0') fkje,xh from zxdk_fkxx where sxh=?";
			String[] temp = dao.getOneRs(sql, new String[] { sxh },
					new String[] { "fkje", "xh" });
			sql = "select replace(NVL(yhdkje,'0'),' ','0') yhdkje from zxdk_xsjbxx where xh=?";
			String tempYhje = dao.getOneRs(sql, new String[] { temp[1] },
			"yhdkje");
			tempYhje = String.valueOf(Integer.parseInt(tempYhje)
					- Integer.parseInt(temp[0]));
			ok = StandardOperation.update("zxdk_xsjbxx",
					new String[] { "yhdkje" }, new String[] { tempYhje }, "xh",
					temp[1], request);
			if(ok){
				logMsg = "修改 zxdk_xsjbxx";
				Base.log(request, logMsg, sUName);
			}

			ok = StandardOperation.delete("zxdk_fkxx", "sxh", sxh, request);
			if(ok){
				logMsg = "删除 zxdk_fkxx";
				Base.log(request, logMsg, sUName);
			}

			ActionForward newFwd = new ActionForward(
					"/data_search.do?go=go&act=fkxx", false);
			return newFwd;
		}

		if (doType != null && doType.equalsIgnoreCase("save")) {
			xh = DealString.toGBK(request.getParameter("xh").toString());
			String xm = DealString.toGBK(request.getParameter("xm").toString());
			String sfzh = DealString.toGBK(request.getParameter("sfzh")
					.toString());
			String htje = DealString.toGBK(request.getParameter("htje")
					.toString());
			String dkyh = DealString.toGBK(request.getParameter("dkyh")
					.toString());
			String htqx = DealString.toGBK(request.getParameter("htqx")
					.toString());
			String fkrq = DealString.toGBK(request.getParameter("fkrq")
					.toString());
			String fkje = DealString.toGBK(request.getParameter("fkje")
					.toString());
			String dkll = DealString.toGBK(request.getParameter("dkll")
					.toString());
			String bz = DealString.toGBK(request.getParameter("bz").toString());

			String tempzje = "0";
			if ((hth != null) || "".equalsIgnoreCase(hth)) {
				sql = "select sum(replace(NVL(YHDKJE,'0'),' ','0')) zje from zxdk_xsjbxx where xh=?";
				tempzje = dao.getOneRs(sql, new String[] { xh }, "zje");
				if (tempzje == null) {
					tempzje = "0";
				}
			}

			if ((fkje == null) || ("".equalsIgnoreCase(fkje))
					|| (" ".equalsIgnoreCase(fkje))) {
				fkje = "0";
			}
			tempzje = String.valueOf((Integer.parseInt(fkje) + Integer
					.parseInt(tempzje)));

			if ("modi".equalsIgnoreCase(doType2)) {
				sql = "select fkje from zxdk_fkxx where sxh=?";
				String tempJe = dao.getOneRs(sql, new String[] { sxh }, "fkje");
				sql = "select replace(NVL(yhdkje,'0'),' ','0') yhdkje from zxdk_xsjbxx where xh=?";
				String tempYhje = dao.getOneRs(sql, new String[] { xh },
				"yhdkje");

				if ((tempYhje != null) && (tempJe != null) && (fkje != null)) {
					tempYhje = String
					.valueOf(Integer.parseInt(tempYhje)
							- Integer.parseInt(tempJe)
							+ Integer.parseInt(fkje));
				}
				StandardOperation.update("zxdk_xsjbxx",
						new String[] { "yhdkje" }, new String[] { tempYhje },
						"xh", xh, request);

				String[] valueForOut = new String[] { xxmc, dkyh, xh, xm, sfzh,
						hth, htje, fkrq, htqx, fkje, nd, dkll, bz };
				ok = StandardOperation.update("zxdk_fkxx", new String[] {
						"xxmc", "dkyh", "xh", "xm", "sfzh", "hth", "htje",
						"fkrq", "htqx", "fkje", "nd", "dkll", "bz" },
						valueForOut, "sxh", sxh, request);
			} else {
				StandardOperation.update("zxdk_xsjbxx",
						new String[] { "yhdkje" }, new String[] { tempzje },
						"xh", xh, request);

				sql = "insert into zxdk_fkxx (sxh,xxmc,dkyh,xh,xm,sfzh,hth,htje,fkrq,htqx,fkje,nd,dkll,bz) "
					+ "values(SEQ_ZXDK_FKXX.NEXTVAL,?,?,?,?,?,?,?,?,?,?,?,?,?)";
				String[] valueForOut = new String[] { xxmc, dkyh, xh, xm, sfzh,
						hth, htje, fkrq, htqx, fkje, nd, dkll, bz };
				ok = dao.runUpdate(sql,valueForOut);
			}

			if (ok) {
				logMsg = "修改 zxdk_xsjbxx,zxdk_fkxx";
				Base.log(request, logMsg, sUName);
				request.setAttribute("ok", "ok");
			} else {
				request.setAttribute("ok", "no");
			}
		}

		outString = new String[] { "sxh", "xxmc", "dkyh", "xh", "xm", "sfzh",
				"hth", "htje", "fkrq", "htqx", "fkje", "ljfkje", "nd", "dkll",
				"bz", "xszt", "kh" };

		if ((sxh == null) || ("".equalsIgnoreCase(sxh))) {
			sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
				+ "from (select f.sxh, f.xxmc, f.dkyh, f.xh, f.xm, f.sfzh, f.hth,"
				+ "f.htje, f.fkrq, f.htqx, f.fkje, a.ljfkje, f.nd, f.dkll, f.bz,b.xszt from zxdk_fkxx f,"
				+ "(select '"
				+ xszt
				+ "' xszt from dual) b,"
				+ "(select max(replace(NVL(ljfkje,'0'),' ','0')) ljfkje,sxh from zxdk_fkxx "
				+ "where hth=? and xh=? group by sxh) a where a.sxh=f.sxh) a ";
			outValue = dao.getOneRs(sql, new String[] { hth, xh }, outString);
		} else {
			sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
				+ "from (select f.sxh, f.xxmc, f.dkyh, f.xh, f.xm, f.sfzh, f.hth,"
				+ "f.htje, f.fkrq, f.htqx, f.fkje, f.ljfkje, f.nd, f.dkll, f.bz, a.xszt from zxdk_fkxx f,"
				+ "(select '"
				+ xszt
				+ "' xszt from dual) a"
				+ " where f.sxh=?) a ";
			outValue = dao.getOneRs(sql, new String[] { sxh }, outString);
		}

		List hthList = null;
		boolean haveHTH = false;
		sql = "select nvl(sum(FKJE),'0') zfkje from zxdk_fkxx where hth=?";
		String zfkje = dao.getOneRs(sql, new String[] { hth },
				new String[] { "zfkje" })[0];
		map.put("zfkje", zfkje);
		map.put("htje", "0");
		if (outValue == null) {
			if (xh != null) {
				haveHTH = true;

				sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
					+ "from (select v.rxny,v.xh,v.ksh,v.xm,"
					+ "v.xb,v.bjmc,v.xymc,q.MZMC,v.zymc xmc,x.xxmc,v.sfzh,"
					+ "q.csrq csny,v.xz,a.xszt,a.nd from view_zxdk_xsjbxx v,view_stu_details q,"
					+ "xtszb x,(select '"
					+ xszt
					+ "' xszt,'"
					+ nd
					+ "' nd from dual) a where "
					+ "v.xh = q.xh and v.xh=?) a ";
				String[] colName = new String[] { "rxny", "xh", "ksh", "xm",
						"xb", "bjmc", "xymc", "mzmc", "xmc", "xxmc", "sfzh",
						"csny", "xz", "xszt", "nd", "kh" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {
				} else {
					colName = new String[] { "rxny", "xh", "ksh", "xm", "xb",
							"bjmc", "xymc", "mzmc", "xmc", "xxmc", "sfzh",
							"csny", "xz", "xszt", "nd", "kh" };
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
				}

				if ((hth != null) && !"".equalsIgnoreCase(hth)) {
					sql = "select hth,htzje htje,httqjzsj htqx,dkll,htjbjrjg dkyh from zxdk_htxx where hth=?";
					colName = new String[] { "hth", "htje", "htqx", "dkll",
					"dkyh" };
					outVal = dao.getOneRs(sql, new String[] { hth }, colName);
					if (outVal != null) {
						colName = new String[] { "hth", "htje", "htqx", "dkll",
						"dkyh" };
						for (int i = 0; i < colName.length; i++) {
							if (outVal[i] != null) {
								map.put(colName[i], outVal[i]);
							} else {
								map.put(colName[i], "");
							}
						}
					}
				} else {
					sql = "select hth from zxdk_htxx where xh=?";
					hthList = dao.getList(sql, new String[] { xh },
							new String[] { "hth" });
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		if ((hthList == null) && (outValue == null)) {
			sql = "select hth from zxdk_htxx";
			hthList = dao.getList(sql, new String[] {}, new String[] { "hth" });
		}
		request.setAttribute("hth", hthList);
		if (haveHTH) {
			request.setAttribute("haveHTH", "have");
		} else {
			request.setAttribute("haveHTH", "null");
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward fsbz_zdff(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		String userDep = session.getAttribute("userDep").toString();
		String userType = dao.getUserType(userDep);
		
		String doType = Base.chgNull(request.getParameter("doType"), "", 1);
		HashMap<String, String> rs = new HashMap<String, String>();
		String xydm = Base.chgNull(request.getParameter("xydm"), "", 1);
		if (userType.equalsIgnoreCase("xy")
				&& (xydm == null || xydm.trim().equals(""))) {
			xydm = userDep;
		}
		String bzffny = Base.chgNull(request.getParameter("bzffny"), "", 1);
		String byyfbz = Base.chgNull(request.getParameter("byyfbz"), "", 1);
		String bybfbz = Base.chgNull(request.getParameter("bybfbz"), "", 1);
		String bysfbz = Base.chgNull(request.getParameter("bysfbz"), "", 1);
		String sql = "";
		if (null != xydm && !"".equalsIgnoreCase(xydm)){
			sql = " and xydm='"+xydm+"'";
		}
		
		if ("save".equalsIgnoreCase(doType)){
			boolean b = false;
			b = dao.runUpdate("insert into fsbzb(xh,xm,xymc,bjmc,kh,byyfbz,bybfbz,bysfbz,bzffny,xxsh) (select xh,xm,xymc,bjmc,kh,?,?,?,?,'已通过' from view_stu_details a where not exists (select 1 from view_xjydjbxx x where x.YDHXJZTM in ('保留学籍', '离校') and x.ydxh=(select max(y.ydxh) from view_xjydjbxx y where y.ydrq=(select max(z.ydrq) from view_xjydjbxx z where substr(z.ydrq,1,7)=?) and y.xh=a.xh))"+sql+")", new String[]{byyfbz,bybfbz,bysfbz,bzffny,bzffny});
			if (b){
				request.setAttribute("over", "ok");
			} else {
				request.setAttribute("over", "no");
			}
		}
		rs.put("xydm", xydm);
		rs.put("bzffny", bzffny);
		rs.put("byyfbz", byyfbz);
		rs.put("bybfbz", bybfbz);
		rs.put("bysfbz", bysfbz);
		request.setAttribute("xyList", Base.getXyList());// 发送学院列表
		request.setAttribute("userType", userType);
		request.setAttribute("rs", rs);
		return mapping.findForward("success");
	}
	
	private ActionForward lsbz_zdff(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		String userDep = session.getAttribute("userDep").toString();
		String userType = dao.getUserType(userDep);
		
		String doType = Base.chgNull(request.getParameter("doType"), "", 1);
		HashMap<String, String> rs = new HashMap<String, String>();
		String xydm = Base.chgNull(request.getParameter("xydm"), "", 1);
		if (userType.equalsIgnoreCase("xy")
				&& (xydm == null || xydm.trim().equals(""))) {
			xydm = userDep;
		}
		String bzffny = Base.chgNull(request.getParameter("bzffny"), "", 1);
		String lsbzmc = Base.chgNull(request.getParameter("lsbzmc"), "", 1);
		String byyfbz = Base.chgNull(request.getParameter("byyfbz"), "", 1);
		String bybfbz = Base.chgNull(request.getParameter("bybfbz"), "", 1);
		String bysfbz = Base.chgNull(request.getParameter("bysfbz"), "", 1);
		String sql = "";
		if (null != xydm && !"".equalsIgnoreCase(xydm)){
			sql = " and xydm='"+xydm+"'";
		}
		
		if ("save".equalsIgnoreCase(doType)){
			boolean b = false;
			b = dao.runUpdate("insert into lsbzb(xh,xm,xymc,bjmc,kh,lsbzmc,byyfbz,bybfbz,bysfbz,bzffny,xxsh) (select xh,xm,xymc,bjmc,kh,?,?,?,?,?,'已通过' from view_stu_details a where not exists (select 1 from view_xjydjbxx x where x.YDHXJZTM in ('保留学籍', '离校') and x.ydxh=(select max(y.ydxh) from view_xjydjbxx y where y.ydrq=(select max(z.ydrq) from view_xjydjbxx z where substr(z.ydrq,1,7)=?) and y.xh=a.xh))"+sql+")", new String[]{lsbzmc,byyfbz,bybfbz,bysfbz,bzffny,bzffny});
			if (b){
				request.setAttribute("over", "ok");
			} else {
				request.setAttribute("over", "no");
			}
		}
		rs.put("xydm", xydm);
		rs.put("lsbzmc", lsbzmc);
		rs.put("bzffny", bzffny);
		rs.put("byyfbz", byyfbz);
		rs.put("bybfbz", bybfbz);
		rs.put("bysfbz", bysfbz);
		request.setAttribute("xyList", Base.getXyList());// 发送学院列表
		request.setAttribute("userType", userType);
		request.setAttribute("rs", rs);
		return mapping.findForward("success");
	}
	
	private ActionForward fsbz(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {

		String userType;

		String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		XszzDao xszzDao = new XszzDao();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		userType = dao.getUserType(userDep);
		String jlsj = dao
		.getOneRs(
				"select to_char(sysdate,'yyyy-mm-dd') jlsj from dual where rownum=1",
				new String[] {}, "jlsj");
		String doType = request.getParameter("doType");// 操作类型

		String sql = "";
		String[] outString = new String[] {};
		sql = "select * from fsbzb where 1=2";
		outString = dao.getColumnName(sql);
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String xh = "";
		String doType2 = request.getParameter("doType2");
		String pk = request.getParameter("pk");
		String dxq = request.getParameter("dxq");
		if (userType.equalsIgnoreCase("xx")) {
			request.setAttribute("isXX", "is");
		} else {
			request.setAttribute("isXX", "no");
		}

		if (doType2 == null) {
			doType2 = "";
		}
		if (pk == null) {
			pk = "";
		}
		request.setAttribute("doType2", doType2);
		request.setAttribute("pk", pk);
		xh = xszzForm.getXh();
		boolean ok = false;

		if ("pass".equalsIgnoreCase(doType)) {
			String sbbm = request.getParameter("sbbm");
			String[] sbbmJ = sbbm.split("!!#!!");
			String[] sqlT = new String[sbbmJ.length];
			for (int i = 1; i < sbbmJ.length; i++) {
				String bm = sbbmJ[i];
				sqlT[i] = "update fsbzb set xxsh='已通过' where xh||BZFFNY='"+bm+"'";
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/data_search.do?go=go&act=fsbz&writeAble=" + dxq, false);
			return newFwd;
		}
		if ("notpass".equalsIgnoreCase(doType)) {
			String sbbm = request.getParameter("sbbm");
			String[] sbbmJ = sbbm.split("!!#!!");
			String[] sqlT = new String[sbbmJ.length];
			for (int i = 1; i < sbbmJ.length; i++) {
				String bm = sbbmJ[i];
				sqlT[i] = "update fsbzb set xxsh='不通过' where xh||BZFFNY='"+bm+"'";
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/data_search.do?go=go&act=fsbz&writeAble=" + dxq, false);
			return newFwd;
		}
		if ("del".equalsIgnoreCase(doType)) {
			String sbbm = request.getParameter("sbbm");
			String[] sbbmJ = sbbm.split("!!#!!");
			String[] sqlT = new String[sbbmJ.length];
			for (int i = 1; i < sbbmJ.length; i++) {
				String bm = sbbmJ[i];
				sql = "select xxsh from fsbzb where xh||BZFFNY=?";
				String[] temp = dao.getOneRs(sql, new String[] { bm },
						new String[] { "xxsh" });
				if ((temp != null)
						&& ((temp[0].equalsIgnoreCase("已通过")))) {
					request.setAttribute("isSh", "is");
				} else {
					sqlT[i] = "delete fsbzb where xh||BZFFNY='"+bm+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/data_search.do?go=go&act=fsbz&writeAble=" + dxq, false);
			return newFwd;
		}

		if (doType != null && doType.equalsIgnoreCase("save")) {
			xh = DealString.toGBK(request.getParameter("xh").toString());
			String xm = DealString.toGBK(request.getParameter("xm").toString());
			String xymc = DealString.toGBK(request.getParameter("xymc")
					.toString());
			String bjmc = DealString.toGBK(request.getParameter("bjmc")
					.toString());
			String kh = DealString.toGBK(request.getParameter("kh").toString());
			String byyfbz = DealString.toGBK(request.getParameter("byyfbz")
					.toString());
			String bybfbz = DealString.toGBK(request.getParameter("bybfbz")
					.toString());
			String bysfbz = DealString.toGBK(request.getParameter("bysfbz")
					.toString());
			String bzffny = DealString.toGBK(request.getParameter("bzffny")
					.toString());
			String xjzt = DealString.toGBK(request.getParameter("xjzt")
					.toString());
			String xxsh = Base.chgNull(request.getParameter("xxsh"), "未审核", 1);
			String xxshyj = Base.chgNull(request.getParameter("xxshyj"), "", 1);

			sql = "select xxsh from fsbzb where xh=? and BZFFNY=?";
			String[] temp = dao.getOneRs(sql, new String[] { xh, bzffny },
					new String[] { "xxsh" });
			if ((temp != null) && (temp[0].equalsIgnoreCase("已通过"))
					&& ("已通过".equalsIgnoreCase(xxsh))) {
				request.setAttribute("ok", "isSH");
			} else {
				ok = StandardOperation.delete("fsbzb", "xh||bzffny", xh
						+ bzffny, request);

				String[] colName1 = new String[] { "xh", "xm", "xymc", "bjmc",
						"kh", "byyfbz", "bybfbz", "bysfbz", "bzffny", "xjzt", "xxsh",
						"xxshyj" };
				String[] valueForOut = new String[] { xh, xm, xymc, bjmc, kh,
						byyfbz, bybfbz, bysfbz, bzffny, xjzt, xxsh, xxshyj };
				ok = StandardOperation.insert("fsbzb", colName1, valueForOut,
						request);

				if (ok) {
					logMsg = "添加 fsbzb";
					Base.log(request, logMsg, sUName);
					request.setAttribute("ok", "ok");
				} else {
					request.setAttribute("ok", "no");
				}
			}
		}

		outString = new String[] { "xh", "xm", "xymc", "bjmc", "kh", "byyfbz",
				"bybfbz", "bysfbz", "bzffny", "xjzt", "jlsj", "xxsh", "xxshyj" };

		sql = "select xh,xm,xymc,bjmc,kh,byyfbz,bybfbz,bysfbz,bzffny,xjzt,jlsj,xxsh,xxshyj "
			+ "from view_fsbzb where xh||bzffny=?";
		outValue = dao.getOneRs(sql, new String[] { pk }, outString);

		if (outValue == null) {
			if (xh != null) {
				sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
					+ "from (select (select a.rxny from bks_xsjbxx a where a.xh=q.xh) rxny,q.xh,q.xm,"
					+ "q.xb,q.bjmc,q.xymc,q.MZMC,"
					+ "q.zymc xmc,x.xxmc,q.sfzh,"
					+ "q.csrq csny,q.xz,j.jlsj,j.byyfbz,j.bybfbz,j.bysfbz,j.xxsh "
					+ "from view_stu_details q,"
					+ "(select '"
					+ jlsj
					+ "' jlsj,'0' byyfbz,'0' bybfbz,'0' bysfbz,'未审核' xxsh from dual) j,"
					+ "xtszb x where q.xh=?) a ";
				String[] colName = new String[] { "rxny", "xh", "xm",
						"xb", "bjmc", "xymc", "mzmc", "xmc", "xxmc", "sfzh",
						"csny", "xz", "jlsj", "byyfbz", "bybfbz", "bysfbz",
						"xxsh", "kh" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {
				} else {
					colName = new String[] { "rxny", "xh", "xm", "xb",
							"bjmc", "xymc", "mzmc", "xmc", "xxmc", "sfzh",
							"csny", "xz", "jlsj", "byyfbz", "bybfbz", "bysfbz",
							"xxsh", "kh" };
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
					map.put("xjzt", xszzDao.getBjlhXjztByBzffny(dao.getOneRs(
							"select to_char(sysdate,'yyyy-mm') now from dual",
							new String[] {}, "now"), xh));
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward StuTempSubsidy(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) {

		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		XszzForm xszzform = (XszzForm) form;
		String userSpecType = session.getAttribute("userType").toString();
		String userDep = session.getAttribute("userDep").toString();
		String tips = "学生资助 - 学生补助 - 临时补助";
		String tableName = "view_lsbzxx";
		String realTable = "lsbzb";
		String pk = "xh||bzffny";
		String xydm = request.getParameter("xydm");
		String zydm = request.getParameter("zydm");
		String bjdm = request.getParameter("bjdm");
		String nj = request.getParameter("nj");
		String bzffny = request.getParameter("bzffny");
		String kh = request.getParameter("kh");
		String xxsh = DealString.toGBK(request.getParameter("xxsh"));
		String lsbzdm = DealString.toGBK(request.getParameter("lsbzdm"));
		String xh = request.getParameter("xh");
		StringBuffer querry = new StringBuffer();
		Vector<Object> rs = new Vector<Object>();
		String[] colList = { "bgcolor", "主键", "行号", "xh", "xm", "bjmc",
				"lsbzmc", "lsbzje", "byyfbz", "bybfbz", "bysfbz",
				"bzffny", "xjzt", "xxsh" };
		String[] colListCN = null;
		String rsNum = "";
		String sql = "";
		querry.append(" where 1=1 ");

		String userType = dao.getUserType(userDep);
		if (userType.equalsIgnoreCase("xx")) {
			request.setAttribute("isXX", "is");
		} else {
			request.setAttribute("isXX", "no");
		}

		if (userSpecType.equalsIgnoreCase("xy")) {
			xydm = userDep;
			xszzform.setXydm(xydm);
		}

		if ("".equalsIgnoreCase(xydm) || xydm == null) {
		} else {
			querry.append("and xydm='");
			querry.append(xydm);
			querry.append("' ");
		}
		
		if ("".equalsIgnoreCase(xxsh) || xxsh == null) {
		} else {
			querry.append("and xxsh='");
			querry.append(xxsh);
			querry.append("' ");
		}
		
		if ("".equalsIgnoreCase(kh) || kh == null) {
		} else {
			querry.append("and kh='");
			querry.append(kh);
			querry.append("' ");
		}
		
		if ("".equalsIgnoreCase(nj) || nj == null) {
		} else {
			querry.append("and nj='");
			querry.append(nj);
			querry.append("' ");
		}
		
		if ("".equalsIgnoreCase(lsbzdm) || lsbzdm == null) {
		} else {
			querry.append("and lsbzdm='");
			querry.append(lsbzdm);
			querry.append("' ");
		}
		
		if ("".equalsIgnoreCase(bzffny) || bzffny == null) {
		} else {
			querry.append("and bzffny='");
			querry.append(bzffny);
			querry.append("' ");
		}

		if ("".equalsIgnoreCase(zydm) || zydm == null) {
		} else {
			querry.append("and zydm='");
			querry.append(zydm);
			querry.append("' ");
		}

		if ("".equalsIgnoreCase(bjdm) || bjdm == null) {
		} else {
			querry.append("and bjdm='");
			querry.append(bjdm);
			querry.append("' ");
		}

		if ("".equalsIgnoreCase(xh) || xh == null) {
		} else {
			if (Check_Input_Value.check2(xh)) {
				querry.append("and xh like '%");
				querry.append(xh);
				querry.append("%'");
			}
		}

		sql = "select (case nvl(a.xxsh,'未审核') when '已通过' then '#99CCFF' "
			+ "when '未审核' then '#FFFFFF' else '#FF9999' end) bgcolor,"
			+ "a.* from (select "
			+ pk
			+ " 主键,rownum 行号,xh,xm,bjmc,lsbzmc,lsbzje,byyfbz,bybfbz,bysfbz,bzffny,xjzt,xxsh from "
			+ tableName + querry.toString() + ") a";

		colListCN = dao.getColumnNameCN(colList, tableName);
		List topTr = dao.arrayToList(colList, colListCN);
		if ((request.getParameter("go") != null)
				&& request.getParameter("go").equalsIgnoreCase("go")) {
			rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
		}

		bzffny = bzffny == null ? "" : bzffny;
		HashMap<String, String> rs1 = new HashMap<String, String>();
		rs1.put("bzffny", bzffny);
		rs1.put("xxsh", xxsh);
		rs1.put("kh", kh);
		rs1.put("xh", xh);
		rs1.put("nj", nj);
		rs1.put("xxsh", xxsh);
		rs1.put("bjdm", bjdm);
		rs1.put("zydm", zydm);
		rs1.put("xydm", xydm);
		rs1.put("lsbzdm", lsbzdm);
		request.setAttribute("rs1", rs1);
		nj = nj==null ? "":nj;
		xydm = xydm==null ? "":xydm;
		zydm = zydm==null ? "":zydm;
		String bjKey = xydm+"!!"+zydm+"!!"+nj;
		request.setAttribute("act", " ");
		request.setAttribute("pk", pk);
		request.setAttribute("tips", tips);
		request.setAttribute("realTable", realTable);
		request.setAttribute("tableName", tableName);
		sql = "select '未审核' xxsh from dual union select '已通过' xxsh from dual union select '不通过' xxsh from dual ";
		List xxshList = dao.getList(sql, new String[] {}, new String[] {
				"xxsh" });
		request.setAttribute("lsbzList", dao.getList("select lsknbzdm lsbzdm,lsknbzmc lsbzmc from lsknbzdmb order by lsknbzdm", new String[]{}, new String[]{"lsbzdm","lsbzmc"}));
		request.setAttribute("xxshList", xxshList);
		request.setAttribute("njList", Base.getNjList());
		request.setAttribute("xyList", Base.getXyList());// 发送学院列表
		request.setAttribute("zyList", Base.getZyMap().get(xydm));// 发送专业列表
		request.setAttribute("bjList", Base.getBjMap().get(bjKey));// 发送班级列表
		request.setAttribute("topTr", topTr);
		request.setAttribute("rsNum", rsNum);
		request.setAttribute("rs", rs);
		request.setAttribute("userType", userSpecType);
		return mapping.findForward("success");
	}

	private ActionForward StuLsbzInfo(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		String userType;

		String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		XszzDao xszzDao = new XszzDao();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String doType = request.getParameter("doType");// 操作类型
		String pkValue = request.getParameter("pkValue");
		userType = dao.getUserType(userDep);

		String sql = "";
		String[] outString = new String[] {};
		sql = "select * from lsbzb where 1=2";
		outString = dao.getColumnName(sql);
		String[] outValue = null;
		String dxq = request.getParameter("dxq");
		HashMap<String, String> map = new HashMap<String, String>();
		String xh = "";
		String pk = "xh||bzffny";
		if (userType.equalsIgnoreCase("xx")) {
			request.setAttribute("isXX", "is");
		} else {
			request.setAttribute("isXX", "no");
		}
		if (doType == null) {
			doType = "";
		}
		if (pk == null) {
			pk = "";
		}
		request.setAttribute("pkValue", pkValue);
		request.setAttribute("doType", doType);
		xh = xszzForm.getXh();
		boolean ok = false;

		if ("pass".equalsIgnoreCase(doType)) {
			String sbbm = request.getParameter("sbbm");
			String[] sbbmJ = sbbm.split("!!#!!");
			String[] sqlT = new String[sbbmJ.length];
			for (int i = 1; i < sbbmJ.length; i++) {
				String bm = sbbmJ[i];
				sqlT[i] = "update lsbzb set xxsh='已通过' where xh||BZFFNY='"+bm+"'";
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/stu_temp_subsidy.do?go=go&writeAble=" + dxq, false);
			return newFwd;
		}
		if ("notpass".equalsIgnoreCase(doType)) {
			String sbbm = request.getParameter("sbbm");
			String[] sbbmJ = sbbm.split("!!#!!");
			String[] sqlT = new String[sbbmJ.length];
			for (int i = 1; i < sbbmJ.length; i++) {
				String bm = sbbmJ[i];
				sqlT[i] = "update lsbzb set xxsh='不通过' where xh||BZFFNY='"+bm+"'";
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/stu_temp_subsidy.do?go=go&writeAble=" + dxq, false);
			return newFwd;
		}
		if ("del".equalsIgnoreCase(doType)) {
			String sbbm = request.getParameter("sbbm");
			String[] sbbmJ = sbbm.split("!!#!!");
			String[] sqlT = new String[sbbmJ.length];
			for (int i = 1; i < sbbmJ.length; i++) {
				String bm = sbbmJ[i];
				sql = "select xxsh from lsbzb where xh||BZFFNY=?";
				String[] temp = dao.getOneRs(sql, new String[] { bm },
						new String[] { "xxsh" });
				if ((temp != null)
						&& (temp[0].equalsIgnoreCase("已通过"))) {
					request.setAttribute("isSh", "is");
				} else {
					sqlT[i] = "delete lsbzb where xh||BZFFNY='"+bm+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/stu_temp_subsidy.do?go=go&writeAble=" + dxq, false);
			return newFwd;
		}

		if (doType != null && doType.equalsIgnoreCase("save")) {
			xh = DealString.toGBK(request.getParameter("xh").toString());
			String byyfbz = DealString.toGBK(request.getParameter("byyfbz")
					.toString());
			String bybfbz = DealString.toGBK(request.getParameter("bybfbz")
					.toString());
			String lsbzdm = DealString.toGBK(request.getParameter("lsbzdm")
					.toString());
			String kh = DealString.toGBK(request.getParameter("kh")
					.toString());
			String bysfbz = DealString.toGBK(request.getParameter("bysfbz")
					.toString());
			String bzffny = DealString.toGBK(request.getParameter("bzffny")
					.toString());
			String xjzt = DealString.toGBK(request.getParameter("xjzt")
					.toString());
			String xxsh = Base.chgNull(request.getParameter("xxsh"), "未审核", 1);
			String xxshyj = Base.chgNull(request.getParameter("xxshyj"), "", 1);

			sql = "select xxsh from lsbzb where xh=? and BZFFNY=?";
			String[] temp = dao.getOneRs(sql, new String[] { xh, bzffny },
					new String[] { "xxsh" });
			if ((temp != null) && (temp[0].equalsIgnoreCase("已通过"))
					&& ("已通过".equalsIgnoreCase(xxsh))) {
				request.setAttribute("ok", "isSH");
			} else {
				if (Base.isNull(pkValue)) {
					StandardOperation.delete("lsbzb", "xh||bzffny",
							xh + bzffny, request);
				} else {
					StandardOperation.delete("lsbzb", pk, pkValue, request);
				}

				String[] colName1 = new String[] { "xh", "byyfbz", "bybfbz",
						"bysfbz", "bzffny", "xjzt", "xxsh", "xxshyj", "lsbzdm", "kh" };
				String[] valueForOut = new String[] { xh, byyfbz, bybfbz,
						bysfbz, bzffny, xjzt, xxsh, xxshyj, lsbzdm, kh };
				ok = StandardOperation.insert("lsbzb", colName1, valueForOut,
						request);

				if (ok) {
					logMsg = "添加 lsbzb";
					Base.log(request, logMsg, sUName);
					request.setAttribute("ok", "ok");
				} else {
					request.setAttribute("ok", "no");
				}
			}
		}

		outString = new String[] { "xh", "xm", "nj", "xb", "xymc", "zymc",
				"bjmc", "byyfbz", "bybfbz", "bysfbz", "bzffny", "xjzt", "jlsj", "xxsh",
				"xxshyj", "lsbzmc", "lsbzdm", "lsbzje", "kh" };

		sql = "select xh,xm,nj,xb,xymc,zymc,bjmc,byyfbz,bybfbz,bysfbz,bzffny,xjzt,jlsj,xxsh,xxshyj,lsbzmc,lsbzdm,lsbzje,kh from "
			+ "view_lsbzxx where xh||bzffny=?";
		outValue = dao.getOneRs(sql, new String[] { pkValue }, outString);

		if (outValue == null) {
			if (xh != null) {
				sql = "select a.*,'0' byyfbz,'0' bybfbz,'0' bysfbz,to_char(sysdate,'yyyy-mm-dd') jlsj,"
					+ "'未审核' xxsh from view_xsjbxx a where xh=?";
				String[] colName = new String[] { "xh", "xm", "nj", "zymc",
						"xb", "bjmc", "xymc", "byyfbz", "bybfbz", "bysfbz",
						"jlsj", "xxsh" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {
				} else {
					colName = new String[] { "xh", "xm", "nj", "zymc", "xb",
							"bjmc", "xymc", "byyfbz", "bybfbz", "bysfbz",
							"jlsj", "xxsh" };
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
					map.put("xjzt", xszzDao.getBjlhXjztByBzffny(dao.getOneRs(
							"select to_char(sysdate,'yyyy-mm') now from dual",
							new String[] {}, "now"), xh));
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		request.setAttribute("lsbzList", dao.getList("select lsknbzdm lsbzdm,lsknbzmc||'||'||lsknbzje lsbzmc from lsknbzdmb order by lsknbzdm", new String[]{}, new String[]{"lsbzdm","lsbzmc"}));
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward xslxxx(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {// 学生离校信息
		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();
		XszzForm xszzForm = (XszzForm) form;

		// String xxmc = ToolClass.getXxmc();
		String doType = request.getParameter("doType");// 操作类型

		String sql = "";
		String[] outString = new String[] {};
		sql = "select x.xh,x.xm,x.sfzh,x.scbyqx,x.yxlxfs,x.dqgzdw,x.dqgzdwdz,x.dqgzdwyb,"
			+ "x.dqgzdwdh,x.lxyy from zxdk_xsjbxx x where 1=2";
		outString = dao.getColumnName(sql);
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String xh = "";
		String sql1 = "select to_char(sysdate,'yyyy-mm-dd') rithtNow from dual";
		String lxsj = dao.getOneRs(sql1, new String[] {},
				new String[] { "rithtNow" })[0];// 获得当前时间
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;

			if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写离校信息
				String xm = DealString.toGBK(request.getParameter("xm")
						.toString());
				String sfzh = DealString.toGBK(request.getParameter("sfzh")
						.toString());
				String scbyqx = DealString.toGBK(request.getParameter("scbyqx")
						.toString());
				String yxlxfs = DealString.toGBK(request.getParameter("yxlxfs")
						.toString());
				String dqgzdw = DealString.toGBK(request.getParameter("dqgzdw")
						.toString());
				String dqgzdwdz = DealString.toGBK(request.getParameter(
				"dqgzdwdz").toString());
				String dqgzdwyb = DealString.toGBK(request.getParameter(
				"dqgzdwyb").toString());
				String dqgzdwdh = DealString.toGBK(request.getParameter(
				"dqgzdwdh").toString());
				String lxyy = DealString.toGBK(request.getParameter("lxyy")
						.toString());

				String[] colName1 = new String[] { "xm", "sfzh", "scbyqx",
						"yxlxfs", "dqgzdw", "dqgzdwdz", "dqgzdwyb", "dqgzdwdh",
						"lxyy", "lxsj" };

				String[] valueForOut = new String[] { xm, sfzh, scbyqx, yxlxfs,
						dqgzdw, dqgzdwdz, dqgzdwyb, dqgzdwdh, lxyy, lxsj };

				boolean ok = false;
				ok = StandardOperation.update("zxdk_xsjbxx", colName1,
						valueForOut, "xh", xh, request);
				if (ok) {
					logMsg = "修改 zxdk_xsjbxx";
					Base.log(request, logMsg, sUName);
					request.setAttribute("ok", "ok");
				} else {
					request.setAttribute("ok", "no");
				}
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String xm = DealString.toGBK(request.getParameter("xm")
						.toString());
				String sfzh = DealString.toGBK(request.getParameter("sfzh")
						.toString());
				String scbyqx = DealString.toGBK(request.getParameter("scbyqx")
						.toString());
				String yxlxfs = DealString.toGBK(request.getParameter("yxlxfs")
						.toString());
				String dqgzdw = DealString.toGBK(request.getParameter("dqgzdw")
						.toString());
				String dqgzdwdz = DealString.toGBK(request.getParameter(
				"dqgzdwdz").toString());
				String dqgzdwyb = DealString.toGBK(request.getParameter(
				"dqgzdwyb").toString());
				String dqgzdwdh = DealString.toGBK(request.getParameter(
				"dqgzdwdh").toString());
				String lxyy = DealString.toGBK(request.getParameter("lxyy")
						.toString());

				String[] colName1 = new String[] { "xm", "sfzh", "scbyqx",
						"yxlxfs", "dqgzdw", "dqgzdwdz", "dqgzdwyb", "dqgzdwdh",
						"lxyy", "lxsj" };

				String[] valueForOut = new String[] { xm, sfzh, scbyqx, yxlxfs,
						dqgzdw, dqgzdwdz, dqgzdwyb, dqgzdwdh, lxyy, lxsj };

				boolean ok = false;
				ok = StandardOperation.update("zxdk_xsjbxx", colName1,
						valueForOut, "xh", xh, request);
				if (ok) {
					logMsg = "修改 zxdk_xsjbxx";
					Base.log(request, logMsg, sUName);
					request.setAttribute("ok", "ok");
				} else {
					request.setAttribute("ok", "no");
				}
			}
		}

		sql = "select x.xh,x.xm,x.sfzh,x.scbyqx,x.yxlxfs,x.dqgzdw,x.dqgzdwdz,x.dqgzdwyb,"
			+ "x.dqgzdwdh,x.lxyy from zxdk_xsjbxx x where x.xh=?";
		outValue = dao.getOneRs(sql, new String[] { xh }, outString);
		outString = new String[] { "xh", "xm", "sfzh", "scbyqx", "yxlxfs",
				"dqgzdw", "dqgzdwdz", "dqgzdwyb", "dqgzdwdh", "lxyy" };

		boolean haveXY = false;
		if ((outValue == null)
				|| ((outValue[3] == null) && (outValue[4] == null)
						&& (outValue[5] == null) && (outValue[6] == null)
						&& (outValue[7] == null) && (outValue[8] == null) && (outValue[9] == null))) {
			if (xh != null) {

				sql = "select xsxh,name,id,dwmc,dwdq,dwdz,dwdh,dwyb from jygl_jyxy "
					+ "where xsxh=? and WJYBZ='1' and XXSH='已通过√'";
				String[] colNamet = new String[] { "xh", "xm", "sfzh",
						"dqgzdw", "scbyqx", "dqgzdwdz", "dqgzdwdh", "dqgzdwyb" };
				String[] outValt = dao.getOneRs(sql, new String[] { xh },
						new String[] { "xsxh", "name", "id", "dwmc", "dwdq",
						"dwdz", "dwdh", "dwyb" });
				if (outValt == null) {
					sql = "select xh,xm,sfzh from zxdk_xsjbxx where xh=?";
					String[] colName = new String[] { "xh", "xm", "sfzh" };
					String[] outVal = dao.getOneRs(sql, new String[] { xh },
							colName);
					if (outVal == null) {
						request.setAttribute("isNULL", "is");
					} else {
						colName = new String[] { "xh", "xm", "sfzh" };
						for (int i = 0; i < colName.length; i++) {
							if (outVal[i] != null) {
								map.put(colName[i], outVal[i]);
							} else {
								map.put(colName[i], "");
							}
						}
					}
				} else {
					haveXY = true;
					for (int i = 0; i < colNamet.length; i++) {
						if (outValt[i] != null) {
							map.put(colNamet[i], outValt[i]);
						} else {
							map.put(colNamet[i], "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		if (haveXY) {
			request.setAttribute("haveXY", "is");
		} else {
			request.setAttribute("haveXY", "no");
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward hkxysd(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {// 还款协议设定
		XszzForm xszzForm = (XszzForm) form;

		String doType = request.getParameter("doType");// 操作类型

		String sUName;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		sUName = session.getAttribute("userName").toString();
		String sql = "";
		String[] outString = new String[] {};
		sql = "select yhmc,hkqx,sfgdhkfs,zhmc,gdhkfsdm from ZXDK_HKXYSZB1 where 1=2";
		outString = dao.getColumnName(sql);
		sql = "select gdhkfsdm from ZXDK_HKXYSZB1 where rownum=1";
		String gdhkfsdm = "";
		boolean ok = false;
		String[] gdhkfsdmTemp = dao.getOneRs(sql, new String[] {},
				new String[] { "gdhkfsdm" });
		if (gdhkfsdmTemp != null) {
			gdhkfsdm = gdhkfsdmTemp[0];
		} else {
			gdhkfsdm = DealString.toGBK(xszzForm.getHkfsdm());
		}

		String logMsg;
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String sfgdhkfs = DealString.toGBK(xszzForm.getSfgdhkfs());
		String yhmc = DealString.toGBK(xszzForm.getYhmc());
		String hkqx = DealString.toGBK(xszzForm.getHkqx());
		String zhmc = DealString.toGBK(xszzForm.getZhmc());
		String hkfsmc1 = DealString.toGBK(xszzForm.getHkfsmc1());
		String hkfsmc2 = DealString.toGBK(xszzForm.getHkfsmc2());
		String hkfsmc3 = DealString.toGBK(xszzForm.getHkfsmc3());
		String hkfsmc4 = DealString.toGBK(xszzForm.getHkfsmc4());
		String hkfsmc5 = DealString.toGBK(xszzForm.getHkfsmc5());
		String hkfsmc6 = DealString.toGBK(xszzForm.getHkfsmc6());
		String hkfsmc7 = DealString.toGBK(xszzForm.getHkfsmc7());
		String hkfsmc8 = DealString.toGBK(xszzForm.getHkfsmc8());
		String hkfsmc9 = DealString.toGBK(xszzForm.getHkfsmc9());
		String hkfsmc10 = DealString.toGBK(xszzForm.getHkfsmc10());
		String[] temp = new String[] { hkfsmc1, hkfsmc2, hkfsmc3, hkfsmc4,
				hkfsmc5, hkfsmc6, hkfsmc7, hkfsmc8, hkfsmc9, hkfsmc10 };

		if (doType != null && doType.equalsIgnoreCase("add")) {
			gdhkfsdm = DealString.toGBK(xszzForm.getHkfsdm());
			String[] sqlT = new String[temp.length];
			int it;
			for (int i = 0; i < temp.length; i++) {
				it = i + 1;
				sqlT[i] = "update ZXDK_HKXYSZB2 set HKFS='"+temp[i]+"' where HKFSDM='"+String.valueOf(it)+"'";
			}
			dao.runBatch(sqlT);
			sql = "select yhmc,hkqx,sfgdhkfs,zhmc,gdhkfsdm from ZXDK_HKXYSZB1 where rownum=1";
			outValue = dao.getOneRs(sql, new String[] {}, outString);

			String[] valueForOut = new String[] { yhmc, hkqx, sfgdhkfs, zhmc,
					gdhkfsdm };
			if (outValue == null) {
				ok = StandardOperation.insert("ZXDK_HKXYSZB1", new String[] {
						"yhmc", "hkqx", "sfgdhkfs", "zhmc", "gdhkfsdm" },
						valueForOut, request);
			} else {
				sql = "update ZXDK_HKXYSZB1 set yhmc=?,hkqx=?,sfgdhkfs=?,zhmc=?,gdhkfsdm=?";
				ok = StandardOperation.update("ZXDK_HKXYSZB1", new String[] {
						"yhmc", "hkqx", "sfgdhkfs", "zhmc", "gdhkfsdm" },
						valueForOut, "1", "1", request);
			}

			if (ok) {
				logMsg = "修改或添加 ZXDK_HKXYSZB1";
				Base.log(request, logMsg, sUName);
				request.setAttribute("ok", "ok");
			} else {
				request.setAttribute("ok", "no");
			}
		}

		if ("read".equalsIgnoreCase(doType)) {
			sfgdhkfs = request.getParameter("sfgdhkfs");

			String[] out = new String[] { sfgdhkfs, yhmc, hkqx, zhmc, gdhkfsdm,
					hkfsmc1, hkfsmc2, hkfsmc3, hkfsmc4, hkfsmc5, hkfsmc6,
					hkfsmc7, hkfsmc8, hkfsmc9, hkfsmc10 };
			String[] pout = new String[] { "sfgdhkfs", "yhmc", "hkqx", "zhmc",
					"gdhkfsdm", "hkfsmc1", "hkfsmc2", "hkfsmc3", "hkfsmc4",
					"hkfsmc5", "hkfsmc6", "hkfsmc7", "hkfsmc8", "hkfsmc9",
			"hkfsmc10" };
			for (int i = 0; i < pout.length; i++) {
				if (out[i] != null) {
					map.put(pout[i], out[i]);
				} else {
					map.put(pout[i], "");
				}
			}
			if ("1".equalsIgnoreCase(sfgdhkfs)) {
				request.setAttribute("isGD", "is");
			} else {
				request.setAttribute("isGD", "no");
			}
		} else {
			sql = "select yhmc,hkqx,sfgdhkfs,zhmc,gdhkfsdm from ZXDK_HKXYSZB1 where rownum=1";
			outValue = dao.getOneRs(sql, new String[] {}, outString);
			outString = new String[] { "yhmc", "hkqx", "sfgdhkfs", "zhmc",
			"gdhkfsdm" };
			if (outValue != null) {
				for (int i = 0; i < outString.length; i++) {
					if (outValue[i] != null) {
						map.put(outString[i], outValue[i]);
					} else {
						map.put(outString[i], "");
					}
				}
			}

			if ("1".equalsIgnoreCase(sfgdhkfs)) {
				request.setAttribute("isGD", "is");
			} else if (("".equalsIgnoreCase(sfgdhkfs) || (sfgdhkfs == null))
					&& (outValue != null)
					&& ("1".equalsIgnoreCase(outValue[2]))) {
				request.setAttribute("isGD", "is");
			} else {
				request.setAttribute("isGD", "no");
			}

			String[] hkfstemp;
			String[] hkfsm = new String[] { "hkfsmc1", "hkfsmc2", "hkfsmc3",
					"hkfsmc4", "hkfsmc5", "hkfsmc6", "hkfsmc7", "hkfsmc8",
					"hkfsmc9", "hkfsmc10" };
			for (int i = 1; i <= 10; i++) {
				sql = "select hkfs from ZXDK_HKXYSZB2 where hkfsdm=?";
				hkfstemp = dao.getOneRs(sql,
						new String[] { String.valueOf(i) },
						new String[] { "hkfs" });
				if (hkfstemp != null) {
					map.put(hkfsm[i - 1], hkfstemp[0]);
				}
			}
		}

		sql = "select hkfs from ZXDK_HKXYSZB2 where hkfsdm=?";
		String[] hkfsTemp = dao.getOneRs(sql, new String[] { gdhkfsdm },
				new String[] { "hkfs" });
		if (hkfsTemp != null) {
			map.put("hkfs", hkfsTemp[0]);
			map.put("hkfsdm", gdhkfsdm);
		} else {
			map.put("hkfs", "");
			map.put("hkfsdm", "");
		}

		sql = "select hkfsdm,hkfs from ZXDK_HKXYSZB2";
		List hkList = dao.getList(sql, new String[] {}, new String[] {
				"hkfsdm", "hkfs" });
		request.setAttribute("hkList", hkList);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward hkxy(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {// 还款协议
		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String xxmc = ToolClass.getXxmc();
		String doType = request.getParameter("doType");// 操作类型
		HashMap<String, String> map = new HashMap<String, String>();
		boolean isStu = false;
		String pkQuery = DealString.toGBK(request.getParameter("queryPK"));

		String sql1 = "";
		String sfksq = "-1";
		String now = dao.getOneRs("select to_char(sysdate,'yyyy-mm-dd') now from dual", new String[]{}, "now");
		String sql = "select yhmc,hkqx zdhkqx,sfgdhkfs,zhmc,gdhkfsdm from zxdk_hkxyszb1 where rownum=1";
		String[] tempOut = new String[] { "yhmc", "zdhkqx", "sfgdhkfs", "zhmc",
		"gdhkfsdm" };
		String[] tmepHksd = dao.getOneRs(sql, new String[] {}, tempOut);

		if (tmepHksd == null) {
			request.setAttribute("sfSD", "no");
		} else {
			request.setAttribute("sfSD", "is");
			if ("1".equalsIgnoreCase(tmepHksd[2])) {
				sql = "select hkfs from zxdk_hkxyszb2 where hkfsdm=?";
				String[] t = dao.getOneRs(sql, new String[] { tmepHksd[4] },
						new String[] { "hkfs" });
				if (t != null) {
					map.put("hkfs", t[0]);
				}
				request.setAttribute("isGD", "is");
			} else {
				request.setAttribute("isGD", "no");
			}
			for (int i = 0; i < tempOut.length; i++) {
				if (tmepHksd[i] != null) {
					map.put(tempOut[i], tmepHksd[i]);
				} else {
					map.put(tempOut[i], "");
				}
			}
		}
		sql = "select hkfsdm,hkfs from ZXDK_HKXYSZB2";
		List hkList = dao.getList(sql, new String[] {}, new String[] {
				"hkfsdm", "hkfs" });
		request.setAttribute("hkList", hkList);

		String[] outString = new String[] {};
		sql = "select xh,xm,xb,csrq,xxmc,xymc,xmc,sfzh,xl,hyzk,poxm,"
			+ "lxdh,gzdw,dwdh,dwdz,dwyzbm,yddh,email,lxrxm,lxrxb,lxrcsrq,"
			+ "lxrgx,lxrdh,lxrdwdz,jtxxzz,jtyzbm,jtlxdh,fqxm,fqzy,fqsfzh,"
			+ "mqxm,mqzy,mqsfzh,bz,hth,zhfkrq,fkzje,lxsj,lxyy,hkkssj,hkfs1,"
			+ "hkfs2,hkcs,hkqx,hkjssj,zffm,zfh from view_zxdk_hkxy where 1=2";
		outString = dao.getColumnName(sql);
		String[] outValue = null;
		String xh = "";

		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;
				sql1 = "select a.kssj,a.jssj from view_shgc_gjzxdk_sjb a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and b.xh=? and a.xmmc='还款协议'";// ,nd
				// and
				// substr(gjjxjsqkssj,1,4)=?
				jxjksjssj = dao.getOneRs(sql1, new String[] { xh },
						new String[] { "kssj", "jssj" });

			if (jxjksjssj == null
					|| jxjksjssj[0].compareToIgnoreCase(now) >= 0
					|| jxjksjssj[1].compareToIgnoreCase(now) <= 0) {// /不在申请时间范围内
				sfksq = "-1";// /不可以进行申请
				request.setAttribute("sfksq", sfksq);
			}else{
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			xh = DealString.toGBK(xszzForm.getXh());
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
		}
		String xm = DealString.toGBK(xszzForm.getXm());
		String xb = DealString.toGBK(xszzForm.getXb());
		String csrq = DealString.toGBK(xszzForm.getCsrq());
		String xymc = DealString.toGBK(xszzForm.getXymc());
		String xmc = DealString.toGBK(xszzForm.getXmc());
		String sfzh = DealString.toGBK(xszzForm.getSfzh());
		String xl = DealString.toGBK(xszzForm.getXl());
		String hyzk = DealString.toGBK(xszzForm.getHyzk());
		String poxm = DealString.toGBK(xszzForm.getPoxm());
		String lxdh = DealString.toGBK(xszzForm.getLxdh());
		String gzdw = DealString.toGBK(xszzForm.getGzdw());
		String dwdh = DealString.toGBK(xszzForm.getDwdh());
		String dwdz = DealString.toGBK(xszzForm.getDwdz());
		String dwyzbm = DealString.toGBK(xszzForm.getDwyzbm());
		String yddh = DealString.toGBK(xszzForm.getYddh());
		String email = DealString.toGBK(xszzForm.getEmail());
		String lxrxm = DealString.toGBK(xszzForm.getLxrxm());
		String lxrxb = DealString.toGBK(xszzForm.getLxrxb());
		String lxrcsrq = DealString.toGBK(xszzForm.getLxrcsrq());
		String lxrgx = DealString.toGBK(xszzForm.getLxrgx());
		String lxrdh = DealString.toGBK(xszzForm.getLxrdh());
		String lxrdwdz = DealString.toGBK(xszzForm.getLxrdwdz());
		String jtxxzz = DealString.toGBK(xszzForm.getJtxxzz());
		String jtyzbm = DealString.toGBK(xszzForm.getJtyzbm());
		String jtlxdh = DealString.toGBK(xszzForm.getJtlxdh());
		String fqxm = DealString.toGBK(xszzForm.getFqxm());
		String fqzy = DealString.toGBK(xszzForm.getFqzy());
		String fqsfzh = DealString.toGBK(xszzForm.getFqsfzh());
		String mqxm = DealString.toGBK(xszzForm.getMqxm());
		String mqzy = DealString.toGBK(xszzForm.getMqzy());
		String mqsfzh = DealString.toGBK(xszzForm.getMqsfzh());
		String bz = DealString.toGBK(xszzForm.getBz());
		String hth = DealString.toGBK(xszzForm.getHth());
		if((null != pkQuery) && (!"".equalsIgnoreCase(pkQuery))){
			hth = pkQuery;
		}
		String zhfkrq = DealString.toGBK(xszzForm.getZhfkrq());
		String fkzje = DealString.toGBK(xszzForm.getFkzje());
		String lxsj = DealString.toGBK(xszzForm.getLxsj());
		String lxyy = DealString.toGBK(xszzForm.getLxyy());
		String hkkssj = DealString.toGBK(xszzForm.getHkkssj());
		String hkfs1 = DealString.toGBK(xszzForm.getHkfs1());
		String hkfs2 = DealString.toGBK(xszzForm.getHkfsdm());
		if ((hkfs2 == null) || ("".equalsIgnoreCase(hkfs2))
				&& (tmepHksd != null)) {
			hkfs2 = tmepHksd[4];
		}
		String hkcs = DealString.toGBK(xszzForm.getHkcs());
		String hkqx = DealString.toGBK(xszzForm.getHkqx());
		String hkjssj = DealString.toGBK(xszzForm.getHkjssj());
		String zffm = DealString.toGBK(xszzForm.getZffm());
		String zfh = DealString.toGBK(xszzForm.getZfh());
		String monthBen = dao.getOneRs("select floor(months_between(add_months(case length(rxny) when 6 then to_date(rxny,'yyyy-mm-dd') when 7 then to_date(rxny,'yyyy-mm') else to_date(to_char(sysdate,'yyyy-mm'),'yyyy-mm') end,120),to_date('"+hkjssj+"','yyyy-mm-dd'))) monthBen from bks_xsjbxx where xh=?", new String[]{xh}, "monthBen");
		if((monthBen == null) || ("".equals(monthBen))){
			hkjssj = dao.getOneRs("select to_char(add_months(case length(rxny) when 6 then to_date(rxny,'yyyy-mm-dd') when 7 then to_date(rxny,'yyyy-mm') else to_date(to_char(sysdate,'yyyy-mm'),'yyyy-mm') end,120),'yyyy-mm-dd') tenYear from bks_xsjbxx where xh=?", new String[]{xh}, "tenYear");
		}
		if((monthBen != null) && (!"".equals(monthBen)) && Integer.valueOf(monthBen) < 0 ){
			hkjssj = dao.getOneRs("select to_char(add_months(case length(rxny) when 6 then to_date(rxny,'yyyy-mm-dd') when 7 then to_date(rxny,'yyyy-mm') else to_date(to_char(sysdate,'yyyy-mm'),'yyyy-mm') end,120),'yyyy-mm-dd') tenYear from bks_xsjbxx where xh=?", new String[]{xh}, "tenYear");
		}
		String num = dao.getOneRs("select floor(months_between(to_date('"+hkjssj+"','yyyy-mm-dd'),to_date('"+hkkssj+"','yyyy-mm-dd'))) num from dual", new String[]{}, "num");
		hkcs = num;
		hkqx = num;
		if ("htxx".equalsIgnoreCase(doType)) {
			isStu = true;
			sql = "select hth,hth from zxdk_htxx where xh=?";
			List hthList = dao.getList(sql, new String[] { xh }, new String[] {
					"hth", "hth" });
			request.setAttribute("hthList", hthList);
			sql = "select NVL(FKRQ5,NVL(FKRQ4,NVL(FKRQ3,NVL(FKRQ2,FKRQ1)))) zhfkrq,ZJE fkzje from zxdk_fkxx where hth=?";
			tempOut = dao.getOneRs(sql, new String[] { hth }, new String[] {
					"zhfkrq", "fkzje" });
			if (tempOut != null) {
				zhfkrq = tempOut[0];
				fkzje = tempOut[1];
				if ((zhfkrq == null) && (fkzje == null)) {
					request.setAttribute("notFK", "is");
				}
			}
			String[] outVal = new String[] { xh, xm, xb, csrq, xxmc, xymc, xmc,
					sfzh, xl, hyzk, poxm, lxdh, gzdw, dwdh, dwdz, dwyzbm, yddh,
					email, lxrxm, lxrxb, lxrcsrq, lxrgx, lxrdh, lxrdwdz,
					jtxxzz, jtyzbm, jtlxdh, fqxm, fqzy, fqsfzh, mqxm, mqzy,
					mqsfzh, bz, hth, zhfkrq, fkzje, lxsj, lxyy, hkkssj, hkfs1,
					hkfs2, hkcs, hkqx, hkjssj, zffm, zfh };
			String[] ourStringTemp = new String[] { "xh", "xm", "xb", "csrq",
					"xxmc", "xymc", "xmc", "sfzh", "xl", "hyzk", "poxm",
					"lxdh", "gzdw", "dwdh", "dwdz", "dwyzbm", "yddh", "email",
					"lxrxm", "lxrxb", "lxrcsrq", "lxrgx", "lxrdh", "lxrdwdz",
					"jtxxzz", "jtyzbm", "jtlxdh", "fqxm", "fqzy", "fqsfzh",
					"mqxm", "mqzy", "mqsfzh", "bz", "hth", "zhfkrq", "fkzje",
					"lxsj", "lxyy", "hkkssj", "hkfs1", "hkfs2", "hkcs", "hkqx",
					"hkjssj", "zffm", "zfh" };
			for (int i = 0; i < ourStringTemp.length; i++) {
				if (outVal[i] != null) {
					map.put(ourStringTemp[i], outVal[i]);
				} else {
					map.put(ourStringTemp[i], "");
				}
			}
		} else if ("add".equalsIgnoreCase(doType)) {
			StandardOperation.delete("zxdk_hkxy", "xh||hth", xh + hth, request);

			String[] colName1 = new String[] { "xh", "xm", "xb", "csrq",
					"xxmc", "xymc", "xmc", "sfzh", "xl", "hyzk", "poxm",
					"lxdh", "gzdw", "dwdh", "dwdz", "dwyzbm", "yddh", "email",
					"lxrxm", "lxrxb", "lxrcsrq", "lxrgx", "lxrdh", "lxrdwdz",
					"jtxxzz", "jtyzbm", "jtlxdh", "fqxm", "fqzy", "fqsfzh",
					"mqxm", "mqzy", "mqsfzh", "bz", "hth", "zhfkrq", "fkzje",
					"lxsj", "lxyy", "hkkssj", "hkfs1", "hkfs2", "hkcs", "hkqx",
					"hkjssj", "zffm", "zfh" };
			String[] input = new String[] { xh, xm, xb, csrq, xxmc, xymc, xmc,
					sfzh, xl, hyzk, poxm, lxdh, gzdw, dwdh, dwdz, dwyzbm, yddh,
					email, lxrxm, lxrxb, lxrcsrq, lxrgx, lxrdh, lxrdwdz,
					jtxxzz, jtyzbm, jtlxdh, fqxm, fqzy, fqsfzh, mqxm, mqzy,
					mqsfzh, bz, hth, zhfkrq, fkzje, lxsj, lxyy, hkkssj, hkfs1,
					hkfs2, hkcs, hkqx, hkjssj, zffm, zfh };
			boolean ok = StandardOperation.insert("zxdk_hkxy", colName1, input,
					request);
			if (ok) {
				logMsg = "添加 zxdk_hkxy";
				Base.log(request, logMsg, sUName);
				request.setAttribute("ok", "ok");
			} else {
				request.setAttribute("ok", "no");
			}
		} else {
			sql = "select xh,xm,xb,csrq,xxmc,xymc,xmc,sfzh,"
				+ "xl,hyzk,poxm,lxdh,gzdw,dwdh,dwdz,dwyzbm,yddh,email,"
				+ "lxrxm,lxrxb,lxrcsrq,lxrgx,lxrdh,lxrdwdz,jtxxzz,jtyzbm,"
				+ "jtlxdh,fqxm,fqzy,fqsfzh,mqxm,mqzy,mqsfzh,bz,hth,zhfkrq,"
				+ "fkzje,lxsj,lxyy,hkkssj,hkfs1,hkfs2,hkcs,hkqx,hkjssj,zffm,zfh "
				+ "from zxdk_hkxy where xh=? and hth=?";
			outValue = dao.getOneRs(sql, new String[] { xh, hth }, outString);
			outString = new String[] { "xh", "xm", "xb", "csrq", "xxmc",
					"xymc", "xmc", "sfzh", "xl", "hyzk", "poxm", "lxdh",
					"gzdw", "dwdh", "dwdz", "dwyzbm", "yddh", "email", "lxrxm",
					"lxrxb", "lxrcsrq", "lxrgx", "lxrdh", "lxrdwdz", "jtxxzz",
					"jtyzbm", "jtlxdh", "fqxm", "fqzy", "fqsfzh", "mqxm",
					"mqzy", "mqsfzh", "bz", "hth", "zhfkrq", "fkzje", "lxsj",
					"lxyy", "hkkssj", "hkfs1", "hkfs2", "hkcs", "hkqx",
					"hkjssj", "zffm", "zfh" };

			isStu = true;
			sql = "select hth,hth from zxdk_htxx where xh=?";
			List hthList = dao.getList(sql, new String[] { xh }, new String[] {
					"hth", "hth" });
			request.setAttribute("hthList", hthList);
			if (outValue == null) {
				if ((xh != null) && (!"".equalsIgnoreCase(xh))) {

					sql = "select xh,xm,xb,csrq,xxmc,xymc,xmc,sfzh,xslx xl,dqgzdw gzdw,"
						+ "dqgzdwdh dwdh,dqgzdwdz dwdz,dqgzdwyb dwyzbm,jtzz jtxxzz,"
						+ "yzbm jtyzbm,fqxm,fqsfzh,mqxm,mqsfzh,lxsj,lxyy,xm zffm from zxdk_xsjbxx where xh=?";
					String[] colName = new String[] { "xh", "xm", "xb", "csrq",
							"xxmc", "xymc", "xmc", "sfzh", "xl", "gzdw",
							"dwdh", "dwdz", "dwyzbm", "jtxxzz", "jtyzbm",
							"fqxm", "fqsfzh", "mqxm", "mqsfzh", "lxsj", "lxyy", "zffm" };
					String[] outVal = dao.getOneRs(sql, new String[] { xh },
							colName);
					if ((outVal == null) || (hthList.size() == 0)) {
						request.setAttribute("isNULL", "is");
					} else {
						colName = new String[] { "xh", "xm", "xb", "csrq",
								"xxmc", "xymc", "xmc", "sfzh", "xl", "gzdw",
								"dwdh", "dwdz", "dwyzbm", "jtxxzz", "jtyzbm",
								"fqxm", "fqsfzh", "mqxm", "mqsfzh", "lxsj",
						"lxyy", "zffm" };
						for (int i = 0; i < colName.length; i++) {
							if (outVal[i] != null) {
								map.put(colName[i], outVal[i]);
							} else {
								map.put(colName[i], "");
							}
						}
					}
					String kssj = dao.getOneRs("select to_char(add_months(case length(rxny) when 6 then to_date(rxny,'yyyymm') when 7 then to_date(rxny,'yyyy-mm') else to_date(to_char(sysdate,'yyyy-mm'),'yyyy-mm') end,floor(xz)*12+1),'yyyy-mm-dd') kssj from bks_xsjbxx where xh=?", new String[]{xh}, "kssj");
					map.put("hkkssj", kssj);
				}
			} else {
				for (int i = 0; i < outString.length; i++) {
					if (outValue[i] != null) {
						map.put(outString[i], outValue[i]);
					} else {
						map.put(outString[i], "");
					}
				}
				String kssj = dao.getOneRs("select to_char(add_months(case length(rxny) when 6 then to_date(rxny,'yyyymm') when 7 then to_date(rxny,'yyyy-mm') else to_date(to_char(sysdate,'yyyy-mm'),'yyyy-mm') end,floor(xz)*12+1),'yyyy-mm-dd') kssj from bks_xsjbxx where xh=?", new String[]{xh}, "kssj");
				map.put("hkkssj", kssj);
			}
		}
		if (isStu) {
			request.setAttribute("isStu", "is");
		} else {
			request.setAttribute("isStu", "no");
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward hkxysqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {

		DAO dao = DAO.getInstance();
		String xm = DealString.toGBK(request.getParameter("xm"));
		String sfzh = DealString.toGBK(request.getParameter("sfzh"));
		String dwdz = DealString.toGBK(request.getParameter("dwdz"));
		String gzdw = DealString.toGBK(request.getParameter("gzdw"));
		String dwyzbm = DealString.toGBK(request.getParameter("dwyzbm"));
		String lxdh = DealString.toGBK(request.getParameter("lxdh"));
		String hth = DealString.toGBK(request.getParameter("hth"));
		String zhfkrq = DealString.toGBK(request.getParameter("zhfkrq"));
		String fkzje = DealString.toGBK(request.getParameter("fkzje"));
		String lxsj = DealString.toGBK(request.getParameter("lxsj"));
		String lxyy = DealString.toGBK(request.getParameter("lxyy"));
		String xxmc = DealString.toGBK(request.getParameter("xxmc"));
		String hkkssj = DealString.toGBK(request.getParameter("hkkssj"));
		String hkjssj = DealString.toGBK(request.getParameter("hkjssj"));
		String hkfs1 = DealString.toGBK(request.getParameter("hkfs1"));
		String hkfs2 = DealString.toGBK(request.getParameter("hkfs2"));
		String hkcs = DealString.toGBK(request.getParameter("hkcs"));
		String hkqx = DealString.toGBK(request.getParameter("hkqx"));
		String zffm = DealString.toGBK(request.getParameter("zffm"));
		String zfh = DealString.toGBK(request.getParameter("zfh"));

		if ("等额本息还款法".equalsIgnoreCase(hkfs1)) {
			hkfs1 = "(一)";
		} else if ("等额本金还款法".equalsIgnoreCase(hkfs1)) {
			hkfs1 = "(二)";
		}

		String zhfkrqYear = "";
		String zhfkrqMon = "";
		String zhfkrqDay = "";
		if ((!"".equalsIgnoreCase(zhfkrq)) && (!" ".equalsIgnoreCase(zhfkrq))) {
			zhfkrqYear = zhfkrq.substring(0, 4);
			zhfkrqMon = zhfkrq.substring(5, 7);
			zhfkrqDay = zhfkrq.substring(8, 10);
		}

		String lxsjYear = "";
		String lxsjMon = "";
		String lxsjDay = "";
		if (!"".equalsIgnoreCase(lxsj) && (!" ".equalsIgnoreCase(lxsj))) {
			lxsjYear = lxsj.substring(0, 4);
			lxsjMon = lxsj.substring(5, 7);
			lxsjDay = lxsj.substring(8, 10);
		}

		String hkkssjYear = "";
		String hkkssjMon = "";
		String hkkssjDay = "";
		if (!"".equalsIgnoreCase(hkkssj) && (!" ".equalsIgnoreCase(hkkssj))) {
			hkkssjYear = hkkssj.substring(0, 4);
			hkkssjMon = hkkssj.substring(5, 7);
			hkkssjDay = hkkssj.substring(8, 10);
		}

		String hkjssjYear = "";
		String hkjssjMon = "";
		String hkjssjDay = "";
		if (!"".equalsIgnoreCase(hkjssj) && (!" ".equalsIgnoreCase(hkjssj))) {
			hkjssjYear = hkjssj.substring(0, 4);
			hkjssjMon = hkjssj.substring(5, 7);
			hkjssjDay = hkjssj.substring(8, 10);
		}

		String sqlT = "{call pro_Disp_dxje(?,?)}";
		String[] fkzjeT = dao.getProVal(sqlT, new String[] { fkzje },
				new int[] { 2 });
		fkzje = fkzjeT[0];

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xm, sfzh, dwdz, gzdw, dwyzbm, lxdh,
				hth, fkzje, lxyy, xxmc, hkfs1, hkfs2, hkcs, hkqx, zffm, zfh,
				zhfkrqYear, zhfkrqMon, zhfkrqDay, lxsjYear, lxsjMon, lxsjDay,
				hkkssjYear, hkkssjMon, hkkssjDay, hkjssjYear, hkjssjMon,
				hkjssjDay };
		String[] outString = new String[] { "xm", "sfzh", "dwdz", "gzdw",
				"dwyzbm", "lxdh", "hth", "fkzje", "lxyy", "xxmc", "hkfs1",
				"hkfs2", "hkcs", "hkqx", "zffm", "zfh", "zhfkrqYear",
				"zhfkrqMon", "zhfkrqDay", "lxsjYear", "lxsjMon", "lxsjDay",
				"hkkssjYear", "hkkssjMon", "hkkssjDay", "hkjssjYear",
				"hkjssjMon", "hkjssjDay" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward zlqrs(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {

		String xm = request.getParameter("xm");
		String xb = request.getParameter("xb");
		String csrq = request.getParameter("csrq");
		String xxmc = request.getParameter("xxmc");
		String xymc = request.getParameter("xymc");
		String xmc = request.getParameter("xmc");
		String sfzh = request.getParameter("sfzh");
		String xl = request.getParameter("xl");
		String jtlxdh = request.getParameter("jtlxdh");
		String jtxxzz = request.getParameter("jtxxzz");
		String hyzk = request.getParameter("hyzk");
		String poxm = request.getParameter("poxm");
		String lxdh = request.getParameter("lxdh");
		String gzdw = request.getParameter("gzdw");
		String dwdh = request.getParameter("dwdh");
		String dwyzbm = request.getParameter("dwyzbm");
		String dwdz = request.getParameter("dwdz");
		String yddh = request.getParameter("yddh");
		String email = request.getParameter("email");
		String lxrxm = request.getParameter("lxrxm");
		String lxrxb = request.getParameter("lxrxb");
		String lxrcsrq = request.getParameter("lxrcsrq");
		String lxrgx = request.getParameter("lxrgx");
		String lxrdh = request.getParameter("lxrdh");
		String lxrdwdz = request.getParameter("lxrdwdz");
		String jtyzbm = request.getParameter("jtyzbm");
		String fqxm = request.getParameter("fqxm");
		String fqzy = request.getParameter("fqzy");
		String fqsfzh = request.getParameter("fqsfzh");
		String mqxm = request.getParameter("mqxm");
		String mqzy = request.getParameter("mqzy");
		String mqsfzh = request.getParameter("mqsfzh");
		String bz = request.getParameter("bz");

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xm, xb, csrq, xxmc, xymc, xmc, sfzh,
				xl, jtlxdh, jtxxzz, hyzk, poxm, lxdh, gzdw, dwdh, dwyzbm, dwdz,
				yddh, email, lxrxm, lxrxb, lxrcsrq, lxrgx, lxrdh, lxrdwdz,
				jtyzbm, fqxm, fqzy, fqsfzh, mqxm, mqzy, mqsfzh, bz };
		String[] outString = new String[] { "xm", "xb", "csrq", "xxmc", "xymc",
				"xmc", "sfzh", "xl", "jtlxdh", "jtxxzz", "hyzk", "poxm",
				"lxdh", "gzdw", "dwdh", "dwyzbm", "dwdz", "yddh", "email",
				"lxrxm", "lxrxb", "lxrcsrq", "lxrgx", "lxrdh", "lxrdwdz",
				"jtyzbm", "fqxm", "fqzy", "fqsfzh", "mqxm", "mqzy", "mqsfzh",
		"bz" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				map.put(outString[i], DealString.toGBK(outValue[i]));
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward bzcx(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) throws SQLException {
		HttpSession session = request.getSession();

		DAO dao = DAO.getInstance();
		Vector<Object> rs = new Vector<Object>();
		String[] colList = null;
		String[] colListCN = null;
		String sql = "";// sql语句
		String querry = " where 1=1 ";// sql条件
		String querry1 = " where 1=1 ";
		String querryt = " where 1=1 ";
//		String querry4 = " where 1=1 ";
		String tableName = request.getParameter("tableName");// 查询信息源（多为视图名）
		String rsNum = "0";// 返回的记录数
		String realTable = "";// 数据源表
		String pk = "";// 数据源表主键（格式为“字段名||字段名||字段名”）
		String writeAble = "yes";// 写权限
		String doType = DealString.toGBK(request.getParameter("doType"));
		String bzlx = DealString.toGBK(request.getParameter("bzlxdm"));
		String xjzt = DealString.toGBK(request.getParameter("xjzt"));
		String bzrq = DealString.toGBK(request.getParameter("bzrq"));
		String bzrq1 = DealString.toGBK(request.getParameter("bzrq1"));
		String bzrq2 = DealString.toGBK(request.getParameter("bzrq2"));
		String bzrqt = DealString.toGBK(request.getParameter("bzrqt"));
		String bzrq4 = DealString.toGBK(request.getParameter("bzrq4"));
		String xydm1 = DealString.toGBK(request.getParameter("xydm1"));
//		String xydm4 = DealString.toGBK(request.getParameter("xydm4"));
		String xydmt = DealString.toGBK(request.getParameter("xydmt"));
		String xydm = DealString.toGBK(request.getParameter("xydm"));
		String xymc4 = DealString.toGBK(request.getParameter("xymc4"));
		String userDep = session.getAttribute("userDep").toString();
		String userType = dao.getUserType(userDep);
		String xxmc = ToolClass.getXxmc();
		tableName = "bzcx";
		String table = "";
		HashMap<String, String> map = new HashMap<String, String>();
		if (xydm == null) {
			xydm = "";
		}
		if (xydm1 == null) {
			xydm1 = "";
		}
//		if (xydm4 == null) {
//			xydm4 = "";
//		}
		if (bzrq == null) {
			bzrq = "";
		}
		if (bzrqt == null) {
			bzrqt = "";
		}
		if (xymc4 == null) {
			xymc4 = "";
		}
		if (bzrq4 == null) {
			bzrq4 = "";
		}
		if (xjzt == null) {
			xjzt = "";
		}
		if (!"".equalsIgnoreCase(xydm)) {
			querry += " and a.xydm='" + xydm + "'";
		}
		if (!"".equalsIgnoreCase(xydm1)) {
			querryt += " and a.xydm='" + xydm1 + "'";
		}
		if (!"".equalsIgnoreCase(bzrq)) {
			querry1 += " and f.bzffny='" + bzrq + "'";
		}
//		if (!"".equalsIgnoreCase(xydm4)) {
//			querry4 += " and a.xydm='" + xydm4 + "'";
//		}
		String[] xydmList;
		if (!"".equalsIgnoreCase(xydmt)) {
			xydmList = xydmt.split(",");
		} else {
			sql = "select distinct xydm from view_njxyzybj order by xydm";
			xydmList = dao.getArray(sql, new String[] {}, "xydm");
		}

		if ("lsbz".equalsIgnoreCase(bzlx)) {
			table = "lsbzb";
		} else if ("fsbz".equalsIgnoreCase(bzlx)) {
			table = "fsbzb";
		}
		sql = "select bzlx bzlxdm,bzlxmc from bzlxb";
		List bzList = dao.getList(sql, new String[] {}, new String[] {
				"bzlxdm", "bzlxmc" });
		request.setAttribute("bzList", bzList);

		sql = "select distinct xydm xydml,xydm||'||'||xymc xymcl from view_njxyzybj order by xydm";
		List xyList1 = dao.getList(sql, new String[] {}, new String[] {
				"xydml", "xymcl" });
		request.setAttribute("xyList1", xyList1);

		sql = "select distinct xydm xydm1,xymc xymc1 from view_njxyzybj order by xydm";
		List xy1List = dao.getList(sql, new String[] {}, new String[] {
				"xydm1", "xymc1" });
		request.setAttribute("xy1List", xy1List);
//		sql = "select distinct xydm xydm4,xymc xymc4 from view_njxyzybj order by xydm";
//		List xy4List = dao.getList(sql, new String[] {}, new String[] {
//				"xydm4", "xymc4" });
//		request.setAttribute("xy4List", xy4List);

		sql = "select bzlxmc from bzlxb where bzlx=?";
		String bzlxmc = dao.getOneRs(sql, new String[] { bzlx }, "bzlxmc");

		request.setAttribute("doType", doType);
		if (bzlx != null) {
			sql = "select bzlxmc from bzlxb where bzlx=?";
			String[] bzInfo = dao.getOneRs(sql, new String[] { bzlx },
					new String[] { "bzlxmc" });
			if (bzInfo != null) {
				map.put("bzlxmc", bzInfo[0]);
				map.put("bzlxdm", bzlx);
			}
		}
		if (xydm != null) {
			sql = "select distinct xymc from view_njxyzybj where xydm=?";
			String[] xyInfo = dao.getOneRs(sql, new String[] { xydm },
					new String[] { "xymc" });
			if (xyInfo != null) {
				map.put("xymc", xyInfo[0]);
				map.put("xydm", xydm);
			}
		}
		if (xydm1 != null) {
			sql = "select distinct xymc xymc1 from view_njxyzybj where xydm=?";
			String[] xyInfo = dao.getOneRs(sql, new String[] { xydm1 },
					new String[] { "xymc1" });
			if (xyInfo != null) {
				map.put("xymc1", xyInfo[0]);
				map.put("xydm1", xydm1);
			}
		}
//		if (xydm4 != null) {
//			sql = "select distinct xymc xymc4 from view_njxyzybj where xydm=?";
//			String[] xyInfo = dao.getOneRs(sql, new String[] { xydm4 },
//					new String[] { "xymc4" });
//			if (xyInfo != null) {
//				map.put("xymc4", xyInfo[0]);
//				map.put("xydm4", xydm4);
//			}
//		}
		map.put("xydmt", xydmt);
		map.put("bzrq", bzrq);
		map.put("bzrq1", bzrq1);
		map.put("bzrq2", bzrq2);
		map.put("bzrqt", bzrqt);
		map.put("bzrq4", bzrq4);
		map.put("xymc4", xymc4);
		map.put("xjzt", xjzt);

		if ("no1".equalsIgnoreCase(doType)) {
			realTable = table;
			pk = "xh";
			colList = new String[] { "主键", "bzlxmc", "xh", "xm", "xymc",
					"xjzt1", "bzffny1", "byyfbz1", "bybfbz1", "bysfbz1", "xjzt2", "bzffny2",
					"byyfbz2", "bybfbz2", "bysfbz2" };
			StringBuffer sqlB = new StringBuffer();
			sqlB.append("select ");
			sqlB.append(pk);
			sqlB.append(" 主键,a.*,(select '");
			sqlB.append(bzlxmc);
			sqlB.append("' bzlxmc from dual) bzlxmc from (select aa.xh,aa.xm,aa.xymc,aa.xydm,NVL((select NVL(x.YDHXJZTM,'正常') xjzt from view_xjydjbxx x where x.ydxh in (select max(y.ydxh) from view_xjydjbxx y where y.ydrq in (select max(z.ydrq) from view_xjydjbxx z where substr(z.ydrq,1,7)=aa.bzffny1) and y.xh=aa.xh)),'正常') xjzt1,aa.bzffny1,nvl(aa.byyfbz1,0) byyfbz1,nvl(aa.bybfbz1,0) bybfbz1,nvl(aa.bysfbz1,0) bysfbz1,NVL((select NVL(x.YDHXJZTM,'正常') xjzt from view_xjydjbxx x where x.ydxh in (select max(y.ydxh) from view_xjydjbxx y where y.ydrq in (select max(z.ydrq) from view_xjydjbxx z where substr(z.ydrq,1,7)=bb.bzffny2) and y.xh=aa.xh)),'正常') xjzt2,bb.bzffny2,nvl(bb.byyfbz2,0) byyfbz2,nvl(bb.bybfbz2,0) bybfbz2,nvl(bb.bysfbz2,0) bysfbz2 from (select a.xh,a.xm,a.xymc,a.xydm,'");
			sqlB.append(bzrq1);
			sqlB.append("' bzffny1,(select nvl(f.byyfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq1);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) byyfbz1,(select nvl(f.bybfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq1);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) bybfbz1,(select nvl(f.bysfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq1);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) bysfbz1 from view_xsjbxx a ");
			sqlB.append(querry);
			sqlB.append(") aa,(select a.xh,'");
			sqlB.append(bzrq2);
			sqlB.append("' bzffny2,(select nvl(f.byyfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq2);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) byyfbz2,(select nvl(f.bybfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq2);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) bybfbz2,(select nvl(f.bysfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq2);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) bysfbz2 from view_xsjbxx a ");
			sqlB.append(querry);
			sqlB.append(") bb where aa.xh=bb.xh) a where not exists(select aa.xh from (select a.xh,a.xm,a.xymc,a.xydm,'");
			sqlB.append(bzrq1);
			sqlB.append("' bzffny1,(select nvl(f.byyfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq1);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) byyfbz1,(select nvl(f.bybfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq1);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) bybfbz1,(select nvl(f.bysfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq1);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) bysfbz1 from view_xsjbxx a ");
			sqlB.append(querry);
			sqlB.append(") aa,(select a.xh,'");
			sqlB.append(bzrq2);
			sqlB.append("' bzffny2,(select nvl(f.byyfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq2);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) byyfbz2,(select nvl(f.bybfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq2);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) bybfbz2,(select nvl(f.bysfbz,'0') from ");
			sqlB.append(table);
			sqlB.append(" f where f.bzffny='");
			sqlB.append(bzrq2);
			sqlB.append("' and xxsh='已通过' and a.xh=f.xh) bysfbz2 from view_xsjbxx a ");
			sqlB.append(querry);
			sqlB.append(") bb where aa.xh=bb.xh and nvl(aa.byyfbz1,0)=nvl(bb.byyfbz2,0) and nvl(aa.bybfbz1,0)=nvl(bb.bybfbz2,0) and a.xh=aa.xh)");
			colListCN = dao.getColumnNameCN(colList, "XSZZ_BZ_QUERY1");
			List topTr = dao.arrayToList(colList, colListCN);
			rs.addAll(dao.rsToVator(sqlB.toString(), new String[] {}, colList));
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
			request.setAttribute("topTr", topTr);// 发送表头

		} else if ("no2".equalsIgnoreCase(doType)) {
			realTable = table;
			pk = "xh";
			colList = new String[] { "主键", "bzlxmc", "xh", "xm", "xymc",
					"bzffny", "xjzt", "byyfbz", "bybfbz", "bysfbz" };
			StringBuffer sqlB = new StringBuffer();
			sqlB.append("select * from (select ");
			sqlB.append(pk);
			sqlB.append(" 主键,a.*,(select '");
			sqlB.append(bzlxmc);
			sqlB.append("' bzlxmc from dual) bzlxmc,NVL((select NVL(x.YDHXJZTM,'正常') xjzt from view_xjydjbxx x where x.ydxh in (select max(y.ydxh) from view_xjydjbxx y where y.ydrq in (select max(z.ydrq) from view_xjydjbxx z where substr(z.ydrq,1,7)=a.bzffny) and y.xh=a.xh)),'正常') xjzt from (select a.xh,a.xm,a.xydm,a.xymc,'");
			sqlB.append(bzrq);
			sqlB.append("' bzffny,nvl((select f.byyfbz from ");
			sqlB.append(table);
			sqlB.append(" f ");
			sqlB.append(querry1);
			sqlB.append(" and f.xh=a.xh and xxsh='已通过'),0) byyfbz,nvl((select f.bybfbz from ");
			sqlB.append(table);
			sqlB.append(" f ");
			sqlB.append(querry1);
			sqlB.append(" and f.xh=a.xh and xxsh='已通过'),0) bybfbz,nvl((select f.bysfbz from ");
			sqlB.append(table);
			sqlB.append(" f ");
			sqlB.append(querry1);
			sqlB.append(" and f.xh=a.xh and xxsh='已通过'),0) bysfbz from view_xsjbxx a ");
			sqlB.append(querryt);
			sqlB.append(") a where nvl(a.byyfbz,0)=0 and nvl(a.bybfbz,0)=0 and nvl(a.bysfbz,0)=0 ) where ");
			List topTr = new ArrayList<HashMap<String, String>>();
			if(xjzt != null && !"".equalsIgnoreCase(xjzt)){
				sqlB.append("xjzt=?");
				colListCN = dao.getColumnNameCN(colList, "XSZZ_BZ_QUERY3");
				topTr = dao.arrayToList(colList, colListCN);
				rs.addAll(dao.rsToVator(sqlB.toString(), new String[] {xjzt}, colList));
			}else {
				sqlB.append("1=1");
				colListCN = dao.getColumnNameCN(colList, "XSZZ_BZ_QUERY3");
				topTr = dao.arrayToList(colList, colListCN);
				rs.addAll(dao.rsToVator(sqlB.toString(), new String[] {}, colList));
			}
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
			request.setAttribute("topTr", topTr);// 发送表头
		} else if ("no3".equalsIgnoreCase(doType)) {
			realTable = table;
			pk = "bzffny";
			if ("fsbz".equalsIgnoreCase(bzlx)) {
				colList = new String[] { "主键", "bzffny", "xymc", "fsbzrs",
						"fsbzje", "bz" };
				colListCN = dao.getColumnNameCN(colList, "XSZZ_BZ_QUERY2");
				List topTr = dao.arrayToList(colList, colListCN);
				int sumRs = 0;
				int sumJe = 0;
				String bz = "";
				for (int i = 0; i < xydmList.length; i++) {
					sql = "select distinct xymc from view_njxyzybj where xydm=?";
					String xymc = dao.getOneRs(sql,
							new String[] { xydmList[i] }, "xymc");

					if (xjzt != null && !"".equalsIgnoreCase(xjzt)) {
						sql = "select xymc,count(xydm) fsbzrs,sum(bysfbz) fsbzje,sum(bybfbz) bz from "
								+ "(select a.xh,b.xm,b.xydm,b.xymc,nvl(a.bybfbz,'0') bybfbz,"
								+ "nvl(a.bysfbz,'0') bysfbz,a.bzffny from view_fsbzb a,view_xsjbxx b "
								+ "where a.xxsh='已通过' and a.bzffny='"
								+ bzrqt
								+ "' and a.xjzt='"
								+ xjzt
								+ "' and b.xydm='"
								+ xydmList[i]
								+ "' and a.xh=b.xh) group by xymc,xydm having xydm is not null";
					} else {
						sql = "select xymc,count(xydm) fsbzrs,sum(bysfbz) fsbzje,sum(bybfbz) bz from "
								+ "(select a.xh,b.xm,b.xydm,b.xymc,nvl(a.bybfbz,'0') bybfbz,"
								+ "nvl(a.bysfbz,'0') bysfbz,a.bzffny from view_fsbzb a,view_xsjbxx b "
								+ "where a.xxsh='已通过' and a.bzffny='"
								+ bzrqt
								+ "' and b.xydm='"
								+ xydmList[i]
								+ "' and a.xh=b.xh) group by xymc,xydm having xydm is not null";
					}
					String[] temp = dao.getOneRs(sql, new String[] {},
							new String[] { "xymc", "fsbzrs", "fsbzje", "bz" });
					if (temp != null) {
						if (temp[2].equalsIgnoreCase("0")) {
							temp[1] = "0";
							temp[3] = "";
						} else {
							sumRs += Integer.parseInt(temp[1]);
							sumJe += Integer.parseInt(temp[2]);
						}
						if (!"".equalsIgnoreCase(temp[3])
								&& !"0".equalsIgnoreCase(temp[3])) {
							bz = "补发" + temp[3];
						} else {
							bz = " ";
						}
						sql = "select '" + bzrqt + "' 主键,'" + bzrqt
						+ "' bzffny,'" + temp[0] + "' xymc,'" + temp[1]
						+ "' fsbzrs,'" + temp[2] + "' fsbzje,'" + bz
						+ "' bz from dual";
						rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
					} else {
						sql = "select '"
							+ bzrqt
							+ "' 主键,'"
							+ bzrqt
							+ "' bzffny,'"
							+ xymc
							+ "' xymc,'0' fsbzrs,'0' fsbzje,' ' bz from dual";
						rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
					}
				}
				sql = "select '" + bzrqt + "' 主键,'" + bzrqt
				+ "' bzffny,'合计' xymc,'" + sumRs + "' fsbzrs,'" + sumJe
				+ "' fsbzje,' ' bz from dual";
				rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
				request.setAttribute("topTr", topTr);// 发送表头
			} else if ("lsbz".equalsIgnoreCase(bzlx)) {
				colList = new String[] { "主键", "bzffny", "xymc", "lsbzrs",
						"lsbzje", "bz" };
				colListCN = dao.getColumnNameCN(colList, "XSZZ_BZ_QUERY4");
				List topTr = dao.arrayToList(colList, colListCN);
				int sumRs = 0;
				int sumJe = 0;
				String bz = "";
				for (int i = 0; i < xydmList.length; i++) {
					sql = "select distinct xymc from view_njxyzybj where xydm=?";
					String xymc = dao.getOneRs(sql,
							new String[] { xydmList[i] }, "xymc");

					if (xjzt != null && !"".equalsIgnoreCase(xjzt)) {
						sql = "select xymc,count(xydm) lsbzrs,sum(bysfbz) lsbzje,sum(bybfbz) bz from "
								+ "(select a.xh,b.xm,b.xydm,b.xymc,nvl(a.bybfbz,'0') bybfbz,"
								+ "nvl(a.bysfbz,'0') bysfbz,a.bzffny from view_lsbzxx a,view_xsjbxx b "
								+ "where a.xxsh='已通过' and a.bzffny='"
								+ bzrqt
								+ "' and a.xjzt='"
								+ xjzt
								+ "' and a.xh=b.xh and b.xydm='"
								+ xydmList[i]
								+ "') group by xymc,xydm having xydm is not null";
					} else {
						sql = "select xymc,count(xydm) lsbzrs,sum(bysfbz) lsbzje,sum(bybfbz) bz from "
								+ "(select a.xh,b.xm,b.xydm,b.xymc,nvl(a.bybfbz,'0') bybfbz,"
								+ "nvl(a.bysfbz,'0') bysfbz,a.bzffny from view_lsbzxx a,view_xsjbxx b "
								+ "where a.xxsh='已通过' and a.bzffny='"
								+ bzrqt
								+ "' and a.xh=b.xh and b.xydm='"
								+ xydmList[i]
								+ "') group by xymc,xydm having xydm is not null";
					}
					String[] temp = dao.getOneRs(sql, new String[] {},
							new String[] { "xymc", "lsbzrs", "lsbzje", "bz" });
					if (temp != null) {
						if (temp[2].equalsIgnoreCase("0")) {
							temp[1] = "0";
							temp[3] = "";
						} else {
							sumRs += Integer.parseInt(temp[1]);
							sumJe += Integer.parseInt(temp[2]);
						}
						if (!"".equalsIgnoreCase(temp[3])
								&& !"0".equalsIgnoreCase(temp[3])) {
							bz = "补发" + temp[3];
						} else {
							bz = " ";
						}
						sql = "select '" + bzrqt + "' 主键,'" + bzrqt
						+ "' bzffny,'" + temp[0] + "' xymc,'" + temp[1]
						+ "' lsbzrs,'" + temp[2] + "' lsbzje,'" + bz
						+ "' bz from dual";
						rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
					} else {
						sql = "select '"
							+ bzrqt
							+ "' 主键,'"
							+ bzrqt
							+ "' bzffny,'"
							+ xymc
							+ "' xymc,'0' lsbzrs,'0' lsbzje,' ' bz from dual";
						rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
					}
				}
				sql = "select '" + bzrqt + "' 主键,'" + bzrqt
				+ "' bzffny,'合计' xymc,'" + sumRs + "' lsbzrs,'" + sumJe
				+ "' lsbzje,' ' bz from dual";
				rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
				request.setAttribute("topTr", topTr);// 发送表头
			}
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
		} else if ("no4".equalsIgnoreCase(doType)) {
			realTable = table;
			pk = "xh||bzffny";
			if ("fsbz".equalsIgnoreCase(bzlx)) {
				colList = new String[] { "主键", "bzffny", "xh", "xm", "xymc",
						"bjmc", "xjzt", "byyfbz", "bybfbz", "bysfbz" };
				colListCN = dao.getColumnNameCN(colList, "view_fsbzb");
				List topTr = dao.arrayToList(colList, colListCN);
				if (xjzt != null && !"".equalsIgnoreCase(xjzt)) {
					sql = "select "
							+ pk
							+ " 主键,a.bzffny,a.xh,a.xm,a.xymc,a.bjmc,a.xjzt,a.byyfbz,a.bybfbz,a.bysfbz from "
							+ "(select f.bzffny,f.xh,f.xm,f.xymc,f.bjmc,f.xjzt,f.byyfbz,f.bybfbz,f.bysfbz from view_fsbzb f "
							+ "where not exists(select 1 from view_xsjbxx a where a.xh=f.xh) and f.bzffny='"
							+ bzrq4 + "' and f.xymc like '%" + xymc4
							+ "%' and f.xjzt='" + xjzt + "') a";
				} else {
					sql = "select "
						+ pk
						+ " 主键,a.bzffny,a.xh,a.xm,a.xymc,a.bjmc,a.xjzt,a.byyfbz,a.bybfbz,a.bysfbz from "
						+ "(select f.bzffny,f.xh,f.xm,f.xymc,f.bjmc,f.xjzt,f.byyfbz,f.bybfbz,f.bysfbz from view_fsbzb f "
						+ "where not exists(select 1 from view_xsjbxx a where a.xh=f.xh) and f.bzffny='"
						+ bzrq4 + "' and f.xymc like '%" + xymc4
						+ "%') a";
				}
				rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
				request.setAttribute("topTr", topTr);// 发送表头
			} else if ("lsbz".equalsIgnoreCase(bzlx)) {
				colList = new String[] { "主键", "bzffny", "xh", "xymc", "xjzt", "byyfbz",
						"bybfbz", "bysfbz" };
				colListCN = dao.getColumnNameCN(colList, "view_lsbzxx");
				List topTr = dao.arrayToList(colList, colListCN);
				if (xjzt != null && !"".equalsIgnoreCase(xjzt)) {
					sql = "select "
							+ pk
							+ " 主键,a.bzffny,a.xh,a.xm,a.xjzt,a.byyfbz,a.bybfbz,a.bysfbz from "
							+ "(select l.bzffny,l.xh,l.xymc,l.xjzt,l.byyfbz,l.bybfbz,l.bysfbz from view_lsbzxx l "
							+ "where not exists(select 1 from view_xsjbxx a where a.xh=l.xh) and l.bzffny='"
							+ bzrq4 + "' and l.xymc like '%" + xymc4
							+ "%' and l.xjzt='" + xjzt + "') a";
				} else {
					sql = "select "
							+ pk
							+ " 主键,a.bzffny,a.xh,a.xm,a.xjzt,a.byyfbz,a.bybfbz,a.bysfbz from "
							+ "(select l.bzffny,l.xh,l.xymc,l.xjzt,l.byyfbz,l.bybfbz,l.bysfbz from view_lsbzxx l "
							+ "where not exists(select 1 from view_xsjbxx a where a.xh=l.xh) and l.bzffny='"
							+ bzrq4 + "' and l.xymc like '%" + xymc4 + "%') a";
				}
				rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
				request.setAttribute("topTr", topTr);// 发送表头
			}
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
		}

		sql = "select xjzt from bjlh_xszz_xjzt ";
		List xjztList = dao.getList(sql, new String[] {}, new String[] {
				"xjzt" });
		request.setAttribute("xjztList", xjztList);
		request.setAttribute("rs1", map);
		request.setAttribute("xxmc", xxmc);// 取学校名称信息
		request.setAttribute("writeAble", writeAble);// 发送读写权限
		request.setAttribute("tableName", tableName);// 发送视图名
		request.setAttribute("realTable", realTable);// 发送数据源表名
		request.setAttribute("pk", pk);// 发送数据源表主键
		request.setAttribute("xyList", dao.getXyList());// 发送学院列表
		request.setAttribute("rs", rs);// 发送数据集
		request.setAttribute("rsNum", rsNum);// 发送记录数
		request.setAttribute("userType", userType);

		return mapping.findForward("success");
	}

	private ActionForward xnmz_lstd(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String sqlb = "";
		sqlb = "西南民族大学绿色通道";

		String xm = DealString.toGBK(request.getParameter("xm").toString());
		String xb = DealString.toGBK(request.getParameter("xb").toString());
		String nj = DealString.toGBK(request.getParameter("nj").toString());
		String xymc = DealString.toGBK(request.getParameter("xymc").toString());
		String xmc = DealString.toGBK(request.getParameter("xmc").toString());
		String mzmc = DealString.toGBK(request.getParameter("mzmc").toString());

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xm, xb, xymc, xmc, mzmc, nj };
		String[] outString = new String[] { "xm", "xb", "xymc", "xmc", "mzmc",
		"nj" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward zjys_dkxx(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {

		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		XszzForm xszzform = (XszzForm) form;
		String userSpecType = session.getAttribute("userType").toString();
		String userDep = session.getAttribute("userDep").toString();
		String tips = "学生资助 - 贷款系统 - 贷款信息";
		String tableName = "VIEW_ZJYS_DKXX";
		String realTable = "zjys_dkxt";
		String pk = "xh";
		String xydm = request.getParameter("xydm");
		String zydm = request.getParameter("zydm");
		String bjdm = request.getParameter("bjdm");
		String xh = request.getParameter("xh");
		StringBuffer querry = new StringBuffer();
		Vector<Object> rs = new Vector<Object>();
		String[] colList = { "主键", "行号", "xh", "xm", "xb", "sfzh", "xymc",
				"zymc", "bjmc", "dkze", "dknx" };
		String[] colListCN = null;
		String rsNum = "";
		String sql = "";
		querry.append(" where 1=1 ");

		String userType = dao.getUserType(userDep);
		if (userType.equalsIgnoreCase("xx")) {
			request.setAttribute("isXX", "is");
		} else {
			request.setAttribute("isXX", "no");
		}

		if (userSpecType.equalsIgnoreCase("xy")) {
			xydm = userDep;
			xszzform.setXydm(xydm);
		}

		if ("".equalsIgnoreCase(xydm) || xydm == null) {
			querry.append("and 1=1 ");
		} else {
			querry.append("and xydm='");
			querry.append(xydm);
			querry.append("' ");
		}

		if ("".equalsIgnoreCase(zydm) || zydm == null) {
			querry.append("and 1=1 ");
		} else {
			querry.append("and zydm='");
			querry.append(zydm);
			querry.append("' ");
		}

		if ("".equalsIgnoreCase(bjdm) || bjdm == null) {
			querry.append("and 1=1 ");
		} else {
			querry.append("and bjdm='");
			querry.append(bjdm);
			querry.append("' ");
		}

		if ("".equalsIgnoreCase(xh) || xh == null) {
			querry.append("and 1=1 ");
		} else {
			if (Check_Input_Value.check2(xh)) {
				querry.append("and xh like '%");
				querry.append(xh);
				querry.append("%'");
			}
		}

		sql = "select "
			+ pk
			+ " 主键,rownum 行号,xh,xm,xb,sfzh,mzmc,xydm,xymc,zydm,zymc,bjdm,"
			+ "bjmc,rxnf,bynf,jtzz,yzbm,yxlxdh,fqxm,fqgzdw,fqlxdh,mqxm,mqgzdw,"
			+ "mqlxdh,jzr1,jzr2,dkze,dknx,ht1_hth,ht1_jbjrjg,ht1_pzrq,ht1_zje,"
			+ "ht1_jby,ht1_pzhz,ht1_hkkssj,ht1_hkjzsj,ht1_hkjzmc,ht1_hkjzzh,"
			+ "ht2_hth,ht2_jbjrjg,ht2_pzrq,ht2_zje,ht2_jby,ht2_pzhz,ht2_hkkssj,"
			+ "ht2_hkjzsj,ht2_hkjzmc,ht2_hkjzzh,ht3_hth,ht3_jbjrjg,ht3_pzrq,"
			+ "ht3_zje,ht3_jby,ht3_pzhz,ht3_hkkssj,ht3_hkjzsj,ht3_hkjzmc,"
			+ "ht3_hkjzzh,ht4_hth,ht4_jbjrjg,ht4_pzrq,ht4_zje,ht4_jby,ht4_pzhz,"
			+ "ht4_hkkssj,ht4_hkjzsj,ht4_hkjzmc,ht4_hkjzzh from "
			+ tableName + querry.toString();

		colListCN = dao.getColumnNameCN(colList, tableName);
		List topTr = dao.arrayToList(colList, colListCN);
		if ((request.getParameter("go") != null)
				&& request.getParameter("go").equalsIgnoreCase("go")) {
			rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
		}

		xydm = xydm==null ? "":xydm;
		zydm = zydm==null ? "":zydm;
		String bjKey = xydm+"!!"+zydm+"!!";
		request.setAttribute("act", " ");
		request.setAttribute("pk", pk);
		request.setAttribute("tips", tips);
		request.setAttribute("realTable", realTable);
		request.setAttribute("tableName", tableName);
		request.setAttribute("xyList", Base.getXyList());// 发送学院列表
		request.setAttribute("zyList", Base.getZyMap().get(xydm));// 发送专业列表
		request.setAttribute("bjList", Base.getBjMap().get(bjKey));// 发送班级列表
		request.setAttribute("topTr", topTr);
		request.setAttribute("rsNum", rsNum);
		request.setAttribute("rs", rs);
		request.setAttribute("userType", userSpecType);
		return mapping.findForward("success");
	}

	private ActionForward zjys_dkxx_info(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {

		String userType;

		String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String doType = request.getParameter("doType");// 操作类型
		String pkValue = request.getParameter("pkValue");
		userType = dao.getUserType(userDep);

		String sql = "";
		String[] outString = new String[] {};
		sql = "select * from VIEW_ZJYS_DKXX where 1=2";
		outString = dao.getColumnName(sql);
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String xh = "";
		String pk = "xh";
		if (userType.equalsIgnoreCase("xx")) {
			request.setAttribute("isXX", "is");
		} else {
			request.setAttribute("isXX", "no");
		}
		if (doType == null) {
			doType = "";
		}
		if (pk == null) {
			pk = "";
		}
		request.setAttribute("pkValue", pkValue);
		request.setAttribute("doType", doType);
		xh = xszzForm.getXh();
		boolean ok = false;

		if (doType != null && doType.equalsIgnoreCase("del")) {
			ok = StandardOperation.delete("zjys_dkxt", pk, pkValue, request);
			if(ok){
				logMsg = "删除 zjys_dkxt";
				Base.log(request, logMsg, sUName);
			}
			ActionForward newFwd = new ActionForward("/zjys_dkxx.do?go=go",
					false);
			return newFwd;
		}

		if (doType != null && doType.equalsIgnoreCase("save")) {
			xh = DealString.toGBK(request.getParameter("xh").toString());
			String mzmc = DealString.toGBK(request.getParameter("mzmc")
					.toString());
			String rxnf = DealString.toGBK(request.getParameter("rxnf")
					.toString());
			String bynf = DealString.toGBK(request.getParameter("bynf")
					.toString());
			String jtzz = DealString.toGBK(request.getParameter("jtzz")
					.toString());
			String yzbm = DealString.toGBK(request.getParameter("yzbm")
					.toString());
			String yxlxdh = DealString.toGBK(request.getParameter("yxlxdh")
					.toString());
			String fqxm = DealString.toGBK(request.getParameter("fqxm")
					.toString());
			String fqgzdw = DealString.toGBK(request.getParameter("fqgzdw")
					.toString());
			String fqlxdh = DealString.toGBK(request.getParameter("fqlxdh")
					.toString());
			String mqxm = DealString.toGBK(request.getParameter("mqxm")
					.toString());
			String mqgzdw = DealString.toGBK(request.getParameter("mqgzdw")
					.toString());
			String mqlxdh = DealString.toGBK(request.getParameter("mqlxdh")
					.toString());
			String jzr1 = DealString.toGBK(request.getParameter("jzr1")
					.toString());
			String jzr2 = DealString.toGBK(request.getParameter("jzr2")
					.toString());
			String dkze = DealString.toGBK(request.getParameter("dkze")
					.toString());
			String dknx = DealString.toGBK(request.getParameter("dknx")
					.toString());
			String ht1_hth = DealString.toGBK(request.getParameter("ht1_hth")
					.toString());
			String ht1_jbjrjg = DealString.toGBK(request.getParameter(
			"ht1_jbjrjg").toString());
			String ht1_pzrq = DealString.toGBK(request.getParameter("ht1_pzrq")
					.toString());
			String ht1_zje = DealString.toGBK(request.getParameter("ht1_zje")
					.toString());
			String ht1_jby = DealString.toGBK(request.getParameter("ht1_jby")
					.toString());
			String ht1_pzhz = DealString.toGBK(request.getParameter("ht1_pzhz")
					.toString());
			String ht1_hkkssj = DealString.toGBK(request.getParameter(
			"ht1_hkkssj").toString());
			String ht1_hkjzsj = DealString.toGBK(request.getParameter(
			"ht1_hkjzsj").toString());
			String ht1_hkjzmc = DealString.toGBK(request.getParameter(
			"ht1_hkjzmc").toString());
			String ht1_hkjzzh = DealString.toGBK(request.getParameter(
			"ht1_hkjzzh").toString());
			String ht2_hth = DealString.toGBK(request.getParameter("ht2_hth")
					.toString());
			String ht2_jbjrjg = DealString.toGBK(request.getParameter(
			"ht2_jbjrjg").toString());
			String ht2_pzrq = DealString.toGBK(request.getParameter("ht2_pzrq")
					.toString());
			String ht2_zje = DealString.toGBK(request.getParameter("ht2_zje")
					.toString());
			String ht2_jby = DealString.toGBK(request.getParameter("ht2_jby")
					.toString());
			String ht2_pzhz = DealString.toGBK(request.getParameter("ht2_pzhz")
					.toString());
			String ht2_hkkssj = DealString.toGBK(request.getParameter(
			"ht2_hkkssj").toString());
			String ht2_hkjzsj = DealString.toGBK(request.getParameter(
			"ht2_hkjzsj").toString());
			String ht2_hkjzmc = DealString.toGBK(request.getParameter(
			"ht2_hkjzmc").toString());
			String ht2_hkjzzh = DealString.toGBK(request.getParameter(
			"ht2_hkjzzh").toString());
			String ht3_hth = DealString.toGBK(request.getParameter("ht3_hth")
					.toString());
			String ht3_jbjrjg = DealString.toGBK(request.getParameter(
			"ht3_jbjrjg").toString());
			String ht3_pzrq = DealString.toGBK(request.getParameter("ht3_pzrq")
					.toString());
			String ht3_zje = DealString.toGBK(request.getParameter("ht3_zje")
					.toString());
			String ht3_jby = DealString.toGBK(request.getParameter("ht3_jby")
					.toString());
			String ht3_pzhz = DealString.toGBK(request.getParameter("ht3_pzhz")
					.toString());
			String ht3_hkkssj = DealString.toGBK(request.getParameter(
			"ht3_hkkssj").toString());
			String ht3_hkjzsj = DealString.toGBK(request.getParameter(
			"ht3_hkjzsj").toString());
			String ht3_hkjzmc = DealString.toGBK(request.getParameter(
			"ht3_hkjzmc").toString());
			String ht3_hkjzzh = DealString.toGBK(request.getParameter(
			"ht3_hkjzzh").toString());
			String ht4_hth = DealString.toGBK(request.getParameter("ht4_hth")
					.toString());
			String ht4_jbjrjg = DealString.toGBK(request.getParameter(
			"ht4_jbjrjg").toString());
			String ht4_pzrq = DealString.toGBK(request.getParameter("ht4_pzrq")
					.toString());
			String ht4_zje = DealString.toGBK(request.getParameter("ht4_zje")
					.toString());
			String ht4_jby = DealString.toGBK(request.getParameter("ht4_jby")
					.toString());
			String ht4_pzhz = DealString.toGBK(request.getParameter("ht4_pzhz")
					.toString());
			String ht4_hkkssj = DealString.toGBK(request.getParameter(
			"ht4_hkkssj").toString());
			String ht4_hkjzsj = DealString.toGBK(request.getParameter(
			"ht4_hkjzsj").toString());
			String ht4_hkjzmc = DealString.toGBK(request.getParameter(
			"ht4_hkjzmc").toString());
			String ht4_hkjzzh = DealString.toGBK(request.getParameter(
			"ht4_hkjzzh").toString());

			if (Base.isNull(pkValue)) {
				StandardOperation.delete("zjys_dkxt", "xh", xh, request);
			} else {
				StandardOperation.delete("zjys_dkxt", pk, pkValue, request);
			}

			String[] colName1 = new String[] { "xh", "mzmc", "rxnf", "bynf",
					"jtzz", "yzbm", "yxlxdh", "fqxm", "fqgzdw", "fqlxdh",
					"mqxm", "mqgzdw", "mqlxdh", "jzr1", "jzr2", "dkze", "dknx",
					"ht1_hth", "ht1_jbjrjg", "ht1_pzrq", "ht1_zje", "ht1_jby",
					"ht1_pzhz", "ht1_hkkssj", "ht1_hkjzsj", "ht1_hkjzmc",
					"ht1_hkjzzh", "ht2_hth", "ht2_jbjrjg", "ht2_pzrq",
					"ht2_zje", "ht2_jby", "ht2_pzhz", "ht2_hkkssj",
					"ht2_hkjzsj", "ht2_hkjzmc", "ht2_hkjzzh", "ht3_hth",
					"ht3_jbjrjg", "ht3_pzrq", "ht3_zje", "ht3_jby", "ht3_pzhz",
					"ht3_hkkssj", "ht3_hkjzsj", "ht3_hkjzmc", "ht3_hkjzzh",
					"ht4_hth", "ht4_jbjrjg", "ht4_pzrq", "ht4_zje", "ht4_jby",
					"ht4_pzhz", "ht4_hkkssj", "ht4_hkjzsj", "ht4_hkjzmc",
					"ht4_hkjzzh" };
			String[] valueForOut = new String[] { xh, mzmc, rxnf, bynf, jtzz,
					yzbm, yxlxdh, fqxm, fqgzdw, fqlxdh, mqxm, mqgzdw, mqlxdh,
					jzr1, jzr2, dkze, dknx, ht1_hth, ht1_jbjrjg, ht1_pzrq,
					ht1_zje, ht1_jby, ht1_pzhz, ht1_hkkssj, ht1_hkjzsj,
					ht1_hkjzmc, ht1_hkjzzh, ht2_hth, ht2_jbjrjg, ht2_pzrq,
					ht2_zje, ht2_jby, ht2_pzhz, ht2_hkkssj, ht2_hkjzsj,
					ht2_hkjzmc, ht2_hkjzzh, ht3_hth, ht3_jbjrjg, ht3_pzrq,
					ht3_zje, ht3_jby, ht3_pzhz, ht3_hkkssj, ht3_hkjzsj,
					ht3_hkjzmc, ht3_hkjzzh, ht4_hth, ht4_jbjrjg, ht4_pzrq,
					ht4_zje, ht4_jby, ht4_pzhz, ht4_hkkssj, ht4_hkjzsj,
					ht4_hkjzmc, ht4_hkjzzh };
			ok = StandardOperation.insert("zjys_dkxt", colName1, valueForOut,
					request);

			if (ok) {
				logMsg = "添加 zjys_dkxt";
				Base.log(request, logMsg, sUName);
				request.setAttribute("ok", "ok");
			} else {
				request.setAttribute("ok", "no");
			}
		}

		outString = new String[] { "xh", "xm", "xb", "sfzh", "mzmc", "xydm",
				"xymc", "zydm", "zymc", "bjdm", "bjmc", "rxnf", "bynf", "jtzz",
				"yzbm", "yxlxdh", "fqxm", "fqgzdw", "fqlxdh", "mqxm", "mqgzdw",
				"mqlxdh", "jzr1", "jzr2", "dkze", "dknx", "ht1_hth",
				"ht1_jbjrjg", "ht1_pzrq", "ht1_zje", "ht1_jby", "ht1_pzhz",
				"ht1_hkkssj", "ht1_hkjzsj", "ht1_hkjzmc", "ht1_hkjzzh",
				"ht2_hth", "ht2_jbjrjg", "ht2_pzrq", "ht2_zje", "ht2_jby",
				"ht2_pzhz", "ht2_hkkssj", "ht2_hkjzsj", "ht2_hkjzmc",
				"ht2_hkjzzh", "ht3_hth", "ht3_jbjrjg", "ht3_pzrq", "ht3_zje",
				"ht3_jby", "ht3_pzhz", "ht3_hkkssj", "ht3_hkjzsj",
				"ht3_hkjzmc", "ht3_hkjzzh", "ht4_hth", "ht4_jbjrjg",
				"ht4_pzrq", "ht4_zje", "ht4_jby", "ht4_pzhz", "ht4_hkkssj",
				"ht4_hkjzsj", "ht4_hkjzmc", "ht4_hkjzzh" };

		sql = "select xh,xm,xb,sfzh,mzmc,xydm,xymc,zydm,zymc,bjdm,bjmc,rxnf,bynf,jtzz,yzbm,"
			+ "yxlxdh,fqxm,fqgzdw,fqlxdh,mqxm,mqgzdw,mqlxdh,jzr1,jzr2,dkze,dknx,ht1_hth,"
			+ "ht1_jbjrjg,ht1_pzrq,ht1_zje,ht1_jby,ht1_pzhz,ht1_hkkssj,ht1_hkjzsj,ht1_hkjzmc,"
			+ "ht1_hkjzzh,ht2_hth,ht2_jbjrjg,ht2_pzrq,ht2_zje,ht2_jby,ht2_pzhz,ht2_hkkssj,"
			+ "ht2_hkjzsj,ht2_hkjzmc,ht2_hkjzzh,ht3_hth,ht3_jbjrjg,ht3_pzrq,ht3_zje,ht3_jby,"
			+ "ht3_pzhz,ht3_hkkssj,ht3_hkjzsj,ht3_hkjzmc,ht3_hkjzzh,ht4_hth,ht4_jbjrjg,ht4_pzrq,"
			+ "ht4_zje,ht4_jby,ht4_pzhz,ht4_hkkssj,ht4_hkjzsj,ht4_hkjzmc,ht4_hkjzzh from "
			+ "VIEW_ZJYS_DKXX where xh=?";
		outValue = dao.getOneRs(sql, new String[] { pkValue }, outString);

		if (outValue == null) {
			if (xh != null) {
				sql = "select a.xh,a.xm,a.xb,a.sfzh,a.xymc,a.zymc,a.bjmc from view_xsjbxx a where a.xh=?";
				String[] colName = new String[] { "xh", "xm", "xb", "sfzh",
						"xymc", "zymc", "bjmc" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {
				} else {
					colName = new String[] { "xh", "xm", "xb", "sfzh", "xymc",
							"zymc", "bjmc" };
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward jsxx_gjzxdk(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		// String xxmc = ToolClass.getXxmc();;
		String doType = request.getParameter("doType");// 操作类型
		String titName = request.getParameter("titName");

		String sfksq = "-1";// 国家奖学金是否可申请参数，-1表示不可以，1表示可以。

		String[] pages = null;
		String[] titNames = null;
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		pages = new String[] { "国家助学贷款" };
		titNames = new String[] { "jsxx_gjzxdk" };

		if (titName == null)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		List pagesList = dao.arrayToList(titNames, pages);
		request.setAttribute("pages", pagesList);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间
		String[] outString = new String[] {};
		sql = "select xh,nd,xm,xb,sfzh,csrq,xydm,"
			+ "xymc,zydm,zymc,bjdm,bjmc,jtzz,xslxdh,"
			+ "jtcy1_xm,jtcy1_nl,jtcy1_gzdwjzw,jtcy1_nsr,"
			+ "jtcy2_xm,jtcy2_nl,jtcy2_gzdwjzw,jtcy2_nsr,"
			+ "jtcy3_xm,jtcy3_nl,jtcy3_gzdwjzw,jtcy3_nsr,"
			+ "jtcy4_xm,jtcy4_nl,jtcy4_gzdwjzw,jtcy4_nsr,"
			+ "jtcy5_xm,jtcy5_nl,jtcy5_gzdwjzw,jtcy5_nsr,"
			+ "rxcj,sxqpm,pjcj,rcbx,jcqk,jtjjknzk,xnxf,"
			+ "jtfybzs,hjxf,bxqdks,jhhkkssj,jhhkjssj,sqsj,"
			+ "bz,xysh,xyshyj,xxsh,xxshyj from VIEW_JSXX_GJZXDK where 1=2";
		outString = dao.getColumnName(sql);// 获得view_xsjxjzxjsq的列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
		String xh = "";
		String pkVal = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;

			sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='国家助学贷款' and b.xh=? ";
			jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
					"kssj", "jssj" });
			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String sfzh = DealString.toGBK(request.getParameter("sfzh")
							.toString());
					String jtzz = DealString.toGBK(request.getParameter("jtzz")
							.toString());
					String xslxdh = DealString.toGBK(request.getParameter(
					"xslxdh").toString());
					String jtcy1_xm = DealString.toGBK(request.getParameter(
					"jtcy1_xm").toString());
					String jtcy1_nl = DealString.toGBK(request.getParameter(
					"jtcy1_nl").toString());
					String jtcy1_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy1_gzdwjzw").toString());
					String jtcy1_nsr = DealString.toGBK(request.getParameter(
					"jtcy1_nsr").toString());
					String jtcy2_xm = DealString.toGBK(request.getParameter(
					"jtcy2_xm").toString());
					String jtcy2_nl = DealString.toGBK(request.getParameter(
					"jtcy2_nl").toString());
					String jtcy2_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy2_gzdwjzw").toString());
					String jtcy2_nsr = DealString.toGBK(request.getParameter(
					"jtcy2_nsr").toString());
					String jtcy3_xm = DealString.toGBK(request.getParameter(
					"jtcy3_xm").toString());
					String jtcy3_nl = DealString.toGBK(request.getParameter(
					"jtcy3_nl").toString());
					String jtcy3_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy3_gzdwjzw").toString());
					String jtcy3_nsr = DealString.toGBK(request.getParameter(
					"jtcy3_nsr").toString());
					String jtcy4_xm = DealString.toGBK(request.getParameter(
					"jtcy4_xm").toString());
					String jtcy4_nl = DealString.toGBK(request.getParameter(
					"jtcy4_nl").toString());
					String jtcy4_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy4_gzdwjzw").toString());
					String jtcy4_nsr = DealString.toGBK(request.getParameter(
					"jtcy4_nsr").toString());
					String jtcy5_xm = DealString.toGBK(request.getParameter(
					"jtcy5_xm").toString());
					String jtcy5_nl = DealString.toGBK(request.getParameter(
					"jtcy5_nl").toString());
					String jtcy5_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy5_gzdwjzw").toString());
					String jtcy5_nsr = DealString.toGBK(request.getParameter(
					"jtcy5_nsr").toString());
					String rxcj = DealString.toGBK(request.getParameter("rxcj")
							.toString());
					String sxqpm = DealString.toGBK(request.getParameter(
					"sxqpm").toString());
					String pjcj = DealString.toGBK(request.getParameter("pjcj")
							.toString());
					String rcbx = DealString.toGBK(request.getParameter("rcbx")
							);
					String jcqk = DealString.toGBK(request.getParameter("jcqk")
							);
					String jtjjknzk = DealString.toGBK(request.getParameter(
					"jtjjknzk"));
					String xnxf = DealString.toGBK(request.getParameter("xnxf")
							.toString());
					String jtfybzs = DealString.toGBK(request.getParameter(
					"jtfybzs").toString());
					String hjxf = DealString.toGBK(request.getParameter("hjxf")
							.toString());
					String bxqdks = DealString.toGBK(request.getParameter(
					"bxqdks").toString());
					String jhhkkssj = DealString.toGBK(request.getParameter(
					"jhhkkssj").toString());
					String jhhkjssj = DealString.toGBK(request.getParameter(
					"jhhkjssj").toString());
					String bz = DealString.toGBK(request.getParameter("bz")
							);
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}

					sql = "select xysh from jsxx_gjzxdk where xh||nd=?";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xysh" });

					if ((temp != null) && temp[0].equalsIgnoreCase("通过")) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("jsxx_gjzxdk", "xh||nd", pkVal, request);

						String[] colName1 = new String[] { "xh", "nd", "jtzz",
								"xslxdh", "sfzh", "jtcy1_xm", "jtcy1_nl",
								"jtcy1_gzdwjzw", "jtcy1_nsr", "jtcy2_xm",
								"jtcy2_nl", "jtcy2_gzdwjzw", "jtcy2_nsr",
								"jtcy3_xm", "jtcy3_nl", "jtcy3_gzdwjzw",
								"jtcy3_nsr", "jtcy4_xm", "jtcy4_nl",
								"jtcy4_gzdwjzw", "jtcy4_nsr", "jtcy5_xm",
								"jtcy5_nl", "jtcy5_gzdwjzw", "jtcy5_nsr",
								"rxcj", "sxqpm", "pjcj", "rcbx", "jcqk",
								"jtjjknzk", "xnxf", "jtfybzs", "hjxf",
								"bxqdks", "jhhkkssj", "jhhkjssj", "bz" };

						String[] valueForOut = new String[] { xh, nd, jtzz,
								xslxdh, sfzh, jtcy1_xm, jtcy1_nl,
								jtcy1_gzdwjzw, jtcy1_nsr, jtcy2_xm, jtcy2_nl,
								jtcy2_gzdwjzw, jtcy2_nsr, jtcy3_xm, jtcy3_nl,
								jtcy3_gzdwjzw, jtcy3_nsr, jtcy4_xm, jtcy4_nl,
								jtcy4_gzdwjzw, jtcy4_nsr, jtcy5_xm, jtcy5_nl,
								jtcy5_gzdwjzw, jtcy5_nsr, rxcj, sxqpm, pjcj,
								rcbx, jcqk, jtjjknzk, xnxf, jtfybzs, hjxf,
								bxqdks, jhhkkssj, jhhkjssj, bz };

						boolean ok = false;
						ok = StandardOperation.insert("jsxx_gjzxdk",
								colName1, valueForOut, request);

						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String sfzh = DealString.toGBK(request.getParameter("sfzh")
						.toString());
				String jtzz = DealString.toGBK(request.getParameter("jtzz")
						.toString());
				String xslxdh = DealString.toGBK(request.getParameter("xslxdh")
						.toString());
				String jtcy1_xm = DealString.toGBK(request.getParameter(
				"jtcy1_xm").toString());
				String jtcy1_nl = DealString.toGBK(request.getParameter(
				"jtcy1_nl").toString());
				String jtcy1_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy1_gzdwjzw").toString());
				String jtcy1_nsr = DealString.toGBK(request.getParameter(
				"jtcy1_nsr").toString());
				String jtcy2_xm = DealString.toGBK(request.getParameter(
				"jtcy2_xm").toString());
				String jtcy2_nl = DealString.toGBK(request.getParameter(
				"jtcy2_nl").toString());
				String jtcy2_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy2_gzdwjzw").toString());
				String jtcy2_nsr = DealString.toGBK(request.getParameter(
				"jtcy2_nsr").toString());
				String jtcy3_xm = DealString.toGBK(request.getParameter(
				"jtcy3_xm").toString());
				String jtcy3_nl = DealString.toGBK(request.getParameter(
				"jtcy3_nl").toString());
				String jtcy3_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy3_gzdwjzw").toString());
				String jtcy3_nsr = DealString.toGBK(request.getParameter(
				"jtcy3_nsr").toString());
				String jtcy4_xm = DealString.toGBK(request.getParameter(
				"jtcy4_xm").toString());
				String jtcy4_nl = DealString.toGBK(request.getParameter(
				"jtcy4_nl").toString());
				String jtcy4_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy4_gzdwjzw").toString());
				String jtcy4_nsr = DealString.toGBK(request.getParameter(
				"jtcy4_nsr").toString());
				String jtcy5_xm = DealString.toGBK(request.getParameter(
				"jtcy5_xm").toString());
				String jtcy5_nl = DealString.toGBK(request.getParameter(
				"jtcy5_nl").toString());
				String jtcy5_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy5_gzdwjzw").toString());
				String jtcy5_nsr = DealString.toGBK(request.getParameter(
				"jtcy5_nsr").toString());
				String rxcj = DealString.toGBK(request.getParameter("rxcj")
						.toString());
				String sxqpm = DealString.toGBK(request.getParameter("sxqpm")
						.toString());
				String pjcj = DealString.toGBK(request.getParameter("pjcj")
						.toString());
				String rcbx = DealString.toGBK(request.getParameter("rcbx")
						);
				String jcqk = DealString.toGBK(request.getParameter("jcqk")
						);
				String jtjjknzk = DealString.toGBK(request.getParameter(
				"jtjjknzk"));
				String xnxf = DealString.toGBK(request.getParameter("xnxf")
						.toString());
				String jtfybzs = DealString.toGBK(request.getParameter(
				"jtfybzs").toString());
				String hjxf = DealString.toGBK(request.getParameter("hjxf")
						.toString());
				String bxqdks = DealString.toGBK(request.getParameter("bxqdks")
						.toString());
				String jhhkkssj = DealString.toGBK(request.getParameter(
				"jhhkkssj").toString());
				String jhhkjssj = DealString.toGBK(request.getParameter(
				"jhhkjssj").toString());
				String bz = DealString.toGBK(request.getParameter("bz"));
				pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = xh + nd;
				}

				sql = "select xysh from jsxx_gjzxdk where xh||nd=?";
				String[] temp = dao.getOneRs(sql, new String[] { pkVal },
						new String[] { "xysh" });

				if ((temp != null) && temp[0].equalsIgnoreCase("通过")) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("jsxx_gjzxdk", "xh||nd", pkVal, request);

					String[] colName1 = new String[] { "xh", "nd", "jtzz",
							"xslxdh", "sfzh", "jtcy1_xm", "jtcy1_nl",
							"jtcy1_gzdwjzw", "jtcy1_nsr", "jtcy2_xm",
							"jtcy2_nl", "jtcy2_gzdwjzw", "jtcy2_nsr",
							"jtcy3_xm", "jtcy3_nl", "jtcy3_gzdwjzw",
							"jtcy3_nsr", "jtcy4_xm", "jtcy4_nl",
							"jtcy4_gzdwjzw", "jtcy4_nsr", "jtcy5_xm",
							"jtcy5_nl", "jtcy5_gzdwjzw", "jtcy5_nsr",
							"rxcj", "sxqpm", "pjcj", "rcbx", "jcqk",
							"jtjjknzk", "xnxf", "jtfybzs", "hjxf",
							"bxqdks", "jhhkkssj", "jhhkjssj", "bz" };

					String[] valueForOut = new String[] { xh, nd, jtzz,
							xslxdh, sfzh, jtcy1_xm, jtcy1_nl,
							jtcy1_gzdwjzw, jtcy1_nsr, jtcy2_xm, jtcy2_nl,
							jtcy2_gzdwjzw, jtcy2_nsr, jtcy3_xm, jtcy3_nl,
							jtcy3_gzdwjzw, jtcy3_nsr, jtcy4_xm, jtcy4_nl,
							jtcy4_gzdwjzw, jtcy4_nsr, jtcy5_xm, jtcy5_nl,
							jtcy5_gzdwjzw, jtcy5_nsr, rxcj, sxqpm, pjcj,
							rcbx, jcqk, jtjjknzk, xnxf, jtfybzs, hjxf,
							bxqdks, jhhkkssj, jhhkjssj, bz };

					boolean ok = false;
					ok = StandardOperation.insert("jsxx_gjzxdk",
							colName1, valueForOut, request);

					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		}

		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd;
		}
		outString = new String[] { "xh", "xm", "xb", "xymc", "zymc", "bjmc",
				"csrq", "nd", "jtzz", "xslxdh", "sfzh", "jtcy1_xm", "jtcy1_nl",
				"jtcy1_gzdwjzw", "jtcy1_nsr", "jtcy2_xm", "jtcy2_nl",
				"jtcy2_gzdwjzw", "jtcy2_nsr", "jtcy3_xm", "jtcy3_nl",
				"jtcy3_gzdwjzw", "jtcy3_nsr", "jtcy4_xm", "jtcy4_nl",
				"jtcy4_gzdwjzw", "jtcy4_nsr", "jtcy5_xm", "jtcy5_nl",
				"jtcy5_gzdwjzw", "jtcy5_nsr", "rxcj", "sxqpm", "pjcj", "rcbx",
				"jcqk", "jtjjknzk", "xnxf", "jtfybzs", "hjxf", "bxqdks",
				"jhhkkssj", "jhhkjssj", "bz", "xysh", "xyshyj", "xxsh",
				"xxshyj", "sqsj" };

		sql = "select xh,xm,xb,xymc,zymc,bjmc,csrq,nd,jtzz,xslxdh,sfzh,"
			+ "jtcy1_xm,jtcy1_nl,jtcy1_gzdwjzw,jtcy1_nsr,"
			+ "jtcy2_xm,jtcy2_nl,jtcy2_gzdwjzw,jtcy2_nsr,"
			+ "jtcy3_xm,jtcy3_nl,jtcy3_gzdwjzw,jtcy3_nsr,"
			+ "jtcy4_xm,jtcy4_nl,jtcy4_gzdwjzw,jtcy4_nsr,"
			+ "jtcy5_xm,jtcy5_nl,jtcy5_gzdwjzw,jtcy5_nsr,"
			+ "rxcj,sxqpm,pjcj,rcbx,jcqk,jtjjknzk,xnxf,"
			+ "jtfybzs,hjxf,bxqdks,jhhkkssj,jhhkjssj,bz,"
			+ "xysh,xyshyj,xxsh,xxshyj,sqsj from view_jsxx_gjzxdk where xh||nd=?";
		outValue = dao.getOneRs(sql, new String[] { pkVal }, outString);

		if (outValue == null) {
			if (xh != null) {
				sql = "select a.xh,a.xm,a.xb,a.sfzh,a.xymc,a.zymc,a.bjmc,b.csrq from "
					+ "view_xsjbxx a,view_stu_details b where a.xh=b.xh and a.xh=?";
				String[] colName = new String[] { "xh", "xm", "xb", "sfzh",
						"xymc", "zymc", "bjmc", "csrq" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {

				} else {
					colName = new String[] { "xh", "xm", "xb", "sfzh", "xymc",
							"zymc", "bjmc", "csrq" };
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward jsxx_gjzxdksqb(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) {
		String sqlb = "";
		sqlb = "江苏信息职业技术学院";

		String xh = DealString.toGBK(request.getParameter("xh").toString());
		String xm = DealString.toGBK(request.getParameter("xm").toString());
		String xb = DealString.toGBK(request.getParameter("xb").toString());
		String xymc = DealString.toGBK(request.getParameter("xymc").toString());
		String zymc = DealString.toGBK(request.getParameter("zymc").toString());
		String csrq = DealString.toGBK(request.getParameter("csrq").toString());
		String sfzh = DealString.toGBK(request.getParameter("sfzh").toString());
		String bjmc = DealString.toGBK(request.getParameter("bjmc").toString());
		String xslxdh = DealString.toGBK(request.getParameter("xslxdh")
				.toString());
		String rxcj = DealString.toGBK(request.getParameter("rxcj").toString());
		String sxqpm = DealString.toGBK(request.getParameter("sxqpm")
				.toString());
		String pjcj = DealString.toGBK(request.getParameter("pjcj").toString());
		String jtzz = DealString.toGBK(request.getParameter("jtzz"));
		String jtcy1_xm = DealString.toGBK(request.getParameter("jtcy1_xm")
				.toString());
		String jtcy1_nl = DealString.toGBK(request.getParameter("jtcy1_nl")
				.toString());
		String jtcy1_nsr = DealString.toGBK(request.getParameter("jtcy1_nsr")
				.toString());
		String jtcy1_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy1_gzdwjzw").toString());
		String jtcy2_xm = DealString.toGBK(request.getParameter("jtcy2_xm")
				.toString());
		String jtcy2_nl = DealString.toGBK(request.getParameter("jtcy2_nl")
				.toString());
		String jtcy2_nsr = DealString.toGBK(request.getParameter("jtcy2_nsr")
				.toString());
		String jtcy2_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy2_gzdwjzw").toString());
		String jtcy3_xm = DealString.toGBK(request.getParameter("jtcy3_xm")
				.toString());
		String jtcy3_nl = DealString.toGBK(request.getParameter("jtcy3_nl")
				.toString());
		String jtcy3_nsr = DealString.toGBK(request.getParameter("jtcy3_nsr")
				.toString());
		String jtcy3_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy3_gzdwjzw").toString());
		String jtcy4_xm = DealString.toGBK(request.getParameter("jtcy4_xm")
				.toString());
		String jtcy4_nl = DealString.toGBK(request.getParameter("jtcy4_nl")
				.toString());
		String jtcy4_nsr = DealString.toGBK(request.getParameter("jtcy4_nsr")
				.toString());
		String jtcy4_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy4_gzdwjzw").toString());
		String jtcy5_xm = DealString.toGBK(request.getParameter("jtcy5_xm")
				.toString());
		String jtcy5_nl = DealString.toGBK(request.getParameter("jtcy5_nl")
				.toString());
		String jtcy5_nsr = DealString.toGBK(request.getParameter("jtcy5_nsr")
				.toString());
		String jtcy5_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy5_gzdwjzw").toString());
		String rcbx = DealString.toGBK(request.getParameter("rcbx"));
		String jcqk = DealString.toGBK(request.getParameter("jcqk"));
		String jtjjknzk = DealString.toGBK(request.getParameter("jtjjknzk")
				);
		String xnxf = DealString.toGBK(request.getParameter("xnxf").toString());
		String jtfybzs = DealString.toGBK(request.getParameter("jtfybzs")
				.toString());
		String hjxf = DealString.toGBK(request.getParameter("hjxf").toString());
		String bxqdks = DealString.toGBK(request.getParameter("bxqdks")
				.toString());
		String jhhkkssj = DealString.toGBK(request.getParameter("jhhkkssj")
				.toString());
		String jhhkjssj = DealString.toGBK(request.getParameter("jhhkjssj")
				.toString());
		String bz = DealString.toGBK(request.getParameter("bz"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj")
				.toString());
		String sqsj = DealString.toGBK(request.getParameter("sqsj").toString());
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj")
				.toString());

		if (sqsj != null && !"".equalsIgnoreCase(sqsj)) {
			sqsj = sqsj.substring(0, 4) + "年" + sqsj.substring(5, 7) + "月"
			+ sqsj.substring(8) + "日";
		}

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xh, xm, xb, sfzh, csrq, xymc, zymc,
				bjmc, jtzz, xslxdh, jtcy1_xm, jtcy1_nl, jtcy1_gzdwjzw,
				jtcy1_nsr, jtcy2_xm, jtcy2_nl, jtcy2_gzdwjzw, jtcy2_nsr,
				jtcy3_xm, jtcy3_nl, jtcy3_gzdwjzw, jtcy3_nsr, jtcy4_xm,
				jtcy4_nl, jtcy4_gzdwjzw, jtcy4_nsr, jtcy5_xm, jtcy5_nl,
				jtcy5_gzdwjzw, jtcy5_nsr, rxcj, sxqpm, pjcj, rcbx, jcqk,
				jtjjknzk, xnxf, jtfybzs, hjxf, bxqdks, jhhkkssj, jhhkjssj,
				sqsj, bz, xyshyj, xxshyj };
		String[] outString = new String[] { "xh", "xm", "xb", "sfzh", "csrq",
				"xymc", "zymc", "bjmc", "jtzz", "xslxdh", "jtcy1_xm",
				"jtcy1_nl", "jtcy1_gzdwjzw", "jtcy1_nsr", "jtcy2_xm",
				"jtcy2_nl", "jtcy2_gzdwjzw", "jtcy2_nsr", "jtcy3_xm",
				"jtcy3_nl", "jtcy3_gzdwjzw", "jtcy3_nsr", "jtcy4_xm",
				"jtcy4_nl", "jtcy4_gzdwjzw", "jtcy4_nsr", "jtcy5_xm",
				"jtcy5_nl", "jtcy5_gzdwjzw", "jtcy5_nsr", "rxcj", "sxqpm",
				"pjcj", "rcbx", "jcqk", "jtjjknzk", "xnxf", "jtfybzs", "hjxf",
				"bxqdks", "jhhkkssj", "jhhkjssj", "sqsj", "bz", "xyshyj",
		"xxshyj" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward jsxx_knsxx(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		String userType;

//		String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
//		userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		// String xxmc = ToolClass.getXxmc();
		String doType = request.getParameter("doType");// 操作类型
		String titName = request.getParameter("titName");

		String sfksq = "-1";// 国家奖学金是否可申请参数，-1表示不可以，1表示可以。

		String[] titNames = null;
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		titNames = new String[] { "jsxx_knsxx" };

		if (titName == null)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间
		String[] outString = new String[] {};
		sql = "select xh,nd,xm,xb,sfzh,xydm,xymc,zydm,zymc,bjdm,bjmc,csrq,zzmm,jtdz,"
			+ "jtdh,xsdh,rxqhk,sfgr,sfcj,sfdq,sfjszn,sfssmz,rxcj,sxqpm,pjcj,cxdd,"
			+ "jtcy1_xm,jtcy1_cw,jtcy1_nl,jtcy1_gzdwjzw,jtcy1_nsr,jtcy1_jkzk,"
			+ "jtcy2_xm,jtcy2_cw,jtcy2_nl,jtcy2_gzdwjzw,jtcy2_nsr,jtcy2_jkzk,"
			+ "jtcy3_xm,jtcy3_cw,jtcy3_nl,jtcy3_gzdwjzw,jtcy3_nsr,jtcy3_jkzk,"
			+ "jtcy4_xm,jtcy4_cw,jtcy4_nl,jtcy4_gzdwjzw,jtcy4_nsr,jtcy4_jkzk,"
			+ "jtcy5_xm,jtcy5_cw,jtcy5_nl,jtcy5_gzdwjzw,jtcy5_nsr,jtcy5_jkzk,"
			+ "jtjjknqk,mzbm_yzbm,mzbm_lxdh,mzbm_lxr,jfqk_jttg,jfqk_qtqytg,"
			+ "jfqk_hjtg,jfqk_yjfy,jfqk_mysffy,jfqk_qnhjfy,jfqk_bxnjttgfybzs,"
			+ "jfqk_ljqf,jfqk_ywhjjh,zzqk_sfsqxnqgzx,zzqk_xnqgzxyapgw,"
			+ "zzqk_sfsqxwqgzx,zzqk_sfsbnczxdk,zzqk_lnyhnczxdhje,zzqk_sfsbgxzxdk,"
			+ "zzqk_lnyhgxzxdhje,zzqk_sfsbbxzxdk,zzqk_lnyhbxzxdhje,zzqk_lnjzxjqk,"
			+ "sqsj,xysh,xyshyj,xxsh,xxshyj,sfwsrh,sfzbh,sfdbh,sffmsxg,sfcnh,sfdsr "
			+ "from VIEW_JSXX_KNSXX where 1=2";
		outString = dao.getColumnName(sql);// 获得view_xsjxjzxjsq的列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
		String xh = "";
		String zzqk_lnjzxjqk = "";
//		String knsrs = "";
		String pkVal = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;

			sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='困难生' and b.xh=? ";
			jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
					"kssj", "jssj" });
			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String jtdz = DealString.toGBK(request.getParameter("jtdz")
							.toString());
					String jtdh = DealString.toGBK(request.getParameter("jtdh")
							.toString());
					String xsdh = DealString.toGBK(request.getParameter("xsdh")
							.toString());
					String rxqhk = DealString.toGBK(request.getParameter(
					"rxqhk").toString());
					String sfgr = DealString.toGBK(request.getParameter("sfgr")
							.toString());
					String sfcj = DealString.toGBK(request.getParameter("sfcj")
							.toString());
					String sfdq = DealString.toGBK(request.getParameter("sfdq")
							.toString());
					String sfjszn = DealString.toGBK(request.getParameter(
					"sfjszn").toString());
					String sfssmz = DealString.toGBK(request.getParameter(
					"sfssmz").toString());
					String rxcj = DealString.toGBK(request.getParameter("rxcj")
							.toString());
					String sxqpm = DealString.toGBK(request.getParameter(
					"sxqpm").toString());
					String pjcj = DealString.toGBK(request.getParameter("pjcj")
							.toString());
					String cxdd = DealString.toGBK(request.getParameter("cxdd")
							.toString());
					String jtcy1_xm = DealString.toGBK(request.getParameter(
					"jtcy1_xm").toString());
					String jtcy1_cw = DealString.toGBK(request.getParameter(
					"jtcy1_cw").toString());
					String jtcy1_nl = DealString.toGBK(request.getParameter(
					"jtcy1_nl").toString());
					String jtcy1_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy1_gzdwjzw").toString());
					String jtcy1_jkzk = DealString.toGBK(request.getParameter(
					"jtcy1_jkzk").toString());
					String jtcy1_nsr = DealString.toGBK(request.getParameter(
					"jtcy1_nsr").toString());
					String jtcy2_xm = DealString.toGBK(request.getParameter(
					"jtcy2_xm").toString());
					String jtcy2_cw = DealString.toGBK(request.getParameter(
					"jtcy2_cw").toString());
					String jtcy2_nl = DealString.toGBK(request.getParameter(
					"jtcy2_nl").toString());
					String jtcy2_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy2_gzdwjzw").toString());
					String jtcy2_jkzk = DealString.toGBK(request.getParameter(
					"jtcy2_jkzk").toString());
					String jtcy2_nsr = DealString.toGBK(request.getParameter(
					"jtcy2_nsr").toString());
					String jtcy3_xm = DealString.toGBK(request.getParameter(
					"jtcy3_xm").toString());
					String jtcy3_cw = DealString.toGBK(request.getParameter(
					"jtcy3_cw").toString());
					String jtcy3_nl = DealString.toGBK(request.getParameter(
					"jtcy3_nl").toString());
					String jtcy3_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy3_gzdwjzw").toString());
					String jtcy3_jkzk = DealString.toGBK(request.getParameter(
					"jtcy3_jkzk").toString());
					String jtcy3_nsr = DealString.toGBK(request.getParameter(
					"jtcy3_nsr").toString());
					String jtcy4_xm = DealString.toGBK(request.getParameter(
					"jtcy4_xm").toString());
					String jtcy4_cw = DealString.toGBK(request.getParameter(
					"jtcy4_cw").toString());
					String jtcy4_nl = DealString.toGBK(request.getParameter(
					"jtcy4_nl").toString());
					String jtcy4_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy4_gzdwjzw").toString());
					String jtcy4_jkzk = DealString.toGBK(request.getParameter(
					"jtcy4_jkzk").toString());
					String jtcy4_nsr = DealString.toGBK(request.getParameter(
					"jtcy4_nsr").toString());
					String jtcy5_xm = DealString.toGBK(request.getParameter(
					"jtcy5_xm").toString());
					String jtcy5_cw = DealString.toGBK(request.getParameter(
					"jtcy5_cw").toString());
					String jtcy5_nl = DealString.toGBK(request.getParameter(
					"jtcy5_nl").toString());
					String jtcy5_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy5_gzdwjzw").toString());
					String jtcy5_jkzk = DealString.toGBK(request.getParameter(
					"jtcy5_jkzk").toString());
					String jtcy5_nsr = DealString.toGBK(request.getParameter(
					"jtcy5_nsr").toString());
					String jtjjknqk = DealString.toGBK(request.getParameter(
					"jtjjknqk"));
					String mzbm_yzbm = DealString.toGBK(request.getParameter(
					"mzbm_yzbm").toString());
					String mzbm_lxdh = DealString.toGBK(request.getParameter(
					"mzbm_lxdh").toString());
					String mzbm_lxr = DealString.toGBK(request.getParameter(
					"mzbm_lxr").toString());
					String jfqk_jttg = DealString.toGBK(request.getParameter(
					"jfqk_jttg").toString());
					String jfqk_qtqytg = DealString.toGBK(request.getParameter(
					"jfqk_qtqytg").toString());
					String jfqk_hjtg = DealString.toGBK(request.getParameter(
					"jfqk_hjtg").toString());
					String jfqk_yjfy = DealString.toGBK(request.getParameter(
					"jfqk_yjfy").toString());
					String jfqk_mysffy = DealString.toGBK(request.getParameter(
					"jfqk_mysffy").toString());
					String jfqk_qnhjfy = DealString.toGBK(request.getParameter(
					"jfqk_qnhjfy").toString());
					String jfqk_bxnjttgfybzs = DealString.toGBK(request
							.getParameter("jfqk_bxnjttgfybzs").toString());
					String jfqk_ljqf = DealString.toGBK(request.getParameter(
					"jfqk_ljqf").toString());
					String jfqk_ywhjjh = DealString.toGBK(request.getParameter(
					"jfqk_ywhjjh").toString());
					String zzqk_sfsqxnqgzx = DealString.toGBK(request
							.getParameter("zzqk_sfsqxnqgzx").toString());
					String zzqk_xnqgzxyapgw = DealString.toGBK(request
							.getParameter("zzqk_xnqgzxyapgw").toString());
					String zzqk_sfsqxwqgzx = DealString.toGBK(request
							.getParameter("zzqk_sfsqxwqgzx").toString());
					String zzqk_sfsbnczxdk = DealString.toGBK(request
							.getParameter("zzqk_sfsbnczxdk").toString());
					String zzqk_lnyhnczxdhje = DealString.toGBK(request
							.getParameter("zzqk_lnyhnczxdhje").toString());
					String zzqk_sfsbgxzxdk = DealString.toGBK(request
							.getParameter("zzqk_sfsbgxzxdk").toString());
					String zzqk_lnyhgxzxdhje = DealString.toGBK(request
							.getParameter("zzqk_lnyhgxzxdhje").toString());
					String zzqk_sfsbbxzxdk = DealString.toGBK(request
							.getParameter("zzqk_sfsbbxzxdk").toString());
					String zzqk_lnyhbxzxdhje = DealString.toGBK(request
							.getParameter("zzqk_lnyhbxzxdhje").toString());
					String sfwsrh = DealString.toGBK(request.getParameter(
							"sfwsrh").toString());
					String sfzbh = DealString.toGBK(request.getParameter(
							"sfzbh").toString());
					String sfdbh = DealString.toGBK(request.getParameter(
							"sfdbh").toString());
					String sffmsxg = DealString.toGBK(request.getParameter(
							"sffmsxg").toString());
					String sfcnh = DealString.toGBK(request.getParameter(
							"sfcnh").toString());
					String sfdsr = DealString.toGBK(request.getParameter(
							"sfdsr").toString()); 
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}

					sql = "select xxsh from jsxx_knsxx where xh||nd=?";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xxsh" });

					if ((temp != null)
							&& (temp[0].equalsIgnoreCase("一般困难")
									|| temp[0].equalsIgnoreCase("特别困难") || temp[0]
									.equalsIgnoreCase("比较困难"))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("jsxx_knsxx", "xh||nd", pkVal, request);

						String[] colName1 = new String[] { "xh", "nd", "jtdz",
								"jtdh", "xsdh", "rxqhk", "sfgr", "sfcj",
								"sfdq", "sfjszn", "sfssmz", "rxcj", "sxqpm",
								"pjcj", "cxdd", "jtcy1_xm", "jtcy1_cw",
								"jtcy1_nl", "jtcy1_gzdwjzw", "jtcy1_nsr",
								"jtcy1_jkzk", "jtcy2_xm", "jtcy2_cw",
								"jtcy2_nl", "jtcy2_gzdwjzw", "jtcy2_nsr",
								"jtcy2_jkzk", "jtcy3_xm", "jtcy3_cw",
								"jtcy3_nl", "jtcy3_gzdwjzw", "jtcy3_nsr",
								"jtcy3_jkzk", "jtcy4_xm", "jtcy4_cw",
								"jtcy4_nl", "jtcy4_gzdwjzw", "jtcy4_nsr",
								"jtcy4_jkzk", "jtcy5_xm", "jtcy5_cw",
								"jtcy5_nl", "jtcy5_gzdwjzw", "jtcy5_nsr",
								"jtcy5_jkzk", "jtjjknqk", "mzbm_yzbm",
								"mzbm_lxdh", "mzbm_lxr", "jfqk_jttg",
								"jfqk_qtqytg", "jfqk_hjtg", "jfqk_yjfy",
								"jfqk_mysffy", "jfqk_qnhjfy",
								"jfqk_bxnjttgfybzs", "jfqk_ljqf",
								"jfqk_ywhjjh", "zzqk_sfsqxnqgzx",
								"zzqk_xnqgzxyapgw", "zzqk_sfsqxwqgzx",
								"zzqk_sfsbnczxdk", "zzqk_lnyhnczxdhje",
								"zzqk_sfsbgxzxdk", "zzqk_lnyhgxzxdhje",
								"zzqk_sfsbbxzxdk", "zzqk_lnyhbxzxdhje",
								"zzqk_lnjzxjqk", "sfwsrh", "sfzbh", "sfdbh",
								"sffmsxg", "sfcnh", "sfdsr" };

						String[] valueForOut = new String[] { xh, nd, jtdz,
								jtdh, xsdh, rxqhk, sfgr, sfcj, sfdq, sfjszn,
								sfssmz, rxcj, sxqpm, pjcj, cxdd, jtcy1_xm,
								jtcy1_cw, jtcy1_nl, jtcy1_gzdwjzw, jtcy1_nsr,
								jtcy1_jkzk, jtcy2_xm, jtcy2_cw, jtcy2_nl,
								jtcy2_gzdwjzw, jtcy2_nsr, jtcy2_jkzk, jtcy3_xm,
								jtcy3_cw, jtcy3_nl, jtcy3_gzdwjzw, jtcy3_nsr,
								jtcy3_jkzk, jtcy4_xm, jtcy4_cw, jtcy4_nl,
								jtcy4_gzdwjzw, jtcy4_nsr, jtcy4_jkzk, jtcy5_xm,
								jtcy5_cw, jtcy5_nl, jtcy5_gzdwjzw, jtcy5_nsr,
								jtcy5_jkzk, jtjjknqk, mzbm_yzbm, mzbm_lxdh,
								mzbm_lxr, jfqk_jttg, jfqk_qtqytg, jfqk_hjtg,
								jfqk_yjfy, jfqk_mysffy, jfqk_qnhjfy,
								jfqk_bxnjttgfybzs, jfqk_ljqf, jfqk_ywhjjh,
								zzqk_sfsqxnqgzx, zzqk_xnqgzxyapgw,
								zzqk_sfsqxwqgzx, zzqk_sfsbnczxdk,
								zzqk_lnyhnczxdhje, zzqk_sfsbgxzxdk,
								zzqk_lnyhgxzxdhje, zzqk_sfsbbxzxdk,
								zzqk_lnyhbxzxdhje, zzqk_lnjzxjqk, sfwsrh,
								sfzbh, sfdbh, sffmsxg, sfcnh, sfdsr };

						boolean ok = false;
						ok = StandardOperation.insert("jsxx_knsxx", colName1,
								valueForOut, request);

						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {

			xh = xszzForm.getXh();
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
					String jtdz = DealString.toGBK(request.getParameter("jtdz")
							.toString());
					String jtdh = DealString.toGBK(request.getParameter("jtdh")
							.toString());
					String xsdh = DealString.toGBK(request.getParameter("xsdh")
							.toString());
					String rxqhk = DealString.toGBK(request.getParameter(
					"rxqhk").toString());
					String sfgr = DealString.toGBK(request.getParameter("sfgr")
							.toString());
					String sfcj = DealString.toGBK(request.getParameter("sfcj")
							.toString());
					String sfdq = DealString.toGBK(request.getParameter("sfdq")
							.toString());
					String sfjszn = DealString.toGBK(request.getParameter(
					"sfjszn").toString());
					String sfssmz = DealString.toGBK(request.getParameter(
					"sfssmz").toString());
					String rxcj = DealString.toGBK(request.getParameter("rxcj")
							.toString());
					String sxqpm = DealString.toGBK(request.getParameter(
					"sxqpm").toString());
					String pjcj = DealString.toGBK(request.getParameter("pjcj")
							.toString());
					String cxdd = DealString.toGBK(request.getParameter("cxdd")
							.toString());
					String jtcy1_xm = DealString.toGBK(request.getParameter(
					"jtcy1_xm").toString());
					String jtcy1_cw = DealString.toGBK(request.getParameter(
					"jtcy1_cw").toString());
					String jtcy1_nl = DealString.toGBK(request.getParameter(
					"jtcy1_nl").toString());
					String jtcy1_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy1_gzdwjzw").toString());
					String jtcy1_jkzk = DealString.toGBK(request.getParameter(
					"jtcy1_jkzk").toString());
					String jtcy1_nsr = DealString.toGBK(request.getParameter(
					"jtcy1_nsr").toString());
					String jtcy2_xm = DealString.toGBK(request.getParameter(
					"jtcy2_xm").toString());
					String jtcy2_cw = DealString.toGBK(request.getParameter(
					"jtcy2_cw").toString());
					String jtcy2_nl = DealString.toGBK(request.getParameter(
					"jtcy2_nl").toString());
					String jtcy2_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy2_gzdwjzw").toString());
					String jtcy2_jkzk = DealString.toGBK(request.getParameter(
					"jtcy2_jkzk").toString());
					String jtcy2_nsr = DealString.toGBK(request.getParameter(
					"jtcy2_nsr").toString());
					String jtcy3_xm = DealString.toGBK(request.getParameter(
					"jtcy3_xm").toString());
					String jtcy3_cw = DealString.toGBK(request.getParameter(
					"jtcy3_cw").toString());
					String jtcy3_nl = DealString.toGBK(request.getParameter(
					"jtcy3_nl").toString());
					String jtcy3_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy3_gzdwjzw").toString());
					String jtcy3_jkzk = DealString.toGBK(request.getParameter(
					"jtcy3_jkzk").toString());
					String jtcy3_nsr = DealString.toGBK(request.getParameter(
					"jtcy3_nsr").toString());
					String jtcy4_xm = DealString.toGBK(request.getParameter(
					"jtcy4_xm").toString());
					String jtcy4_cw = DealString.toGBK(request.getParameter(
					"jtcy4_cw").toString());
					String jtcy4_nl = DealString.toGBK(request.getParameter(
					"jtcy4_nl").toString());
					String jtcy4_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy4_gzdwjzw").toString());
					String jtcy4_jkzk = DealString.toGBK(request.getParameter(
					"jtcy4_jkzk").toString());
					String jtcy4_nsr = DealString.toGBK(request.getParameter(
					"jtcy4_nsr").toString());
					String jtcy5_xm = DealString.toGBK(request.getParameter(
					"jtcy5_xm").toString());
					String jtcy5_cw = DealString.toGBK(request.getParameter(
					"jtcy5_cw").toString());
					String jtcy5_nl = DealString.toGBK(request.getParameter(
					"jtcy5_nl").toString());
					String jtcy5_gzdwjzw = DealString.toGBK(request
							.getParameter("jtcy5_gzdwjzw").toString());
					String jtcy5_jkzk = DealString.toGBK(request.getParameter(
					"jtcy5_jkzk").toString());
					String jtcy5_nsr = DealString.toGBK(request.getParameter(
					"jtcy5_nsr").toString());
					String jtjjknqk = DealString.toGBK(request.getParameter(
					"jtjjknqk"));
					String mzbm_yzbm = DealString.toGBK(request.getParameter(
					"mzbm_yzbm").toString());
					String mzbm_lxdh = DealString.toGBK(request.getParameter(
					"mzbm_lxdh").toString());
					String mzbm_lxr = DealString.toGBK(request.getParameter(
					"mzbm_lxr").toString());
					String jfqk_jttg = DealString.toGBK(request.getParameter(
					"jfqk_jttg").toString());
					String jfqk_qtqytg = DealString.toGBK(request.getParameter(
					"jfqk_qtqytg").toString());
					String jfqk_hjtg = DealString.toGBK(request.getParameter(
					"jfqk_hjtg").toString());
					String jfqk_yjfy = DealString.toGBK(request.getParameter(
					"jfqk_yjfy").toString());
					String jfqk_mysffy = DealString.toGBK(request.getParameter(
					"jfqk_mysffy").toString());
					String jfqk_qnhjfy = DealString.toGBK(request.getParameter(
					"jfqk_qnhjfy").toString());
					String jfqk_bxnjttgfybzs = DealString.toGBK(request
							.getParameter("jfqk_bxnjttgfybzs").toString());
					String jfqk_ljqf = DealString.toGBK(request.getParameter(
					"jfqk_ljqf").toString());
					String jfqk_ywhjjh = DealString.toGBK(request.getParameter(
					"jfqk_ywhjjh").toString());
					String zzqk_sfsqxnqgzx = DealString.toGBK(request
							.getParameter("zzqk_sfsqxnqgzx").toString());
					String zzqk_xnqgzxyapgw = DealString.toGBK(request
							.getParameter("zzqk_xnqgzxyapgw").toString());
					String zzqk_sfsqxwqgzx = DealString.toGBK(request
							.getParameter("zzqk_sfsqxwqgzx").toString());
					String zzqk_sfsbnczxdk = DealString.toGBK(request
							.getParameter("zzqk_sfsbnczxdk").toString());
					String zzqk_lnyhnczxdhje = DealString.toGBK(request
							.getParameter("zzqk_lnyhnczxdhje").toString());
					String zzqk_sfsbgxzxdk = DealString.toGBK(request
							.getParameter("zzqk_sfsbgxzxdk").toString());
					String zzqk_lnyhgxzxdhje = DealString.toGBK(request
							.getParameter("zzqk_lnyhgxzxdhje").toString());
					String zzqk_sfsbbxzxdk = DealString.toGBK(request
							.getParameter("zzqk_sfsbbxzxdk").toString());
					String zzqk_lnyhbxzxdhje = DealString.toGBK(request
							.getParameter("zzqk_lnyhbxzxdhje").toString());
					String sfwsrh = DealString.toGBK(request.getParameter(
							"sfwsrh").toString());
					String sfzbh = DealString.toGBK(request.getParameter(
							"sfzbh").toString());
					String sfdbh = DealString.toGBK(request.getParameter(
							"sfdbh").toString());
					String sffmsxg = DealString.toGBK(request.getParameter(
							"sffmsxg").toString());
					String sfcnh = DealString.toGBK(request.getParameter(
							"sfcnh").toString());
					String sfdsr = DealString.toGBK(request.getParameter(
							"sfdsr").toString());
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}

					sql = "select xxsh from jsxx_knsxx where xh||nd=?";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xxsh" });

					if ((temp != null)
							&& (temp[0].equalsIgnoreCase("一般困难") || temp[0]
									.equalsIgnoreCase("特别困难") || temp[0].equalsIgnoreCase("比较困难"))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("jsxx_knsxx", "xh||nd", pkVal, request);

						String[] colName1 = new String[] { "xh", "nd", "jtdz",
								"jtdh", "xsdh", "rxqhk", "sfgr", "sfcj",
								"sfdq", "sfjszn", "sfssmz", "rxcj", "sxqpm",
								"pjcj", "cxdd", "jtcy1_xm", "jtcy1_cw",
								"jtcy1_nl", "jtcy1_gzdwjzw", "jtcy1_nsr",
								"jtcy1_jkzk", "jtcy2_xm", "jtcy2_cw",
								"jtcy2_nl", "jtcy2_gzdwjzw", "jtcy2_nsr",
								"jtcy2_jkzk", "jtcy3_xm", "jtcy3_cw",
								"jtcy3_nl", "jtcy3_gzdwjzw", "jtcy3_nsr",
								"jtcy3_jkzk", "jtcy4_xm", "jtcy4_cw",
								"jtcy4_nl", "jtcy4_gzdwjzw", "jtcy4_nsr",
								"jtcy4_jkzk", "jtcy5_xm", "jtcy5_cw",
								"jtcy5_nl", "jtcy5_gzdwjzw", "jtcy5_nsr",
								"jtcy5_jkzk", "jtjjknqk", "mzbm_yzbm",
								"mzbm_lxdh", "mzbm_lxr", "jfqk_jttg",
								"jfqk_qtqytg", "jfqk_hjtg", "jfqk_yjfy",
								"jfqk_mysffy", "jfqk_qnhjfy",
								"jfqk_bxnjttgfybzs", "jfqk_ljqf",
								"jfqk_ywhjjh", "zzqk_sfsqxnqgzx",
								"zzqk_xnqgzxyapgw", "zzqk_sfsqxwqgzx",
								"zzqk_sfsbnczxdk", "zzqk_lnyhnczxdhje",
								"zzqk_sfsbgxzxdk", "zzqk_lnyhgxzxdhje",
								"zzqk_sfsbbxzxdk", "zzqk_lnyhbxzxdhje",
								"zzqk_lnjzxjqk", "sfwsrh", "sfzbh", "sfdbh",
								"sffmsxg", "sfcnh", "sfdsr" };

						String[] valueForOut = new String[] { xh, nd, jtdz,
								jtdh, xsdh, rxqhk, sfgr, sfcj, sfdq, sfjszn,
								sfssmz, rxcj, sxqpm, pjcj, cxdd, jtcy1_xm,
								jtcy1_cw, jtcy1_nl, jtcy1_gzdwjzw, jtcy1_nsr,
								jtcy1_jkzk, jtcy2_xm, jtcy2_cw, jtcy2_nl,
								jtcy2_gzdwjzw, jtcy2_nsr, jtcy2_jkzk, jtcy3_xm,
								jtcy3_cw, jtcy3_nl, jtcy3_gzdwjzw, jtcy3_nsr,
								jtcy3_jkzk, jtcy4_xm, jtcy4_cw, jtcy4_nl,
								jtcy4_gzdwjzw, jtcy4_nsr, jtcy4_jkzk, jtcy5_xm,
								jtcy5_cw, jtcy5_nl, jtcy5_gzdwjzw, jtcy5_nsr,
								jtcy5_jkzk, jtjjknqk, mzbm_yzbm, mzbm_lxdh,
								mzbm_lxr, jfqk_jttg, jfqk_qtqytg, jfqk_hjtg,
								jfqk_yjfy, jfqk_mysffy, jfqk_qnhjfy,
								jfqk_bxnjttgfybzs, jfqk_ljqf, jfqk_ywhjjh,
								zzqk_sfsqxnqgzx, zzqk_xnqgzxyapgw,
								zzqk_sfsqxwqgzx, zzqk_sfsbnczxdk,
								zzqk_lnyhnczxdhje, zzqk_sfsbgxzxdk,
								zzqk_lnyhgxzxdhje, zzqk_sfsbbxzxdk,
								zzqk_lnyhbxzxdhje, zzqk_lnjzxjqk, sfwsrh,
								sfzbh, sfdbh, sffmsxg, sfcnh, sfdsr };

						boolean ok = false;
						ok = StandardOperation.insert("jsxx_knsxx", colName1,
								valueForOut, request);

						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
			}
		}

		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd;
		}
		outString = new String[] { "xh", "nd", "xm", "xb", "sfzh", "xydm",
				"xymc", "zydm", "zymc", "bjdm", "bjmc", "csrq", "zzmm", "jtdz",
				"jtdh", "xsdh", "rxqhk", "sfgr", "sfcj", "sfdq", "sfjszn",
				"sfssmz", "rxcj", "sxqpm", "pjcj", "cxdd", "jtcy1_xm",
				"jtcy1_cw", "jtcy1_nl", "jtcy1_gzdwjzw", "jtcy1_nsr",
				"jtcy1_jkzk", "jtcy2_xm", "jtcy2_cw", "jtcy2_nl",
				"jtcy2_gzdwjzw", "jtcy2_nsr", "jtcy2_jkzk", "jtcy3_xm",
				"jtcy3_cw", "jtcy3_nl", "jtcy3_gzdwjzw", "jtcy3_nsr",
				"jtcy3_jkzk", "jtcy4_xm", "jtcy4_cw", "jtcy4_nl",
				"jtcy4_gzdwjzw", "jtcy4_nsr", "jtcy4_jkzk", "jtcy5_xm",
				"jtcy5_cw", "jtcy5_nl", "jtcy5_gzdwjzw", "jtcy5_nsr",
				"jtcy5_jkzk", "jtjjknqk", "mzbm_yzbm", "mzbm_lxdh", "mzbm_lxr",
				"jfqk_jttg", "jfqk_qtqytg", "jfqk_hjtg", "jfqk_yjfy",
				"jfqk_mysffy", "jfqk_qnhjfy", "jfqk_bxnjttgfybzs", "jfqk_ljqf",
				"jfqk_ywhjjh", "zzqk_sfsqxnqgzx", "zzqk_xnqgzxyapgw",
				"zzqk_sfsqxwqgzx", "zzqk_sfsbnczxdk", "zzqk_lnyhnczxdhje",
				"zzqk_sfsbgxzxdk", "zzqk_lnyhgxzxdhje", "zzqk_sfsbbxzxdk",
				"zzqk_lnyhbxzxdhje", "zzqk_lnjzxjqk", "sqsj", "xysh", "xyshyj",
				"xxsh", "xxshyj", "sfwsrh", "sfzbh", "sfdbh", "sffmsxg", "sfcnh", "sfdsr" };

		sql = "select xh,nd,xm,xb,sfzh,xydm,xymc,zydm,zymc,bjdm,bjmc,csrq,zzmm,jtdz,"
			+ "jtdh,xsdh,rxqhk,sfgr,sfcj,sfdq,sfjszn,sfssmz,rxcj,sxqpm,pjcj,cxdd,"
			+ "jtcy1_xm,jtcy1_cw,jtcy1_nl,jtcy1_gzdwjzw,jtcy1_nsr,jtcy1_jkzk,"
			+ "jtcy2_xm,jtcy2_cw,jtcy2_nl,jtcy2_gzdwjzw,jtcy2_nsr,jtcy2_jkzk,"
			+ "jtcy3_xm,jtcy3_cw,jtcy3_nl,jtcy3_gzdwjzw,jtcy3_nsr,jtcy3_jkzk,"
			+ "jtcy4_xm,jtcy4_cw,jtcy4_nl,jtcy4_gzdwjzw,jtcy4_nsr,jtcy4_jkzk,"
			+ "jtcy5_xm,jtcy5_cw,jtcy5_nl,jtcy5_gzdwjzw,jtcy5_nsr,jtcy5_jkzk,"
			+ "jtjjknqk,mzbm_yzbm,mzbm_lxdh,mzbm_lxr,jfqk_jttg,jfqk_qtqytg,"
			+ "jfqk_hjtg,jfqk_yjfy,jfqk_mysffy,jfqk_qnhjfy,jfqk_bxnjttgfybzs,"
			+ "jfqk_ljqf,jfqk_ywhjjh,zzqk_sfsqxnqgzx,zzqk_xnqgzxyapgw,"
			+ "zzqk_sfsqxwqgzx,zzqk_sfsbnczxdk,zzqk_lnyhnczxdhje,zzqk_sfsbgxzxdk,"
			+ "zzqk_lnyhgxzxdhje,zzqk_sfsbbxzxdk,zzqk_lnyhbxzxdhje,zzqk_lnjzxjqk,"
			+ "sqsj,xysh,xyshyj,xxsh,xxshyj,sfwsrh,sfzbh,sfdbh,sffmsxg,sfcnh,sfdsr "
			+ "from view_jsxx_knsxx where xh||nd=?";
		outValue = dao.getOneRs(sql, new String[] { pkVal }, outString);

		List<String> xszzList = dao.getJsxxStuJzxj(xh);
		if (xszzList.size() != 0) {
			request.setAttribute("notJzxj", "no");
			request.setAttribute("xszzList", xszzList);
			for (Iterator<String> it = xszzList.iterator(); it.hasNext();) {
				String st = it.next();
				zzqk_lnjzxjqk += st + "||"; 
			}
		} else {
			zzqk_lnjzxjqk = "无";
			request.setAttribute("notJzxj", "is");
		}
		if (outValue == null) {
			if (xh != null) {
				sql = "select v.xh,v.xm,v.xb,v.sfzh,v.xymc,"
					+ "v.zymc,v.bjmc,q.csrq,q.zzmmmc zzmm "
					+ "from view_xsjbxx v,view_stu_details q where v.xh=q.xh and v.xh=?";
				String[] colName = new String[] { "xh", "xm", "xb", "sfzh",
						"xymc", "zymc", "bjmc", "csrq", "zzmm" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {

				} else {
					colName = new String[] { "xh", "xm", "xb", "sfzh", "xymc",
							"zymc", "bjmc", "csrq", "zzmm" };
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward jsxx_knssqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String sqlb = "";
		sqlb = "江苏信息职业技术学院";

		DAO dao = DAO.getInstance();
		String xh = DealString.toGBK(request.getParameter("xh").toString());
		String xm = DealString.toGBK(request.getParameter("xm").toString());
		String xb = DealString.toGBK(request.getParameter("xb").toString());
		String sfzh = DealString.toGBK(request.getParameter("sfzh").toString());
		String zymc = DealString.toGBK(request.getParameter("zymc").toString());
		String bjmc = DealString.toGBK(request.getParameter("bjmc").toString());
		String zzmm = DealString.toGBK(request.getParameter("zzmm").toString());
		String csrq = DealString.toGBK(request.getParameter("csrq").toString());
		String jtdz = DealString.toGBK(request.getParameter("jtdz").toString());
		String jtdh = DealString.toGBK(request.getParameter("jtdh").toString());
		String xsdh = DealString.toGBK(request.getParameter("xsdh").toString());
		String rxqhk = DealString.toGBK(request.getParameter("rxqhk")
				.toString());
		String sfgr = DealString.toGBK(request.getParameter("sfgr").toString());
		String sfcj = DealString.toGBK(request.getParameter("sfcj").toString());
		String sfdq = DealString.toGBK(request.getParameter("sfdq").toString());
		String sfjszn = DealString.toGBK(request.getParameter("sfjszn")
				.toString());
		String sfssmz = DealString.toGBK(request.getParameter("sfssmz")
				.toString());
		String rxcj = DealString.toGBK(request.getParameter("rxcj").toString());
		String sxqpm = DealString.toGBK(request.getParameter("sxqpm")
				.toString());
		String pjcj = DealString.toGBK(request.getParameter("pjcj").toString());
		String cxdd = DealString.toGBK(request.getParameter("cxdd").toString());
		String jtcy1_xm = DealString.toGBK(request.getParameter("jtcy1_xm")
				.toString());
		String jtcy1_cw = DealString.toGBK(request.getParameter("jtcy1_cw")
				.toString());
		String jtcy1_nl = DealString.toGBK(request.getParameter("jtcy1_nl")
				.toString());
		String jtcy1_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy1_gzdwjzw").toString());
		String jtcy1_jkzk = DealString.toGBK(request.getParameter("jtcy1_jkzk")
				.toString());
		String jtcy1_nsr = DealString.toGBK(request.getParameter("jtcy1_nsr")
				.toString());
		String jtcy2_xm = DealString.toGBK(request.getParameter("jtcy2_xm")
				.toString());
		String jtcy2_cw = DealString.toGBK(request.getParameter("jtcy2_cw")
				.toString());
		String jtcy2_nl = DealString.toGBK(request.getParameter("jtcy2_nl")
				.toString());
		String jtcy2_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy2_gzdwjzw").toString());
		String jtcy2_jkzk = DealString.toGBK(request.getParameter("jtcy2_jkzk")
				.toString());
		String jtcy2_nsr = DealString.toGBK(request.getParameter("jtcy2_nsr")
				.toString());
		String jtcy3_xm = DealString.toGBK(request.getParameter("jtcy3_xm")
				.toString());
		String jtcy3_cw = DealString.toGBK(request.getParameter("jtcy3_cw")
				.toString());
		String jtcy3_nl = DealString.toGBK(request.getParameter("jtcy3_nl")
				.toString());
		String jtcy3_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy3_gzdwjzw").toString());
		String jtcy3_jkzk = DealString.toGBK(request.getParameter("jtcy3_jkzk")
				.toString());
		String jtcy3_nsr = DealString.toGBK(request.getParameter("jtcy3_nsr")
				.toString());
		String jtcy4_xm = DealString.toGBK(request.getParameter("jtcy4_xm")
				.toString());
		String jtcy4_cw = DealString.toGBK(request.getParameter("jtcy4_cw")
				.toString());
		String jtcy4_nl = DealString.toGBK(request.getParameter("jtcy4_nl")
				.toString());
		String jtcy4_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy4_gzdwjzw").toString());
		String jtcy4_jkzk = DealString.toGBK(request.getParameter("jtcy4_jkzk")
				.toString());
		String jtcy4_nsr = DealString.toGBK(request.getParameter("jtcy4_nsr")
				.toString());
		String jtcy5_xm = DealString.toGBK(request.getParameter("jtcy5_xm")
				.toString());
		String jtcy5_cw = DealString.toGBK(request.getParameter("jtcy5_cw")
				.toString());
		String jtcy5_nl = DealString.toGBK(request.getParameter("jtcy5_nl")
				.toString());
		String jtcy5_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy5_gzdwjzw").toString());
		String jtcy5_jkzk = DealString.toGBK(request.getParameter("jtcy5_jkzk")
				.toString());
		String jtcy5_nsr = DealString.toGBK(request.getParameter("jtcy5_nsr")
				.toString());
		String jtjjknqk = DealString.toGBK(request.getParameter("jtjjknqk")
				);
		String mzbm_yzbm = DealString.toGBK(request.getParameter("mzbm_yzbm")
				.toString());
		String mzbm_lxdh = DealString.toGBK(request.getParameter("mzbm_lxdh")
				.toString());
		String mzbm_lxr = DealString.toGBK(request.getParameter("mzbm_lxr")
				.toString());
		String jfqk_jttg = DealString.toGBK(request.getParameter("jfqk_jttg")
				.toString());
		String jfqk_qtqytg = DealString.toGBK(request.getParameter(
		"jfqk_qtqytg").toString());
		String jfqk_hjtg = DealString.toGBK(request.getParameter("jfqk_hjtg")
				.toString());
		String jfqk_yjfy = DealString.toGBK(request.getParameter("jfqk_yjfy")
				.toString());
		String jfqk_mysffy = DealString.toGBK(request.getParameter(
		"jfqk_mysffy").toString());
		String jfqk_qnhjfy = DealString.toGBK(request.getParameter(
		"jfqk_qnhjfy").toString());
		String jfqk_bxnjttgfybzs = DealString.toGBK(request.getParameter(
		"jfqk_bxnjttgfybzs").toString());
		String jfqk_ljqf = DealString.toGBK(request.getParameter("jfqk_ljqf")
				.toString());
		String jfqk_ywhjjh = DealString.toGBK(request.getParameter(
		"jfqk_ywhjjh").toString());
		String zzqk_sfsqxnqgzx = DealString.toGBK(request.getParameter(
		"zzqk_sfsqxnqgzx").toString());
		String zzqk_xnqgzxyapgw = DealString.toGBK(request.getParameter(
		"zzqk_xnqgzxyapgw").toString());
		String zzqk_sfsqxwqgzx = DealString.toGBK(request.getParameter(
		"zzqk_sfsqxwqgzx").toString());
		String zzqk_sfsbnczxdk = DealString.toGBK(request.getParameter(
		"zzqk_sfsbnczxdk").toString());
		String zzqk_lnyhnczxdhje = DealString.toGBK(request.getParameter(
		"zzqk_lnyhnczxdhje").toString());
		String zzqk_sfsbgxzxdk = DealString.toGBK(request.getParameter(
		"zzqk_sfsbgxzxdk").toString());
		String zzqk_lnyhgxzxdhje = DealString.toGBK(request.getParameter(
		"zzqk_lnyhgxzxdhje").toString());
		String zzqk_sfsbbxzxdk = DealString.toGBK(request.getParameter(
		"zzqk_sfsbbxzxdk").toString());
		String zzqk_lnyhbxzxdhje = DealString.toGBK(request.getParameter(
		"zzqk_lnyhbxzxdhje").toString());
		String zzqk_lnjzxjqk = DealString.toGBK(request.getParameter(
		"zzqk_lnjzxjqk"));
		String sqsj = DealString.toGBK(request.getParameter("sqsj").toString());
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj")
				.toString());
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj")
				.toString());
		String xysh = DealString.toGBK(request.getParameter("xysh").toString());
		String xxsh = DealString.toGBK(request.getParameter("xxsh").toString());
		String sfwsrh = DealString.toGBK(request.getParameter("sfwsrh")
				.toString());
		String sfzbh = DealString.toGBK(request.getParameter("sfzbh")
				.toString());
		String sfdbh = DealString.toGBK(request.getParameter("sfdbh")
				.toString());
		String sffmsxg = DealString.toGBK(request.getParameter("sffmsxg")
				.toString());
		String sfcnh = DealString.toGBK(request.getParameter("sfcnh")
				.toString());
		String sfdsr = DealString.toGBK(request.getParameter("sfdsr")
				.toString()); 

		if (sqsj != null && !"".equalsIgnoreCase(sqsj)) {
			sqsj = sqsj.substring(0, 4) + "年" + sqsj.substring(5, 7) + "月"
			+ sqsj.substring(8) + "日";
		}

		List<String> xszzList = dao.getJsxxStuJzxj(xh);
		if (xszzList.size() != 0) {
			request.setAttribute("notJzxj", "no");
			request.setAttribute("xszzList", xszzList);
		} else {
			zzqk_lnjzxjqk = "无";
			request.setAttribute("notJzxj", "is");
		}

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xh, xm, xb, sfzh, zymc, bjmc, csrq,
				zzmm, jtdz, jtdh, xsdh, rxqhk, sfgr, sfcj, sfdq, sfjszn,
				sfssmz, rxcj, sxqpm, pjcj, cxdd, jtcy1_xm, jtcy1_cw, jtcy1_nl,
				jtcy1_gzdwjzw, jtcy1_nsr, jtcy1_jkzk, jtcy2_xm, jtcy2_cw,
				jtcy2_nl, jtcy2_gzdwjzw, jtcy2_nsr, jtcy2_jkzk, jtcy3_xm,
				jtcy3_cw, jtcy3_nl, jtcy3_gzdwjzw, jtcy3_nsr, jtcy3_jkzk,
				jtcy4_xm, jtcy4_cw, jtcy4_nl, jtcy4_gzdwjzw, jtcy4_nsr,
				jtcy4_jkzk, jtcy5_xm, jtcy5_cw, jtcy5_nl, jtcy5_gzdwjzw,
				jtcy5_nsr, jtcy5_jkzk, jtjjknqk, mzbm_yzbm, mzbm_lxdh,
				mzbm_lxr, jfqk_jttg, jfqk_qtqytg, jfqk_hjtg, jfqk_yjfy,
				jfqk_mysffy, jfqk_qnhjfy, jfqk_bxnjttgfybzs, jfqk_ljqf,
				jfqk_ywhjjh, zzqk_sfsqxnqgzx, zzqk_xnqgzxyapgw,
				zzqk_sfsqxwqgzx, zzqk_sfsbnczxdk, zzqk_lnyhnczxdhje,
				zzqk_sfsbgxzxdk, zzqk_lnyhgxzxdhje, zzqk_sfsbbxzxdk,
				zzqk_lnyhbxzxdhje, zzqk_lnjzxjqk, sqsj, xyshyj, xxshyj, xysh,
				xxsh, sfwsrh, sfzbh, sfdbh, sffmsxg, sfcnh, sfdsr };
		String[] outString = new String[] { "xh", "xm", "xb", "sfzh", "zymc",
				"bjmc", "csrq", "zzmm", "jtdz", "jtdh", "xsdh", "rxqhk",
				"sfgr", "sfcj", "sfdq", "sfjszn", "sfssmz", "rxcj", "sxqpm",
				"pjcj", "cxdd", "jtcy1_xm", "jtcy1_cw", "jtcy1_nl",
				"jtcy1_gzdwjzw", "jtcy1_nsr", "jtcy1_jkzk", "jtcy2_xm",
				"jtcy2_cw", "jtcy2_nl", "jtcy2_gzdwjzw", "jtcy2_nsr",
				"jtcy2_jkzk", "jtcy3_xm", "jtcy3_cw", "jtcy3_nl",
				"jtcy3_gzdwjzw", "jtcy3_nsr", "jtcy3_jkzk", "jtcy4_xm",
				"jtcy4_cw", "jtcy4_nl", "jtcy4_gzdwjzw", "jtcy4_nsr",
				"jtcy4_jkzk", "jtcy5_xm", "jtcy5_cw", "jtcy5_nl",
				"jtcy5_gzdwjzw", "jtcy5_nsr", "jtcy5_jkzk", "jtjjknqk",
				"mzbm_yzbm", "mzbm_lxdh", "mzbm_lxr", "jfqk_jttg",
				"jfqk_qtqytg", "jfqk_hjtg", "jfqk_yjfy", "jfqk_mysffy",
				"jfqk_qnhjfy", "jfqk_bxnjttgfybzs", "jfqk_ljqf", "jfqk_ywhjjh",
				"zzqk_sfsqxnqgzx", "zzqk_xnqgzxyapgw", "zzqk_sfsqxwqgzx",
				"zzqk_sfsbnczxdk", "zzqk_lnyhnczxdhje", "zzqk_sfsbgxzxdk",
				"zzqk_lnyhgxzxdhje", "zzqk_sfsbbxzxdk", "zzqk_lnyhbxzxdhje",
				"zzqk_lnjzxjqk", "sqsj", "xyshyj", "xxshyj", "xysh", "xxsh",
				"sfwsrh", "sfzbh", "sfdbh", "sffmsxg", "sfcnh", "sfdsr" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward jsxx_sbknbz(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		// String xxmc = ToolClass.getXxmc();
		String doType = request.getParameter("doType");// 操作类型
		String titName = request.getParameter("titName");

		String sbsj = "";
		sbsj = request.getParameter("sbsj");
		if (sbsj == null) {
			sbsj = "";
		}

		String[] titNames = null;
		titNames = new String[] { "jsxx_sbknbz" };

		if (titName == null)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		String sql = "";
		String[] outString = new String[] {};
		sql = "select xh,xm,xb,csrq,xydm,xymc,zydm,zymc,bjdm,bjmc,jtdz,lxdh,"
			+ "jtcy1_cw,jtcy1_nl,jtcy1_stzk,jtcy1_gzdwjzw,jtcy1_nsr,"
			+ "jtcy2_cw,jtcy2_nl,jtcy2_stzk,jtcy2_gzdwjzw,jtcy2_nsr,"
			+ "jtcy3_cw,jtcy3_nl,jtcy3_stzk,jtcy3_gzdwjzw,jtcy3_nsr,"
			+ "jtcy4_cw,jtcy4_nl,jtcy4_stzk,jtcy4_gzdwjzw,jtcy4_nsr,"
			+ "jtcy5_cw,jtcy5_nl,jtcy5_stzk,jtcy5_gzdwjzw,jtcy5_nsr,"
			+ "sfljs,sfdq,sfsxg,sfcj,xxqk,cxdd,psbx,jcqk,mnjttgfy,"
			+ "mnqphytgfy,mnhjtgfy,mnyjgzfy,mypjshf,mnhjfy,mncjynqgzxbt,"
			+ "cjywqgzxbc,ywshhjbgk,sbsj,zzyy,yyf,qtfy,sfqf,jtbxlpk,xybxlpk,"
			+ "jtjjzkjsqsbbzly,ywzm,nsqbzje,sqsj,xysh,xyshyj,xxsh,xxshyj "
			+ "from VIEW_JSXX_SBKNBZSQB where 1=2";
		outString = dao.getColumnName(sql);// 获得view_xsjxjzxjsq的列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String xh = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;

			if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
				String jtdz = DealString.toGBK(request.getParameter("jtdz")
						.toString());
				String lxdh = DealString.toGBK(request.getParameter("lxdh")
						.toString());
				String jtcy1_cw = DealString.toGBK(request.getParameter(
				"jtcy1_cw").toString());
				String jtcy1_nl = DealString.toGBK(request.getParameter(
				"jtcy1_nl").toString());
				String jtcy1_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy1_gzdwjzw").toString());
				String jtcy1_stzk = DealString.toGBK(request.getParameter(
				"jtcy1_stzk").toString());
				String jtcy1_nsr = DealString.toGBK(request.getParameter(
				"jtcy1_nsr").toString());
				String jtcy2_cw = DealString.toGBK(request.getParameter(
				"jtcy2_cw").toString());
				String jtcy2_nl = DealString.toGBK(request.getParameter(
				"jtcy2_nl").toString());
				String jtcy2_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy2_gzdwjzw").toString());
				String jtcy2_stzk = DealString.toGBK(request.getParameter(
				"jtcy2_stzk").toString());
				String jtcy2_nsr = DealString.toGBK(request.getParameter(
				"jtcy2_nsr").toString());
				String jtcy3_cw = DealString.toGBK(request.getParameter(
				"jtcy3_cw").toString());
				String jtcy3_nl = DealString.toGBK(request.getParameter(
				"jtcy3_nl").toString());
				String jtcy3_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy3_gzdwjzw").toString());
				String jtcy3_stzk = DealString.toGBK(request.getParameter(
				"jtcy3_stzk").toString());
				String jtcy3_nsr = DealString.toGBK(request.getParameter(
				"jtcy3_nsr").toString());
				String jtcy4_cw = DealString.toGBK(request.getParameter(
				"jtcy4_cw").toString());
				String jtcy4_nl = DealString.toGBK(request.getParameter(
				"jtcy4_nl").toString());
				String jtcy4_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy4_gzdwjzw").toString());
				String jtcy4_stzk = DealString.toGBK(request.getParameter(
				"jtcy4_stzk").toString());
				String jtcy4_nsr = DealString.toGBK(request.getParameter(
				"jtcy4_nsr").toString());
				String jtcy5_cw = DealString.toGBK(request.getParameter(
				"jtcy5_cw").toString());
				String jtcy5_nl = DealString.toGBK(request.getParameter(
				"jtcy5_nl").toString());
				String jtcy5_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy5_gzdwjzw").toString());
				String jtcy5_stzk = DealString.toGBK(request.getParameter(
				"jtcy5_stzk").toString());
				String jtcy5_nsr = DealString.toGBK(request.getParameter(
				"jtcy5_nsr").toString());
				String sfljs = DealString.toGBK(request.getParameter("sfljs")
						.toString());
				String sfdq = DealString.toGBK(request.getParameter("sfdq")
						.toString());
				String sfsxg = DealString.toGBK(request.getParameter("sfsxg")
						.toString());
				String sfcj = DealString.toGBK(request.getParameter("sfcj")
						.toString());
				String xxqk = DealString.toGBK(request.getParameter("xxqk")
						);
				String bkhywbjgkc = DealString.toGBK(request.getParameter(
				"bkhywbjgkc").toString());
				String cxdd = DealString.toGBK(request.getParameter("cxdd")
						.toString());
				String psbx = DealString.toGBK(request.getParameter("psbx")
						.toString());
				String jcqk = DealString.toGBK(request.getParameter("jcqk")
						);
				String mnjttgfy = DealString.toGBK(request.getParameter(
				"mnjttgfy").toString());
				String mnqphytgfy = DealString.toGBK(request.getParameter(
				"mnqphytgfy").toString());
				String mnhjtgfy = DealString.toGBK(request.getParameter(
				"mnhjtgfy").toString());
				String mnyjgzfy = DealString.toGBK(request.getParameter(
				"mnyjgzfy").toString());
				String mypjshf = DealString.toGBK(request.getParameter(
				"mypjshf").toString());
				String mnhjfy = DealString.toGBK(request.getParameter("mnhjfy")
						.toString());
				String mncjynqgzxbt = DealString.toGBK(request.getParameter(
				"mncjynqgzxbt").toString());
				String cjywqgzxbc = DealString.toGBK(request.getParameter(
				"cjywqgzxbc").toString());
				String ywshhjbgk = DealString.toGBK(request.getParameter(
				"ywshhjbgk"));
				sbsj = DealString
				.toGBK(request.getParameter("sbsj").toString());
				String zzyy = DealString.toGBK(request.getParameter("zzyy")
						.toString());
				String yyf = DealString.toGBK(request.getParameter("yyf")
						.toString());
				String qtfy = DealString.toGBK(request.getParameter("qtfy")
						.toString());
				String sfqf = DealString.toGBK(request.getParameter("sfqf")
						.toString());
				String jtbxlpk = DealString.toGBK(request.getParameter(
				"jtbxlpk").toString());
				String xybxlpk = DealString.toGBK(request.getParameter(
				"xybxlpk").toString());
				String jtjjzkjsqsbbzly = DealString.toGBK(request.getParameter(
				"jtjjzkjsqsbbzly"));
				String ywzm = DealString.toGBK(request.getParameter("ywzm")
						.toString());
				String nsqbzje = DealString.toGBK(request.getParameter(
				"nsqbzje").toString());

				sql = "select xxsh from jsxx_sbknbzsqb where xh=? and sbsj=?";
				String[] temp = dao.getOneRs(sql, new String[] { xh, sbsj },
						new String[] { "xxsh" });

				if ((temp != null) && (temp[0].equalsIgnoreCase("通过"))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("jsxx_sbknbzsqb", "xh||sbsj", xh
							+ sbsj, request);

					String[] colName1 = new String[] { "xh", "jtdz", "lxdh",
							"jtcy1_cw", "jtcy1_nl", "jtcy1_stzk",
							"jtcy1_gzdwjzw", "jtcy1_nsr", "jtcy2_cw",
							"jtcy2_nl", "jtcy2_stzk", "jtcy2_gzdwjzw",
							"jtcy2_nsr", "jtcy3_cw", "jtcy3_nl", "jtcy3_stzk",
							"jtcy3_gzdwjzw", "jtcy3_nsr", "jtcy4_cw",
							"jtcy4_nl", "jtcy4_stzk", "jtcy4_gzdwjzw",
							"jtcy4_nsr", "jtcy5_cw", "jtcy5_nl", "jtcy5_stzk",
							"jtcy5_gzdwjzw", "jtcy5_nsr", "sfljs", "sfdq",
							"sfsxg", "sfcj", "xxqk", "bkhywbjgkc", "cxdd",
							"psbx", "jcqk", "mnjttgfy", "mnqphytgfy",
							"mnhjtgfy", "mnyjgzfy", "mypjshf", "mnhjfy",
							"mncjynqgzxbt", "cjywqgzxbc", "ywshhjbgk", "sbsj",
							"zzyy", "yyf", "qtfy", "sfqf", "jtbxlpk",
							"xybxlpk", "jtjjzkjsqsbbzly", "ywzm", "nsqbzje" };

					String[] valueForOut = new String[] { xh, jtdz, lxdh,
							jtcy1_cw, jtcy1_nl, jtcy1_stzk, jtcy1_gzdwjzw,
							jtcy1_nsr, jtcy2_cw, jtcy2_nl, jtcy2_stzk,
							jtcy2_gzdwjzw, jtcy2_nsr, jtcy3_cw, jtcy3_nl,
							jtcy3_stzk, jtcy3_gzdwjzw, jtcy3_nsr, jtcy4_cw,
							jtcy4_nl, jtcy4_stzk, jtcy4_gzdwjzw, jtcy4_nsr,
							jtcy5_cw, jtcy5_nl, jtcy5_stzk, jtcy5_gzdwjzw,
							jtcy5_nsr, sfljs, sfdq, sfsxg, sfcj, xxqk,
							bkhywbjgkc, cxdd, psbx, jcqk, mnjttgfy, mnqphytgfy,
							mnhjtgfy, mnyjgzfy, mypjshf, mnhjfy, mncjynqgzxbt,
							cjywqgzxbc, ywshhjbgk, sbsj, zzyy, yyf, qtfy, sfqf,
							jtbxlpk, xybxlpk, jtjjzkjsqsbbzly, ywzm, nsqbzje };

					boolean ok = false;
					ok = StandardOperation.insert("jsxx_sbknbzsqb",
							colName1, valueForOut, request);

					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {

			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String jtdz = DealString.toGBK(request.getParameter("jtdz")
						.toString());
				String lxdh = DealString.toGBK(request.getParameter("lxdh")
						.toString());
				String jtcy1_cw = DealString.toGBK(request.getParameter(
				"jtcy1_cw").toString());
				String jtcy1_nl = DealString.toGBK(request.getParameter(
				"jtcy1_nl").toString());
				String jtcy1_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy1_gzdwjzw").toString());
				String jtcy1_stzk = DealString.toGBK(request.getParameter(
				"jtcy1_stzk").toString());
				String jtcy1_nsr = DealString.toGBK(request.getParameter(
				"jtcy1_nsr").toString());
				String jtcy2_cw = DealString.toGBK(request.getParameter(
				"jtcy2_cw").toString());
				String jtcy2_nl = DealString.toGBK(request.getParameter(
				"jtcy2_nl").toString());
				String jtcy2_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy2_gzdwjzw").toString());
				String jtcy2_stzk = DealString.toGBK(request.getParameter(
				"jtcy2_stzk").toString());
				String jtcy2_nsr = DealString.toGBK(request.getParameter(
				"jtcy2_nsr").toString());
				String jtcy3_cw = DealString.toGBK(request.getParameter(
				"jtcy3_cw").toString());
				String jtcy3_nl = DealString.toGBK(request.getParameter(
				"jtcy3_nl").toString());
				String jtcy3_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy3_gzdwjzw").toString());
				String jtcy3_stzk = DealString.toGBK(request.getParameter(
				"jtcy3_stzk").toString());
				String jtcy3_nsr = DealString.toGBK(request.getParameter(
				"jtcy3_nsr").toString());
				String jtcy4_cw = DealString.toGBK(request.getParameter(
				"jtcy4_cw").toString());
				String jtcy4_nl = DealString.toGBK(request.getParameter(
				"jtcy4_nl").toString());
				String jtcy4_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy4_gzdwjzw").toString());
				String jtcy4_stzk = DealString.toGBK(request.getParameter(
				"jtcy4_stzk").toString());
				String jtcy4_nsr = DealString.toGBK(request.getParameter(
				"jtcy4_nsr").toString());
				String jtcy5_cw = DealString.toGBK(request.getParameter(
				"jtcy5_cw").toString());
				String jtcy5_nl = DealString.toGBK(request.getParameter(
				"jtcy5_nl").toString());
				String jtcy5_gzdwjzw = DealString.toGBK(request.getParameter(
				"jtcy5_gzdwjzw").toString());
				String jtcy5_stzk = DealString.toGBK(request.getParameter(
				"jtcy5_stzk").toString());
				String jtcy5_nsr = DealString.toGBK(request.getParameter(
				"jtcy5_nsr").toString());
				String sfljs = DealString.toGBK(request.getParameter("sfljs")
						.toString());
				String sfdq = DealString.toGBK(request.getParameter("sfdq")
						.toString());
				String sfsxg = DealString.toGBK(request.getParameter("sfsxg")
						.toString());
				String sfcj = DealString.toGBK(request.getParameter("sfcj")
						.toString());
				String xxqk = DealString.toGBK(request.getParameter("xxqk")
						);
				String bkhywbjgkc = DealString.toGBK(request.getParameter(
				"bkhywbjgkc").toString());
				String cxdd = DealString.toGBK(request.getParameter("cxdd")
						.toString());
				String psbx = DealString.toGBK(request.getParameter("psbx")
						.toString());
				String jcqk = DealString.toGBK(request.getParameter("jcqk")
						);
				String mnjttgfy = DealString.toGBK(request.getParameter(
				"mnjttgfy").toString());
				String mnqphytgfy = DealString.toGBK(request.getParameter(
				"mnqphytgfy").toString());
				String mnhjtgfy = DealString.toGBK(request.getParameter(
				"mnhjtgfy").toString());
				String mnyjgzfy = DealString.toGBK(request.getParameter(
				"mnyjgzfy").toString());
				String mypjshf = DealString.toGBK(request.getParameter(
				"mypjshf").toString());
				String mnhjfy = DealString.toGBK(request.getParameter("mnhjfy")
						.toString());
				String mncjynqgzxbt = DealString.toGBK(request.getParameter(
				"mncjynqgzxbt").toString());
				String cjywqgzxbc = DealString.toGBK(request.getParameter(
				"cjywqgzxbc").toString());
				String ywshhjbgk = DealString.toGBK(request.getParameter(
				"ywshhjbgk"));
				sbsj = DealString
				.toGBK(request.getParameter("sbsj").toString());
				String zzyy = DealString.toGBK(request.getParameter("zzyy")
						.toString());
				String yyf = DealString.toGBK(request.getParameter("yyf")
						.toString());
				String qtfy = DealString.toGBK(request.getParameter("qtfy")
						.toString());
				String sfqf = DealString.toGBK(request.getParameter("sfqf")
						.toString());
				String jtbxlpk = DealString.toGBK(request.getParameter(
				"jtbxlpk").toString());
				String xybxlpk = DealString.toGBK(request.getParameter(
				"xybxlpk").toString());
				String jtjjzkjsqsbbzly = DealString.toGBK(request.getParameter(
				"jtjjzkjsqsbbzly"));
				String ywzm = DealString.toGBK(request.getParameter("ywzm")
						.toString());
				String nsqbzje = DealString.toGBK(request.getParameter(
				"nsqbzje").toString());

				sql = "select xxsh from jsxx_sbknbzsqb where xh=? and sbsj=?";
				String[] temp = dao.getOneRs(sql, new String[] { xh, sbsj },
						new String[] { "xxsh" });

				if ((temp != null) && (temp[0].equalsIgnoreCase("通过"))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("jsxx_sbknbzsqb", "xh||sbsj", xh
							+ sbsj, request);

					String[] colName1 = new String[] { "xh", "jtdz", "lxdh",
							"jtcy1_cw", "jtcy1_nl", "jtcy1_stzk",
							"jtcy1_gzdwjzw", "jtcy1_nsr", "jtcy2_cw",
							"jtcy2_nl", "jtcy2_stzk", "jtcy2_gzdwjzw",
							"jtcy2_nsr", "jtcy3_cw", "jtcy3_nl", "jtcy3_stzk",
							"jtcy3_gzdwjzw", "jtcy3_nsr", "jtcy4_cw",
							"jtcy4_nl", "jtcy4_stzk", "jtcy4_gzdwjzw",
							"jtcy4_nsr", "jtcy5_cw", "jtcy5_nl", "jtcy5_stzk",
							"jtcy5_gzdwjzw", "jtcy5_nsr", "sfljs", "sfdq",
							"sfsxg", "sfcj", "xxqk", "bkhywbjgkc", "cxdd",
							"psbx", "jcqk", "mnjttgfy", "mnqphytgfy",
							"mnhjtgfy", "mnyjgzfy", "mypjshf", "mnhjfy",
							"mncjynqgzxbt", "cjywqgzxbc", "ywshhjbgk", "sbsj",
							"zzyy", "yyf", "qtfy", "sfqf", "jtbxlpk",
							"xybxlpk", "jtjjzkjsqsbbzly", "ywzm", "nsqbzje" };

					String[] valueForOut = new String[] { xh, jtdz, lxdh,
							jtcy1_cw, jtcy1_nl, jtcy1_stzk, jtcy1_gzdwjzw,
							jtcy1_nsr, jtcy2_cw, jtcy2_nl, jtcy2_stzk,
							jtcy2_gzdwjzw, jtcy2_nsr, jtcy3_cw, jtcy3_nl,
							jtcy3_stzk, jtcy3_gzdwjzw, jtcy3_nsr, jtcy4_cw,
							jtcy4_nl, jtcy4_stzk, jtcy4_gzdwjzw, jtcy4_nsr,
							jtcy5_cw, jtcy5_nl, jtcy5_stzk, jtcy5_gzdwjzw,
							jtcy5_nsr, sfljs, sfdq, sfsxg, sfcj, xxqk,
							bkhywbjgkc, cxdd, psbx, jcqk, mnjttgfy, mnqphytgfy,
							mnhjtgfy, mnyjgzfy, mypjshf, mnhjfy, mncjynqgzxbt,
							cjywqgzxbc, ywshhjbgk, sbsj, zzyy, yyf, qtfy, sfqf,
							jtbxlpk, xybxlpk, jtjjzkjsqsbbzly, ywzm, nsqbzje };

					boolean ok = false;
					ok = StandardOperation.insert("jsxx_sbknbzsqb",
							colName1, valueForOut, request);

					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		}

		outString = new String[] { "xh", "xm", "xb", "csrq", "xydm", "xymc",
				"zydm", "zymc", "bjdm", "bjmc", "jtdz", "lxdh", "jtcy1_cw",
				"jtcy1_nl", "jtcy1_stzk", "jtcy1_gzdwjzw", "jtcy1_nsr",
				"jtcy2_cw", "jtcy2_nl", "jtcy2_stzk", "jtcy2_gzdwjzw",
				"jtcy2_nsr", "jtcy3_cw", "jtcy3_nl", "jtcy3_stzk",
				"jtcy3_gzdwjzw", "jtcy3_nsr", "jtcy4_cw", "jtcy4_nl",
				"jtcy4_stzk", "jtcy4_gzdwjzw", "jtcy4_nsr", "jtcy5_cw",
				"jtcy5_nl", "jtcy5_stzk", "jtcy5_gzdwjzw", "jtcy5_nsr",
				"sfljs", "sfdq", "sfsxg", "sfcj", "xxqk", "bkhywbjgkc", "cxdd",
				"psbx", "jcqk", "mnjttgfy", "mnqphytgfy", "mnhjtgfy",
				"mnyjgzfy", "mypjshf", "mnhjfy", "mncjynqgzxbt", "cjywqgzxbc",
				"ywshhjbgk", "sbsj", "zzyy", "yyf", "qtfy", "sfqf", "jtbxlpk",
				"xybxlpk", "jtjjzkjsqsbbzly", "ywzm", "nsqbzje", "sqsj",
				"xysh", "xyshyj", "xxsh", "xxshyj" };

		sql = "select xh,xm,xb,csrq,xydm,xymc,zydm,zymc,bjdm,bjmc,jtdz,lxdh,"
			+ "jtcy1_cw,jtcy1_nl,jtcy1_stzk,jtcy1_gzdwjzw,jtcy1_nsr,"
			+ "jtcy2_cw,jtcy2_nl,jtcy2_stzk,jtcy2_gzdwjzw,jtcy2_nsr,"
			+ "jtcy3_cw,jtcy3_nl,jtcy3_stzk,jtcy3_gzdwjzw,jtcy3_nsr,"
			+ "jtcy4_cw,jtcy4_nl,jtcy4_stzk,jtcy4_gzdwjzw,jtcy4_nsr,"
			+ "jtcy5_cw,jtcy5_nl,jtcy5_stzk,jtcy5_gzdwjzw,jtcy5_nsr,"
			+ "sfljs,sfdq,sfsxg,sfcj,xxqk,bkhywbjgkc,cxdd,psbx,jcqk,"
			+ "mnjttgfy,mnqphytgfy,mnhjtgfy,mnyjgzfy,mypjshf,mnhjfy,"
			+ "mncjynqgzxbt,cjywqgzxbc,ywshhjbgk,sbsj,zzyy,yyf,qtfy,"
			+ "sfqf,jtbxlpk,xybxlpk,jtjjzkjsqsbbzly,ywzm,nsqbzje,sqsj,"
			+ "xysh,xyshyj,xxsh,xxshyj from view_jsxx_sbknbzsqb "
			+ "where xh=? and sbsj=?";
		outValue = dao.getOneRs(sql, new String[] { xh, sbsj }, outString);

		if (outValue == null) {
			if (xh != null) {
				sql = "select v.xh,v.xm,v.xb,v.sfzh,v.xymc,"
					+ "v.zymc,v.bjmc,q.csrq "
					+ "from view_xsjbxx v ,view_stu_details q where v.xh=q.xh and v.xh=?";
				String[] colName = new String[] { "xh", "xm", "xb", "sfzh",
						"xymc", "zymc", "bjmc", "csrq" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {

				} else {
					colName = new String[] { "xh", "xm", "xb", "sfzh", "xymc",
							"zymc", "bjmc", "csrq" };
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward jsxx_sbknbzsqb(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) {
		String sqlb = "";
		sqlb = "江苏信息职业技术学院";

		String xh = DealString.toGBK(request.getParameter("xh").toString());
		String xm = DealString.toGBK(request.getParameter("xm").toString());
		String xb = DealString.toGBK(request.getParameter("xb").toString());
		String csrq = DealString.toGBK(request.getParameter("csrq").toString());
		String xymc = DealString.toGBK(request.getParameter("xymc").toString());
		String zymc = DealString.toGBK(request.getParameter("zymc").toString());
		String bjmc = DealString.toGBK(request.getParameter("bjmc").toString());
		String jtdz = DealString.toGBK(request.getParameter("jtdz"));
		String lxdh = DealString.toGBK(request.getParameter("lxdh").toString());
		String jtcy1_cw = DealString.toGBK(request.getParameter("jtcy1_cw")
				.toString());
		String jtcy1_nl = DealString.toGBK(request.getParameter("jtcy1_nl")
				.toString());
		String jtcy1_stzk = DealString.toGBK(request.getParameter("jtcy1_stzk")
				.toString());
		String jtcy1_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy1_gzdwjzw").toString());
		String jtcy1_nsr = DealString.toGBK(request.getParameter("jtcy1_nsr")
				.toString());
		String jtcy2_cw = DealString.toGBK(request.getParameter("jtcy2_cw")
				.toString());
		String jtcy2_nl = DealString.toGBK(request.getParameter("jtcy2_nl")
				.toString());
		String jtcy2_stzk = DealString.toGBK(request.getParameter("jtcy2_stzk")
				.toString());
		String jtcy2_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy2_gzdwjzw").toString());
		String jtcy2_nsr = DealString.toGBK(request.getParameter("jtcy2_nsr")
				.toString());
		String jtcy3_cw = DealString.toGBK(request.getParameter("jtcy3_cw")
				.toString());
		String jtcy3_nl = DealString.toGBK(request.getParameter("jtcy3_nl")
				.toString());
		String jtcy3_stzk = DealString.toGBK(request.getParameter("jtcy3_stzk")
				.toString());
		String jtcy3_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy3_gzdwjzw").toString());
		String jtcy3_nsr = DealString.toGBK(request.getParameter("jtcy3_nsr")
				.toString());
		String jtcy4_cw = DealString.toGBK(request.getParameter("jtcy4_cw")
				.toString());
		String jtcy4_nl = DealString.toGBK(request.getParameter("jtcy4_nl")
				.toString());
		String jtcy4_stzk = DealString.toGBK(request.getParameter("jtcy4_stzk")
				.toString());
		String jtcy4_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy4_gzdwjzw").toString());
		String jtcy4_nsr = DealString.toGBK(request.getParameter("jtcy4_nsr")
				.toString());
		String jtcy5_cw = DealString.toGBK(request.getParameter("jtcy5_cw")
				.toString());
		String jtcy5_nl = DealString.toGBK(request.getParameter("jtcy5_nl")
				.toString());
		String jtcy5_stzk = DealString.toGBK(request.getParameter("jtcy5_stzk")
				.toString());
		String jtcy5_gzdwjzw = DealString.toGBK(request.getParameter(
		"jtcy5_gzdwjzw").toString());
		String jtcy5_nsr = DealString.toGBK(request.getParameter("jtcy5_nsr")
				.toString());
		String sfljs = DealString.toGBK(request.getParameter("sfljs")
				.toString());
		String sfdq = DealString.toGBK(request.getParameter("sfdq").toString());
		String sfsxg = DealString.toGBK(request.getParameter("sfsxg")
				.toString());
		String sfcj = DealString.toGBK(request.getParameter("sfcj").toString());
		String xxqk = DealString.toGBK(request.getParameter("xxqk"));
		String bkhywbjgkc = DealString.toGBK(request.getParameter("bkhywbjgkc")
				.toString());
		String cxdd = DealString.toGBK(request.getParameter("cxdd").toString());
		String psbx = DealString.toGBK(request.getParameter("psbx"));
		String jcqk = DealString.toGBK(request.getParameter("jcqk"));
		String mnjttgfy = DealString.toGBK(request.getParameter("mnjttgfy")
				.toString());
		String mnqphytgfy = DealString.toGBK(request.getParameter("mnqphytgfy")
				.toString());
		String mnhjtgfy = DealString.toGBK(request.getParameter("mnhjtgfy")
				.toString());
		String mnyjgzfy = DealString.toGBK(request.getParameter("mnyjgzfy")
				.toString());
		String mypjshf = DealString.toGBK(request.getParameter("mypjshf")
				.toString());
		String mnhjfy = DealString.toGBK(request.getParameter("mnhjfy")
				.toString());
		String mncjynqgzxbt = DealString.toGBK(request.getParameter(
		"mncjynqgzxbt").toString());
		String cjywqgzxbc = DealString.toGBK(request.getParameter("cjywqgzxbc")
				.toString());
		String ywshhjbgk = DealString.toGBK(request.getParameter("ywshhjbgk")
				);
		String sbsj = DealString.toGBK(request.getParameter("sbsj").toString());
		String zzyy = DealString.toGBK(request.getParameter("zzyy").toString());
		String yyf = DealString.toGBK(request.getParameter("yyf").toString());
		String qtfy = DealString.toGBK(request.getParameter("qtfy").toString());
		String sfqf = DealString.toGBK(request.getParameter("sfqf").toString());
		String jtbxlpk = DealString.toGBK(request.getParameter("jtbxlpk")
				.toString());
		String xybxlpk = DealString.toGBK(request.getParameter("xybxlpk")
				.toString());
		String jtjjzkjsqsbbzly = DealString.toGBK(request.getParameter(
		"jtjjzkjsqsbbzly"));
		String ywzm = DealString.toGBK(request.getParameter("ywzm").toString());
		String nsqbzje = DealString.toGBK(request.getParameter("nsqbzje")
				.toString());
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj")
				.toString());
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj")
				.toString());

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xh, xm, xb, csrq, xymc, zymc, bjmc,
				jtdz, lxdh, jtcy1_cw, jtcy1_nl, jtcy1_stzk, jtcy1_gzdwjzw,
				jtcy1_nsr, jtcy2_cw, jtcy2_nl, jtcy2_stzk, jtcy2_gzdwjzw,
				jtcy2_nsr, jtcy3_cw, jtcy3_nl, jtcy3_stzk, jtcy3_gzdwjzw,
				jtcy3_nsr, jtcy4_cw, jtcy4_nl, jtcy4_stzk, jtcy4_gzdwjzw,
				jtcy4_nsr, jtcy5_cw, jtcy5_nl, jtcy5_stzk, jtcy5_gzdwjzw,
				jtcy5_nsr, sfljs, sfdq, sfsxg, sfcj, xxqk, bkhywbjgkc, cxdd,
				psbx, jcqk, mnjttgfy, mnqphytgfy, mnhjtgfy, mnyjgzfy, mypjshf,
				mnhjfy, mncjynqgzxbt, cjywqgzxbc, ywshhjbgk, sbsj, zzyy, yyf,
				qtfy, sfqf, jtbxlpk, xybxlpk, jtjjzkjsqsbbzly, ywzm, nsqbzje,
				xyshyj, xxshyj };
		String[] outString = new String[] { "xh", "xm", "xb", "csrq", "xymc",
				"zymc", "bjmc", "jtdz", "lxdh", "jtcy1_cw", "jtcy1_nl",
				"jtcy1_stzk", "jtcy1_gzdwjzw", "jtcy1_nsr", "jtcy2_cw",
				"jtcy2_nl", "jtcy2_stzk", "jtcy2_gzdwjzw", "jtcy2_nsr",
				"jtcy3_cw", "jtcy3_nl", "jtcy3_stzk", "jtcy3_gzdwjzw",
				"jtcy3_nsr", "jtcy4_cw", "jtcy4_nl", "jtcy4_stzk",
				"jtcy4_gzdwjzw", "jtcy4_nsr", "jtcy5_cw", "jtcy5_nl",
				"jtcy5_stzk", "jtcy5_gzdwjzw", "jtcy5_nsr", "sfljs", "sfdq",
				"sfsxg", "sfcj", "xxqk", "bkhywbjgkc", "cxdd", "psbx", "jcqk",
				"mnjttgfy", "mnqphytgfy", "mnhjtgfy", "mnyjgzfy", "mypjshf",
				"mnhjfy", "mncjynqgzxbt", "cjywqgzxbc", "ywshhjbgk", "sbsj",
				"zzyy", "yyf", "qtfy", "sfqf", "jtbxlpk", "xybxlpk",
				"jtjjzkjsqsbbzly", "ywzm", "nsqbzje", "xyshyj", "xxshyj" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	// 学生查看申请结果
	private ActionForward stuResultQuery(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) {
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		String xxdm = StandardOperation.getXxdm();
		String username = session.getAttribute("userName").toString();
		String userType = session.getAttribute("userType").toString();
		String sql = "";
		String[] colList = null;
		String[] colListCN = null;
		Vector<Object> rs = new Vector<Object>();
		String rsNum = "";
		List topTr = new ArrayList<String[]>();
		HashMap<String, String> map = new HashMap<String, String>();
		String gnmkmc = DealString.toGBK(request.getParameter("gnmkmc"));
		String cdlb = request.getParameter("cdlb");
		String doType = request.getParameter("doType");
		ActionForward myActFwd = null;
		List tempList = null;
		String querry = " and 1=1";

		if ("query".equals(doType)) {
			map.put("gnmkmc", gnmkmc);
		}

		querry += Globals.NotJudgeWhichSchool(xxdm);

		if ("result".equalsIgnoreCase(cdlb)) {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC) || xxdm.equalsIgnoreCase(Globals.XXDM_XBEMY)) {// 上海工程技术大学
				sql = "select gnmklj,gnmkmc from xszz_gnmkb where xxdm=? and gnmklx='申请' order by xssx";
				tempList = dao.getList(sql, new String[] { xxdm },
						new String[] { "gnmklj", "gnmkmc" });
			} else if (Globals.JudgeWhichSchool(xxdm)) {
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY)) {
					String userName = session.getAttribute("userName")
							.toString();
					ArrayList<String> userBj = new ArrayList<String>();
					userBj = dao.getUserBj(userName);
					if (userType.equalsIgnoreCase("xy") && userBj.size() != 0) {
						sql = "select a.gnmklj,a.gnmkmc from "
							+ "(select gnmklj,gnmkmc,xssx from xszz_gnmkb where xxdm=? and gnmklx='申请' and gnmkmc in ('困难生','学费缓缴','国家助学贷款')) "
							+ " a order by a.xssx";
					} else {
						sql = "select a.gnmklj,a.gnmkmc from "
							+ "((select gnmklj,gnmkmc,xssx from xszz_gnmkb where xxdm=? and gnmklx='申请' and gnmkmc<>'学生及家庭情况调查') "
							+ "union (select gnmklj,gnmkmc,xssx from xszz_gnmkb where "
							+ "xxmc is null and gnmklx='申请' " + querry
							+ ")) a order by a.xssx";
					}
				} else {
					sql = "select a.gnmklj,a.gnmkmc from "
							+ "((select gnmklj,gnmkmc,xssx from xszz_gnmkb where xxdm=? and gnmklx='申请' and gnmkmc<>'学生及家庭情况调查') "
							+ "union all (select gnmklj,gnmkmc,xssx from xszz_gnmkb where "
							+ "xxmc is null and gnmklx='申请' " + querry
							+ ")) a order by a.xssx";
				}
				tempList = dao.getList(sql, new String[] { xxdm },
						new String[] { "gnmklj", "gnmkmc" });
			} else {
				sql = "select gnmklj,gnmkmc from xszz_gnmkb where xxmc is null and gnmklx='申请'";
				tempList = dao.getList(sql, new String[] {}, new String[] {
						"gnmklj", "gnmkmc" });
			}
			request.setAttribute("list", tempList);
			request.setAttribute("rs", map);
		}

		if ((xxdm.equalsIgnoreCase(Globals.XXDM_SHGC) || xxdm.equalsIgnoreCase(Globals.XXDM_XBEMY)) && "query".equals(doType)) {// 上海工程技术大学
			if ("困难生".equals(gnmkmc)) {
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_shgc_kns.do?isQuery=is",false);
					return myActFwd;
				}
				String tableName = "view_shgc_knsxx"; // 困难生申请表
				sql = "select '/xgxt/shgc_kns.do?pkVal='||xh||nd url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "xymc", "zymc", "bjmc",
						"sqsj", "xysh", "xxsh" };
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("助学贷款".equals(gnmkmc)) {
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_shgc_zxdk.do?isQuery=is",false);
					return myActFwd;
				}
				String tableName = "view_zxdk_xssqxx"; // 困难生申请表
				sql = "select '/xgxt/zxdksq.do?jxjlbType=zxdksq'||'&'||'pkVal='||xh||nd url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "xysh", "xxsh",
				"sqsj" };
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("还款协议".equals(gnmkmc)) {
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_shgc_hkxy.do?isQuery=is",false);
					return myActFwd;
				}
				String tableName = "view_zxdk_hkxy"; // 学生奖学金助学金申请表 各表相同
				sql = "select '' url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colList = new String[] { "url", "行号", "xh", "xm", "hth", "xysh",
						"xxsh", "sqsj" };
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("资助项目".equals(gnmkmc)) {
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/shgc_xszz.do?method=zzsqxxList&isQuery=is",false);
					return myActFwd;
				}
				String tableName = "view_xszz_shgc_zzbbxssqb"; 
				sql = "select '/xgxt/shgc_xszz.do?method=zzsq'||'&'||'pkVal='||nd||bbdm||xh url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colList = new String[] { "url", "行号", "nd", "bbmc", "xh", "xm",
						"xysh", "xypzje", "xxsh", "xxpzje", "sqsj" };
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("绿色通道".equals(gnmkmc)) {
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_lstd.do?isQuery=is",false);
					return myActFwd;
				}
				String tableName = "view_lstdsq"; // 各表相同
				sql = "select '' url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colList = new String[] { "url", "行号", "xh", "xm", "xysh", "xxsh", "sqsj" };
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("国家助学贷款".equals(gnmkmc) && xxdm.equalsIgnoreCase(Globals.XXDM_XBEMY)) {
				String tableName = "view_xszz_common_gjzxdk";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "hj",
						"sqsj", "xysh", "xyshyj", "xxsh", "xxshyj" };
				sql = "select '/xgxt/new_common_xszz.do?method=gjzxdksq'||'&'||'pkVal='||nd||xh url,";
				if (!userType.equalsIgnoreCase("stu")) {
					myActFwd = new ActionForward(
							"/new_common_xszz.do?method=gjzxdksh&isQuery=is",
							false);
					return myActFwd;
				}
				sql += "rownum 行号,a.* from " + tableName + " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
		} else if ("query".equals(doType)) {
			if ("困难生".equals(gnmkmc)) {
				String tableName = "view_knsxx"; // 困难生申请表
				colList = new String[] { "url", "行号", "xh", "xn", "xm", "xysh", "xxsh",
				"sqsj" };
				sql = "select '' url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_xnmz_kns.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_xsjtqkdcb";
					colList = new String[] { "url", "行号", "xh", "xm", "fdysh", "xysh", "xxsh", "sqsj" };
					sql = "select '/xgxt/xnmz_knssq.do' url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_BJLYDX)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_bjly_kns.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_bjlydx_knssqb";
					colList = new String[] { "url", "行号", "xh", "xm", "xysh", "xxsh",
					"sqsj" };
					sql = "select '' url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_JSXX)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_jsxx_knsxx.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "VIEW_JSXX_KNSXX";
					colList = new String[] { "url", "行号", "nd", "xh", "xm", "xysh", "xxsh",
					"sqsj" };
					sql = "select '/xgxt/jsxx_knsxx.do?pkVal='||xh||nd url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_HZZY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/hzzyjsxy_xszz.do?method=knssh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_hzzy_knssqb";
					colList = new String[] { "url", "行号", "nd", "xh", "xm", "mzrd", "xysh", "xxsh",
					"sqsj" };
					sql = "select '/xgxt/hzzyjsxy_xszz.do?method=knssq'||'&'||'pkVal='||nd||xh url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/zjjdzyjsxy_xszz.do?method=knssh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_zjjd_knsxx";
					colList = new String[] { "url", "行号", "nd", "xh", "xm", "fdysh", "fdyshyj", "xysh",
							"xyshyj", "xxsh", "xxshyj", "sqsj" };
					sql = "select '/xgxt/zjjdzyjsxy_xszz.do?method=knssq'||'&'||'pkVal='||nd||xh url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_zzsf_kns.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_zzsf_knsxx";
					colList = new String[] { "url", "行号", "xh", "xm", "xysh", "xxsh",
							"zzdjmc", "zzdjje", "sqsj" };
					sql = "select '' url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_GDNZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_gdnz_kns.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_gdnzzyjsxy_knsxx";
					colList = new String[] { "url", "行号", "xh", "xm", "xysh", "xxsh",
							"kncdpm", "sqsj" };
					sql = "select '/xgxt/gdnz_kns.do' url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/csmz_xszz.do?method=knssh&isQuery=is",
								false);
						return myActFwd;
					}
					tableName = "view_csmz_knsxx";
					colList = new String[] { "url", "行号", "xh", "xm", "nd", "sqsj",
							"fdysh", "xysh", "xxsh" };
					sql = "select '/xgxt/csmz_xszz.do?method=knssq'||'&'||'pkVal='||nd||xh url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_BJLHDX)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/bjlhdx_xszz.do?method=knssh&isQuery=is",
								false);
						return myActFwd;
					}
					tableName = "view_bjlhdx_kns";
					colList = new String[] { "url", "行号", "xh", "xm", "sqsj",
							"xypdjg", "pdsj", "xxsh" };
					sql = "select '/xgxt/bjlhdx_xszz.do?method=knssq'||'&'||'pkVal='||xh url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_SHNLZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/auditing_shnl_kns.do?isQuery=is", false);
						return myActFwd;
					}
					tableName = "view_shnl_knsxx";
					colList = new String[] { "url", "行号", "nd", "xh", "xm", "xb",
							"sqsj", "shjg" };
					sql = "select '/xgxt/shnl_kns.do?pkVal='||xh||nd url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_JHZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/jhzyjsxy_xszz.do?method=knssh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_xszz_jhzy_kns";
					colList = new String[] { "url", "行号", "nd", "xh", "xm",
							"sqsj", "fdysh", "fdyshyj", "xysh", "xyshyj",
							"xxsh", "xxshyj" };
					sql = "select '/xgxt/jhzyjsxy_xszz.do?method=knssq'||'&'||'pkVal='||nd||xh url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_NBLGXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/nblg_xszz.do?method=knssh&isQuery=is", false);
						return myActFwd;
					}
					tableName = "view_nblg_kns";
					colList = new String[] { "url", "行号", "xn", "xh", "xm", "xb",
							"sqsj", "mzpy", "csly", "xysh", "xxsh" };
					sql = "select '/xgxt/nblg_xszz.do?method=knssq'||'&'||'pkVal='||xn||xh url,";
				}
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_kns.do?isQuery=is",false);
					return myActFwd;
				}
				sql += "rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("困难生登记表".equals(gnmkmc)) {
				String tableName = "view_xg_zz_knsdjb"; // 困难生申请表
				colList = new String[] { "url", "行号", "xh", "nd", "xm", "sqsj" };
				sql = "select '' url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_JHZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/jhzyjsxy_xszz.do?method=knsdjbsh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_xg_zz_knsdjb";
					colList = new String[] { "url", "行号", "xh", "nd", "xm", "jtlx", "sqsj" };
					sql = "select '/xgxt/jhzyjsxy_xszz.do?method=knsdjb'||'&'||'pkVal='||nd||xh url,";
				}
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/jhzyjsxy_xszz.do?method=knsdjbsh&isQuery=is",false);
					return myActFwd;
				}
				sql += "rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("贫困生".equals(gnmkmc)) {
				String tableName = "view_csmz_knsxx";
				colList = new String[] { "url", "行号", "xh", "xm", "nd", "sqsj",
						"fdysh", "xysh", "xxsh" };
				sql = "select '/xgxt/csmz_xszz.do?method=knssq&pkVal='||nd||xh url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/csmz_xszz.do?method=knssh&isQuery=is", false);
						return myActFwd;
					}
					tableName = "view_csmz_knsxx";
					colList = new String[] { "url", "行号", "xh", "xm", "nd", "sqsj",
							"fdysh", "xysh", "xxsh" };
					sql = "select '/xgxt/csmz_xszz.do?method=knssq'||'&'||'pkVal='||nd||xh url,";
				}
				sql += "rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("困难生认定".equals(gnmkmc)) {
				String tableName = "view_zzsf_knsxx";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "fdysh", "xysh", "xxsh", "sqsj" };
				sql = "select '/xgxt/zzsf_kns.do?pkVal='||xh||nd url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_zzsf_kns.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_zzsf_knsxx";
					colList = new String[] { "url", "行号", "nd", "xh", "xm", "fdysh", "xysh", "xxsh", "sqsj" };
					sql = "select '/xgxt/zzsf_kns.do?pkVal='||xh||nd url,";
				}
				sql += "rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("国家助学、奖学金".equals(gnmkmc)) {
				String tableName = "view_xsjxjzxjsq"; // 学生奖学金助学金申请表 各表相同
				colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "xysh",
						"xxsh", "sqsj" };
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_gjjzxj.do?isQuery=is",false);
					return myActFwd;
				}
				if(xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)){
					colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "fdysh", "xysh",
						"xxsh", "sqsj" };
				}
				sql = "select '/xgxt/gjjxjzxj.do?jxjlbType=gjjzxj'||'&'||'pkVal='||xh||nd||jzxjmc url,rownum 行号,a.* from " + tableName
				+ " a where jzxjmc in ('gjjxj','gjzxj') and xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("省(市)政府助学、奖学金".equals(gnmkmc)) {
				String tableName = "view_xsjxjzxjsq"; // 学生奖学金助学金申请表 各表相同
				colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "xysh",
						"xxsh", "sqsj" };
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_szfjzxj.do?isQuery=is",false);
					return myActFwd;
				}
				if(xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)){
					colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "xysh",
							"xxsh", "zzdjmc", "zzdjje", "sqsj" };
				}
				if(xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)){
					colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "fdysh", "xysh",
						"xxsh", "sqsj" };
				}
				sql = "select '/xgxt/gjjxjzxj.do?jxjlbType=szfjzxj'||'&'||'pkVal='||xh||nd||jzxjmc url,rownum 行号,a.* from " + tableName
				+ " a where jzxjmc in ('szfjxj','szfzxj') and xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("校内贷学金".equals(gnmkmc)) {
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_xndxj.do?isQuery=is",false);
					return myActFwd;
				}
				String tableName = "view_xsbzxx"; // 校内贷学金
				colList = new String[] { "url", "行号", "xh", "nd", "xm", "BZMC", "xysh",
						"xxsh", "sqsj" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					colList = new String[] { "url", "行号", "xh", "nd", "xm", "BZMC", "xysh",
							"xxsh", "sqsj", "zzdjmc", "zzdjje" };
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					colList = new String[] { "url", "行号", "xh", "nd", "xm", "BZMC", "fdysh",
							"xysh", "xxsh", "sqsj" };
				}
				sql = "select '/xgxt/xndxjsq.do?pkVal='||xh||bzdm||nd url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("心平基金自立助学贷款".equals(gnmkmc)) {
				String tableName = "view_xpjjzxdksq"; // 心平基金自立助学贷款申请表
				sql = "select '' url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colList = new String[] { "url", "行号", "xh", "nd", "xm", "xysh", "xxsh",
				"sqsj" };
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("学费补助".equals(gnmkmc)) {
				String tableName = "view_xsbzxx"; // 学生补助表 //各表相同
				sql = "select '/xgxt/xfbz.do?pkVal='||xh||bzdm||nd url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colList = new String[] { "url", "行号", "xh", "nd", "xm", "BZMC", "xysh",
						"xxsh", "sqsj" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					colList = new String[] { "url", "行号", "xh", "nd", "xm", "BZMC", "xysh",
							"xxsh", "sqsj", "zzdjmc", "zzdjje" };
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					colList = new String[] { "url", "行号", "xh", "nd", "xm", "BZMC", "fdysh",
							"xysh", "xxsh", "sqsj" };
				}
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_xfbz.do?isQuery=is",false);
					return myActFwd;
				}
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("外设助学金".equals(gnmkmc)) {
				String tableName = "view_xswszxjsqxx"; // 外设助学金申请表 各表相同
				colList = new String[] { "url", "行号", "xh", "nd", "xm", "xysh",
						"xxsh", "sqsj" };
				sql = "select '/xgxt/wszxj.do?pkVal='||xh||bzdm||nd url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_SZXXZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_szxx_wszxjsq.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_szxx_wszxjsqb";
					colList = new String[] { "url", "行号", "xh", "nd", "xm", "bzmc", "xysh",
							"xxsh", "sqsj" };
					sql = "select '/xgxt/szxx_wszxjsq.do?pkVal='||xh||bzdm||nd url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					colList = new String[] { "url", "行号", "xh", "nd", "xm", "bzmc", "xysh",
							"xxsh", "zzdjmc", "zzdjje", "sqsj" };
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					colList = new String[] { "url", "行号", "xh", "nd", "xm", "fdysh", "xysh",
							"xxsh", "sqsj" };
				}
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_wszxj.do?isQuery=is",false);
					return myActFwd;
				}
				sql += "rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("校内助学金".equals(gnmkmc)) {
				String tableName = "view_szxx_xnzxjsqb";
				colList = new String[] { "url", "行号", "nd", "xmmc", "xh", "xm",
						"zxjje", "sqsj", "xysh", "xxsh" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_SZXXZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/auditing_szxx_xnzxjsq.do?isQuery=is", false);
						return myActFwd;
					}
					tableName = "view_szxx_xnzxjsqb";
					colList = new String[] { "url", "行号", "nd", "xmmc", "xh", "xm",
							"zxjje", "sqsj", "xysh", "xxsh" };
				}
				sql = "select '/xgxt/szxx_xnzxjsq.do?pkVal='||xh||nd||xmdm url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("绿色通道".equals(gnmkmc)) {
				String tableName = "view_lstdsq"; // 各表相同
				colList = new String[] { "url", "行号", "xh", "xm", "xysh", "xxsh", "sqsj" };
				sql = "select '/xgxt/lstdsq.do?jxjlbType=lstdsq'||'&'||'pkVal='||xh||nd url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_lstd.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_xsjtqkdcb";
					colList = new String[] { "url", "行号", "xh", "xm", "fdysh", "xysh", "xxsh", "sqsj" };
					sql = "select '/xgxt/lstdsq.do?jxjlbType=lstdsq' url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_HZZY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_hzzy_lstdsq.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_hzzy_lstdsqb";
					colList = new String[] { "url", "行号", "xh", "xm", "xysh", "xxsh", "sqsj" };
					sql = "select '/xgxt/hzzy_lstdsq.do?pkVal='||xh||nd url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_zzsf_lstd.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_zzsf_lstd";
					colList = new String[] { "url", "行号", "xh", "xm", "xysh", "xxsh",
							"zzdjmc", "zzdjje", "sqsj" };
					sql = "select '/xgxt/zzsf_lstd.do?pkVal='||xh||nd url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_CQKJXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_cqkjxy_lstd.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_cqkjxy_lstd";
					colList = new String[] { "url", "行号", "xh", "xm", "sqsj", "fdysh", "xysh", "xxsh",
							"tyhjxf", "jzrq" };
					sql = "select '' url,";
				}
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_lstd.do?isQuery=is",false);
					return myActFwd;
				}
				sql += "rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("国家助学贷款".equals(gnmkmc)) {
				String tableName = "view_zzsf_gjzxdk";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "xysh",
						"xxsh", "sqsj" };
				sql = "select '/xgxt/zzsf_gjzxdk.do?pkVal='||xh||nd url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_zzsf_gjzxdk.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_zzsf_gjzxdk";
					sql = "select '/xgxt/zzsf_gjzxdk.do?pkVal='||xh||nd url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_ZBDX)) {
					tableName = "view_zbdx_gjzxdk";
					sql = "select '/xgxt/zbdx_xszz.do?method=gjzxdk' url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_JSXX)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_jsxx_gjzxdk.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "VIEW_JSXX_GJZXDK";
					sql = "select '/xgxt/jsxx_gjzxdk.do?pkVal='||xh||nd url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/csmz_xszz.do?method=gjzxdksh&isQuery=is",
								false);
						return myActFwd;
					}
					tableName = "view_csmz_gjzxdk";
					colList = new String[] { "url", "行号", "xh", "xm", "nd", "sqsj", "sqje", "sqdknx",
							"fdysh", "xysh", "xxsh" };
					sql = "select '/xgxt/csmz_xszz.do?method=gjzxdksq'||'&'||'pkVal='||nd||xh url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_BJLHDX)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/bjlhdx_xszz.do?method=gjzxdksh&isQuery=is",
								false);
						return myActFwd;
					}
					tableName = "view_xszz_bjlh_gjzxdksqb";
					colList = new String[] { "url", "行号", "xh", "xm", "xn", "sqsj", "dkze", "sqzt",
							"fdysh", "xysh", "xxsh", "dkfdsj", "dkdqsj" };
					sql = "select '/xgxt/bjlhdx_xszz.do?method=gjzxdksq'||'&'||'isQuery=is'||'&'||'pkVal='||xn||xh url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/zjjdzyjsxy_xszz.do?method=gjzxdksh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_xszz_zjjd_gjzxdk";
					colList = new String[] { "url", "行号", "nd", "xh", "xm", "xfdk",
							"sqsj", "fdysh", "fdyshyj", "xysh", "xyshyj",
							"xxsh", "xxshyj" };
					sql = "select '/xgxt/zjjdzyjsxy_xszz.do?method=gjzxdksq'||'&'||'pkVal='||nd||xh url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_NBLGXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/nblg_xszz.do?method=gjzxdksh&isQuery=is", false);
						return myActFwd;
					}
					tableName = "view_nblg_gjzxdk";
					colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqje", "sqsj",
							"xysh", "xyshyj", "xxsh", "xxshyj" };
					sql = "select '/xgxt/nblg_xszz.do?method=gjzxdksq'||'&'||'pkVal='||xn||xh url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_GDNZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/gnnzzy_gjzxdk.do?method=zxdkshList&isQuery=is",false);
						return myActFwd;
					}
					tableName = "VIEW_GNNZZY_GJZXDKSQB";
					sql = "select '/xgxt/gnnzzy_gjzxdk.do?method=zxdksq'||'&'||'pkVal='||nd||xh url,";
				}
				sql += "rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("伤、病困难补助".equals(gnmkmc)) {
				String tableName = "VIEW_JSXX_SBKNBZSQB";
				colList = new String[] { "url", "行号", "xh", "xm", "xysh", "xxsh",
						"sbsj", "sqsj" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_JSXX)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_jsxx_sbknbz.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "VIEW_JSXX_SBKNBZSQB";
				}
				sql = "select '/xgxt/jsxx_sbknbz.do?xh='||xh||'&'||'sbsj='||sbsj url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("国家奖学金".equals(gnmkmc)) {
				String tableName = "view_szxx_gjjxjsqb";
				colList = new String[] { "url", "行号", "xh", "nd", "xm", "xysh", "xxsh",
				"sqsj" };
				sql = "select '/xgxt/szxx_gjjxjsq.do?pkVal='||xh||nd url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_zzsf_gjjxj.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_zzsf_gjjxj";
					colList = new String[] { "url", "行号", "xn", "xh", "xm", "zzdjmc", "zzdjje", "xyshrxm", "sqsj", "xysh", "xxsh" };
					sql = "select '/xgxt/zzsf_gjjxj.do?pkVal='||xh||xn url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_HZZY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/hzzyjsxy_xszz.do?method=gjjxjsh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_hzzy_xszz_gjjxj";
					colList = new String[] { "url", "行号", "nd", "xh", "xm", "xymc",
						"zymc", "bjmc", "sqsj", "xysh", "xxsh" };
					sql = "select '/xgxt/hzzyjsxy_xszz.do?method=gjjxjsq'||'&'||'pkVal='||nd||xh url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_gjjzxj.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_xsjxjzxjsq";
					colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "xysh",
							"xxsh", "sqsj" };
					sql = "select '/xgxt/gjjxjzxj.do?jxjlbType=gjjzxj'||'&'||'pkVal='||xh||nd||jzxjmc url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/csmz_xszz.do?method=gjjxjsh&isQuery=is",
								false);
						return myActFwd;
					}
					tableName = "view_csmz_gjjxj";
					colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
							"fdysh", "xysh", "xxsh" };
					sql = "select '/xgxt/csmz_xszz.do?method=gjjxjsq'||'&'||'pkVal='||xn||xh url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_BJLHDX)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/auditing_gjjzxj.do?isQuery=is",
								false);
						return myActFwd;
					}
					tableName = "view_xsjxjzxjsq";
					colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "xysh",
							"xxsh", "sqsj" };
					sql = "select '/xgxt/gjjxjzxj.do?jxjlbType=gjjzxj'||'&'||'pkVal='||xh||nd||jzxjmc url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)){
					//云南艺术
					tableName = "view_xsjxjzxjsq"; // 学生奖学金申请表 各表相同
					colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "xysh",
							"xxsh", "sqsj" };
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_gjjzxj.do?isQuery=is&shxm=gjjxj",false);
						return myActFwd;
					}					
				}
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/auditing_szxx_gjjxjsq.do?isQuery=is",false);
					return myActFwd;
				}
				sql += "rownum 行号,a.* from " + tableName
						+ " a where xh=?";
				if(Globals.XXDM_YNYS.equalsIgnoreCase(xxdm)){
					//云南艺术
					sql = "select '/xgxt/gjjxjzxj.do?jxjlbType=gjjxj'||'&'||'pkVal='||xh||nd||jzxjmc url,rownum 行号,a.* from " + tableName
					+ " a where jzxjmc='gjjxj' and xh=?";				
				}
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				
				
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("国家助学金".equals(gnmkmc)) {
				String tableName = "view_szxx_gjzxjsqb";
				colList = new String[] { "url", "行号", "xh", "nd", "xm", "xysh", "xxsh",
				"sqsj" };
				sql = "select '/xgxt/szxx_gjzxjsq.do?pkVal='||xh||nd url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_SZXXZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_szxx_gjzxjsq.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_szxx_gjzxjsqb";
					colList = new String[] { "url", "行号", "xh", "nd", "xm", "xysh", "xxsh",
					"sqsj" };
					sql = "select '/xgxt/szxx_gjzxjsq.do?pkVal='||xh||nd url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_JSXX)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_jsxx_gjzxj.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_jsxx_gjzxj";
					colList = new String[] { "url", "行号", "xh", "nd", "xm", "xssqdjje", "xysh", "xytysqje", "xxsh",
					"xxtyshje", "sqsj" };
					sql = "select '/xgxt/jsxx_gjzxj.do?pkVal='||xh||nd url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/zjjdzyjsxy_xszz.do?method=gjzxjsh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_zjjd_gjzxjsqb";
					colList = new String[] { "url", "行号", "nd", "xh", "xm", "zxjdjmc",
							"zxjje", "sqsj", "xysh", "xyshyj", "xxsh", "xxshyj" };
					sql = "select '/xgxt/zjjdzyjsxy_xszz.do?method=gjzxjsq'||'&'||'pkVal='||nd||xh url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_BJLHDX)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/bjlh_xszz.do?method=gjzxjsh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_xszz_bjlhdx_gjzxj";
					colList = new String[] { "url", "行号", "xn", "xh", "xm", "zxjmc",
							"zxjje", "sqsj", "xysh", "xyshyj", "xxsh", "xxshyj" };
					sql = "select '/xgxt/bjlh_xszz.do?method=gjzxjsq'||'&'||'pkVal='||xn||xh url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_HZZY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/hzzyjsxy_xszz.do?method=gjzxjsh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_hzzy_xszz_gjzxj";
					colList = new String[] { "url", "行号", "nd", "xh", "xm", "xymc",
							"zymc", "bjmc", "zxjdj", "sqsj", "xysh", "xxsh" };
					sql = "select '/xgxt/hzzyjsxy_xszz.do?method=gjzxjsq'||'&'||'pkVal='||nd||xh url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward("/csmz_xszz.do?method=gjzxjsh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_csmz_gjzxj";
					colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
							"fdysh", "xysh", "xxsh" };
					sql = "select '/xgxt/csmz_xszz.do?method=gjzxjsq'||'&'||'pkVal='||xn||xh url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_zzsf_gjzxj.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_zzsf_gjzxj";
					colList = new String[] { "url", "行号", "xn", "xh", "xm", "zzdjmc", "zzdjje", "xyshryhm", "sqsj", "xysh", "xxsh" };
					sql = "select '/xgxt/zzsf_gjzxj.do?pkVal='||xh||xn url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_NBLGXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/nblg_xszz.do?method=gjzxjsh&isQuery=is", false);
						return myActFwd;
					}
					tableName = "view_nblg_gjzxj";
					colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqdj",
							"sqsj", "bdsyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
					sql = "select '/xgxt/nblg_xszz.do?method=gjzxjsq'||'&'||'pkVal='||xn||xh url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_JHZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/jhzyjsxy_xszz.do?method=gjzxjsh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_xszz_jhzy_gjzxj";
					colList = new String[] { "url", "行号", "nd", "xh", "xm",
							"xymc", "zymc", "bjmc", "zxjdj", "zxjje", "sqsj",
							"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh",
							"xxshyj" };
					sql = "select '/xgxt/jhzyjsxy_xszz.do?method=gjzxjsq'||'&'||'pkVal='||nd||xh url,";
				}
				if(Globals.XXDM_YNYS.equalsIgnoreCase(xxdm)){
					//云南艺术
					tableName = "view_xsjxjzxjsq"; // 学生奖学金申请表 各表相同
					colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "xysh",
							"xxsh", "sqsj" };
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_gjjzxj.do?isQuery=is&shxm=gjzxj",false);
						return myActFwd;
					}
				}
				sql += "rownum 行号,a.* from " + tableName
						+ " a where xh=?";
				if(Globals.XXDM_YNYS.equalsIgnoreCase(xxdm)){
					//云南艺术
					sql = "select '/xgxt/gjjxjzxj.do?jxjlbType=gjzxj'||'&'||'pkVal='||xh||nd||jzxjmc url,rownum 行号,a.* from " + tableName
					+ " a where jzxjmc='gjzxj' and xh=?";				
				}
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("学生学费减免".equals(gnmkmc)) {
				String tableName = "view_zzsf_xsxfjmsq";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "xysh", "xxsh",
						"tyjmje", "sqsj" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_zzsf_xsxfjm.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_zzsf_xsxfjmsq";
				}
				sql = "select '/xgxt/zzsf_xsxfjm.do?pkVal='||xh||nd url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("学费减免".equals(gnmkmc)) {
				String tableName = "view_xszz_zjjd_xfjm";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "sqsj", "xfjmmc", "xfjmje",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/zjjdzyjsxy_xszz.do?method=xfjmsh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_xszz_zjjd_xfjm";
					colList = new String[] { "行号", "nd", "xh", "xm", "sqsj", "xfjmmc", "xfjmje",
							"xysh", "xyshyj", "xxsh", "xxshyj" };
				}
				sql = "select '/xgxt/zjjdzyjsxy_xszz.do?method=xfjmsq'||'&'||'pkVal='||nd||xh url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("国家助学贷款确认书".equals(gnmkmc)) {
				String tableName = "view_zbdx_dkqrs";
				colList = new String[] { "url", "行号", "xh", "nd", "xm", "xysh", "xxsh" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZBDX)) {
					tableName = "view_zbdx_dkqrs";
				}
				sql = "select '' url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("家庭情况调查".equals(gnmkmc)) {
				String tableName = "view_hzzy_jtqkdcb";
				colList = new String[] { "url", "行号", "xh", "xm", "xysh", "xxsh" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_HZZY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_hzzy_jtqkdc.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_hzzy_jtqkdcb";
				}
				sql = "select '/xgxt/hzzy_jtqkdc.do' url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("关爱基金".equals(gnmkmc)) {
				String tableName = "view_hzzy_gajjsqb";
				colList = new String[] { "url", "行号", "xh", "nd", "xm", "xysh", "xxsh", "sqsj" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_HZZY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_hzzy_gajjsq.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_hzzy_gajjsqb";
				}
				sql = "select '/xgxt/hzzy_gajjsq.do?pkVal='||xh||nd url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("校内特困补助".equals(gnmkmc)) {
				String tableName = "view_zzsf_tkbzsq";
				colList = new String[] { "url", "行号", "xh", "nd","xm", "xysh", "xxsh", "sqsj" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_zzsf_tkbz.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_zzsf_tkbzsq";
					colList = new String[] { "行号", "xh", "nd", "xm", "xysh",
							"xxsh", "zzdjmc", "zzdjje", "sqsj" };
				}
				sql = "select '/xgxt/zzsf_tkbz.do?pkVal='||xh||nd url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("困难补助".equals(gnmkmc)) {
				String tableName = "view_hzzy_pksknbz";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "xysh", "xxsh", "sqsj" };
				sql = "select '/xgxt/hzzy_pksknbz.do?pkVal='||xh||nd url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_HZZY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_hzzy_pksknbz.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_hzzy_pksknbz";
					sql = "select '/xgxt/hzzy_pksknbz.do?pkVal='||xh||nd url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_GDNZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_gdnzzyjsxy_knbzsqxx.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_gdnzzyjsxy_knbzsqxx";
					colList = new String[] { "url", "行号", "nd", "knbzmc", "xh", "xm", "xysh", "xxsh", "sqsj" };
					sql = "select '/xgxt/gdnzzyjsxy_knbzsqxx.do?pkVal='||xh||nd||knbzdm url,";
				}
				sql += "rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("奖学金".equals(gnmkmc)) {
				String tableName = "view_gdnzzyjsxy_jxjsqxx";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_GDNZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_gdnzzyjsxy_jxjsqxx.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_gdnzzyjsxy_jxjsqxx";
				}
				sql = "select '/xgxt/gdnzzyjsxy_jxjsqxx.do?pkVal='||xh||nd||jxjdm url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "jlmc", "jlgrje",
						"sqsj", "xysh", "xxsh", "ffrq", "ffje", "cjje", "sfje" };
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("助学金".equals(gnmkmc)) {
				String tableName = "view_gdnzzyjsxy_zxjsqxx";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "zzmc", "zzgrje",
						"sqsj", "xysh", "xxsh", "ffrq", "ffje", "cjje", "sfje" };
				sql = "select '/xgxt/gdnzzyjsxy_zxjsqxx.do?pkVal='||xh||nd||zxjdm url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_GDNZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/auditing_gdnzzyjsxy_zxjsqxx.do?isQuery=is",
								false);
						return myActFwd;
					}
					tableName = "view_gdnzzyjsxy_zxjsqxx";
					sql = "select '/xgxt/gdnzzyjsxy_zxjsqxx.do?pkVal='||xh||nd||zxjdm url,";
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_NBLGXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/nblg_xszz.do?method=zxjsh&isQuery=is", false);
						return myActFwd;
					}
					tableName = "view_nblg_zxj";
					colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqzxjlx",
							"sqsj", "xysh", "xyshyj", "xxsh", "xxshyj" };
					sql = "select '/xgxt/nblg_xszz.do?method=zxjsq'||'&'||'pkVal='||xn||xh url,";
				}
				sql += "rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("开发区慈善总会\"金秋助学\"".equals(gnmkmc)) {
				String tableName = "view_hzzy_jqzx";
				colList = new String[] { "url", "行号", "xh", "nd", "xm", "xysh", "xxsh", "sqsj" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_HZZY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_hzzy_jqzx.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_hzzy_jqzx";
				}
				sql = "select '/xgxt/hzzy_jqzx.do?pkVal='||xh||nd url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("国家励志奖学金".equals(gnmkmc)) {
				String tableName = "view_zzsf_gjlzjxj";
				colList = new String[] { "url", "行号", "xh", "nd", "xm", "xysh", "xxsh", "sqsj" };
				sql = "select '/xgxt/zzsf_gjlzjxj.do?pkVal='||xh||nd url,";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/auditing_zzsf_gjlzjxj.do?isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_zzsf_gjlzjxj";
					sql = "select '/xgxt/zzsf_gjlzjxj.do?pkVal='||xh||nd url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward("/csmz_xszz.do?method=gjlzjxjsh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_csmz_gjlzjxj";
					colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
							"fdysh", "xysh", "xxsh" };
					sql = "select '/xgxt/csmz_xszz.do?method=gjlzjxjsq'||'&'||'pkVal='||xn||xh url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/zjjdzyjsxy_xszz.do?method=gjlzjxjsh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_xszz_zjjd_gjlzjxj";
					colList = new String[] { "url", "行号", "nd", "xh", "xm", "sqsj",
							"xysh", "xyshyj", "xxsh", "xxshyj" };
					sql = "select '/xgxt/zjjdzyjsxy_xszz.do?method=gjlzjxjsq'||'&'||'pkVal='||nd||xh url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_NBLGXY)) {
					if (!userType.equalsIgnoreCase("stu")) {
						myActFwd = new ActionForward(
								"/nblg_xszz.do?method=gjlzjxjsh&isQuery=is", false);
						return myActFwd;
					}
					tableName = "view_nblg_gjzxj";
					colList = new String[] { "url", "行号", "xn", "xh", "xm",
							"sqsj", "bdsyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
					sql = "select '/xgxt/nblg_xszz.do?method=gjlzjxjsq'||'&'||'pkVal='||xn||xh url,";
				}
				if(xxdm.equals(Globals.XXDM_YNYS)){//云南艺术学院
					if (!userType.equalsIgnoreCase("stu")) {
						return new ActionForward("/xszz_ynys.do?method=gjlzjxjwh&sqms=true",false);
					}
					tableName = "view_xszz_ynys_gjlzjxj";
					colList = new String[] { "url", "行号", "nd", "xh", "xm",
							"sqsj", "xysh", "xyshyj", "xxsh", "xxshyj" };
					sql = "select '/xgxt/xszz_ynys.do?method=gjlzjxjpre'||'&'||'sqms=true'||'&'||'pkVal='||nd url,";
				}
				if (xxdm.equalsIgnoreCase(Globals.XXDM_JHZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/jhzyjsxy_xszz.do?method=gjlzjxjsh&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_xszz_jhzy_gjlzjxj";
					colList = new String[] { "url", "行号", "nd", "xh", "xm", "sqsj", "fdysh", "fdyshyj",
							"xysh", "xyshyj", "xxsh", "xxshyj" };
					sql = "select '/xgxt/jhzyjsxy_xszz.do?method=gjlzjxjsq'||'&'||'pkVal='||nd||xh url,";
				}
				sql += "rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if("省政府励志奖学金".equals(gnmkmc)){
				String tableName = "view_xszz_ynys_szflzjxj";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "sqsj", "xysh", "xyshyj", "xxsh", "xxshyj" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
					if (!userType.equalsIgnoreCase("stu")){
						return new ActionForward("/xszz_ynys.do?method=szflzjxjwh&sqms=true",false);
					}
					tableName = "view_xszz_ynys_szflzjxj";
				}
				sql = "select '/xgxt/xszz_ynys.do?method=szflzjxjpre'||'&'||'sqms=true'||'&'||'pkVal='||nd url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
			if ("还贷信息".equals(gnmkmc)) {
				String tableName = "view_gdnzzy_hdjbxx";
				colList = new String[] { "url", "行号", "hth", "xh", "xm", "htje", "zfxjtrq", "hksj" };
				if (xxdm.equalsIgnoreCase(Globals.XXDM_GDNZZYJSXY)) {
					if (!userType.equalsIgnoreCase("stu")){
						myActFwd = new ActionForward("/gnnzzy_gjzxdk.do?method=hdxxshList&isQuery=is",false);
						return myActFwd;
					}
					tableName = "view_gdnzzy_hdjbxx";
				}
				sql = "select '/xgxt/gnnzzy_gjzxdk.do?method=hdxxsq'||'&'||'pkVal='||xh||hth url,rownum 行号,a.* from " + tableName
				+ " a where xh=?";
				
				colListCN = dao.getColumnNameCN(colList, tableName);
				topTr = dao.arrayToList(colList, colListCN);
				if ((request.getParameter("act") != null)
						&& request.getParameter("act").equalsIgnoreCase("go")) {
					rs.addAll(dao.rsToVator(sql, new String[] { username },
							colList));
					if (rs == null) {
						rsNum = "0";
					} else {
						rsNum = String.valueOf(rs.size());
					}
				}
			}
		}
		if ("学费缓缴".equals(gnmkmc)) {
			String tableName = "view_xszz_zjjd_xfhj";
			colList = new String[] { "url", "行号", "nd", "xh", "xm", "hjje", "sqsj",
					"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			sql = "select '/xgxt/zjjdzyjsxy_xszz.do?method=xfhjsq'||'&'||'pkVal='||nd||xh url,";
			if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY)) {
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/zjjdzyjsxy_xszz.do?method=xfhjsh&isQuery=is",false);
					return myActFwd;
				}
				tableName = "view_xszz_zjjd_xfhj";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "hjje", "sqsj", "fdysh", "fdyshyj",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
				sql = "select '/xgxt/zjjdzyjsxy_xszz.do?method=xfhjsq'||'&'||'pkVal='||nd||xh url,";
			}
			if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
				if (!userType.equalsIgnoreCase("stu")) {
					myActFwd = new ActionForward(
							"/xszz_ynys.do?method=xfhjsh&isQuery=is", false);
					return myActFwd;
				}
				tableName = "view_xszz_ynys_xfhj";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "hjje",
						"hjqx", "sqsj", "xysh", "xyshyj", "xxsh", "xxshyj" };
				sql = "select '/xgxt/xszz_ynys.do?method=xfhjsq'||'&'||'pkVal='||nd||xh url,";
			}
			sql += "rownum 行号,a.* from " + tableName + " a where xh=?";
			
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("帮困助学基金".equals(gnmkmc)) {
			String tableName = "view_xszz_jhzy_bkzxjj";
			colList = new String[] { "url", "行号", "xh", "nd", "xm", "fdysh", "xysh", "xxsh", "sqsj" };
			sql = "select '/xgxt/jhzyjsxy_xszz.do?pkVal='||nd||xh url,";
			if (xxdm.equalsIgnoreCase(Globals.XXDM_JHZYJSXY)) {
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/jhzyjsxy_xszz.do?method=bkzxjjsh&isQuery=is",false);
					return myActFwd;
				}
				tableName = "view_xszz_jhzy_bkzxjj";
				colList = new String[] { "url", "行号", "nd", "xh", "xm", "sqsj",
						"zxjjdj", "zxjjje", "fdysh", "fdyshyj", "xysh", "xyshyj",
						"xxsh", "xxshyj" };
				sql = "select '/xgxt/jhzyjsxy_xszz.do?method=bkzxjjsq'||'&'||'pkVal='||nd||xh url,";
			}
			sql += "rownum 行号,a.* from " + tableName
			+ " a where xh=?";
			
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("临时困难补助".equals(gnmkmc)) {
			String tableName = "view_xszz_zjjd_lsbz";
			colList = new String[] { "url", "行号", "xh", "xm", "sqsj", "lsbzmc",
					"lsbzje", "xysh", "xyshyj", "xxsh", "xxshyj" };
			sql = "select '/xgxt/zjjdzyjsxy_xszz.do?method=lsbzsq'||'&'||'pkVal='||id url,";
			if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY)) {
				if (!userType.equalsIgnoreCase("stu")){
					myActFwd = new ActionForward("/zjjdzyjsxy_xszz.do?method=lsbzsh&isQuery=is",false);
					return myActFwd;
				}
				tableName = "view_xszz_zjjd_lsbz";
				colList = new String[] { "url", "行号", "xh", "xm", "sqsj", "lsbzmc", "lsbzje",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
				sql = "select '/xgxt/zjjdzyjsxy_xszz.do?method=lsbzsq'||'&'||'pkVal='||id url,";
			} else if (xxdm.equalsIgnoreCase(Globals.XXDM_NBLGXY)) {
				if (!userType.equalsIgnoreCase("stu")) {
					myActFwd = new ActionForward(
							"/nblg_xszz.do?method=lsknbzsh&isQuery=is", false);
					return myActFwd;
				}
				tableName = "view_nblg_lsknbz";
				colList = new String[] { "url", "行号", "xn", "xh", "xm",
						"sqje", "sqsj", "xysh", "xyshyj", "xxsh", "xxshyj" };
				sql = "select '/xgxt/nblg_xszz.do?method=lsknbzsq'||'&'||'pkVal='||xn||xh url,";
			}
			sql += "rownum 行号,a.* from " + tableName + " a where xh=?";
			
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("彩虹慈善助学金".equals(gnmkmc)) {
			String tableName = "view_nblg_chzxj";
			colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj", "xysh",
					"xyshyj", "xxsh", "xxshyj" };
			if (xxdm.equalsIgnoreCase(Globals.XXDM_NBLGXY)) {
				if (!userType.equalsIgnoreCase("stu")) {
					myActFwd = new ActionForward(
							"/nblg_xszz.do?method=chzxjsh&isQuery=is", false);
					return myActFwd;
				}
				tableName = "view_nblg_chzxj";
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			sql = "select '/xgxt/nblg_xszz.do?method=chzxjsq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from " + tableName + " a where xh=?";
			
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao
						.rsToVator(sql, new String[] { username }, colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("慈善总会高校在校生助学金".equals(gnmkmc)) {
			String tableName = "view_nblg_zxszxj";
			colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj", "xysh",
					"xyshyj", "xxsh", "xxshyj" };
			if (xxdm.equalsIgnoreCase(Globals.XXDM_NBLGXY)) {
				if (!userType.equalsIgnoreCase("stu")) {
					myActFwd = new ActionForward(
							"/nblg_xszz.do?method=zxszxjsh&isQuery=is", false);
					return myActFwd;
				}
				tableName = "view_nblg_chzxj";
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			sql = "select '/xgxt/nblg_xszz.do?method=zxszxjsq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from " + tableName + " a where xh=?";
			
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao
						.rsToVator(sql, new String[] { username }, colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("生源地信用助学贷款".equals(gnmkmc)) {
			String tableName = "view_zzsf_sydxyzxdk";
			colList = new String[] { "url", "行号", "xn", "xh", "xm", "sydxyzxdkhtbh", "sqsj", "xysh",
					"xyshyj", "xxsh", "xxshyj" };
			if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
				if (!userType.equalsIgnoreCase("stu")) {
					myActFwd = new ActionForward(
							"/auditing_zzsf_sydxyzxdk.do?isQuery=is", false);
					return myActFwd;
				}
				tableName = "view_zzsf_sydxyzxdk";
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sydxyzxdkhtbh", "sqsj", "xysh",
						"xyshyj", "xxsh", "xxshyj" };
			}
			sql = "select '/xgxt/zzsf_sydxyzxdk.do?pkVal='||xh||xn url,rownum 行号,a.* from " + tableName + " a where xh=?";
			
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao
						.rsToVator(sql, new String[] { username }, colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("云南艺术学院进步鼓励奖助学金".equals(gnmkmc)) {
			String tableName = "view_xsjxjzxjsq"; // 学生奖学金助学金申请表 各表相同
			colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "xysh",
					"xxsh", "sqsj" };
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/xszz_ynys.do?method=jzxjsh&lx=jbgl&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/xszz_ynys.do?method=jzxjsq&lx=jbgl'||'&'||'pkVal='||xh||nd||jzxjmc url,rownum 行号,a.* from " + tableName
			+ " a where jzxjmc in ('jbgl') and xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("云南艺术学院奖学金".equals(gnmkmc)) {
			String tableName = "view_xsjxjzxjsq"; // 学生奖学金助学金申请表 各表相同
			colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "xysh",
					"xxsh", "sqsj" };
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/xszz_ynys.do?method=jzxjsh&lx=xy&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/xszz_ynys.do?method=jzxjsq&lx=xy'||'&'||'pkVal='||xh||nd||jzxjmc url,rownum 行号,a.* from " + tableName
			+ " a where jzxjmc in ('xy') and xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}		
		if ("云南艺术学院救济助学金".equals(gnmkmc)) {
			String tableName = "view_xsjxjzxjsq"; // 学生奖学金助学金申请表 各表相同
			colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "xysh",
					"xxsh", "sqsj" };
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/xszz_ynys.do?method=jzxjsh&lx=jj&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/xszz_ynys.do?method=jj&lx=jbgl'||'&'||'pkVal='||xh||nd||jzxjmc url,rownum 行号,a.* from " + tableName
			+ " a where jzxjmc in ('jj') and xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("云南艺术学院国家助学贷款奖补专项资金助学金".equals(gnmkmc)) {
			String tableName = "view_xsjxjzxjsq"; // 学生奖学金助学金申请表 各表相同
			colList = new String[] { "url", "行号", "xh", "xm", "nd", "JZXJZWMC", "xysh",
					"xxsh", "sqsj" };
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/xszz_ynys.do?method=jzxjsh&lx=gjzxdkjbzx&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/xszz_ynys.do?method=jj&lx=gjzxdkjbzx'||'&'||'pkVal='||xh||nd||jzxjmc url,rownum 行号,a.* from " + tableName
			+ " a where jzxjmc in ('gjzxdkjbzx') and xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		request.setAttribute("rs", rs);// 发送数据集
		request.setAttribute("topTr", topTr);// 发送表头
		request.setAttribute("rsNum", rsNum);// 发送记录数
		request.setAttribute("rs1", map);// 把查询条件发回去
		return mapping.findForward("success");
	}
	
//	 学生查看申请结果
	@SuppressWarnings("unchecked")
	private ActionForward stuResultQueryCommon(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		XszzCommonN05Service service = new XszzCommonN05Service();
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		String xxdm = StandardOperation.getXxdm();
		String username = session.getAttribute("userName").toString();
		String userType = session.getAttribute("userType").toString();
		String sql = "";
		String[] colList = null;
		String[] colListCN = null;
		Vector<Object> rs = new Vector<Object>();
		String rsNum = "";
		List topTr = new ArrayList<String[]>();
		HashMap<String, String> map = new HashMap<String, String>();
		String gnmklj = DealString.toGBK(request.getParameter("gnmklj"));
		String cdlb = request.getParameter("cdlb");
		String doType = request.getParameter("doType");
		ActionForward myActFwd = null;
		List tempList = null;
		String querry = " and 1=1";

		if ("query".equals(doType)) {
			map.put("gnmklj", gnmklj);
		}

		querry += Globals.NotJudgeWhichSchool(xxdm);

		if ("result".equalsIgnoreCase(cdlb)) {
			sql = "select gnmklj,gnmkmc from xszz_gnmkb where xxmc is null and gnmklx='申请' and gnmkmc<>'外设助学金 ' order by to_number(xssx)";
			tempList = dao.getList(sql, new String[] {}, new String[] {
					"gnmklj", "gnmkmc" });
			String num = dao.getOneRs("select count(*) num from xszz_gnmkb where gnmklj like 'n05_xszz.do?method=wszxj1%'", new String[]{}, "num");
			if (!"0".equalsIgnoreCase(num)) {
				tempList.addAll(dao.getList(
						"select 'n05_xszz.do?method=wszxj1sq&xmdm='||xmdm gnmklj,xmmc gnmkmc from xszz_com_wszxjdmb order by xmdm",
						new String[] {}, new String[] {
								"gnmklj", "gnmkmc" }));
			}
			num = dao.getOneRs("select count(*) num from xszz_gnmkb where gnmklj like 'n05_xszz.do?method=wszxj2%'", new String[]{}, "num");
			if (!"0".equalsIgnoreCase(num)) {
				tempList.addAll(dao.getList(
						"select 'n05_xszz.do?method=wszxj2sq&xmdm='||xmdm gnmklj,xmmc gnmkmc from xszz_com_wszxjdmb order by xmdm",
						new String[] {}, new String[] {
								"gnmklj", "gnmkmc" }));
			}
			request.setAttribute("list", tempList);
			request.setAttribute("rs", map);
		}
		
		//================2010/6/29 edit by luojw==============================
		if ("xszz_jjkns_sq.do".equals(gnmklj)) {//经济困难生认定
			myActFwd = new ActionForward("/xszz_jjkns_jg.do",false);
			return myActFwd;
		}
		// ================end==============================
		
		if ("n05_xszz.do?method=jtqkdc1sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_jtqkdc1";
			colList = new String[] { "url", "行号", "xh", "xm", "xb", "sfzh", "txsj" };
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=jtqkdc1query&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=jtqkdc1sq'||'&'||'pkVal='||xh url,rownum 行号,a.* from view_xszz_com_jtqkdc1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=knsrd1sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_knsrdb1"; // 困难生认定
			colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
					"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=knsrd1sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=knsrd1sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_knsrdb1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=knsrd2sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_knsrdb1"; // 困难生认定
			colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
					"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=knsrd2sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=knsrd2sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_knsrdb1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=knsrd3sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_knsrdb3"; // 困难生认定
			colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
					"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=knsrd3sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=knsrd3sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_knsrdb3 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=knsrd4sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_knsrdb1"; // 困难生认定
			colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
					"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=knsrd4sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=knsrd4sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_knsrdb1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=knslsbz1sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_knslsbz1"; // 困难生临时补助
			String shjb = service.getShjb("view_xszz_com_knslsbz1");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "kndj", "sqje", "sqsj",
						"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "kndj", "sqje", "sqsj",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=knslsbz1sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=knslsbz1sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_knslsbz1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=lsbz2sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_knslsbz2"; // 临时补助
			String shjb = service.getShjb("view_xszz_com_knslsbz2");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xqmc", "xh", "xm", "sqje", "sqsj", "pzje",
						"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xqmc", "xh", "xm", "sqje", "sqsj", "pzje",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=lsbz2sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=lsbz2sq'||'&'||'pkVal='||xn||xq||xh url,rownum 行号,a.* from view_xszz_com_knslsbz2 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=gjjxj1sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_gjjxj1"; // 国家奖学金
			String shjb = service.getShjb("view_xszz_com_gjjxj1");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=gjjxj1sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=gjjxj1sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_gjjxj1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=gjzxj1sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_gjzxj1"; // 国家助学金
			String shjb = service.getShjb("view_xszz_com_gjzxj1");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"zxjdj", "zxjje", "fdysh", "fdyshyj", "xysh", "xyshyj",
						"xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"zxjdj", "zxjje", "xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=gjzxj1sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=gjzxj1sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_gjzxj1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=gjzxj2sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_gjzxj2"; // 国家助学金
			String shjb = service.getShjb("view_xszz_com_gjzxj2");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"zxjdj", "zxjje", "rdqk", "fdysh", "fdyshyj", "xysh", "xyshyj",
						"xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"zxjdj", "zxjje", "rdqk", "xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=gjzxj2sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=gjzxj2sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_gjzxj2 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=gjzxj3sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_gjzxj3"; // 国家助学金
			String shjb = service.getShjb("view_xszz_com_gjzxj3");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"zxjdj", "zxjje", "fdysh", "fdyshyj", "xysh", "xyshyj",
						"xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"zxjdj", "zxjje", "xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=gjzxj3sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=gjzxj3sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_gjzxj3 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=gjlzjxj1sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_gjlzjxj1"; // 国家励志奖学金
			String shjb = service.getShjb("view_xszz_com_gjlzjxj1");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=gjlzjxj1sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=gjlzjxj1sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_gjlzjxj1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=gjlzjxj2sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_gjlzjxj2"; // 国家励志奖学金
			String shjb = service.getShjb("view_xszz_com_gjlzjxj2");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=gjlzjxj2sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=gjlzjxj2sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_gjlzjxj2 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=xfjm1sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_xfjm1"; // 学费减免
			String shjb = service.getShjb("view_xszz_com_xfjm1");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqsj",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=xfjm1sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=xfjm1sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_xfjm1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=xfjm2sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_xfjm2"; // 学费减免
			String shjb = service.getShjb("view_xszz_com_xfjm2");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xqmc", "xh", "xm", "sqjmje", "sqsj", "pzjmje",
						"fdysh", "fdyshyj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xqmc", "xh", "xm", "sqjmje", "sqsj", "pzjmje",
						"xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=xfjm2sh&isQuery=is",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=xfjm2sq'||'&'||'pkVal='||xn||xq||xh url,rownum 行号,a.* from view_xszz_com_xfjm2 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=xfjm3Add".equals(gnmklj)) {
			String tableName = "view_xszz_com_xfjm3"; // 学费减免
			String shjb = service.getShjb("view_xszz_com_xfjm3");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xh", "xm", "xb", "xn", "nj", 
		                  "xymc", "bjmc", "sqdc", "sqsj", "spdc", 
		                  "jmje", "fdysh", "xysh", "xxsh" };
			} else {
				colList = new String[] { "url", "行号", "xh", "xm", "xb", "xn", "nj", 
		                  "xymc", "bjmc", "sqdc", "sqsj", "spdc", 
		                  "jmje", "xysh", "xxsh" };
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/n05_xszz.do?method=xfjm3",false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=xfjm3Add'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_xfjm3 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=xfhj1sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_xfhj1"; // 学费缓交
			String shjb = service.getShjb("view_xszz_com_xfhj1");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "hjje",
						"hjqx", "sqsj", "fdysh", "fdyshyj", "xysh", "xyshyj",
						"xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "hjje",
						"hjqx", "sqsj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")) {
				myActFwd = new ActionForward(
						"/n05_xszz.do?method=xfhj1sh&isQuery=is", false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=xfhj1sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_xfhj1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("n05_xszz.do?method=xfhj2sq".equals(gnmklj)) {
			String tableName = "view_xszz_com_xfhj2"; // 学费缓交
			String shjb = service.getShjb("view_xszz_com_xfhj2");
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "hjxf", "hjzsf",
						"hjxzfqx", "sqsj", "fdysh", "fdyshyj", "xysh", "xyshyj",
						"xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "hjxf", "hjzsf",
						"hjxzfqx", "sqsj", "xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")) {
				myActFwd = new ActionForward(
						"/n05_xszz.do?method=xfhj2sh&isQuery=is", false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=xfhj2sq'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_xfhj2 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}		
		 // 学费缓交
		if ("n05_xszz.do?method=xfhj3Add".equals(gnmklj)) {
			String tableName = "view_xszz_com_xfhj3"; // 学费缓交
			String shjb = service.getShjb("view_xszz_com_xfhj3");//审核级别
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xh", "xm", "sfzh","xn","nj",
										 "xymc","bjmc","hjje","sqsj", "fdysh", 
						                 "fdyshyj", "xysh", "xyshyj", "xxsh", 
						                 "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xh", "xm", "sfzh","xn","nj",
										 "xymc","bjmc","hjje","sqsj", "xysh", 
										 "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")) {
				myActFwd = new ActionForward(
						"/n05_xszz.do?method=xfhj3", false);
				return myActFwd;
			}
			//TODO 学生查询
			sql = "select '/xgxt/n05_xszz.do?method=xfhj3Add'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_xfhj3 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		 // 住宿费缓交
		if ("n05_xszz.do?method=zsfhj1Add".equals(gnmklj)) {
			String tableName = "view_xszz_com_zsfhj1"; // 住宿费缓交
			String shjb = service.getShjb("view_xszz_com_zsfhj1");//审核级别
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xh", "xm", "sfzh","xn","nj",
										 "xymc","bjmc","hjje","sqsj", "fdysh", 
						                 "fdyshyj", "xysh", "xyshyj", "xxsh", 
						                 "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xh", "xm", "sfzh","xn","nj",
										 "xymc","bjmc","hjje","sqsj", "xysh", 
										 "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")) {
				myActFwd = new ActionForward(
						"/n05_xszz.do?method=zsfhj1", false);
				return myActFwd;
			}
			//TODO 学生查询
			sql = "select '/xgxt/n05_xszz.do?method=zsfhj1Add'||'&'||'pkVal='||xn||xh url,rownum 行号,a.* from view_xszz_com_zsfhj1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if (gnmklj.startsWith("n05_xszz.do?method=wszxj1sq")) {
			String xmdm = gnmklj.substring(gnmklj.lastIndexOf("xmdm")+5);
			String tableName = "view_xszz_com_wszxj1"; // 外设助学金
			String shjb = service.getShjb("view_xszz_com_wszxj1"+xmdm);
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqje",
						"sqsj", "pzje", "fdysh", "fdyshyj", "xysh", "xyshyj",
						"xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqje",
						"sqsj", "pzje", "xysh", "xyshyj", "xxsh", "xxshyj" };
			}
			if (!userType.equalsIgnoreCase("stu")) {
				myActFwd = new ActionForward(
						"/n05_xszz.do?method=wszxj1sh&isQuery=is&xmdm="+xmdm, false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=wszxj1sq'||'&'||'pkVal='||xn||zxjdm||xh||'&'||'xmdm='||zxjdm url,rownum 行号,a.* from view_xszz_com_wszxj1 a where xh=? and zxjdm=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username, xmdm },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if (gnmklj.startsWith("n05_xszz.do?method=wszxj2sq")) {
			String xmdm = gnmklj.substring(gnmklj.lastIndexOf("xmdm")+5);
			String tableName = "view_xszz_com_wszxj2"; // 外设助学金
			String shjb = service.getShjb("view_xszz_com_wszxj1"+xmdm);
			
			if ("3".equalsIgnoreCase(shjb)) {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqje",
						"sqsj", "pzje", "fdysh", "fdyshyj", "xysh", "xyshyj",
						"xxsh", "xxshyj" };
			} else {
				colList = new String[] { "url", "行号", "xn", "xh", "xm", "sqje",
						"sqsj", "pzje", "xysh", "xxsh" };
			}
			if (!userType.equalsIgnoreCase("stu")) {
				myActFwd = new ActionForward(
						"/n05_xszz.do?method=wszxj2sh&isQuery=is&xmdm="+xmdm, false);
				return myActFwd;
			}
			sql = "select '/xgxt/n05_xszz.do?method=wszxj2sq'||'&'||'pkValue='||xn||zxjdm||xh||'&'||'xmdm='||zxjdm url,rownum 行号,a.* from view_xszz_com_wszxj2 a where xh=? and zxjdm=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username, xmdm },
						colList));
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		if ("nbtyJtjjkns.do?method=jtjjknsSq".equals(gnmklj)) {
			
			NbtyJtjjknsService nbtyJtjjknsService=new NbtyJtjjknsService();
			String tableName = "VIEW_NBTY_XSZZ_JTJJKNS1"; //TODO 宁波天一 家庭经济困难学生困难补助
			String shjb=(nbtyJtjjknsService.getShjb(tableName).get(0)).get("jb");//审核级别
			if("3".equalsIgnoreCase(shjb)){
				colList = new String[] {"url", "pk", "xh", "xm", "xb", "xn","nd","bzmc", "bjmc",
					 "fdysh","xysh", "xxsh"  };
			}else{
				colList = new String[] {"url", "pk", "xh", "xm", "xb", "xn","nd","bzmc", "bjmc",
						 "xysh", "xxsh"  };	
			}
			if (!userType.equalsIgnoreCase("stu")){
				myActFwd = new ActionForward("/nbtyJtjjkns.do?method=jtjjknsResult",false);
				return myActFwd;
			}
			sql = "select '/xgxt/nbtyJtjjkns.do?method=oneJtjjknsbz&doType=save&pkValue='||xh||xn||bzlx url,rownum 行号,a.* from VIEW_NBTY_XSZZ_JTJJKNS1 a where xh=?";
			colListCN = dao.getColumnNameCN(colList, tableName);
			topTr = dao.arrayToList(colList, colListCN);
			if ((request.getParameter("act") != null)
					&& request.getParameter("act").equalsIgnoreCase("go")) {
				rs.addAll(dao.rsToVator(sql, new String[] { username }, colList));
				
				if (rs == null) {
					rsNum = "0";
				} else {
					rsNum = String.valueOf(rs.size());
				}
			}
		}
		request.setAttribute("rs", rs);// 发送数据集
		request.setAttribute("topTr", topTr);// 发送表头
		request.setAttribute("rsNum", rsNum);// 发送记录数
		request.setAttribute("rs1", map);// 把查询条件发回去
		return mapping.findForward("success");
	}

	private ActionForward zzsf_xsxfjm(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		String userType;

		// String userDep;

		String sUName;

		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String doType = request.getParameter("doType");

		String xxmc = ToolClass.getXxmc();
		String sfksq = "-1";

		request.setAttribute("xxmc", xxmc);
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间

		sql = "select dm xslb,mc xslbmc from zzsf_xslb";
		List xslbList = dao.getList(sql, new String[] {}, new String[] {
				"xslb", "xslbmc" });

		String[] outString = new String[] {};
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
		String xh = "";
		String pkVal = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;

			sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='学生学费减免' and b.xh=? ";
			jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
					"kssj", "jssj" });
			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String xslb = DealString.toGBK(request.getParameter("xslb")
							.toString());
					String jzxm = DealString.toGBK(request.getParameter("jzxm")
							.toString());
					String jtdz = DealString.toGBK(request.getParameter("jtdz")
							.toString());
					String yzbm = DealString.toGBK(request.getParameter("yzbm")
							.toString());
					String jtdh = DealString.toGBK(request.getParameter("jtdh")
							.toString());
					String ssdz = DealString.toGBK(request.getParameter("ssdz")
							.toString());
					String ssdh = DealString.toGBK(request.getParameter("ssdh")
							.toString());
					String jtjjqk = DealString.toGBK(
							request.getParameter("jtjjqk").toString());
					String yxknbzqk = DealString.toGBK(
							request.getParameter("yxknbzqk").toString());
					String qggw = DealString.toGBK(request.getParameter("qggw")
							.toString());
					String psbxqk = DealString.toGBK(
							request.getParameter("psbxqk").toString());
					String sqzl = DealString.toGBK(request.getParameter("sqzl")
							.toString());
					String sqje = DealString.toGBK(request.getParameter("sqje")
							.toString());
					String gehjqk = DealString.toGBK(
							request.getParameter("gehjqk").toString());
					String xxcj = DealString.toGBK(request.getParameter("xxcj")
							.toString());
					String bz = DealString.toGBK(
							request.getParameter("bz").toString());
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}

					sql = "select xxsh from zzsf_xsxfjmsq where xh||nd=? ";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xxsh" });
					
					String[] colName1 = new String[] { "xh", "nd", "xslb",
							"jzxm", "jtdz", "yzbm", "jtdh", "ssdz", "ssdh",
							"jtjjqk", "yxknbzqk", "qggw", "psbxqk", "sqzl",
							"sqje", "gehjqk", "xxcj", "bz" };

					String[] valueForOut = new String[] { xh, nd, xslb,
							jzxm, jtdz, yzbm, jtdh, ssdz, ssdh, jtjjqk,
							yxknbzqk, qggw, psbxqk, sqzl, sqje, gehjqk,
							xxcj, bz };
					
					if (temp == null) {
						boolean ok = false;
						ok = StandardOperation.insert("zzsf_xsxfjmsq",
								colName1, valueForOut, request);
						if (ok) {
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					} else {
						if ("通过".equalsIgnoreCase(temp[0]) || "已通过"
										.equalsIgnoreCase(temp[0])) {
							request.setAttribute("isPASS", "is");
						} else {
							colName1 = new String[] { "xh", "nd", "xslb",
									"jzxm", "jtdz", "yzbm", "jtdh", "ssdz",
									"ssdh", "jtjjqk", "yxknbzqk", "qggw",
									"psbxqk", "sqzl", "sqje", "gehjqk", "xxcj",
									"bz", "sqsj", "xysh", "xxsh", "xyshyj",
									"xxshyj", "zzdjdm", "xyzzfzryj",
									"xyshryhm", "tyjmje", "tyjmjedx" };

							valueForOut = new String[] { xh, nd, xslb, jzxm,
									jtdz, yzbm, jtdh, ssdz, ssdh, jtjjqk,
									yxknbzqk, qggw, psbxqk, sqzl, sqje, gehjqk,
									xxcj, bz, rightNow, "未审核", "未审核", "", "",
									"", "", "", "", "" };

							boolean ok = false;
							ok = StandardOperation.update("zzsf_xsxfjmsq",
									colName1, valueForOut, "xh||nd", pkVal,
									request);
							if (ok) {
								request.setAttribute("ok", "ok");
							} else {
								request.setAttribute("ok", "no");
							}
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String xslb = DealString.toGBK(request.getParameter("xslb")
						.toString());
				String jzxm = DealString.toGBK(request.getParameter("jzxm")
						.toString());
				String jtdz = DealString.toGBK(request.getParameter("jtdz")
						.toString());
				String yzbm = DealString.toGBK(request.getParameter("yzbm")
						.toString());
				String jtdh = DealString.toGBK(request.getParameter("jtdh")
						.toString());
				String ssdz = DealString.toGBK(request.getParameter("ssdz")
						.toString());
				String ssdh = DealString.toGBK(request.getParameter("ssdh")
						.toString());
				String jtjjqk = DealString.toGBK(
						request.getParameter("jtjjqk").toString());
				String yxknbzqk = DealString.toGBK(
						request.getParameter("yxknbzqk").toString());
				String qggw = DealString.toGBK(request.getParameter("qggw")
						.toString());
				String psbxqk = DealString.toGBK(
						request.getParameter("psbxqk").toString());
				String sqzl = DealString.toGBK(request.getParameter("sqzl")
						.toString());
				String sqje = DealString.toGBK(request.getParameter("sqje")
						.toString());
				String gehjqk = DealString.toGBK(
						request.getParameter("gehjqk").toString());
				String xxcj = DealString.toGBK(request.getParameter("xxcj")
						.toString());
				String bz = DealString.toGBK(
						request.getParameter("bz").toString());
				pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = xh + nd;
				}

				sql = "select xxsh from zzsf_xsxfjmsq where xh||nd=? ";
				String[] temp = dao.getOneRs(sql, new String[] { pkVal },
						new String[] { "xxsh" });
				String[] colName1 = new String[] { "xh", "nd", "xslb",
						"jzxm", "jtdz", "yzbm", "jtdh", "ssdz", "ssdh",
						"jtjjqk", "yxknbzqk", "qggw", "psbxqk", "sqzl",
						"sqje", "gehjqk", "xxcj", "bz" };

				String[] valueForOut = new String[] { xh, nd, xslb,
						jzxm, jtdz, yzbm, jtdh, ssdz, ssdh, jtjjqk,
						yxknbzqk, qggw, psbxqk, sqzl, sqje, gehjqk,
						xxcj, bz };
				
				if (temp == null) {
					boolean ok = false;
					ok = StandardOperation.insert("zzsf_xsxfjmsq",
							colName1, valueForOut, request);
					if (ok) {
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				} else {
					if ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0])) {
						request.setAttribute("isPASS", "is");
					} else {
						colName1 = new String[] { "xh", "nd", "xslb",
								"jzxm", "jtdz", "yzbm", "jtdh", "ssdz",
								"ssdh", "jtjjqk", "yxknbzqk", "qggw",
								"psbxqk", "sqzl", "sqje", "gehjqk", "xxcj",
								"bz", "sqsj", "xysh", "xxsh", "xyshyj",
								"xxshyj", "zzdjdm", "xyzzfzryj",
								"xyshryhm", "tyjmje", "tyjmjedx" };

						valueForOut = new String[] { xh, nd, xslb, jzxm,
								jtdz, yzbm, jtdh, ssdz, ssdh, jtjjqk,
								yxknbzqk, qggw, psbxqk, sqzl, sqje, gehjqk,
								xxcj, bz, rightNow, "未审核", "未审核", "", "",
								"", "", "", "", "" };

						boolean ok = false;
						ok = StandardOperation.update("zzsf_xsxfjmsq",
								colName1, valueForOut, "xh||nd", pkVal,
								request);
						if (ok) {
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			}
		}

		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd;
		}
		outString = new String[] { "xh", "nd", "xm", "xb", "sfzh", "xydm",
				"xymc", "zydm", "zymc", "bjdm", "bjmc", "csrq", "syd", "zzmm",
				"xslb", "xslbmc", "jzxm", "jtdz", "yzbm", "jtdh", "ssdz",
				"ssdh", "jtjjqk", "yxknbzqk", "qggw", "psbxqk", "sqzl", "sqje",
				"gehjqk", "xxcj", "sqsj", "xysh", "xyshyj", "tyjmje",
				"tyjmjedx", "xxsh", "xxshyj", "bz" };
		sql = "select xh,nd,xm,xb,sfzh,xydm,xymc,zydm,zymc,bjdm,bjmc,csrq,syd,"
			+ "zzmm,xslb,xslbmc,jzxm,jtdz,yzbm,jtdh,ssdz,ssdh,jtjjqk,yxknbzqk,"
			+ "qggw,psbxqk,sqzl,sqje,gehjqk,xxcj,sqsj,xysh,xyshyj,tyjmje,"
			+ "tyjmjedx,xxsh,xxshyj,bz from VIEW_ZZSF_XSXFJMSQ where xh||nd=? ";
		outValue = dao.getOneRs(sql, new String[] { pkVal }, outString);

		if (outValue == null) {
			if (xh != null) {
				sql = "select j.xh,j.xm,j.xb,j.sfzh,j.xydm,j.xymc,"
					+ "j.zydm,j.zymc,j.bjdm,j.bjmc,(select b.csrq from view_stu_details b where b.xh=j.xh) csrq,"
					+ "(select b.lydq syd from view_stu_details b where b.xh=j.xh) syd,"
					+ "(select b.zzmmmc zzmm from view_stu_details b where "
					+ "b.xh=j.xh) zzmm from "
					+ "view_xsjbxx j where j.xh=?";
				String[] colName = new String[] { "xh", "xm", "xb", "sfzh",
						"xydm", "xymc", "zydm", "zymc", "bjdm", "bjmc", "csrq",
						"syd", "zzmm" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {

				} else {
					colName = new String[] { "xh", "xm", "xb", "sfzh", "xydm",
							"xymc", "zydm", "zymc", "bjdm", "bjmc", "csrq",
							"syd", "zzmm" };
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		if (null != xh && dao.isKns(xh)) {
			request.setAttribute("isKNS", "is");
		} else {
			request.setAttribute("isKNS", "no");
		}
		request.setAttribute("xslbList", xslbList);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward zzsf_xsxfjmsqb(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) {
		String sqlb = "";
		sqlb = "漳州师院";

		String xh = DealString.toGBK(request.getParameter("xh").toString());
		String nd = DealString.toGBK(request.getParameter("nd").toString());
		String xm = DealString.toGBK(request.getParameter("xm").toString());
		String xb = DealString.toGBK(request.getParameter("xb").toString());
		String sfzh = DealString.toGBK(request.getParameter("sfzh").toString());
		String xymc = DealString.toGBK(request.getParameter("xymc").toString());
		String zymc = DealString.toGBK(request.getParameter("zymc").toString());
		String bjmc = DealString.toGBK(request.getParameter("bjmc").toString());
		String csrq = DealString.toGBK(request.getParameter("csrq").toString());
		String syd = DealString.toGBK(request.getParameter("syd").toString());
		String zzmm = DealString.toGBK(request.getParameter("zzmm").toString());
		String xslb = DealString.toGBK(request.getParameter("xslb").toString());
		String jzxm = DealString.toGBK(request.getParameter("jzxm").toString());
		String jtdz = DealString.toGBK(request.getParameter("jtdz").toString());
		String yzbm = DealString.toGBK(request.getParameter("yzbm").toString());
		String xslbmc = DealString.toGBK(request.getParameter("xslbmc")
				.toString());
		String jtdh = DealString.toGBK(request.getParameter("jtdh").toString());
		String ssdz = DealString.toGBK(request.getParameter("ssdz").toString());
		String ssdh = DealString.toGBK(request.getParameter("ssdh").toString());
		String jtjjqk = DealString.toGBK(
				request.getParameter("jtjjqk").toString());
		String yxknbzqk = DealString.toGBK(
				request.getParameter("yxknbzqk").toString());
		String qggw = DealString.toGBK(request.getParameter("qggw").toString());
		String psbxqk = DealString.toGBK(
				request.getParameter("psbxqk").toString());
		String sqzl = DealString.toGBK(request.getParameter("sqzl").toString());
		String sqje = DealString.toGBK(request.getParameter("sqje").toString());
		String gehjqk = DealString.toGBK(
				request.getParameter("gehjqk").toString());
		String xxcj = DealString.toGBK(request.getParameter("xxcj").toString());
		String sqsj = DealString.toGBK(request.getParameter("sqsj").toString());
		String xyshyj = DealString.toGBK(
				request.getParameter("xyshyj").toString());
		String tyjmje = DealString.toGBK(request.getParameter("tyjmje")
				.toString());
		String tyjmjedx = DealString.toGBK(request.getParameter("tyjmjedx")
				.toString());
		String xxshyj = DealString.toGBK(
				request.getParameter("xxshyj").toString());
		String bz = DealString.toGBK(request.getParameter("bz").toString());

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xh, nd, xm, xb, sfzh, xymc, zymc,
				bjmc, csrq, syd, zzmm, xslb, xslbmc, jzxm, jtdz, yzbm, jtdh,
				ssdz, ssdh, jtjjqk, yxknbzqk, qggw, psbxqk, sqzl, sqje, gehjqk,
				xxcj, sqsj, xyshyj, tyjmje, tyjmjedx, xxshyj, bz };
		String[] outString = new String[] { "xh", "nd", "xm", "xb", "sfzh",
				"xymc", "zymc", "bjmc", "csrq", "syd", "zzmm", "xslb",
				"xslbmc", "jzxm", "jtdz", "yzbm", "jtdh", "ssdz", "ssdh",
				"jtjjqk", "yxknbzqk", "qggw", "psbxqk", "sqzl", "sqje",
				"gehjqk", "xxcj", "sqsj", "xyshyj", "tyjmje", "tyjmjedx",
				"xxshyj", "bz" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward xnmz_knssq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String titName = request.getParameter("titName");

		String xxmc = ToolClass.getXxmc();
		String sfksq = "-1";

		request.setAttribute("xxmc", xxmc);
		String[] pages = null;
		String[] titNames = null;
		String[] outString = null;
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		pages = new String[] { "困难生申请" };
		titNames = new String[] { "xnmz_knssq" };

		if (titName == null)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		List pagesList = dao.arrayToList(titNames, pages);
		request.setAttribute("pages", pagesList);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间

		String doType = request.getParameter("doType");// 操作类型

		sql = "select xh,xxmc,xymc,xmc,nj,xm,xb,csny,mzmc,sfzh,zzmm,rxqhk,"
			+ "jtrks,byxx,grtc,sfgc,sfdq,sflszn,jtxxtxdz,jtyzbm,jtlxdh,"
			+ "jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdw,jtcy1_zy,jtcy1_nsr,jtcy1_jkzk,"
			+ "jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdw,jtcy2_zy,jtcy2_nsr,jtcy2_jkzk,"
			+ "jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdw,jtcy3_zy,jtcy3_nsr,jtcy3_jkzk,"
			+ "jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdw,jtcy4_zy,jtcy4_nsr,jtcy4_jkzk,"
			+ "jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdw,jtcy5_zy,jtcy5_nsr,jtcy5_jkzk,"
			+ "jtrjnsr,xsyhhjqk,jtzszrzhqk,jtzstfywsj,jtcyndlrqk,jtcysyqk,jtqzqk,"
			+ "qtqk,mzbmxxtxdz,mzbmyzbm,mzbmlxdh from view_xsjtqkdcb where 1=2";
		outString = dao.getColumnName(sql);// 获得lstdsq的列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String xh = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;

			sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='困难生' and b.xh=? ";
			jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
					"kssj", "jssj" });
			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String xm = DealString.toGBK(request.getParameter("xm")
							.toString());
					String xb = DealString.toGBK(request.getParameter("xb")
							.toString());
					String csny = DealString.toGBK(request.getParameter("csny")
							.toString());
					String mzmc = DealString.toGBK(request.getParameter("mzmc")
							.toString());
					String sfzh = DealString.toGBK(request.getParameter("sfzh")
							.toString());
					String zzmm = DealString.toGBK(request.getParameter("zzmm")
							.toString());
					String rxqhk = DealString.toGBK(request.getParameter(
					"rxqhk").toString());
					String jtrks = DealString.toGBK(request.getParameter(
					"jtrks").toString());
					String byxx = DealString.toGBK(request.getParameter("byxx")
							.toString());
					String grtc = DealString.toGBK(request.getParameter("grtc")
							.toString());
					String sfgc = DealString.toGBK(request.getParameter("sfgc")
							.toString());
					String sfdq = DealString.toGBK(request.getParameter("sfdq")
							.toString());
					String sflszn = DealString.toGBK(request.getParameter(
					"sflszn").toString());
					String jtxxtxdz = DealString.toGBK(request.getParameter(
					"jtxxtxdz").toString());
					String jtyzbm = DealString.toGBK(request.getParameter(
					"jtyzbm").toString());
					String jtlxdh = DealString.toGBK(request.getParameter(
					"jtlxdh").toString());
					String jtcy1_xm = DealString.toGBK(request.getParameter(
					"jtcy1_xm").toString());
					String jtcy1_nl = DealString.toGBK(request.getParameter(
					"jtcy1_nl").toString());
					String jtcy1_gx = DealString.toGBK(request.getParameter(
					"jtcy1_gx").toString());
					String jtcy1_gzdw = DealString.toGBK(request.getParameter(
					"jtcy1_gzdw").toString());
					String jtcy1_zy = DealString.toGBK(request.getParameter(
					"jtcy1_zy").toString());
					String jtcy1_nsr = DealString.toGBK(request.getParameter(
					"jtcy1_nsr").toString());
					String jtcy1_jkzk = DealString.toGBK(request.getParameter(
					"jtcy1_jkzk").toString());
					String jtcy2_xm = DealString.toGBK(request.getParameter(
					"jtcy2_xm").toString());
					String jtcy2_nl = DealString.toGBK(request.getParameter(
					"jtcy2_nl").toString());
					String jtcy2_gx = DealString.toGBK(request.getParameter(
					"jtcy2_gx").toString());
					String jtcy2_gzdw = DealString.toGBK(request.getParameter(
					"jtcy2_gzdw").toString());
					String jtcy2_zy = DealString.toGBK(request.getParameter(
					"jtcy2_zy").toString());
					String jtcy2_nsr = DealString.toGBK(request.getParameter(
					"jtcy2_nsr").toString());
					String jtcy2_jkzk = DealString.toGBK(request.getParameter(
					"jtcy2_jkzk").toString());
					String jtcy3_xm = DealString.toGBK(request.getParameter(
					"jtcy3_xm").toString());
					String jtcy3_nl = DealString.toGBK(request.getParameter(
					"jtcy3_nl").toString());
					String jtcy3_gx = DealString.toGBK(request.getParameter(
					"jtcy3_gx").toString());
					String jtcy3_gzdw = DealString.toGBK(request.getParameter(
					"jtcy3_gzdw").toString());
					String jtcy3_zy = DealString.toGBK(request.getParameter(
					"jtcy3_zy").toString());
					String jtcy3_nsr = DealString.toGBK(request.getParameter(
					"jtcy3_nsr").toString());
					String jtcy3_jkzk = DealString.toGBK(request.getParameter(
					"jtcy3_jkzk").toString());
					String jtcy4_xm = DealString.toGBK(request.getParameter(
					"jtcy4_xm").toString());
					String jtcy4_nl = DealString.toGBK(request.getParameter(
					"jtcy4_nl").toString());
					String jtcy4_gx = DealString.toGBK(request.getParameter(
					"jtcy4_gx").toString());
					String jtcy4_gzdw = DealString.toGBK(request.getParameter(
					"jtcy4_gzdw").toString());
					String jtcy4_zy = DealString.toGBK(request.getParameter(
					"jtcy4_zy").toString());
					String jtcy4_nsr = DealString.toGBK(request.getParameter(
					"jtcy4_nsr").toString());
					String jtcy4_jkzk = DealString.toGBK(request.getParameter(
					"jtcy4_jkzk").toString());
					String jtcy5_xm = DealString.toGBK(request.getParameter(
					"jtcy5_xm").toString());
					String jtcy5_nl = DealString.toGBK(request.getParameter(
					"jtcy5_nl").toString());
					String jtcy5_gx = DealString.toGBK(request.getParameter(
					"jtcy5_gx").toString());
					String jtcy5_gzdw = DealString.toGBK(request.getParameter(
					"jtcy5_gzdw").toString());
					String jtcy5_zy = DealString.toGBK(request.getParameter(
					"jtcy5_zy").toString());
					String jtcy5_nsr = DealString.toGBK(request.getParameter(
					"jtcy5_nsr").toString());
					String jtcy5_jkzk = DealString.toGBK(request.getParameter(
					"jtcy5_jkzk").toString());
					String jtrjnsr = DealString.toGBK(request.getParameter(
					"jtrjnsr").toString());
					String xsyhhjqk = DealString.toGBK(request.getParameter(
					"xsyhhjqk").toString());
					String jtzszrzhqk = DealString.toGBK(request.getParameter(
					"jtzszrzhqk").toString());
					String jtzstfywsj = DealString.toGBK(request.getParameter(
					"jtzstfywsj").toString());
					String jtcyndlrqk = DealString.toGBK(request.getParameter(
					"jtcyndlrqk").toString());
					String jtcysyqk = DealString.toGBK(request.getParameter(
					"jtcysyqk").toString());
					String jtqzqk = DealString.toGBK(request.getParameter(
					"jtqzqk").toString());
					String qtqk = DealString.toGBK(request.getParameter("qtqk")
							.toString());
					String mzbmxxtxdz = DealString.toGBK(request.getParameter(
					"mzbmxxtxdz").toString());
					String mzbmyzbm = DealString.toGBK(request.getParameter(
					"mzbmyzbm").toString());
					String mzbmlxdh = DealString.toGBK(request.getParameter(
					"mzbmlxdh").toString());

					sql = "select xxsh from xsjtqkdcb where xh=?";
					String[] temp = dao.getOneRs(sql, new String[] { xh },
							new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation
								.delete("xsjtqkdcb", "xh", xh, request);

						String[] colName1 = new String[] { "xh", "xm", "xb",
								"csny", "mzmc", "sfzh", "zzmm", "rxqhk",
								"jtrks", "byxx", "grtc", "sfgc", "sfdq",
								"sflszn", "jtxxtxdz", "jtyzbm", "jtlxdh",
								"jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
								"jtcy1_gzdw", "jtcy1_zy", "jtcy1_nsr",
								"jtcy1_jkzk", "jtcy2_xm", "jtcy2_nl",
								"jtcy2_gx", "jtcy2_gzdw", "jtcy2_zy",
								"jtcy2_nsr", "jtcy2_jkzk", "jtcy3_xm",
								"jtcy3_nl", "jtcy3_gx", "jtcy3_gzdw",
								"jtcy3_zy", "jtcy3_nsr", "jtcy3_jkzk",
								"jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
								"jtcy4_gzdw", "jtcy4_zy", "jtcy4_nsr",
								"jtcy4_jkzk", "jtcy5_xm", "jtcy5_nl",
								"jtcy5_gx", "jtcy5_gzdw", "jtcy5_zy",
								"jtcy5_nsr", "jtcy5_jkzk", "jtrjnsr",
								"xsyhhjqk", "jtzszrzhqk", "jtzstfywsj",
								"jtcyndlrqk", "jtcysyqk", "jtqzqk", "qtqk",
								"mzbmxxtxdz", "mzbmyzbm", "mzbmlxdh" };

						String[] valueForOut = new String[] { xh, xm, xb, csny,
								mzmc, sfzh, zzmm, rxqhk, jtrks, byxx, grtc,
								sfgc, sfdq, sflszn, jtxxtxdz, jtyzbm, jtlxdh,
								jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdw,
								jtcy1_zy, jtcy1_nsr, jtcy1_jkzk, jtcy2_xm,
								jtcy2_nl, jtcy2_gx, jtcy2_gzdw, jtcy2_zy,
								jtcy2_nsr, jtcy2_jkzk, jtcy3_xm, jtcy3_nl,
								jtcy3_gx, jtcy3_gzdw, jtcy3_zy, jtcy3_nsr,
								jtcy3_jkzk, jtcy4_xm, jtcy4_nl, jtcy4_gx,
								jtcy4_gzdw, jtcy4_zy, jtcy4_nsr, jtcy4_jkzk,
								jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_gzdw,
								jtcy5_zy, jtcy5_nsr, jtcy5_jkzk, jtrjnsr,
								xsyhhjqk, jtzszrzhqk, jtzstfywsj, jtcyndlrqk,
								jtcysyqk, jtqzqk, qtqk, mzbmxxtxdz, mzbmyzbm,
								mzbmlxdh };

						boolean ok = false;
						ok = StandardOperation.insert("xsjtqkdcb", colName1,
								valueForOut, request);
						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String xm = DealString.toGBK(request.getParameter("xm")
						.toString());
				String xb = DealString.toGBK(request.getParameter("xb")
						.toString());
				String csny = DealString.toGBK(request.getParameter("csny")
						.toString());
				String mzmc = DealString.toGBK(request.getParameter("mzmc")
						.toString());
				String sfzh = DealString.toGBK(request.getParameter("sfzh")
						.toString());
				String zzmm = DealString.toGBK(request.getParameter("zzmm")
						.toString());
				String rxqhk = DealString.toGBK(request.getParameter("rxqhk")
						.toString());
				String jtrks = DealString.toGBK(request.getParameter("jtrks")
						.toString());
				String byxx = DealString.toGBK(request.getParameter("byxx")
						.toString());
				String grtc = DealString.toGBK(request.getParameter("grtc")
						.toString());
				String sfgc = DealString.toGBK(request.getParameter("sfgc")
						.toString());
				String sfdq = DealString.toGBK(request.getParameter("sfdq")
						.toString());
				String sflszn = DealString.toGBK(request.getParameter("sflszn")
						.toString());
				String jtxxtxdz = DealString.toGBK(request.getParameter(
				"jtxxtxdz").toString());
				String jtyzbm = DealString.toGBK(request.getParameter("jtyzbm")
						.toString());
				String jtlxdh = DealString.toGBK(request.getParameter("jtlxdh")
						.toString());
				String jtcy1_xm = DealString.toGBK(request.getParameter(
				"jtcy1_xm").toString());
				String jtcy1_nl = DealString.toGBK(request.getParameter(
				"jtcy1_nl").toString());
				String jtcy1_gx = DealString.toGBK(request.getParameter(
				"jtcy1_gx").toString());
				String jtcy1_gzdw = DealString.toGBK(request.getParameter(
				"jtcy1_gzdw").toString());
				String jtcy1_zy = DealString.toGBK(request.getParameter(
				"jtcy1_zy").toString());
				String jtcy1_nsr = DealString.toGBK(request.getParameter(
				"jtcy1_nsr").toString());
				String jtcy1_jkzk = DealString.toGBK(request.getParameter(
				"jtcy1_jkzk").toString());
				String jtcy2_xm = DealString.toGBK(request.getParameter(
				"jtcy2_xm").toString());
				String jtcy2_nl = DealString.toGBK(request.getParameter(
				"jtcy2_nl").toString());
				String jtcy2_gx = DealString.toGBK(request.getParameter(
				"jtcy2_gx").toString());
				String jtcy2_gzdw = DealString.toGBK(request.getParameter(
				"jtcy2_gzdw").toString());
				String jtcy2_zy = DealString.toGBK(request.getParameter(
				"jtcy2_zy").toString());
				String jtcy2_nsr = DealString.toGBK(request.getParameter(
				"jtcy2_nsr").toString());
				String jtcy2_jkzk = DealString.toGBK(request.getParameter(
				"jtcy2_jkzk").toString());
				String jtcy3_xm = DealString.toGBK(request.getParameter(
				"jtcy3_xm").toString());
				String jtcy3_nl = DealString.toGBK(request.getParameter(
				"jtcy3_nl").toString());
				String jtcy3_gx = DealString.toGBK(request.getParameter(
				"jtcy3_gx").toString());
				String jtcy3_gzdw = DealString.toGBK(request.getParameter(
				"jtcy3_gzdw").toString());
				String jtcy3_zy = DealString.toGBK(request.getParameter(
				"jtcy3_zy").toString());
				String jtcy3_nsr = DealString.toGBK(request.getParameter(
				"jtcy3_nsr").toString());
				String jtcy3_jkzk = DealString.toGBK(request.getParameter(
				"jtcy3_jkzk").toString());
				String jtcy4_xm = DealString.toGBK(request.getParameter(
				"jtcy4_xm").toString());
				String jtcy4_nl = DealString.toGBK(request.getParameter(
				"jtcy4_nl").toString());
				String jtcy4_gx = DealString.toGBK(request.getParameter(
				"jtcy4_gx").toString());
				String jtcy4_gzdw = DealString.toGBK(request.getParameter(
				"jtcy4_gzdw").toString());
				String jtcy4_zy = DealString.toGBK(request.getParameter(
				"jtcy4_zy").toString());
				String jtcy4_nsr = DealString.toGBK(request.getParameter(
				"jtcy4_nsr").toString());
				String jtcy4_jkzk = DealString.toGBK(request.getParameter(
				"jtcy4_jkzk").toString());
				String jtcy5_xm = DealString.toGBK(request.getParameter(
				"jtcy5_xm").toString());
				String jtcy5_nl = DealString.toGBK(request.getParameter(
				"jtcy5_nl").toString());
				String jtcy5_gx = DealString.toGBK(request.getParameter(
				"jtcy5_gx").toString());
				String jtcy5_gzdw = DealString.toGBK(request.getParameter(
				"jtcy5_gzdw").toString());
				String jtcy5_zy = DealString.toGBK(request.getParameter(
				"jtcy5_zy").toString());
				String jtcy5_nsr = DealString.toGBK(request.getParameter(
				"jtcy5_nsr").toString());
				String jtcy5_jkzk = DealString.toGBK(request.getParameter(
				"jtcy5_jkzk").toString());
				String jtrjnsr = DealString.toGBK(request.getParameter(
				"jtrjnsr").toString());
				String xsyhhjqk = DealString.toGBK(request.getParameter(
				"xsyhhjqk").toString());
				String jtzszrzhqk = DealString.toGBK(request.getParameter(
				"jtzszrzhqk").toString());
				String jtzstfywsj = DealString.toGBK(request.getParameter(
				"jtzstfywsj").toString());
				String jtcyndlrqk = DealString.toGBK(request.getParameter(
				"jtcyndlrqk").toString());
				String jtcysyqk = DealString.toGBK(request.getParameter(
				"jtcysyqk").toString());
				String jtqzqk = DealString.toGBK(request.getParameter("jtqzqk")
						.toString());
				String qtqk = DealString.toGBK(request.getParameter("qtqk")
						.toString());
				String mzbmxxtxdz = DealString.toGBK(request.getParameter(
				"mzbmxxtxdz").toString());
				String mzbmyzbm = DealString.toGBK(request.getParameter(
				"mzbmyzbm").toString());
				String mzbmlxdh = DealString.toGBK(request.getParameter(
				"mzbmlxdh").toString());

				sql = "select xxsh from xsjtqkdcb where xh=?";
				String[] temp = dao.getOneRs(sql, new String[] { xh },
						new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("xsjtqkdcb", "xh", xh, request);

					String[] colName1 = new String[] { "xh", "xm", "xb",
							"csny", "mzmc", "sfzh", "zzmm", "rxqhk", "jtrks",
							"byxx", "grtc", "sfgc", "sfdq", "sflszn",
							"jtxxtxdz", "jtyzbm", "jtlxdh", "jtcy1_xm",
							"jtcy1_nl", "jtcy1_gx", "jtcy1_gzdw", "jtcy1_zy",
							"jtcy1_nsr", "jtcy1_jkzk", "jtcy2_xm", "jtcy2_nl",
							"jtcy2_gx", "jtcy2_gzdw", "jtcy2_zy", "jtcy2_nsr",
							"jtcy2_jkzk", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
							"jtcy3_gzdw", "jtcy3_zy", "jtcy3_nsr",
							"jtcy3_jkzk", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
							"jtcy4_gzdw", "jtcy4_zy", "jtcy4_nsr",
							"jtcy4_jkzk", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
							"jtcy5_gzdw", "jtcy5_zy", "jtcy5_nsr",
							"jtcy5_jkzk", "jtrjnsr", "xsyhhjqk", "jtzszrzhqk",
							"jtzstfywsj", "jtcyndlrqk", "jtcysyqk", "jtqzqk",
							"qtqk", "mzbmxxtxdz", "mzbmyzbm", "mzbmlxdh" };

					String[] valueForOut = new String[] { xh, xm, xb, csny,
							mzmc, sfzh, zzmm, rxqhk, jtrks, byxx, grtc, sfgc,
							sfdq, sflszn, jtxxtxdz, jtyzbm, jtlxdh, jtcy1_xm,
							jtcy1_nl, jtcy1_gx, jtcy1_gzdw, jtcy1_zy,
							jtcy1_nsr, jtcy1_jkzk, jtcy2_xm, jtcy2_nl,
							jtcy2_gx, jtcy2_gzdw, jtcy2_zy, jtcy2_nsr,
							jtcy2_jkzk, jtcy3_xm, jtcy3_nl, jtcy3_gx,
							jtcy3_gzdw, jtcy3_zy, jtcy3_nsr, jtcy3_jkzk,
							jtcy4_xm, jtcy4_nl, jtcy4_gx, jtcy4_gzdw, jtcy4_zy,
							jtcy4_nsr, jtcy4_jkzk, jtcy5_xm, jtcy5_nl,
							jtcy5_gx, jtcy5_gzdw, jtcy5_zy, jtcy5_nsr,
							jtcy5_jkzk, jtrjnsr, xsyhhjqk, jtzszrzhqk,
							jtzstfywsj, jtcyndlrqk, jtcysyqk, jtqzqk, qtqk,
							mzbmxxtxdz, mzbmyzbm, mzbmlxdh };

					boolean ok = false;
					ok = StandardOperation.insert("xsjtqkdcb", colName1,
							valueForOut, request);
					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		}

		sql = "select xh,xxmc,xymc,xmc,nj,xm,xb,csny,mzmc,sfzh,zzmm,rxqhk,"
				+ "jtrks,byxx,grtc,sfgc,sfdq,sflszn,jtxxtxdz,jtyzbm,jtlxdh,"
				+ "jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdw,jtcy1_zy,jtcy1_nsr,jtcy1_jkzk,"
				+ "jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdw,jtcy2_zy,jtcy2_nsr,jtcy2_jkzk,"
				+ "jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdw,jtcy3_zy,jtcy3_nsr,jtcy3_jkzk,"
				+ "jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdw,jtcy4_zy,jtcy4_nsr,jtcy4_jkzk,"
				+ "jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdw,jtcy5_zy,jtcy5_nsr,jtcy5_jkzk,"
				+ "jtrjnsr,xsyhhjqk,jtzszrzhqk,jtzstfywsj,jtcyndlrqk,jtcysyqk,jtqzqk,"
				+ "qtqk,mzbmxxtxdz,mzbmyzbm,mzbmlxdh from view_xsjtqkdcb where xh=? ";
		outValue = dao.getOneRs(sql, new String[] { xh }, outString);
		outString = new String[] { "xh", "xxmc", "xymc", "xmc", "nj", "xm",
				"xb", "csny", "mzmc", "sfzh", "zzmm", "rxqhk", "jtrks", "byxx",
				"grtc", "sfgc", "sfdq", "sflszn", "jtxxtxdz", "jtyzbm",
				"jtlxdh", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx", "jtcy1_gzdw",
				"jtcy1_zy", "jtcy1_nsr", "jtcy1_jkzk", "jtcy2_xm", "jtcy2_nl",
				"jtcy2_gx", "jtcy2_gzdw", "jtcy2_zy", "jtcy2_nsr",
				"jtcy2_jkzk", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx", "jtcy3_gzdw",
				"jtcy3_zy", "jtcy3_nsr", "jtcy3_jkzk", "jtcy4_xm", "jtcy4_nl",
				"jtcy4_gx", "jtcy4_gzdw", "jtcy4_zy", "jtcy4_nsr",
				"jtcy4_jkzk", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx", "jtcy5_gzdw",
				"jtcy5_zy", "jtcy5_nsr", "jtcy5_jkzk", "jtrjnsr", "xsyhhjqk",
				"jtzszrzhqk", "jtzstfywsj", "jtcyndlrqk", "jtcysyqk", "jtqzqk",
				"qtqk", "mzbmxxtxdz", "mzbmyzbm", "mzbmlxdh" };

		if (outValue == null) {
			if (xh != null) {
				sql = "select v.xh,v.xm,v.xb,x.xxmc,v.xymc,v.zymc xmc,v.nj,q.mzmc "
					+ "from view_xsjbxx v,view_stu_details q,xtszb x "
					+ "where v.xh = q.xh and v.xh=?";
				String[] colName = new String[] { "xh", "xm", "xb", "xxmc",
						"xymc", "xmc", "nj", "mzmc" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {

				} else {
					colName = new String[] { "xh", "xm", "xb", "xxmc", "xymc",
							"xmc", "nj", "mzmc" };
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward xnmz_knssqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String sqlb = "";
		sqlb = "困难生申请表";

		String xh = DealString.toGBK(request.getParameter("xh"));
		String xm = DealString.toGBK(request.getParameter("xm").toString());
		String xxmc = DealString.toGBK(request.getParameter("xxmc").toString());
		String xymc = DealString.toGBK(request.getParameter("xymc").toString());
		String xmc = DealString.toGBK(request.getParameter("xmc").toString());
		String nj = DealString.toGBK(request.getParameter("nj").toString());
		String xb = DealString.toGBK(request.getParameter("xb").toString());
		String csny = DealString.toGBK(request.getParameter("csny").toString());
		String mzmc = DealString.toGBK(request.getParameter("mzmc").toString());
		String sfzh = DealString.toGBK(request.getParameter("sfzh").toString());
		String zzmm = DealString.toGBK(request.getParameter("zzmm").toString());
		String rxqhk = DealString.toGBK(request.getParameter("rxqhk")
				.toString());
		String jtrks = DealString.toGBK(request.getParameter("jtrks")
				.toString());
		String byxx = DealString.toGBK(request.getParameter("byxx").toString());
		String grtc = DealString.toGBK(request.getParameter("grtc").toString());
		String sfgc = DealString.toGBK(request.getParameter("sfgc").toString());
		String sfdq = DealString.toGBK(request.getParameter("sfdq").toString());
		String sflszn = DealString.toGBK(request.getParameter("sflszn")
				.toString());
		String jtxxtxdz = DealString.toGBK(request.getParameter("jtxxtxdz")
				.toString());
		String jtyzbm = DealString.toGBK(request.getParameter("jtyzbm")
				.toString());
		String jtlxdh = DealString.toGBK(request.getParameter("jtlxdh")
				.toString());
		String jtcy1_xm = DealString.toGBK(request.getParameter("jtcy1_xm")
				.toString());
		String jtcy1_nl = DealString.toGBK(request.getParameter("jtcy1_nl")
				.toString());
		String jtcy1_gx = DealString.toGBK(request.getParameter("jtcy1_gx")
				.toString());
		String jtcy1_gzdw = DealString.toGBK(request.getParameter("jtcy1_gzdw")
				.toString());
		String jtcy1_zy = DealString.toGBK(request.getParameter("jtcy1_zy")
				.toString());
		String jtcy1_nsr = DealString.toGBK(request.getParameter("jtcy1_nsr")
				.toString());
		String jtcy1_jkzk = DealString.toGBK(request.getParameter("jtcy1_jkzk")
				.toString());
		String jtcy2_xm = DealString.toGBK(request.getParameter("jtcy2_xm")
				.toString());
		String jtcy2_nl = DealString.toGBK(request.getParameter("jtcy2_nl")
				.toString());
		String jtcy2_gx = DealString.toGBK(request.getParameter("jtcy2_gx")
				.toString());
		String jtcy2_gzdw = DealString.toGBK(request.getParameter("jtcy2_gzdw")
				.toString());
		String jtcy2_zy = DealString.toGBK(request.getParameter("jtcy2_zy")
				.toString());
		String jtcy2_nsr = DealString.toGBK(request.getParameter("jtcy2_nsr")
				.toString());
		String jtcy2_jkzk = DealString.toGBK(request.getParameter("jtcy2_jkzk")
				.toString());
		String jtcy3_xm = DealString.toGBK(request.getParameter("jtcy3_xm")
				.toString());
		String jtcy3_nl = DealString.toGBK(request.getParameter("jtcy3_nl")
				.toString());
		String jtcy3_gx = DealString.toGBK(request.getParameter("jtcy3_gx")
				.toString());
		String jtcy3_gzdw = DealString.toGBK(request.getParameter("jtcy3_gzdw")
				.toString());
		String jtcy3_zy = DealString.toGBK(request.getParameter("jtcy3_zy")
				.toString());
		String jtcy3_nsr = DealString.toGBK(request.getParameter("jtcy3_nsr")
				.toString());
		String jtcy3_jkzk = DealString.toGBK(request.getParameter("jtcy3_jkzk")
				.toString());
		String jtcy4_xm = DealString.toGBK(request.getParameter("jtcy4_xm")
				.toString());
		String jtcy4_nl = DealString.toGBK(request.getParameter("jtcy4_nl")
				.toString());
		String jtcy4_gx = DealString.toGBK(request.getParameter("jtcy4_gx")
				.toString());
		String jtcy4_gzdw = DealString.toGBK(request.getParameter("jtcy4_gzdw")
				.toString());
		String jtcy4_zy = DealString.toGBK(request.getParameter("jtcy4_zy")
				.toString());
		String jtcy4_nsr = DealString.toGBK(request.getParameter("jtcy4_nsr")
				.toString());
		String jtcy4_jkzk = DealString.toGBK(request.getParameter("jtcy4_jkzk")
				.toString());
		String jtcy5_xm = DealString.toGBK(request.getParameter("jtcy5_xm")
				.toString());
		String jtcy5_nl = DealString.toGBK(request.getParameter("jtcy5_nl")
				.toString());
		String jtcy5_gx = DealString.toGBK(request.getParameter("jtcy5_gx")
				.toString());
		String jtcy5_gzdw = DealString.toGBK(request.getParameter("jtcy5_gzdw")
				.toString());
		String jtcy5_zy = DealString.toGBK(request.getParameter("jtcy5_zy")
				.toString());
		String jtcy5_nsr = DealString.toGBK(request.getParameter("jtcy5_nsr")
				.toString());
		String jtcy5_jkzk = DealString.toGBK(request.getParameter("jtcy5_jkzk")
				.toString());
		String jtrjnsr = DealString.toGBK(request.getParameter("jtrjnsr")
				.toString());
		String xsyhhjqk = DealString.toGBK(request.getParameter("xsyhhjqk")
				.toString());
		String jtzszrzhqk = DealString.toGBK(request.getParameter("jtzszrzhqk")
				.toString());
		String jtzstfywsj = DealString.toGBK(request.getParameter("jtzstfywsj")
				.toString());
		String jtcyndlrqk = DealString.toGBK(request.getParameter("jtcyndlrqk")
				.toString());
		String jtcysyqk = DealString.toGBK(request.getParameter("jtcysyqk")
				.toString());
		String jtqzqk = DealString.toGBK(request.getParameter("jtqzqk")
				.toString());
		String qtqk = DealString.toGBK(request.getParameter("qtqk").toString());
		String mzbmxxtxdz = DealString.toGBK(request.getParameter("mzbmxxtxdz")
				.toString());
		String mzbmyzbm = DealString.toGBK(request.getParameter("mzbmyzbm")
				.toString());
		String mzbmlxdh = DealString.toGBK(request.getParameter("mzbmlxdh")
				.toString());

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xh, xxmc, xymc, xmc, nj, xm, xb,
				csny, mzmc, sfzh, zzmm, rxqhk, jtrks, byxx, grtc, sfgc, sfdq,
				sflszn, jtxxtxdz, jtyzbm, jtlxdh, jtcy1_xm, jtcy1_nl, jtcy1_gx,
				jtcy1_gzdw, jtcy1_zy, jtcy1_nsr, jtcy1_jkzk, jtcy2_xm,
				jtcy2_nl, jtcy2_gx, jtcy2_gzdw, jtcy2_zy, jtcy2_nsr,
				jtcy2_jkzk, jtcy3_xm, jtcy3_nl, jtcy3_gx, jtcy3_gzdw, jtcy3_zy,
				jtcy3_nsr, jtcy3_jkzk, jtcy4_xm, jtcy4_nl, jtcy4_gx,
				jtcy4_gzdw, jtcy4_zy, jtcy4_nsr, jtcy4_jkzk, jtcy5_xm,
				jtcy5_nl, jtcy5_gx, jtcy5_gzdw, jtcy5_zy, jtcy5_nsr,
				jtcy5_jkzk, jtrjnsr, xsyhhjqk, jtzszrzhqk, jtzstfywsj,
				jtcyndlrqk, jtcysyqk, jtqzqk, qtqk, mzbmxxtxdz, mzbmyzbm,
				mzbmlxdh };
		String[] outString = new String[] { "xh", "xxmc", "xymc", "xmc", "nj",
				"xm", "xb", "csny", "mzmc", "sfzh", "zzmm", "rxqhk", "jtrks",
				"byxx", "grtc", "sfgc", "sfdq", "sflszn", "jtxxtxdz", "jtyzbm",
				"jtlxdh", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx", "jtcy1_gzdw",
				"jtcy1_zy", "jtcy1_nsr", "jtcy1_jkzk", "jtcy2_xm", "jtcy2_nl",
				"jtcy2_gx", "jtcy2_gzdw", "jtcy2_zy", "jtcy2_nsr",
				"jtcy2_jkzk", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx", "jtcy3_gzdw",
				"jtcy3_zy", "jtcy3_nsr", "jtcy3_jkzk", "jtcy4_xm", "jtcy4_nl",
				"jtcy4_gx", "jtcy4_gzdw", "jtcy4_zy", "jtcy4_nsr",
				"jtcy4_jkzk", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx", "jtcy5_gzdw",
				"jtcy5_zy", "jtcy5_nsr", "jtcy5_jkzk", "jtrjnsr", "xsyhhjqk",
				"jtzszrzhqk", "jtzstfywsj", "jtcyndlrqk", "jtcysyqk", "jtqzqk",
				"qtqk", "mzbmxxtxdz", "mzbmyzbm", "mzbmlxdh" };
		// System.out.println(outString[35]+outValue[35]);
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				// System.out.println("i="+i+" "+outString[i]);
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward bjly_knssq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String titName = request.getParameter("titName");

		String xxmc = ToolClass.getXxmc();
		String sfksq = "-1";

		String nd = Base.currNd;
		request.setAttribute("xxmc", xxmc);
		String[] pages = null;
		String[] titNames = null;
		String[] outString = null;
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		pages = new String[] { "困难生申请" };
		titNames = new String[] { "bjly_knssq" };

		if (titName == null)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		List pagesList = dao.arrayToList(titNames, pages);
		request.setAttribute("pages", pagesList);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间

		String doType = request.getParameter("doType");// 操作类型

		sql = "select count(*) con from bjlydx_knssrly";
		String con = dao.getOneRs(sql, new String[] {}, "con");
		boolean isNULL = false;
		if (con.equalsIgnoreCase("0")) {
			isNULL = true;
			con = "1";
		} else {
			con = String.valueOf(Integer.parseInt(con) + 1);
		}
		if (isNULL) {
			request.setAttribute("isNULL", "is");
		} else {
			request.setAttribute("isNULL", "no");
		}
		request.setAttribute("con", con);
		List<String[]> srlyList = dao.getSrlyList();
		request.setAttribute("srlyList", srlyList);

		sql = "select * from view_bjlydx_knssqb where 1=2";
		outString = dao.getColumnName(sql);// 获得列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String xh = "";
		String pkVal = "";
		ArrayList<String> srList = new ArrayList<String>();
		String query = " xh=?, nd=?";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;

			sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='困难生' and b.xh=? ";
			jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
					"kssj", "jssj" });
			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String lxdh = DealString.toGBK(request.getParameter("lxdh")
							.toString());
					String jtcy1_xm = DealString.toGBK(request.getParameter(
					"jtcy1_xm").toString());
					String jtcy1_cw = DealString.toGBK(request.getParameter(
					"jtcy1_cw").toString());
					String jtcy1_nl = DealString.toGBK(request.getParameter(
					"jtcy1_nl").toString());
					String jtcy1_sfzh = DealString.toGBK(request.getParameter(
					"jtcy1_sfzh").toString());
					String jtcy1_gzdw = DealString.toGBK(request.getParameter(
					"jtcy1_gzdw").toString());
					String jtcy1_ysr = DealString.toGBK(request.getParameter(
					"jtcy1_ysr").toString());
					String jtcy1_jkzk = DealString.toGBK(request.getParameter(
					"jtcy1_jkzk").toString());
					String jtcy2_xm = DealString.toGBK(request.getParameter(
					"jtcy2_xm").toString());
					String jtcy2_cw = DealString.toGBK(request.getParameter(
					"jtcy2_cw").toString());
					String jtcy2_nl = DealString.toGBK(request.getParameter(
					"jtcy2_nl").toString());
					String jtcy2_sfzh = DealString.toGBK(request.getParameter(
					"jtcy2_sfzh").toString());
					String jtcy2_gzdw = DealString.toGBK(request.getParameter(
					"jtcy2_gzdw").toString());
					String jtcy2_ysr = DealString.toGBK(request.getParameter(
					"jtcy2_ysr").toString());
					String jtcy2_jkzk = DealString.toGBK(request.getParameter(
					"jtcy2_jkzk").toString());
					String jtcy3_xm = DealString.toGBK(request.getParameter(
					"jtcy3_xm").toString());
					String jtcy3_cw = DealString.toGBK(request.getParameter(
					"jtcy3_cw").toString());
					String jtcy3_nl = DealString.toGBK(request.getParameter(
					"jtcy3_nl").toString());
					String jtcy3_sfzh = DealString.toGBK(request.getParameter(
					"jtcy3_sfzh").toString());
					String jtcy3_gzdw = DealString.toGBK(request.getParameter(
					"jtcy3_gzdw").toString());
					String jtcy3_ysr = DealString.toGBK(request.getParameter(
					"jtcy3_ysr").toString());
					String jtcy3_jkzk = DealString.toGBK(request.getParameter(
					"jtcy3_jkzk").toString());
					String jtcy4_xm = DealString.toGBK(request.getParameter(
					"jtcy4_xm").toString());
					String jtcy4_cw = DealString.toGBK(request.getParameter(
					"jtcy4_cw").toString());
					String jtcy4_nl = DealString.toGBK(request.getParameter(
					"jtcy4_nl").toString());
					String jtcy4_sfzh = DealString.toGBK(request.getParameter(
					"jtcy4_sfzh").toString());
					String jtcy4_gzdw = DealString.toGBK(request.getParameter(
					"jtcy4_gzdw").toString());
					String jtcy4_ysr = DealString.toGBK(request.getParameter(
					"jtcy4_ysr").toString());
					String jtcy4_jkzk = DealString.toGBK(request.getParameter(
					"jtcy4_jkzk").toString());
					String jtcy5_xm = DealString.toGBK(request.getParameter(
					"jtcy5_xm").toString());
					String jtcy5_cw = DealString.toGBK(request.getParameter(
					"jtcy5_cw").toString());
					String jtcy5_nl = DealString.toGBK(request.getParameter(
					"jtcy5_nl").toString());
					String jtcy5_sfzh = DealString.toGBK(request.getParameter(
					"jtcy5_sfzh").toString());
					String jtcy5_gzdw = DealString.toGBK(request.getParameter(
					"jtcy5_gzdw").toString());
					String jtcy5_ysr = DealString.toGBK(request.getParameter(
					"jtcy5_ysr").toString());
					String jtcy5_jkzk = DealString.toGBK(request.getParameter(
					"jtcy5_jkzk").toString());
					String sqyy = DealString.toGBK(
							request.getParameter("sqyy").toString());
					String bz = DealString.toGBK(
							request.getParameter("bz").toString());
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}

					sql = "select xxsh from bjlydx_knssqb where xh||nd=?";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("bjlydx_knssqb", "xh||nd", pkVal, request);

						String[] colName1 = new String[] { "xh", "nd", "lxdh",
								"jtcy1_xm", "jtcy1_cw", "jtcy1_nl",
								"jtcy1_sfzh", "jtcy1_gzdw", "jtcy1_ysr",
								"jtcy1_jkzk", "jtcy2_xm", "jtcy2_cw",
								"jtcy2_nl", "jtcy2_sfzh", "jtcy2_gzdw",
								"jtcy2_ysr", "jtcy2_jkzk", "jtcy3_xm",
								"jtcy3_cw", "jtcy3_nl", "jtcy3_sfzh",
								"jtcy3_gzdw", "jtcy3_ysr", "jtcy3_jkzk",
								"jtcy4_xm", "jtcy4_cw", "jtcy4_nl",
								"jtcy4_sfzh", "jtcy4_gzdw", "jtcy4_ysr",
								"jtcy4_jkzk", "jtcy5_xm", "jtcy5_cw",
								"jtcy5_nl", "jtcy5_sfzh", "jtcy5_gzdw",
								"jtcy5_ysr", "jtcy5_jkzk", "sqyy", "bz" };

						String[] valueForOut = new String[] { xh, nd, lxdh,
								jtcy1_xm, jtcy1_cw, jtcy1_nl, jtcy1_sfzh,
								jtcy1_gzdw, jtcy1_ysr, jtcy1_jkzk, jtcy2_xm,
								jtcy2_cw, jtcy2_nl, jtcy2_sfzh, jtcy2_gzdw,
								jtcy2_ysr, jtcy2_jkzk, jtcy3_xm, jtcy3_cw,
								jtcy3_nl, jtcy3_sfzh, jtcy3_gzdw, jtcy3_ysr,
								jtcy3_jkzk, jtcy4_xm, jtcy4_cw, jtcy4_nl,
								jtcy4_sfzh, jtcy4_gzdw, jtcy4_ysr, jtcy4_jkzk,
								jtcy5_xm, jtcy5_cw, jtcy5_nl, jtcy5_sfzh,
								jtcy5_gzdw, jtcy5_ysr, jtcy5_jkzk, sqyy, bz };

						boolean ok = false;
						ok = StandardOperation.insert("bjlydx_knssqb",
								colName1, valueForOut, request);
						if (ok) {
							if (srlyList.size() != 0) {
								srList.add(xh);
								srList.add(nd);
								for (Iterator it = srlyList.iterator(); it
								.hasNext();) {
									String[] tempSr = (String[]) it.next();
									String srName = "srly" + tempSr[0];
									String sr = DealString.toGBK(request
											.getParameter(srName).toString());
									if ("".equalsIgnoreCase(sr) || sr == null) {
										sr = "0";
									}
									srList.add(sr);
									query += ", " + srName + "=? ";
								}
								sql = "update bjlydx_knssqb set " + query
								+ " where xh||nd='"
								+ pkVal + "'";
								dao.runUpdate(sql, srList);
							}
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String lxdh = DealString.toGBK(request.getParameter("lxdh")
						.toString());
				String jtcy1_xm = DealString.toGBK(request.getParameter(
				"jtcy1_xm").toString());
				String jtcy1_cw = DealString.toGBK(request.getParameter(
				"jtcy1_cw").toString());
				String jtcy1_nl = DealString.toGBK(request.getParameter(
				"jtcy1_nl").toString());
				String jtcy1_sfzh = DealString.toGBK(request.getParameter(
				"jtcy1_sfzh").toString());
				String jtcy1_gzdw = DealString.toGBK(request.getParameter(
				"jtcy1_gzdw").toString());
				String jtcy1_ysr = DealString.toGBK(request.getParameter(
				"jtcy1_ysr").toString());
				String jtcy1_jkzk = DealString.toGBK(request.getParameter(
				"jtcy1_jkzk").toString());
				String jtcy2_xm = DealString.toGBK(request.getParameter(
				"jtcy2_xm").toString());
				String jtcy2_cw = DealString.toGBK(request.getParameter(
				"jtcy2_cw").toString());
				String jtcy2_nl = DealString.toGBK(request.getParameter(
				"jtcy2_nl").toString());
				String jtcy2_sfzh = DealString.toGBK(request.getParameter(
				"jtcy2_sfzh").toString());
				String jtcy2_gzdw = DealString.toGBK(request.getParameter(
				"jtcy2_gzdw").toString());
				String jtcy2_ysr = DealString.toGBK(request.getParameter(
				"jtcy2_ysr").toString());
				String jtcy2_jkzk = DealString.toGBK(request.getParameter(
				"jtcy2_jkzk").toString());
				String jtcy3_xm = DealString.toGBK(request.getParameter(
				"jtcy3_xm").toString());
				String jtcy3_cw = DealString.toGBK(request.getParameter(
				"jtcy3_cw").toString());
				String jtcy3_nl = DealString.toGBK(request.getParameter(
				"jtcy3_nl").toString());
				String jtcy3_sfzh = DealString.toGBK(request.getParameter(
				"jtcy3_sfzh").toString());
				String jtcy3_gzdw = DealString.toGBK(request.getParameter(
				"jtcy3_gzdw").toString());
				String jtcy3_ysr = DealString.toGBK(request.getParameter(
				"jtcy3_ysr").toString());
				String jtcy3_jkzk = DealString.toGBK(request.getParameter(
				"jtcy3_jkzk").toString());
				String jtcy4_xm = DealString.toGBK(request.getParameter(
				"jtcy4_xm").toString());
				String jtcy4_cw = DealString.toGBK(request.getParameter(
				"jtcy4_cw").toString());
				String jtcy4_nl = DealString.toGBK(request.getParameter(
				"jtcy4_nl").toString());
				String jtcy4_sfzh = DealString.toGBK(request.getParameter(
				"jtcy4_sfzh").toString());
				String jtcy4_gzdw = DealString.toGBK(request.getParameter(
				"jtcy4_gzdw").toString());
				String jtcy4_ysr = DealString.toGBK(request.getParameter(
				"jtcy4_ysr").toString());
				String jtcy4_jkzk = DealString.toGBK(request.getParameter(
				"jtcy4_jkzk").toString());
				String jtcy5_xm = DealString.toGBK(request.getParameter(
				"jtcy5_xm").toString());
				String jtcy5_cw = DealString.toGBK(request.getParameter(
				"jtcy5_cw").toString());
				String jtcy5_nl = DealString.toGBK(request.getParameter(
				"jtcy5_nl").toString());
				String jtcy5_sfzh = DealString.toGBK(request.getParameter(
				"jtcy5_sfzh").toString());
				String jtcy5_gzdw = DealString.toGBK(request.getParameter(
				"jtcy5_gzdw").toString());
				String jtcy5_ysr = DealString.toGBK(request.getParameter(
				"jtcy5_ysr").toString());
				String jtcy5_jkzk = DealString.toGBK(request.getParameter(
				"jtcy5_jkzk").toString());
				String sqyy = DealString.toGBK(
						request.getParameter("sqyy").toString());
				String bz = DealString.toGBK(
						request.getParameter("bz").toString());
				pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = xh + nd;
				}

				sql = "select xxsh from bjlydx_knssqb where xh||nd=?";
				String[] temp = dao.getOneRs(sql, new String[] { pkVal },
						new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("bjlydx_knssqb", "xh||nd", pkVal, request);

					String[] colName1 = new String[] { "xh", "nd", "lxdh",
							"jtcy1_xm", "jtcy1_cw", "jtcy1_nl",
							"jtcy1_sfzh", "jtcy1_gzdw", "jtcy1_ysr",
							"jtcy1_jkzk", "jtcy2_xm", "jtcy2_cw",
							"jtcy2_nl", "jtcy2_sfzh", "jtcy2_gzdw",
							"jtcy2_ysr", "jtcy2_jkzk", "jtcy3_xm",
							"jtcy3_cw", "jtcy3_nl", "jtcy3_sfzh",
							"jtcy3_gzdw", "jtcy3_ysr", "jtcy3_jkzk",
							"jtcy4_xm", "jtcy4_cw", "jtcy4_nl",
							"jtcy4_sfzh", "jtcy4_gzdw", "jtcy4_ysr",
							"jtcy4_jkzk", "jtcy5_xm", "jtcy5_cw",
							"jtcy5_nl", "jtcy5_sfzh", "jtcy5_gzdw",
							"jtcy5_ysr", "jtcy5_jkzk", "sqyy", "bz" };

					String[] valueForOut = new String[] { xh, nd, lxdh,
							jtcy1_xm, jtcy1_cw, jtcy1_nl, jtcy1_sfzh,
							jtcy1_gzdw, jtcy1_ysr, jtcy1_jkzk, jtcy2_xm,
							jtcy2_cw, jtcy2_nl, jtcy2_sfzh, jtcy2_gzdw,
							jtcy2_ysr, jtcy2_jkzk, jtcy3_xm, jtcy3_cw,
							jtcy3_nl, jtcy3_sfzh, jtcy3_gzdw, jtcy3_ysr,
							jtcy3_jkzk, jtcy4_xm, jtcy4_cw, jtcy4_nl,
							jtcy4_sfzh, jtcy4_gzdw, jtcy4_ysr, jtcy4_jkzk,
							jtcy5_xm, jtcy5_cw, jtcy5_nl, jtcy5_sfzh,
							jtcy5_gzdw, jtcy5_ysr, jtcy5_jkzk, sqyy, bz };

					boolean ok = false;
					ok = StandardOperation.insert("bjlydx_knssqb",
							colName1, valueForOut, request);
					if (ok) {
						if (srlyList.size() != 0) {
							srList.add(xh);
							srList.add(nd);
							for (Iterator it = srlyList.iterator(); it
							.hasNext();) {
								String[] tempSr = (String[]) it.next();
								String srName = "srly" + tempSr[0];
								String sr = DealString.toGBK(request
										.getParameter(srName).toString());
								if ("".equalsIgnoreCase(sr) || sr == null) {
									sr = "0";
								}
								srList.add(sr);
								query += ", " + srName + "=? ";
							}
							sql = "update bjlydx_knssqb set " + query
							+ " where xh||nd='" + pkVal
							+ "'";
							dao.runUpdate(sql, srList);
						}
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		}
		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd;
		}

		sql = "select * from view_bjlydx_knssqb where xh||nd=? ";
		outValue = dao.getOneRs(sql, new String[] { pkVal }, outString);

		if (outValue == null) {
			if (xh != null) {
				sql = "select xh,xm,xb,sfzh,nj,xymc,zymc,bjmc,'" + nd
				+ "' nd from view_xsjbxx where xh=?";
				String[] colName = new String[] { "xh", "xm", "xb", "sfzh",
						"nj", "xymc", "zymc", "bjmc", "nd" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {

				} else {
					colName = new String[] { "xh", "xm", "xb", "sfzh", "nj",
							"xymc", "zymc", "bjmc", "nd" };
					for (int i = 0; i < colName.length; i++) {
						if (outVal[i] != null) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
				}
			}
		} else {
			for (int i = 0; i < outString.length; i++) {
				outString[i] = outString[i].toLowerCase();
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward bjly_knssqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String sqlb = "";
		sqlb = "北京林业大学困难生申请表";

		DAO dao = DAO.getInstance();
		String sql = "select count(*) con from bjlydx_knssrly";
		String con = dao.getOneRs(sql, new String[] {}, "con");
		boolean isNULL = false;
		if (con.equalsIgnoreCase("0")) {
			isNULL = true;
			con = "1";
		} else {
			con = String.valueOf(Integer.parseInt(con) + 1);
		}
		if (isNULL) {
			request.setAttribute("isNULL", "is");
		} else {
			request.setAttribute("isNULL", "no");
		}
		request.setAttribute("con", con);
		List<String[]> srlyList = dao.getSrlyList();
		request.setAttribute("srlyList", srlyList);

		String nd = Base.currNd;
		String xh = DealString.toGBK(request.getParameter("xh").toString());
		String xm = DealString.toGBK(request.getParameter("xm").toString());
		String xb = DealString.toGBK(request.getParameter("xb").toString());
		String nj = DealString.toGBK(request.getParameter("nj").toString());
		String sfzh = DealString.toGBK(request.getParameter("sfzh").toString());
		String xymc = DealString.toGBK(request.getParameter("xymc").toString());
		String zymc = DealString.toGBK(request.getParameter("zymc").toString());
		String bjmc = DealString.toGBK(request.getParameter("bjmc").toString());
		String lxdh = DealString.toGBK(request.getParameter("lxdh").toString());
		String jtcy1_xm = DealString.toGBK(request.getParameter("jtcy1_xm")
				.toString());
		String jtcy1_cw = DealString.toGBK(request.getParameter("jtcy1_cw")
				.toString());
		String jtcy1_nl = DealString.toGBK(request.getParameter("jtcy1_nl")
				.toString());
		String jtcy1_sfzh = DealString.toGBK(request.getParameter("jtcy1_sfzh")
				.toString());
		String jtcy1_gzdw = DealString.toGBK(request.getParameter("jtcy1_gzdw")
				.toString());
		String jtcy1_ysr = DealString.toGBK(request.getParameter("jtcy1_ysr")
				.toString());
		String jtcy1_jkzk = DealString.toGBK(request.getParameter("jtcy1_jkzk")
				.toString());
		String jtcy2_xm = DealString.toGBK(request.getParameter("jtcy2_xm")
				.toString());
		String jtcy2_cw = DealString.toGBK(request.getParameter("jtcy2_cw")
				.toString());
		String jtcy2_nl = DealString.toGBK(request.getParameter("jtcy2_nl")
				.toString());
		String jtcy2_sfzh = DealString.toGBK(request.getParameter("jtcy2_sfzh")
				.toString());
		String jtcy2_gzdw = DealString.toGBK(request.getParameter("jtcy2_gzdw")
				.toString());
		String jtcy2_ysr = DealString.toGBK(request.getParameter("jtcy2_ysr")
				.toString());
		String jtcy2_jkzk = DealString.toGBK(request.getParameter("jtcy2_jkzk")
				.toString());
		String jtcy3_xm = DealString.toGBK(request.getParameter("jtcy3_xm")
				.toString());
		String jtcy3_cw = DealString.toGBK(request.getParameter("jtcy3_cw")
				.toString());
		String jtcy3_nl = DealString.toGBK(request.getParameter("jtcy3_nl")
				.toString());
		String jtcy3_sfzh = DealString.toGBK(request.getParameter("jtcy3_sfzh")
				.toString());
		String jtcy3_gzdw = DealString.toGBK(request.getParameter("jtcy3_gzdw")
				.toString());
		String jtcy3_ysr = DealString.toGBK(request.getParameter("jtcy3_ysr")
				.toString());
		String jtcy3_jkzk = DealString.toGBK(request.getParameter("jtcy3_jkzk")
				.toString());
		String jtcy4_xm = DealString.toGBK(request.getParameter("jtcy4_xm")
				.toString());
		String jtcy4_cw = DealString.toGBK(request.getParameter("jtcy4_cw")
				.toString());
		String jtcy4_nl = DealString.toGBK(request.getParameter("jtcy4_nl")
				.toString());
		String jtcy4_sfzh = DealString.toGBK(request.getParameter("jtcy4_sfzh")
				.toString());
		String jtcy4_gzdw = DealString.toGBK(request.getParameter("jtcy4_gzdw")
				.toString());
		String jtcy4_ysr = DealString.toGBK(request.getParameter("jtcy4_ysr")
				.toString());
		String jtcy4_jkzk = DealString.toGBK(request.getParameter("jtcy4_jkzk")
				.toString());
		String jtcy5_xm = DealString.toGBK(request.getParameter("jtcy5_xm")
				.toString());
		String jtcy5_cw = DealString.toGBK(request.getParameter("jtcy5_cw")
				.toString());
		String jtcy5_nl = DealString.toGBK(request.getParameter("jtcy5_nl")
				.toString());
		String jtcy5_sfzh = DealString.toGBK(request.getParameter("jtcy5_sfzh")
				.toString());
		String jtcy5_gzdw = DealString.toGBK(request.getParameter("jtcy5_gzdw")
				.toString());
		String jtcy5_ysr = DealString.toGBK(request.getParameter("jtcy5_ysr")
				.toString());
		String jtcy5_jkzk = DealString.toGBK(request.getParameter("jtcy5_jkzk")
				.toString());
		String sqyy = DealString.toGBK(request.getParameter("sqyy").toString());
		String bz = DealString.toGBK(request.getParameter("bz").toString());

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue = new String[] { xh, nd, lxdh, xm, xb, nj, sfzh,
				xymc, zymc, bjmc, jtcy1_xm, jtcy1_cw, jtcy1_nl, jtcy1_sfzh,
				jtcy1_gzdw, jtcy1_ysr, jtcy1_jkzk, jtcy2_xm, jtcy2_cw,
				jtcy2_nl, jtcy2_sfzh, jtcy2_gzdw, jtcy2_ysr, jtcy2_jkzk,
				jtcy3_xm, jtcy3_cw, jtcy3_nl, jtcy3_sfzh, jtcy3_gzdw,
				jtcy3_ysr, jtcy3_jkzk, jtcy4_xm, jtcy4_cw, jtcy4_nl,
				jtcy4_sfzh, jtcy4_gzdw, jtcy4_ysr, jtcy4_jkzk, jtcy5_xm,
				jtcy5_cw, jtcy5_nl, jtcy5_sfzh, jtcy5_gzdw, jtcy5_ysr,
				jtcy5_jkzk, sqyy, bz };
		String[] outString = new String[] { "xh", "nd", "lxdh", "xm", "xb",
				"nj", "sfzh", "xymc", "zymc", "bjmc", "jtcy1_xm", "jtcy1_cw",
				"jtcy1_nl", "jtcy1_sfzh", "jtcy1_gzdw", "jtcy1_ysr",
				"jtcy1_jkzk", "jtcy2_xm", "jtcy2_cw", "jtcy2_nl", "jtcy2_sfzh",
				"jtcy2_gzdw", "jtcy2_ysr", "jtcy2_jkzk", "jtcy3_xm",
				"jtcy3_cw", "jtcy3_nl", "jtcy3_sfzh", "jtcy3_gzdw",
				"jtcy3_ysr", "jtcy3_jkzk", "jtcy4_xm", "jtcy4_cw", "jtcy4_nl",
				"jtcy4_sfzh", "jtcy4_gzdw", "jtcy4_ysr", "jtcy4_jkzk",
				"jtcy5_xm", "jtcy5_cw", "jtcy5_nl", "jtcy5_sfzh", "jtcy5_gzdw",
				"jtcy5_ysr", "jtcy5_jkzk", "sqyy", "bz" };
		// System.out.println(outString[35]+outValue[35]);
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				// System.out.println("i="+i+" "+outString[i]);
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}

		if (srlyList.size() != 0) {
			for (Iterator it = srlyList.iterator(); it.hasNext();) {
				String[] tempSr = (String[]) it.next();
				String srName = "srly" + tempSr[0];
				String sr = DealString.toGBK(request.getParameter(srName)
						.toString());
				if ("".equalsIgnoreCase(sr) || sr == null) {
					sr = "0";
				}
				map.put(srName, sr);
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward szxx_gjjxjsq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String doType = request.getParameter("doType");// 操作类型
		String titName = request.getParameter("titName");// 访问助学金还是奖学金

		String sfksq = "-1";// 国家奖学金是否可申请参数，-1表示不可以，1表示可以。

		String xxmc = StandardOperation.getXxmc();
		String[] titNames = null;
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		List<HashMap<String, String>> jxjdjList = new ArrayList<HashMap<String, String>>();
		String[] cols = { "jxjdjdm", "jxjdjmc" };
		jxjdjList = dao.getList("select dm jxjdjdm,mc jxjdjmc from gjjxjdjdmb",
				new String[] {}, cols);

		request.setAttribute("jxjdjList", jxjdjList);

		titNames = new String[] { "szxx_gjjxjsq" };

		if (null == titName)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间
		String[] outString = new String[] {};
		sql = "select xh,nd,csny,rxny,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,"
			+ "jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,"
			+ "jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,"
			+ "sqsj,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,"
			+ "jxjdjdm,jjje,xysh,xxsh from szxx_gjjxjsqb where 1=2";
		outString = dao.getColumnName(sql);// 获得列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
		String xh = "";
		String pkVal = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;

			sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='国家奖学金' and b.xh=? ";
			jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
					"kssj", "jssj" });
			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String csny = DealString.toGBK(request.getParameter("csny")
							.toString());
					String rxny = DealString.toGBK(request.getParameter("rxny")
							.toString());
					String jlxx = DealString.toGBK(
							request.getParameter("jlxx").toString());
					String radjthk = DealString.toGBK(request.getParameter(
					"radjthk").toString());
					String hkrs = DealString.toGBK(request.getParameter("hkrs")
							.toString());
					String jtyzsr = DealString.toGBK(request.getParameter(
					"jtyzsr").toString());
					String jtrjsr = DealString.toGBK(request.getParameter(
					"jtrjsr").toString());
					String jtsrly = DealString.toGBK(request.getParameter(
					"jtsrly").toString());
					String yzbm = DealString.toGBK(request.getParameter("yzbm")
							.toString());
					String jtzz = DealString.toGBK(
							request.getParameter("jtzz").toString());
					String jtcy1_xm = DealString.toGBK(request.getParameter(
					"jtcy1_xm").toString());
					String jtcy1_nl = DealString.toGBK(request.getParameter(
					"jtcy1_nl").toString());
					String jtcy1_gx = DealString.toGBK(request.getParameter(
					"jtcy1_gx").toString());
					String jtcy1_gzdz = DealString.toGBK(request.getParameter(
					"jtcy1_gzdz").toString());
					String jtcy2_xm = DealString.toGBK(request.getParameter(
					"jtcy2_xm").toString());
					String jtcy2_nl = DealString.toGBK(request.getParameter(
					"jtcy2_nl").toString());
					String jtcy2_gx = DealString.toGBK(request.getParameter(
					"jtcy2_gx").toString());
					String jtcy2_gzdz = DealString.toGBK(request.getParameter(
					"jtcy2_gzdz").toString());
					String jtcy3_xm = DealString.toGBK(request.getParameter(
					"jtcy3_xm").toString());
					String jtcy3_nl = DealString.toGBK(request.getParameter(
					"jtcy3_nl").toString());
					String jtcy3_gx = DealString.toGBK(request.getParameter(
					"jtcy3_gx").toString());
					String jtcy3_gzdz = DealString.toGBK(request.getParameter(
					"jtcy3_gzdz").toString());
					String jtcy4_xm = DealString.toGBK(request.getParameter(
					"jtcy4_xm").toString());
					String jtcy4_nl = DealString.toGBK(request.getParameter(
					"jtcy4_nl").toString());
					String jtcy4_gx = DealString.toGBK(request.getParameter(
					"jtcy4_gx").toString());
					String jtcy4_gzdz = DealString.toGBK(request.getParameter(
					"jtcy4_gzdz").toString());
					String jtcy5_xm = DealString.toGBK(request.getParameter(
					"jtcy5_xm").toString());
					String jtcy5_nl = DealString.toGBK(request.getParameter(
					"jtcy5_nl").toString());
					String jtcy5_gx = DealString.toGBK(request.getParameter(
					"jtcy5_gx").toString());
					String jtcy5_gzdz = DealString.toGBK(request.getParameter(
					"jtcy5_gzdz").toString());
					String jxjdjdm = DealString.toGBK(request.getParameter(
					"jxjdjdm").toString());
					String jjje = DealString.toGBK(request.getParameter("jjje")
							.toString());
					String sqly = DealString.toGBK(
							request.getParameter("sqly").toString());
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}

					sql = "select xxsh from szxx_gjjxjsqb where xh||nd=?";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("szxx_gjjxjsqb", "xh||nd", pkVal, request);

						String[] valueForOut = null;
						String[] colName1 = new String[] { "xh", "nd", "csny",
								"rxny", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
								"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl",
								"jtcy2_gx", "jtcy2_gzdz", "jtcy3_xm",
								"jtcy3_nl", "jtcy3_gx", "jtcy3_gzdz",
								"jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
								"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl",
								"jtcy5_gx", "jtcy5_gzdz", "jlxx", "hkrs",
								"jtyzsr", "jtrjsr", "jtsrly", "jtzz", "sqly",
								"yzbm", "radjthk", "jxjdjdm", "jjje" };

						valueForOut = new String[] { xh, nd, csny, rxny,
								jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdz,
								jtcy2_xm, jtcy2_nl, jtcy2_gx, jtcy2_gzdz,
								jtcy3_xm, jtcy3_nl, jtcy3_gx, jtcy3_gzdz,
								jtcy4_xm, jtcy4_nl, jtcy4_gx, jtcy4_gzdz,
								jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_gzdz, jlxx,
								hkrs, jtyzsr, jtrjsr, jtsrly, jtzz, sqly, yzbm,
								radjthk, jxjdjdm, jjje };

						boolean ok = false;
						ok = StandardOperation.insert("szxx_gjjxjsqb",
								colName1, valueForOut, request);
						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String csny = DealString.toGBK(request.getParameter("csny")
						.toString());
				String rxny = DealString.toGBK(request.getParameter("rxny")
						.toString());
				String jlxx = DealString.toGBK(
						request.getParameter("jlxx").toString());
				String radjthk = DealString.toGBK(request.getParameter(
				"radjthk").toString());
				String hkrs = DealString.toGBK(request.getParameter("hkrs")
						.toString());
				String jtyzsr = DealString.toGBK(request.getParameter("jtyzsr")
						.toString());
				String jtrjsr = DealString.toGBK(request.getParameter("jtrjsr")
						.toString());
				String jtsrly = DealString.toGBK(request.getParameter("jtsrly")
						.toString());
				String yzbm = DealString.toGBK(request.getParameter("yzbm")
						.toString());
				String jtzz = DealString.toGBK(
						request.getParameter("jtzz").toString());
				String jtcy1_xm = DealString.toGBK(request.getParameter(
				"jtcy1_xm").toString());
				String jtcy1_nl = DealString.toGBK(request.getParameter(
				"jtcy1_nl").toString());
				String jtcy1_gx = DealString.toGBK(request.getParameter(
				"jtcy1_gx").toString());
				String jtcy1_gzdz = DealString.toGBK(request.getParameter(
				"jtcy1_gzdz").toString());
				String jtcy2_xm = DealString.toGBK(request.getParameter(
				"jtcy2_xm").toString());
				String jtcy2_nl = DealString.toGBK(request.getParameter(
				"jtcy2_nl").toString());
				String jtcy2_gx = DealString.toGBK(request.getParameter(
				"jtcy2_gx").toString());
				String jtcy2_gzdz = DealString.toGBK(request.getParameter(
				"jtcy2_gzdz").toString());
				String jtcy3_xm = DealString.toGBK(request.getParameter(
				"jtcy3_xm").toString());
				String jtcy3_nl = DealString.toGBK(request.getParameter(
				"jtcy3_nl").toString());
				String jtcy3_gx = DealString.toGBK(request.getParameter(
				"jtcy3_gx").toString());
				String jtcy3_gzdz = DealString.toGBK(request.getParameter(
				"jtcy3_gzdz").toString());
				String jtcy4_xm = DealString.toGBK(request.getParameter(
				"jtcy4_xm").toString());
				String jtcy4_nl = DealString.toGBK(request.getParameter(
				"jtcy4_nl").toString());
				String jtcy4_gx = DealString.toGBK(request.getParameter(
				"jtcy4_gx").toString());
				String jtcy4_gzdz = DealString.toGBK(request.getParameter(
				"jtcy4_gzdz").toString());
				String jtcy5_xm = DealString.toGBK(request.getParameter(
				"jtcy5_xm").toString());
				String jtcy5_nl = DealString.toGBK(request.getParameter(
				"jtcy5_nl").toString());
				String jtcy5_gx = DealString.toGBK(request.getParameter(
				"jtcy5_gx").toString());
				String jtcy5_gzdz = DealString.toGBK(request.getParameter(
				"jtcy5_gzdz").toString());
				String jxjdjdm = DealString.toGBK(request.getParameter(
				"jxjdjdm").toString());
				String jjje = DealString.toGBK(request.getParameter("jjje")
						.toString());
				String sqly = DealString.toGBK(
						request.getParameter("sqly").toString());
				pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = xh + nd;
				}

				sql = "select xxsh from szxx_gjjxjsqb where xh||nd=?";
				String[] temp = dao.getOneRs(sql, new String[] { pkVal },
						new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("szxx_gjjxjsqb", "xh||nd",
							pkVal, request);

					String[] valueForOut = null;
					String[] colName1 = new String[] { "xh", "nd", "csny",
							"rxny", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
							"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
							"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
							"jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
							"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
							"jtcy5_gzdz", "jlxx", "hkrs", "jtyzsr", "jtrjsr",
							"jtsrly", "jtzz", "sqly", "yzbm", "radjthk",
							"jxjdjdm", "jjje" };

					valueForOut = new String[] { xh, nd, csny, rxny, jtcy1_xm,
							jtcy1_nl, jtcy1_gx, jtcy1_gzdz, jtcy2_xm, jtcy2_nl,
							jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_nl, jtcy3_gx,
							jtcy3_gzdz, jtcy4_xm, jtcy4_nl, jtcy4_gx,
							jtcy4_gzdz, jtcy5_xm, jtcy5_nl, jtcy5_gx,
							jtcy5_gzdz, jlxx, hkrs, jtyzsr, jtrjsr, jtsrly,
							jtzz, sqly, yzbm, radjthk, jxjdjdm, jjje };

					boolean ok = false;
					ok = StandardOperation.insert("szxx_gjjxjsqb", colName1,
							valueForOut, request);
					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		}
		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd;
		}

		sql = "select xh,nd,xm,csny,rxny,mzmc,xb,xydm,xymc,zydm,zymc,bjdm,bjmc,nj,"
			+ "jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,"
			+ "jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,"
			+ "jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sqsj,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
			+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,jxjdjdm,jxjdjmc,jjje,xysh,xxsh,kh "
			+ "from view_szxx_gjjxjsqb where xh||nd=?";
		outString = new String[] { "xh", "nd", "xm", "csny", "rxny", "mzmc",
				"xb", "xydm", "xymc", "zydm", "zymc", "bjdm", "bjmc", "nj",
				"jtcy1_xm", "jtcy1_nl", "jtcy1_gx", "jtcy1_gzdz", "jtcy2_xm",
				"jtcy2_nl", "jtcy2_gx", "jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl",
				"jtcy3_gx", "jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
				"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx", "jtcy5_gzdz",
				"sqsj", "jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly", "jtzz",
				"sqly", "xyshyj", "xxshyj", "yzbm", "radjthk", "jxjdjdm",
				"jxjdjmc", "jjje", "xysh", "xxsh", "kh" };
		outValue = dao.getOneRs(sql, new String[] { pkVal }, outString);

		if (null == outValue) {
			if (null != xh) {
				sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
					+ "from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,"
					+ "v.nj,q.mzmc ,v.zymc,x.xxmc,"
					+ "(select j.rxny from bks_xsjbxx j where v.xh=j.xh) rxny,q.csrq csny from "
					+ "view_xsjbxx v,view_stu_details q,xtszb x where "
					+ "v.xh = q.xh and v.xh=?) a";
				String[] colName = new String[] { "xh", "xm", "xb", "bjmc",
						"xymc", "nj", "mzmc", "zymc", "xxmc", "rxny", "csny",
				"kh" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {

				} else {
					colName = new String[] { "xh", "xm", "xb", "bjmc", "xymc",
							"nj", "mzmc", "zymc", "xxmc", "rxny", "csny", "kh" };
					for (int i = 0; i < colName.length; i++) {
						if (null != outVal[i]) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
				}
			}
		} else {

			map.put("xxmc", xxmc);
			int len1 = outString.length;
			int len2 = outValue.length;
			int max = 0;
			if (len1 >= len2) {
				max = len2;
			} else {
				max = len1;
			}
			for (int i = 0; i < max; i++) {
				if (null != outValue[i]) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}

		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward szxx_gjjxjsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String sqlb = "";

		String xxmc = ToolClass.getXxmc();
		sqlb = "国家奖学金";

		String xh = DealString.toGBK(request.getParameter("xh"));
		String xm = DealString.toGBK(request.getParameter("xm"));
		String csny = DealString.toGBK(request.getParameter("csny"));
		String xb = DealString.toGBK(request.getParameter("xb"));
		String rxny = DealString.toGBK(request.getParameter("rxny"));
		String mzmc = DealString.toGBK(request.getParameter("mzmc"));
		xxmc = DealString.toGBK(request.getParameter("xxmc"));
		String xymc = DealString.toGBK(request.getParameter("xymc"));
		String zymc = DealString.toGBK(request.getParameter("zymc"));
		String bjmc = DealString.toGBK(request.getParameter("bjmc"));
		String jlxx = DealString.toGBK(request.getParameter("jlxx"));
		String radjthk = DealString.toGBK(request.getParameter("radjthk"));
		String hkrs = DealString.toGBK(request.getParameter("hkrs"));
		String jtyzsr = DealString.toGBK(request.getParameter("jtyzsr"));
		String jtrjsr = DealString.toGBK(request.getParameter("jtrjsr"));
		String jtsrly = DealString.toGBK(request.getParameter("jtsrly"));
		String yzbm = DealString.toGBK(request.getParameter("yzbm"));
		String jtzz = DealString.toGBK(request.getParameter("jtzz"));
		String jtcy1_xm = DealString.toGBK(request.getParameter("jtcy1_xm"));
		String jtcy1_nl = DealString.toGBK(request.getParameter("jtcy1_nl"));
		String jtcy1_gx = DealString.toGBK(request.getParameter("jtcy1_gx"));
		String jtcy1_gzdz = DealString
		.toGBK(request.getParameter("jtcy1_gzdz"));
		String jtcy2_xm = DealString.toGBK(request.getParameter("jtcy2_xm"));
		String jtcy2_nl = DealString.toGBK(request.getParameter("jtcy2_nl"));
		String jtcy2_gx = DealString.toGBK(request.getParameter("jtcy2_gx"));
		String jtcy2_gzdz = DealString
		.toGBK(request.getParameter("jtcy2_gzdz"));
		String jtcy3_xm = DealString.toGBK(request.getParameter("jtcy3_xm"));
		String jtcy3_nl = DealString.toGBK(request.getParameter("jtcy3_nl"));
		String jtcy3_gx = DealString.toGBK(request.getParameter("jtcy3_gx"));
		String jtcy3_gzdz = DealString
		.toGBK(request.getParameter("jtcy3_gzdz"));
		String jtcy4_xm = DealString.toGBK(request.getParameter("jtcy4_xm"));
		String jtcy4_nl = DealString.toGBK(request.getParameter("jtcy4_nl"));
		String jtcy4_gx = DealString.toGBK(request.getParameter("jtcy4_gx"));
		String jtcy4_gzdz = DealString
		.toGBK(request.getParameter("jtcy4_gzdz"));
		String jtcy5_xm = DealString.toGBK(request.getParameter("jtcy5_xm"));
		String jtcy5_nl = DealString.toGBK(request.getParameter("jtcy5_nl"));
		String jtcy5_gx = DealString.toGBK(request.getParameter("jtcy5_gx"));
		String jtcy5_gzdz = DealString
		.toGBK(request.getParameter("jtcy5_gzdz"));
		String sqly = DealString.toGBK(request.getParameter("sqly"));
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));
		String jxjdjmc = DealString.toGBK(request.getParameter("jxjdjmc")
				.toString());
		String jjje = DealString.toGBK(request.getParameter("jjje").toString());

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue;
		String[] outString;
		outValue = new String[] { xh, xm, rxny, xb, bjmc, xymc, mzmc, xxmc,
				jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdz, jtcy2_xm, jtcy2_nl,
				jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_nl, jtcy3_gx, jtcy3_gzdz,
				jtcy4_xm, jtcy4_nl, jtcy4_gx, jtcy4_gzdz, jtcy5_xm, jtcy5_nl,
				jtcy5_gx, jtcy5_gzdz, jlxx, hkrs, jtyzsr, jtrjsr, jtsrly, jtzz,
				sqly, xyshyj, xxshyj, yzbm, radjthk, csny, zymc, jxjdjmc, jjje };
		outString = new String[] { "xh", "xm", "rxny", "xb", "bjmc", "xy",
				"mzmc", "xxmc", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
				"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx", "jtcy2_gzdz",
				"jtcy3_xm", "jtcy3_nl", "jtcy3_gx", "jtcy3_gzdz", "jtcy4_xm",
				"jtcy4_nl", "jtcy4_gx", "jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl",
				"jtcy5_gx", "jtcy5_gzdz", "jlxx", "hkrs", "jtyzsr", "jtrjsr",
				"jtsrly", "jtzz", "sqly", "xyshyj", "xxshyj", "yzbm",
				"radjthk", "csny", "xmc", "jxjdjmc", "jjje" };
		// System.out.println(outString[35]+outValue[35]);
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				// System.out.println("i="+i+" "+outString[i]);
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward szxx_gjzxjsq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String doType = request.getParameter("doType");// 操作类型
		String titName = request.getParameter("titName");// 访问助学金还是奖学金

		String sfksq = "-1";// 国家奖学金是否可申请参数，-1表示不可以，1表示可以。

		String xxmc = StandardOperation.getXxmc();
		String[] titNames = null;
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		List<HashMap<String, String>> zmclList = new ArrayList<HashMap<String, String>>();
		String[] cols = { "zmcldm", "zmclmc" };
		zmclList = dao.getList("select dm zmcldm,mc zmclmc from zmcldmb",
				new String[] {}, cols);

		request.setAttribute("zmclList", zmclList);

		titNames = new String[] { "szxx_gjzxjsq" };

		if (null == titName)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间
		String[] outString = new String[] {};
		sql = "select xh,nd,xm,csny,rxny,mzmc,xb,xydm,xymc,zydm,zymc,bjdm,bjmc,nj,"
			+ "jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,"
			+ "jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,"
			+ "jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sqsj,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
			+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,zmcldm,zmclmc,zxjje,xysh,xxsh,kh "
			+ "from view_szxx_gjzxjsqb where 1=2";
		outString = dao.getColumnName(sql);// 获得列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
		String xh = "";
		String pkVal = "";
		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;

			sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='国家助学金' and b.xh=? ";
			jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
					"kssj", "jssj" });
			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String csny = DealString.toGBK(request.getParameter("csny")
							.toString());
					String rxny = DealString.toGBK(request.getParameter("rxny")
							.toString());
					String jlxx = DealString.toGBK(
							request.getParameter("jlxx").toString());
					String radjthk = DealString.toGBK(request.getParameter(
					"radjthk").toString());
					String hkrs = DealString.toGBK(request.getParameter("hkrs")
							.toString());
					String jtyzsr = DealString.toGBK(request.getParameter(
					"jtyzsr").toString());
					String jtrjsr = DealString.toGBK(request.getParameter(
					"jtrjsr").toString());
					String jtsrly = DealString.toGBK(request.getParameter(
					"jtsrly").toString());
					String yzbm = DealString.toGBK(request.getParameter("yzbm")
							.toString());
					String jtzz = DealString.toGBK(
							request.getParameter("jtzz").toString());
					String jtcy1_xm = DealString.toGBK(request.getParameter(
					"jtcy1_xm").toString());
					String jtcy1_nl = DealString.toGBK(request.getParameter(
					"jtcy1_nl").toString());
					String jtcy1_gx = DealString.toGBK(request.getParameter(
					"jtcy1_gx").toString());
					String jtcy1_gzdz = DealString.toGBK(request.getParameter(
					"jtcy1_gzdz").toString());
					String jtcy2_xm = DealString.toGBK(request.getParameter(
					"jtcy2_xm").toString());
					String jtcy2_nl = DealString.toGBK(request.getParameter(
					"jtcy2_nl").toString());
					String jtcy2_gx = DealString.toGBK(request.getParameter(
					"jtcy2_gx").toString());
					String jtcy2_gzdz = DealString.toGBK(request.getParameter(
					"jtcy2_gzdz").toString());
					String jtcy3_xm = DealString.toGBK(request.getParameter(
					"jtcy3_xm").toString());
					String jtcy3_nl = DealString.toGBK(request.getParameter(
					"jtcy3_nl").toString());
					String jtcy3_gx = DealString.toGBK(request.getParameter(
					"jtcy3_gx").toString());
					String jtcy3_gzdz = DealString.toGBK(request.getParameter(
					"jtcy3_gzdz").toString());
					String jtcy4_xm = DealString.toGBK(request.getParameter(
					"jtcy4_xm").toString());
					String jtcy4_nl = DealString.toGBK(request.getParameter(
					"jtcy4_nl").toString());
					String jtcy4_gx = DealString.toGBK(request.getParameter(
					"jtcy4_gx").toString());
					String jtcy4_gzdz = DealString.toGBK(request.getParameter(
					"jtcy4_gzdz").toString());
					String jtcy5_xm = DealString.toGBK(request.getParameter(
					"jtcy5_xm").toString());
					String jtcy5_nl = DealString.toGBK(request.getParameter(
					"jtcy5_nl").toString());
					String jtcy5_gx = DealString.toGBK(request.getParameter(
					"jtcy5_gx").toString());
					String jtcy5_gzdz = DealString.toGBK(request.getParameter(
					"jtcy5_gzdz").toString());
					String zmcldm = DealString.toGBK(request.getParameter(
					"zmcldm").toString());
					String zxjje = DealString.toGBK(request.getParameter(
					"zxjje").toString());
					String sqly = DealString.toGBK(
							request.getParameter("sqly").toString());
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd;
					}

					sql = "select xxsh from szxx_gjzxjsqb where xh||nd=?";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal },
							new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("szxx_gjzxjsqb", "xh||nd", pkVal, request);

						String[] valueForOut = null;
						String[] colName1 = new String[] { "xh", "nd", "csny",
								"rxny", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
								"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl",
								"jtcy2_gx", "jtcy2_gzdz", "jtcy3_xm",
								"jtcy3_nl", "jtcy3_gx", "jtcy3_gzdz",
								"jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
								"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl",
								"jtcy5_gx", "jtcy5_gzdz", "jlxx", "hkrs",
								"jtyzsr", "jtrjsr", "jtsrly", "jtzz", "sqly",
								"yzbm", "radjthk", "zmcldm", "zxjje" };

						valueForOut = new String[] { xh, nd, csny, rxny,
								jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdz,
								jtcy2_xm, jtcy2_nl, jtcy2_gx, jtcy2_gzdz,
								jtcy3_xm, jtcy3_nl, jtcy3_gx, jtcy3_gzdz,
								jtcy4_xm, jtcy4_nl, jtcy4_gx, jtcy4_gzdz,
								jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_gzdz, jlxx,
								hkrs, jtyzsr, jtrjsr, jtsrly, jtzz, sqly, yzbm,
								radjthk, zmcldm, zxjje };

						boolean ok = false;
						ok = StandardOperation.insert("szxx_gjzxjsqb",
								colName1, valueForOut, request);
						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String csny = DealString.toGBK(request.getParameter("csny")
						.toString());
				String rxny = DealString.toGBK(request.getParameter("rxny")
						.toString());
				String jlxx = DealString.toGBK(
						request.getParameter("jlxx").toString());
				String radjthk = DealString.toGBK(request.getParameter(
				"radjthk").toString());
				String hkrs = DealString.toGBK(request.getParameter("hkrs")
						.toString());
				String jtyzsr = DealString.toGBK(request.getParameter("jtyzsr")
						.toString());
				String jtrjsr = DealString.toGBK(request.getParameter("jtrjsr")
						.toString());
				String jtsrly = DealString.toGBK(request.getParameter("jtsrly")
						.toString());
				String yzbm = DealString.toGBK(request.getParameter("yzbm")
						.toString());
				String jtzz = DealString.toGBK(
						request.getParameter("jtzz").toString());
				String jtcy1_xm = DealString.toGBK(request.getParameter(
				"jtcy1_xm").toString());
				String jtcy1_nl = DealString.toGBK(request.getParameter(
				"jtcy1_nl").toString());
				String jtcy1_gx = DealString.toGBK(request.getParameter(
				"jtcy1_gx").toString());
				String jtcy1_gzdz = DealString.toGBK(request.getParameter(
				"jtcy1_gzdz").toString());
				String jtcy2_xm = DealString.toGBK(request.getParameter(
				"jtcy2_xm").toString());
				String jtcy2_nl = DealString.toGBK(request.getParameter(
				"jtcy2_nl").toString());
				String jtcy2_gx = DealString.toGBK(request.getParameter(
				"jtcy2_gx").toString());
				String jtcy2_gzdz = DealString.toGBK(request.getParameter(
				"jtcy2_gzdz").toString());
				String jtcy3_xm = DealString.toGBK(request.getParameter(
				"jtcy3_xm").toString());
				String jtcy3_nl = DealString.toGBK(request.getParameter(
				"jtcy3_nl").toString());
				String jtcy3_gx = DealString.toGBK(request.getParameter(
				"jtcy3_gx").toString());
				String jtcy3_gzdz = DealString.toGBK(request.getParameter(
				"jtcy3_gzdz").toString());
				String jtcy4_xm = DealString.toGBK(request.getParameter(
				"jtcy4_xm").toString());
				String jtcy4_nl = DealString.toGBK(request.getParameter(
				"jtcy4_nl").toString());
				String jtcy4_gx = DealString.toGBK(request.getParameter(
				"jtcy4_gx").toString());
				String jtcy4_gzdz = DealString.toGBK(request.getParameter(
				"jtcy4_gzdz").toString());
				String jtcy5_xm = DealString.toGBK(request.getParameter(
				"jtcy5_xm").toString());
				String jtcy5_nl = DealString.toGBK(request.getParameter(
				"jtcy5_nl").toString());
				String jtcy5_gx = DealString.toGBK(request.getParameter(
				"jtcy5_gx").toString());
				String jtcy5_gzdz = DealString.toGBK(request.getParameter(
				"jtcy5_gzdz").toString());
				String zmcldm = DealString.toGBK(request.getParameter("zmcldm")
						.toString());
				String zxjje = DealString.toGBK(request.getParameter("zxjje")
						.toString());
				String sqly = DealString.toGBK(
						request.getParameter("sqly").toString());
				pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = xh + nd;
				}

				sql = "select xxsh from szxx_gjzxjsqb where xh||nd=?";
				String[] temp = dao.getOneRs(sql, new String[] { pkVal },
						new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("szxx_gjzxjsqb", "xh||nd",
							pkVal, request);

					String[] valueForOut = null;
					String[] colName1 = new String[] { "xh", "nd", "csny",
							"rxny", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
							"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
							"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
							"jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
							"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
							"jtcy5_gzdz", "jlxx", "hkrs", "jtyzsr", "jtrjsr",
							"jtsrly", "jtzz", "sqly", "yzbm", "radjthk",
							"zmcldm", "zxjje" };

					valueForOut = new String[] { xh, nd, csny, rxny, jtcy1_xm,
							jtcy1_nl, jtcy1_gx, jtcy1_gzdz, jtcy2_xm, jtcy2_nl,
							jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_nl, jtcy3_gx,
							jtcy3_gzdz, jtcy4_xm, jtcy4_nl, jtcy4_gx,
							jtcy4_gzdz, jtcy5_xm, jtcy5_nl, jtcy5_gx,
							jtcy5_gzdz, jlxx, hkrs, jtyzsr, jtrjsr, jtsrly,
							jtzz, sqly, yzbm, radjthk, zmcldm, zxjje };

					boolean ok = false;
					ok = StandardOperation.insert("szxx_gjzxjsqb", colName1,
							valueForOut, request);
					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		}
		pkVal = request.getParameter("pkVal");
		if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
			pkVal = DealString.toGBK(pkVal);
		} else {
			pkVal = xh + nd;
		}

		sql = "select xh,nd,xm,csny,rxny,mzmc,xb,xydm,xymc,zydm,zymc,bjdm,bjmc,nj,"
			+ "jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,"
			+ "jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,"
			+ "jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sqsj,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
			+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,zmcldm,zmclmc,zxjje,xysh,xxsh,kh "
			+ "from view_szxx_gjzxjsqb where xh=? and nd=?";
		outString = new String[] { "xh", "nd", "xm", "csny", "rxny", "mzmc",
				"xb", "xydm", "xymc", "zydm", "zymc", "bjdm", "bjmc", "nj",
				"jtcy1_xm", "jtcy1_nl", "jtcy1_gx", "jtcy1_gzdz", "jtcy2_xm",
				"jtcy2_nl", "jtcy2_gx", "jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl",
				"jtcy3_gx", "jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
				"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx", "jtcy5_gzdz",
				"sqsj", "jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly", "jtzz",
				"sqly", "xyshyj", "xxshyj", "yzbm", "radjthk", "zmcldm",
				"zmclmc", "zxjje", "xysh", "xxsh", "kh" };
		outValue = dao.getOneRs(sql, new String[] { pkVal }, outString);

		if (null == outValue) {
			if (null != xh) {
				sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
					+ "from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,"
					+ "v.nj,q.mzmc,v.zymc,x.xxmc,"
					+ "(select j.rxny from bks_xsjbxx j where j.xh=v.xh) rxny,q.csrq csny from "
					+ "view_xsjbxx v,view_stu_details q,xtszb x where "
					+ "v.xh = q.xh and v.xh=?) a ";
				String[] colName = new String[] { "xh", "xm", "xb", "bjmc",
						"xymc", "nj", "mzmc", "zymc", "xxmc", "rxny", "csny",
				"kh" };
				String[] outVal = dao.getOneRs(sql, new String[] { xh },
						colName);
				if (outVal == null) {

				} else {
					colName = new String[] { "xh", "xm", "xb", "bjmc", "xymc",
							"nj", "mzmc", "zymc", "xxmc", "rxny", "csny", "kh" };
					for (int i = 0; i < colName.length; i++) {
						if (null != outVal[i]) {
							map.put(colName[i], outVal[i]);
						} else {
							map.put(colName[i], "");
						}
					}
				}
			}
		} else {

			map.put("xxmc", xxmc);
			int len1 = outString.length;
			int len2 = outValue.length;
			int max = 0;
			if (len1 >= len2) {
				max = len2;
			} else {
				max = len1;
			}
			for (int i = 0; i < max; i++) {
				if (null != outValue[i]) {
					map.put(outString[i], outValue[i]);
				} else {
					map.put(outString[i], "");
				}
			}
		}

		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward szxx_gjzxjsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
		String sqlb = "";

		String xxmc = ToolClass.getXxmc();
		sqlb = "国家助学金";

		String xh = DealString.toGBK(request.getParameter("xh"));
		String xm = DealString.toGBK(request.getParameter("xm"));
		String csny = DealString.toGBK(request.getParameter("csny"));
		String xb = DealString.toGBK(request.getParameter("xb"));
		String rxny = DealString.toGBK(request.getParameter("rxny"));
		String mzmc = DealString.toGBK(request.getParameter("mzmc"));
		xxmc = DealString.toGBK(request.getParameter("xxmc"));
		String xymc = DealString.toGBK(request.getParameter("xymc"));
		String zymc = DealString.toGBK(request.getParameter("zymc"));
		String bjmc = DealString.toGBK(request.getParameter("bjmc"));
		String jlxx = DealString.toGBK(request.getParameter("jlxx"));
		String radjthk = DealString.toGBK(request.getParameter("radjthk"));
		String hkrs = DealString.toGBK(request.getParameter("hkrs"));
		String jtyzsr = DealString.toGBK(request.getParameter("jtyzsr"));
		String jtrjsr = DealString.toGBK(request.getParameter("jtrjsr"));
		String jtsrly = DealString.toGBK(request.getParameter("jtsrly"));
		String yzbm = DealString.toGBK(request.getParameter("yzbm"));
		String jtzz = DealString.toGBK(request.getParameter("jtzz"));
		String jtcy1_xm = DealString.toGBK(request.getParameter("jtcy1_xm"));
		String jtcy1_nl = DealString.toGBK(request.getParameter("jtcy1_nl"));
		String jtcy1_gx = DealString.toGBK(request.getParameter("jtcy1_gx"));
		String jtcy1_gzdz = DealString
		.toGBK(request.getParameter("jtcy1_gzdz"));
		String jtcy2_xm = DealString.toGBK(request.getParameter("jtcy2_xm"));
		String jtcy2_nl = DealString.toGBK(request.getParameter("jtcy2_nl"));
		String jtcy2_gx = DealString.toGBK(request.getParameter("jtcy2_gx"));
		String jtcy2_gzdz = DealString
		.toGBK(request.getParameter("jtcy2_gzdz"));
		String jtcy3_xm = DealString.toGBK(request.getParameter("jtcy3_xm"));
		String jtcy3_nl = DealString.toGBK(request.getParameter("jtcy3_nl"));
		String jtcy3_gx = DealString.toGBK(request.getParameter("jtcy3_gx"));
		String jtcy3_gzdz = DealString
		.toGBK(request.getParameter("jtcy3_gzdz"));
		String jtcy4_xm = DealString.toGBK(request.getParameter("jtcy4_xm"));
		String jtcy4_nl = DealString.toGBK(request.getParameter("jtcy4_nl"));
		String jtcy4_gx = DealString.toGBK(request.getParameter("jtcy4_gx"));
		String jtcy4_gzdz = DealString
		.toGBK(request.getParameter("jtcy4_gzdz"));
		String jtcy5_xm = DealString.toGBK(request.getParameter("jtcy5_xm"));
		String jtcy5_nl = DealString.toGBK(request.getParameter("jtcy5_nl"));
		String jtcy5_gx = DealString.toGBK(request.getParameter("jtcy5_gx"));
		String jtcy5_gzdz = DealString
		.toGBK(request.getParameter("jtcy5_gzdz"));
		String sqly = DealString.toGBK(request.getParameter("sqly"));
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));
		String zmclmc = DealString.toGBK(request.getParameter("zmclmc")
				.toString());
		String zxjje = DealString.toGBK(request.getParameter("zxjje")
				.toString());

		HashMap<String, String> map = new HashMap<String, String>();
		String[] outValue;
		String[] outString;
		outValue = new String[] { xh, xm, rxny, xb, bjmc, xymc, mzmc, xxmc,
				jtcy1_xm, jtcy1_nl, jtcy1_gx, jtcy1_gzdz, jtcy2_xm, jtcy2_nl,
				jtcy2_gx, jtcy2_gzdz, jtcy3_xm, jtcy3_nl, jtcy3_gx, jtcy3_gzdz,
				jtcy4_xm, jtcy4_nl, jtcy4_gx, jtcy4_gzdz, jtcy5_xm, jtcy5_nl,
				jtcy5_gx, jtcy5_gzdz, jlxx, hkrs, jtyzsr, jtrjsr, jtsrly, jtzz,
				sqly, xyshyj, xxshyj, yzbm, radjthk, csny, zymc, zmclmc, zxjje };
		outString = new String[] { "xh", "xm", "rxny", "xb", "bjmc", "xy",
				"mzmc", "xxmc", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
				"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx", "jtcy2_gzdz",
				"jtcy3_xm", "jtcy3_nl", "jtcy3_gx", "jtcy3_gzdz", "jtcy4_xm",
				"jtcy4_nl", "jtcy4_gx", "jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl",
				"jtcy5_gx", "jtcy5_gzdz", "jlxx", "hkrs", "jtyzsr", "jtrjsr",
				"jtsrly", "jtzz", "sqly", "xyshyj", "xxshyj", "yzbm",
				"radjthk", "csny", "xmc", "zmclmc", "zxjje" };
		// System.out.println(outString[35]+outValue[35]);
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null && !(outValue[i].equals(""))) {
				// System.out.println("i="+i+" "+outString[i]);
				map.put(outString[i], outValue[i]);
			} else {
				map.put(outString[i], " ");
			}
		}
		request.setAttribute("sqlb", sqlb);
		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward szxx_wszxjsq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm thisForm = (XszzForm) form;
		String doType = request.getParameter("doType");
		String tips = "当前所在位置：学生资助 - 申请 - 外设助学金申请";
		String sfksq = "";
		boolean ksq = false;
		String sql = "";
		String sql1 = "";

		List wszxjList = dao.getList(
				"select ZXJDM wszxjdm,ZXJMC wszxjmc from wszxjdmb",
				new String[] {}, new String[] { "wszxjdm", "wszxjmc" });

		String thisXn = Base.currXn;
		String thisNd = Base.currNd;// 获得当前年度
		sql1 = "select to_char(sysdate,'yyyy-mm-dd') rithtNow from dual";
		String rightNow = dao.getOneRs(sql1, new String[] {},
				new String[] { "rithtNow" })[0];// 获得当前时间
		HashMap<String, String> map = new HashMap<String, String>();
		String bzdm = "";
		String pkT = DealString.toGBK(request.getParameter("queryPK"));
		String xh = DealString.toGBK(request.getParameter("xh"));
		sql = "select xh,xm,bzdm from szxx_WSZXJSQB where xh=? and nd=? and bzdm "
			+ "in (select bzdm from wszxjdmb)";
		String[] result = dao.getOneRs(sql, new String[] { xh,
				thisNd }, new String[] { "xh", "xm", "bzdm" });

		request.setAttribute("tips", tips);
		request.setAttribute("wszxjList", wszxjList);

		List zmclList = dao.getList("select dm zmcldm,mc zmclmc from zmcldmb",
				new String[] {}, new String[] { "zmcldm", "zmclmc" });
		request.setAttribute("zmclList", zmclList);
		String pkVal = "";

		if (doType == null || doType.equalsIgnoreCase(" ")
				|| doType.equalsIgnoreCase("query")) {// 进入页面
			if (userType.equalsIgnoreCase("stu")) {// 学生用户
				xh = sUName;
				String[] jxjksjssj = null;

				sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
						+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='外设助学金' and b.xh=? ";
				jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
						"kssj", "jssj" });
				if (jxjksjssj != null
						&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
						&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
					sfksq = "yes";// 可申请
					request.setAttribute("sfksq", sfksq);
					ksq = true;
				} else {
					sfksq = "no";// 不可申请
					request.setAttribute("errMsg", "非申请时间!");
				}
				if (ksq) {
					sql = "select xh,xm,bzdm from szxx_WSZXJSQB where xh=? and nd=? and bzdm "
						+ "in (select bzdm from wszxjdmb)";
					result = dao.getOneRs(sql, new String[] { xh,
							thisNd }, new String[] { "xh", "xm", "bzdm" });
					if (result == null) {// 没有申请过
						String sql2 = "select bzdm,bzmc,zmcldm,zmclmc,wszxjje,"
							+ "xn,nd,xh,xm,xb,mzmc,qsh,qsdh,jtdz,yzbm,"
							+ "jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_nl,jtcy1_ysr,"
							+ "jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_nl,jtcy2_ysr,"
							+ "jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_nl,jtcy3_ysr,"
							+ "jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_nl,jtcy4_ysr,"
							+ "jtcy5_xm,jtcy5_gx,jtcy5_gzdw,jtcy5_nl,jtcy5_ysr,"
							+ "sqzzly,csny,jg,jcqk,zzmm,drshgzqk,brcn,xyshyj,"
							+ "xxshyj,xz,kh from view_szxx_WSZXJSQB where xh=?";
						String[] outString = { "bzdm", "bzmc", "zmcldm",
								"zmclmc", "wszxjje", "xn", "nd", "xh", "xm",
								"xb", "mzmc", "qsh", "qsdh", "jtdz", "yzbm",
								"jtcy1_xm", "jtcy1_gx", "jtcy1_gzdw",
								"jtcy1_nl", "jtcy1_ysr", "jtcy2_xm",
								"jtcy2_gx", "jtcy2_gzdw", "jtcy2_nl",
								"jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
								"jtcy3_gzdw", "jtcy3_nl", "jtcy3_ysr",
								"jtcy4_xm", "jtcy4_gx", "jtcy4_gzdw",
								"jtcy4_nl", "jtcy4_ysr", "jtcy5_xm",
								"jtcy5_gx", "jtcy5_gzdw", "jtcy5_nl",
								"jtcy5_ysr", "sqzzly", "csny", "jg", "jcqk",
								"zzmm", "drshgzqk", "brcn", "xyshyj", "xxshyj",
								"xz", "kh" };

						String[] outValue = dao.getOneRs(sql2,
								new String[] { xh }, outString);
						if (outValue == null) {
							sql2 = "select b.bzdm,b.bzmc,b.zmcldm,b.zmclmc,b.wszxjje,b.xn,b.nd,"
								+ "a.xh,a.xm,a.xb,b.mzmc,a.ssbh qsh ,a.qsdh,b.jtdz,b.yzbm,"
								+ "b.jtcy1_xm,b.jtcy1_gx,b.jtcy1_gzdw,b.jtcy1_nl,b.jtcy1_ysr,"
								+ "b.jtcy2_xm,b.jtcy2_gx,b.jtcy2_gzdw,b.jtcy2_nl,b.jtcy2_ysr,"
								+ "b.jtcy3_xm,b.jtcy3_gx,b.jtcy3_gzdw,b.jtcy3_nl,b.jtcy3_ysr,"
								+ "b.jtcy4_xm,b.jtcy4_gx,b.jtcy4_gzdw,b.jtcy4_nl,b.jtcy4_ysr,"
								+ "b.jtcy5_xm,b.jtcy5_gx,b.jtcy5_gzdw,b.jtcy5_nl,b.jtcy5_ysr,"
								+ "b.sqzzly,b.csny,b.jg,b.jcqk,b.zzmm,b.drshgzqk,b.brcn,"
								+ "b.xyshyj,b.xxshyj,a.xz,b.kh from view_xsjbxx a left join "
								+ "view_szxx_WSZXJSQB b on a.xh=b.xh where a.xh=?";

							outValue = dao.getOneRs(sql2, new String[] { xh },
									outString);

						}

						for (int i = 0; i < outValue.length; i++) {
							if (outValue[i] != null) {
								map.put(outString[i], outValue[i]);
							} else
								map.put(outString[i], "");
						}
						map.put("wszxjdm", bzdm);
						request.setAttribute("rs", map);

					} else {// 申请过
						bzdm = result[2];
						if((null != pkT) && (!"".equalsIgnoreCase(pkT))){
							bzdm = pkT;
						}
						String pkValue = xh + bzdm + thisNd;
						String sql2 = "select bzdm,bzmc,zmcldm,zmclmc,wszxjje,xn,nd,"
							+ "xh,xm,xb,mzmc,qsh,qsdh,jtdz,yzbm,"
							+ "jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_nl,jtcy1_ysr,"
							+ "jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_nl,jtcy2_ysr,"
							+ "jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_nl,jtcy3_ysr,"
							+ "jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_nl,jtcy4_ysr,"
							+ "jtcy5_xm,jtcy5_gx,jtcy5_gzdw,jtcy5_nl,jtcy5_ysr,"
							+ "sqzzly,csny,jg,jcqk,zzmm,drshgzqk,brcn,xyshyj,"
							+ "xxshyj,xz,kh from view_szxx_WSZXJSQB where xh||bzdm||nd=?";
						String[] outString = { "bzdm", "bzmc", "zmcldm",
								"zmclmc", "wszxjje", "xn", "nd", "xh", "xm",
								"xb", "mzmc", "qsh", "qsdh", "jtdz", "yzbm",
								"jtcy1_xm", "jtcy1_gx", "jtcy1_gzdw",
								"jtcy1_nl", "jtcy1_ysr", "jtcy2_xm",
								"jtcy2_gx", "jtcy2_gzdw", "jtcy2_nl",
								"jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
								"jtcy3_gzdw", "jtcy3_nl", "jtcy3_ysr",
								"jtcy4_xm", "jtcy4_gx", "jtcy4_gzdw",
								"jtcy4_nl", "jtcy4_ysr", "jtcy5_xm",
								"jtcy5_gx", "jtcy5_gzdw", "jtcy5_nl",
								"jtcy5_ysr", "sqzzly", "csny", "jg", "jcqk",
								"zzmm", "drshgzqk", "brcn", "xyshyj", "xxshyj",
								"xz", "kh" };
						String[] outValue = dao.getOneRs(sql2,
								new String[] { pkValue }, outString);
						for (int i = 0; i < outValue.length; i++) {
							if (outValue[i] != null) {
								map.put(outString[i], outValue[i]);
							} else
								map.put(outString[i], "");
						}
						map.put("wszxjdm", bzdm);
						request.setAttribute("rs", map);
					}
					return mapping.findForward("success");
				}
			} else {// 学院或学校用户
				bzdm = result[2];
				if((null != pkT) && (!"".equalsIgnoreCase(pkT))){
					bzdm = pkT;
				}
				String pkValue = xh + bzdm + thisNd;
				pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = pkValue;
				}
				String sql2 = "select bzdm,bzmc,zmcldm,zmclmc,wszxjje,xn,nd,"
					+ "xh,xm,xb,mzmc,qsh,qsdh,jtdz,yzbm,"
					+ "jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_nl,jtcy1_ysr,"
					+ "jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_nl,jtcy2_ysr,"
					+ "jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_nl,jtcy3_ysr,"
					+ "jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_nl,jtcy4_ysr,"
					+ "jtcy5_xm,jtcy5_gx,jtcy5_gzdw,jtcy5_nl,jtcy5_ysr,"
					+ "sqzzly,csny,jg,jcqk,zzmm,drshgzqk,brcn,xyshyj,"
					+ "xxshyj,xz,kh from view_szxx_WSZXJSQB where xh||bzdm||nd=?";
				String[] outString = { "bzdm", "bzmc", "zmcldm",
						"zmclmc", "wszxjje", "xn", "nd", "xh", "xm",
						"xb", "mzmc", "qsh", "qsdh", "jtdz", "yzbm",
						"jtcy1_xm", "jtcy1_gx", "jtcy1_gzdw",
						"jtcy1_nl", "jtcy1_ysr", "jtcy2_xm",
						"jtcy2_gx", "jtcy2_gzdw", "jtcy2_nl",
						"jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
						"jtcy3_gzdw", "jtcy3_nl", "jtcy3_ysr",
						"jtcy4_xm", "jtcy4_gx", "jtcy4_gzdw",
						"jtcy4_nl", "jtcy4_ysr", "jtcy5_xm",
						"jtcy5_gx", "jtcy5_gzdw", "jtcy5_nl",
						"jtcy5_ysr", "sqzzly", "csny", "jg", "jcqk",
						"zzmm", "drshgzqk", "brcn", "xyshyj", "xxshyj",
						"xz", "kh" };
				String[] outValue = dao.getOneRs(sql2,
						new String[] { pkVal }, outString);
				for (int i = 0; i < outValue.length; i++) {
					if (outValue[i] != null) {
						map.put(outString[i], outValue[i]);
					} else
						map.put(outString[i], "");
				}
				map.put("wszxjdm", bzdm);
				request.setAttribute("writeable", "yes");
				request.setAttribute("rs", map);
				return mapping.findForward("success");
			}
		} else if (doType.equalsIgnoreCase("save")) {// 执行保存操作
			bzdm = thisForm.getWszxjdm();
			if((null != pkT) && (!"".equalsIgnoreCase(pkT))){
				bzdm = pkT;
			}
			String zmcldm = DealString.toGBK(request.getParameter("zmcldm"));
			xh = DealString.toGBK(request.getParameter("xh"));
			String xm = DealString.toGBK(request.getParameter("xm"));
			String csny = DealString.toGBK(request.getParameter("csny"));
			String xb = DealString.toGBK(request.getParameter("xb"));
			String jg = DealString.toGBK(request.getParameter("jg"));
			String mzmc = DealString.toGBK(request.getParameter("mzmc"));
			String qsh = DealString.toGBK(request.getParameter("qsh"));
			String qsdh = DealString.toGBK(request.getParameter("qsdh"));
			String xz = DealString.toGBK(request.getParameter("xz"));
			String jcqk = DealString.toGBK(request.getParameter("jcqk"));
			String zzmm = DealString.toGBK(request.getParameter("zzmm"));
			String yzbm = DealString.toGBK(request.getParameter("yzbm"));
			String jtdz = DealString.toGBK(request.getParameter("jtdz"));
			String jtcy1_xm = DealString
			.toGBK(request.getParameter("jtcy1_xm"));
			String jtcy1_nl = DealString
			.toGBK(request.getParameter("jtcy1_nl"));
			String jtcy1_gx = DealString
			.toGBK(request.getParameter("jtcy1_gx"));
			String jtcy1_gzdw = DealString.toGBK(request
					.getParameter("jtcy1_gzdw"));
			String jtcy1_ysr = DealString.toGBK(request
					.getParameter("jtcy1_ysr"));
			String jtcy2_xm = DealString
			.toGBK(request.getParameter("jtcy2_xm"));
			String jtcy2_nl = DealString
			.toGBK(request.getParameter("jtcy2_nl"));
			String jtcy2_gx = DealString
			.toGBK(request.getParameter("jtcy2_gx"));
			String jtcy2_gzdw = DealString.toGBK(request
					.getParameter("jtcy2_gzdw"));
			String jtcy2_ysr = DealString.toGBK(request
					.getParameter("jtcy2_ysr"));
			String jtcy3_xm = DealString
			.toGBK(request.getParameter("jtcy3_xm"));
			String jtcy3_nl = DealString
			.toGBK(request.getParameter("jtcy3_nl"));
			String jtcy3_gx = DealString
			.toGBK(request.getParameter("jtcy3_gx"));
			String jtcy3_gzdw = DealString.toGBK(request
					.getParameter("jtcy3_gzdw"));
			String jtcy3_ysr = DealString.toGBK(request
					.getParameter("jtcy3_ysr"));
			String jtcy4_xm = DealString
			.toGBK(request.getParameter("jtcy4_xm"));
			String jtcy4_nl = DealString
			.toGBK(request.getParameter("jtcy4_nl"));
			String jtcy4_gx = DealString
			.toGBK(request.getParameter("jtcy4_gx"));
			String jtcy4_gzdw = DealString.toGBK(request
					.getParameter("jtcy4_gzdw"));
			String jtcy4_ysr = DealString.toGBK(request
					.getParameter("jtcy4_ysr"));
			String jtcy5_xm = DealString
			.toGBK(request.getParameter("jtcy5_xm"));
			String jtcy5_nl = DealString
			.toGBK(request.getParameter("jtcy5_nl"));
			String jtcy5_gx = DealString
			.toGBK(request.getParameter("jtcy5_gx"));
			String jtcy5_gzdw = DealString.toGBK(request
					.getParameter("jtcy5_gzdw"));
			String jtcy5_ysr = DealString.toGBK(request
					.getParameter("jtcy5_ysr"));
			String drshgzqk = DealString.toGBK(request.getParameter("drshgzqk")
					);
			String sqzzly = DealString.toGBK(request.getParameter("sqzzly")
					);
			String brcn = DealString.toGBK(request.getParameter("brcn"));
			String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
			String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));

			HashMap<String, String> map1 = new HashMap<String, String>();

			String pkValue = xh + bzdm + thisNd;
			pkVal = request.getParameter("pkVal");
			if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
				pkVal = DealString.toGBK(pkVal);
			} else {
				pkVal = pkValue;
			}
			boolean ok = false;
			String[] resTest = dao
			.getOneRs(
					"select xh,bzdm,nd from view_szxx_WSZXJSQB where xh||bzdm||nd=?",
					new String[] { pkVal }, new String[] { "xh",
							"bzdm", "nd" });
			if (resTest == null) {// 库中没有相应的学生信息
				String[] colName1 = new String[] { "bzdm", "zmcldm", "xn",
						"nd", "xh", "xm", "xb", "mzmc", "qsh", "qsdh", "jtdz",
						"yzbm", "jtcy1_xm", "jtcy1_gx", "jtcy1_gzdw",
						"jtcy1_nl", "jtcy1_ysr", "jtcy2_xm", "jtcy2_gx",
						"jtcy2_gzdw", "jtcy2_nl", "jtcy2_ysr", "jtcy3_xm",
						"jtcy3_gx", "jtcy3_gzdw", "jtcy3_nl", "jtcy3_ysr",
						"jtcy4_xm", "jtcy4_gx", "jtcy4_gzdw", "jtcy4_nl",
						"jtcy4_ysr", "jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw",
						"jtcy5_nl", "jtcy5_ysr", "sqzzly", "csny", "jg",
						"jcqk", "zzmm", "drshgzqk", "brcn", "xyshyj", "xxshyj",
						"xz" };
				ok = StandardOperation.insert("szxx_WSZXJSQB", colName1,
						new String[] { bzdm, zmcldm, thisXn, thisNd, xh, xm,
								xb, mzmc, qsh, qsdh, jtdz, yzbm, jtcy1_xm,
								jtcy1_gx, jtcy1_gzdw, jtcy1_nl, jtcy1_ysr,
								jtcy2_xm, jtcy2_gx, jtcy2_gzdw, jtcy2_nl,
								jtcy2_ysr, jtcy3_xm, jtcy3_gx, jtcy3_gzdw,
								jtcy3_nl, jtcy3_ysr, jtcy4_xm, jtcy4_gx,
								jtcy4_gzdw, jtcy4_nl, jtcy4_ysr, jtcy5_xm,
								jtcy5_gx, jtcy5_gzdw, jtcy5_nl, jtcy5_ysr,
								sqzzly, csny, jg, jcqk, zzmm, drshgzqk, brcn,
								xyshyj, xxshyj, xz }, request);
				if (ok) {
					logMsg = "添加 szxx_WSZXJSQB";
					Base.log(request, logMsg, sUName);
				}
				request.setAttribute("ok", ok);

			} else {
				sql = "select xxsh from view_szxx_WSZXJSQB where xh||bzdm||nd=?";
				String[] temp = dao.getOneRs(sql, new String[] { pkVal },
						new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("view_szxx_WSZXJSQB",
							"xh||bzdm||nd", pkVal, request);
					String[] colName1 = new String[] { "bzdm", "zmcldm", "xn",
							"nd", "xh", "xm", "xb", "mzmc", "qsh", "qsdh",
							"jtdz", "yzbm", "jtcy1_xm", "jtcy1_gx",
							"jtcy1_gzdw", "jtcy1_nl", "jtcy1_ysr", "jtcy2_xm",
							"jtcy2_gx", "jtcy2_gzdw", "jtcy2_nl", "jtcy2_ysr",
							"jtcy3_xm", "jtcy3_gx", "jtcy3_gzdw", "jtcy3_nl",
							"jtcy3_ysr", "jtcy4_xm", "jtcy4_gx", "jtcy4_gzdw",
							"jtcy4_nl", "jtcy4_ysr", "jtcy5_xm", "jtcy5_gx",
							"jtcy5_gzdw", "jtcy5_nl", "jtcy5_ysr", "sqzzly",
							"csny", "jg", "jcqk", "zzmm", "drshgzqk", "brcn",
							"xyshyj", "xxshyj", "xz" };
					ok = StandardOperation.insert("view_szxx_WSZXJSQB",
							colName1, new String[] { bzdm, zmcldm, thisXn,
									thisNd, xh, xm, xb, mzmc, qsh, qsdh, jtdz,
									yzbm, jtcy1_xm, jtcy1_gx, jtcy1_gzdw,
									jtcy1_nl, jtcy1_ysr, jtcy2_xm, jtcy2_gx,
									jtcy2_gzdw, jtcy2_nl, jtcy2_ysr, jtcy3_xm,
									jtcy3_gx, jtcy3_gzdw, jtcy3_nl, jtcy3_ysr,
									jtcy4_xm, jtcy4_gx, jtcy4_gzdw, jtcy4_nl,
									jtcy4_ysr, jtcy5_xm, jtcy5_gx, jtcy5_gzdw,
									jtcy5_nl, jtcy5_ysr, sqzzly, csny, jg,
									jcqk, zzmm, drshgzqk, brcn, xyshyj, xxshyj,
									xz }, request);
					if (ok) {
						logMsg = "添加 szxx_WSZXJSQB";
						Base.log(request, logMsg, sUName);
					}
					request.setAttribute("ok", ok);
				}
			}
			String[] outValue = new String[] { bzdm, zmcldm, xh, xm, xb, mzmc,
					qsh, qsdh, jtdz, yzbm, jtcy1_xm, jtcy1_gx, jtcy1_gzdw,
					jtcy1_nl, jtcy1_ysr, jtcy2_xm, jtcy2_gx, jtcy2_gzdw,
					jtcy2_nl, jtcy2_ysr, jtcy3_xm, jtcy3_gx, jtcy3_gzdw,
					jtcy3_nl, jtcy3_ysr, jtcy4_xm, jtcy4_gx, jtcy4_gzdw,
					jtcy4_nl, jtcy4_ysr, jtcy5_xm, jtcy5_gx, jtcy5_gzdw,
					jtcy5_nl, jtcy5_ysr, sqzzly, csny, jg, jcqk, zzmm,
					drshgzqk, brcn, xyshyj, xxshyj, xz };
			String[] outString = new String[] { "bzdm", "zmcldm", "xh", "xm",
					"xb", "mzmc", "qsh", "qsdh", "jtdz", "yzbm", "jtcy1_xm",
					"jtcy1_gx", "jtcy1_gzdw", "jtcy1_nl", "jtcy1_ysr",
					"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw", "jtcy2_nl",
					"jtcy2_ysr", "jtcy3_xm", "jtcy3_gx", "jtcy3_gzdw",
					"jtcy3_nl", "jtcy3_ysr", "jtcy4_xm", "jtcy4_gx",
					"jtcy4_gzdw", "jtcy4_nl", "jtcy4_ysr", "jtcy5_xm",
					"jtcy5_gx", "jtcy5_gzdw", "jtcy5_nl", "jtcy5_ysr",
					"sqzzly", "csny", "jg", "jcqk", "zzmm", "drshgzqk", "brcn",
					"xyshyj", "xxshyj", "xz" };
			for (int i = 0; i < outValue.length; i++) {
				if (outValue[i] != null) {
					map1.put(outString[i], outValue[i]);
				} else
					map1.put(outString[i], "");
			}
			map.put("wszxjdm", bzdm);
			request.setAttribute("rs", map1);
			return mapping.findForward("success");
		}

		return new ActionForward("/errMsg.do", false);
	}

	private ActionForward szxx_wszxjsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {

		HashMap<String, String> map = new HashMap<String, String>();
		String xh = request.getParameter("xh");
		String xm = request.getParameter("xm");
		String csny = request.getParameter("csny");
		String xb = request.getParameter("xb");
		String jg = request.getParameter("jg");
		String mzmc = request.getParameter("mzmc");
		String xz = request.getParameter("xz");
		String qsh = request.getParameter("qsh");
		String qsdh = request.getParameter("qsdh");
		String jcqk = request.getParameter("jcqk");
		String zzmm = request.getParameter("zzmm");
		String yzbm = request.getParameter("yzbm");
		String jtdz = request.getParameter("jtdz");
		String jtcy1_xm = request.getParameter("jtcy1_xm");
		String jtcy1_nl = request.getParameter("jtcy1_nl");
		String jtcy1_gx = request.getParameter("jtcy1_gx");
		String jtcy1_ysr = request.getParameter("jtcy1_ysr");
		String jtcy1_gzdw = request.getParameter("jtcy1_gzdw");
		String jtcy2_xm = request.getParameter("jtcy2_xm");
		String jtcy2_nl = request.getParameter("jtcy2_nl");
		String jtcy2_gx = request.getParameter("jtcy2_gx");
		String jtcy2_ysr = request.getParameter("jtcy2_ysr");
		String jtcy2_gzdw = request.getParameter("jtcy2_gzdw");
		String jtcy3_xm = request.getParameter("jtcy3_xm");
		String jtcy3_nl = request.getParameter("jtcy3_nl");
		String jtcy3_gx = request.getParameter("jtcy3_gx");
		String jtcy3_ysr = request.getParameter("jtcy3_ysr");
		String jtcy3_gzdw = request.getParameter("jtcy3_gzdw");
		String jtcy4_xm = request.getParameter("jtcy4_xm");
		String jtcy4_nl = request.getParameter("jtcy4_nl");
		String jtcy4_gx = request.getParameter("jtcy4_gx");
		String jtcy4_ysr = request.getParameter("jtcy4_ysr");
		String jtcy4_gzdw = request.getParameter("jtcy4_gzdw");
		String jtcy5_xm = request.getParameter("jtcy5_xm");
		String jtcy5_nl = request.getParameter("jtcy5_nl");
		String jtcy5_gx = request.getParameter("jtcy5_gx");
		String jtcy5_ysr = request.getParameter("jtcy5_ysr");
		String jtcy5_gzdw = request.getParameter("jtcy5_gzdw");
		String drshgzqk = request.getParameter("drshgzqk");
		String sqzzly = request.getParameter("sqzzly");
		String xyshyj = request.getParameter("xyshyj");
		String xxshyj = request.getParameter("xxshyj");

		String[] outValue = new String[] { xh, xm, csny, xb, jg, mzmc, xz, qsh,
				qsdh, jcqk, zzmm, yzbm, jtdz, jtcy1_xm, jtcy1_nl, jtcy1_gx,
				jtcy1_ysr, jtcy1_gzdw, jtcy2_xm, jtcy2_nl, jtcy2_gx, jtcy2_ysr,
				jtcy2_gzdw, jtcy3_xm, jtcy3_nl, jtcy3_gx, jtcy3_ysr,
				jtcy3_gzdw, jtcy4_xm, jtcy4_nl, jtcy4_gx, jtcy4_ysr,
				jtcy4_gzdw, jtcy5_xm, jtcy5_nl, jtcy5_gx, jtcy5_ysr,
				jtcy5_gzdw, drshgzqk, sqzzly, xyshyj, xxshyj };
		String[] outString = new String[] { "xh", "xm", "csny", "xb", "jg",
				"mzmc", "xz", "qsh", "qsdh", "jcqk", "zzmm", "yzbm", "jtdz",
				"jtcy1_xm", "jtcy1_nl", "jtcy1_gx", "jtcy1_ysr", "jtcy1_gzdw",
				"jtcy2_xm", "jtcy2_nl", "jtcy2_gx", "jtcy2_ysr", "jtcy2_gzdw",
				"jtcy3_xm", "jtcy3_nl", "jtcy3_gx", "jtcy3_ysr", "jtcy3_gzdw",
				"jtcy4_xm", "jtcy4_nl", "jtcy4_gx", "jtcy4_ysr", "jtcy4_gzdw",
				"jtcy5_xm", "jtcy5_nl", "jtcy5_gx", "jtcy5_ysr", "jtcy5_gzdw",
				"drshgzqk", "sqzzly", "xyshyj", "xxshyj" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null) {
				map.put(outString[i], outValue[i]);
			} else
				map.put(outString[i], "");
		}
		String xxmc = ToolClass.getXxmc();
		map.put("xxmc", xxmc);
		request.setAttribute("rs", map);
		return mapping.findForward("success");

	}

	private ActionForward szxx_xnzxjsq(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {

		String userType;

		// String userDep;

		String sUName;

		String logMsg;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		userType = session.getAttribute("userType").toString();
		sUName = session.getAttribute("userName").toString();
		// userDep = session.getAttribute("userDep").toString();

		XszzForm xszzForm = (XszzForm) form;

		String doType = request.getParameter("doType");// 操作类型
		String titName = request.getParameter("titName");// 访问助学金还是奖学金

		String sfksq = "-1";

		List zmclList = dao.getList("select dm zmcldm,mc zmclmc from zmcldmb",
				new String[] {}, new String[] { "zmcldm", "zmclmc" });
		request.setAttribute("zmclList", zmclList);

		List xnzxjList = dao.getList("select dm xmdm,mc xmmc from xnzxjdmb",
				new String[] {}, new String[] { "xmdm", "xmmc" });
		request.setAttribute("xnzxjList", xnzxjList);

		String xxmc = StandardOperation.getXxmc();
		String[] titNames = null;
		String rightNow = (dao.getOneRs(
				"select to_char(sysdate,'yyyy-mm-dd') sdate from dual",
				new String[] {}, new String[] { "sdate" }))[0];
		String pkVal = "";

		titNames = new String[] { "szxx_xnzxjsq" };

		if (null == titName)
			titName = titNames[0];

		request.setAttribute("titName", titName);
		String sql = "";
		String sql1 = "";// 用于获取设置的申请时间
		String[] outString = new String[] {};
		sql = "select xh,xmdm,xmmc,zxjje,nd,xm,xb,nj,xydm,xymc,zydm,zymc,bjdm,bjmc,"
			+ "zmcldm,zmclmc,bz,sqsj,xysh,xxsh,xyshyj,xxshyj,kh from view_szxx_xnzxjsqb where 1=2";
		outString = dao.getColumnName(sql);// 获得列名数组
		String[] outValue = null;
		HashMap<String, String> map = new HashMap<String, String>();
		String nd = Base.currNd;
		String xh = "";
		String xmdm = "";
		String pkT = DealString.toGBK(request.getParameter("queryPK"));

		if (userType.equalsIgnoreCase("stu")) {
			xh = sUName;
			String[] jxjksjssj = null;

			sql1 = "select a.kssj,a.jssj from NBLG_SJB a,"
					+ "view_xsjbxx b where a.xydm=b.xydm and a.xmmc='校内助学金' and b.xh=? ";
			jxjksjssj = dao.getOneRs(sql1, new String[] { xh }, new String[] {
					"kssj", "jssj" });
			if (jxjksjssj != null
					&& jxjksjssj[0].compareToIgnoreCase(rightNow) <= 0
					&& jxjksjssj[1].compareToIgnoreCase(rightNow) >= 0) {// /在申请时间范围内
				sfksq = "1";// /可以进行申请
				request.setAttribute("sfksq", sfksq);
				if (doType != null && doType.equalsIgnoreCase("add")) {// /学生填写申请
					String zmcldm = DealString.toGBK(request.getParameter(
					"zmcldm").toString());
					String bz = DealString.toGBK(
							request.getParameter("bz").toString());
					xmdm = DealString.toGBK(request.getParameter("xmdm")
							.toString());
					if((null != pkT) && (!"".equalsIgnoreCase(pkT))){
						xmdm = pkT;
					}
					pkVal = request.getParameter("pkVal");
					if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
						pkVal = DealString.toGBK(pkVal);
					} else {
						pkVal = xh + nd + xmdm;
					}

					sql = "select xxsh from szxx_xnzxjsqb where xh||nd||xmdm=?";
					String[] temp = dao.getOneRs(sql, new String[] { pkVal }, new String[] { "xxsh" });
					if ((temp != null)
							&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
									.equalsIgnoreCase(temp[0]))) {
						request.setAttribute("isPASS", "is");
					} else {
						StandardOperation.delete("szxx_xnzxjsqb",
								"xh||nd||xmdm", pkVal, request);

						String[] valueForOut = null;
						String[] colName1 = new String[] { "xh", "nd", "xmdm",
								"zmcldm", "bz" };

						valueForOut = new String[] { xh, nd, xmdm, zmcldm, bz };

						boolean ok = false;
						ok = StandardOperation.insert("szxx_xnzxjsqb",
								colName1, valueForOut, request);
						if (ok) {
							logMsg = "申请" + titName;
							Base.log(request, logMsg, sUName);
							request.setAttribute("ok", "ok");
						} else {
							request.setAttribute("ok", "no");
						}
					}
				}
			} else {// 不在申请时间范围内
				sfksq = "-1";
				request.setAttribute("sfksq", sfksq);// 不能申请
			}
		} else if (!(userType.equalsIgnoreCase("stu"))) {
			sfksq = "1";// /可以进行申请
			request.setAttribute("sfksq", sfksq);
			xh = xszzForm.getXh();
			if (doType != null && doType.equalsIgnoreCase("add")) {
				xh = DealString.toGBK(request.getParameter("xh").toString());
				String bz = DealString.toGBK(
						request.getParameter("bz").toString());
				xmdm = DealString
				.toGBK(request.getParameter("xmdm").toString());
				if((null != pkT) && (!"".equalsIgnoreCase(pkT))){
					xmdm = pkT;
				}
				String zmcldm = DealString.toGBK(request.getParameter("xmdm")
						.toString());
				pkVal = request.getParameter("pkVal");
				if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
					pkVal = DealString.toGBK(pkVal);
				} else {
					pkVal = xh + nd;
				}

				sql = "select xxsh from szxx_xnzxjsqb where xh||nd||xmdm=?";
				String[] temp = dao.getOneRs(sql,
						new String[] { pkVal }, new String[] { "xxsh" });
				if ((temp != null)
						&& ("通过".equalsIgnoreCase(temp[0]) || "已通过"
								.equalsIgnoreCase(temp[0]))) {
					request.setAttribute("isPASS", "is");
				} else {
					StandardOperation.delete("szxx_xnzxjsqb", "xh||nd||xmdm",
							pkVal, request);

					String[] valueForOut = null;
					String[] colName1 = new String[] { "xh", "nd", "xmdm",
							"zmcldm", "bz" };

					valueForOut = new String[] { xh, nd, xmdm, zmcldm, bz };

					boolean ok = false;
					ok = StandardOperation.insert("szxx_xnzxjsqb", colName1,
							valueForOut, request);
					if (ok) {
						logMsg = "申请" + titName;
						Base.log(request, logMsg, sUName);
						request.setAttribute("ok", "ok");
					} else {
						request.setAttribute("ok", "no");
					}
				}
			}
		}

		if (doType != null && doType.equalsIgnoreCase("find")) {
			xmdm = DealString.toGBK(request.getParameter("xmdm").toString());
			if((null != pkT) && (!"".equalsIgnoreCase(pkT))){
				xmdm = pkT;
			}
			pkVal = request.getParameter("pkVal");
			if((null != pkVal) && (!"".equalsIgnoreCase(pkVal))){
				pkVal = DealString.toGBK(pkVal);
			} else {
				pkVal = xh + nd;
			}
			sql = "select xh,xmdm,xmmc,zxjje,nd,xm,xb,nj,xydm,xymc,zydm,zymc,bjdm,bjmc,"
				+ "zmcldm,zmclmc,bz,sqsj,xysh,xxsh,xyshyj,xxshyj,kh from "
				+ "view_szxx_xnzxjsqb where xh||nd||xmdm=?";
			outString = new String[] { "xh", "xmdm", "xmmc", "zxjje", "nd",
					"xm", "xb", "nj", "xydm", "xymc", "zydm", "zymc", "bjdm",
					"bjmc", "zmcldm", "zmclmc", "bz", "sqsj", "xysh", "xxsh",
					"xyshyj", "xxshyj", "kh" };
			outValue = dao.getOneRs(sql, new String[] { pkVal },
					outString);
			if (outValue == null) {
				if (null != xh) {
					sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
						+ "from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,"
						+ "v.nj,q.mzmc ,v.zymc,x.xxmc,"
						+ "(select j.rxny from bks_xsjbxx j where j.xh=v.xh) rxny,q.csrq csny from "
						+ "view_xsjbxx v,view_stu_details q,xtszb x where "
						+ "v.xh = q.xh and v.xh=?) a ";
					String[] colName = new String[] { "xh", "xm", "xb", "bjmc",
							"xymc", "nj", "mzmc", "zymc", "xxmc", "rxny",
							"csny", "kh" };
					String[] outVal = dao.getOneRs(sql, new String[] { xh },
							colName);
					if (outVal == null) {

					} else {
						colName = new String[] { "xh", "xm", "xb", "bjmc",
								"xymc", "nj", "mzmc", "zymc", "xxmc", "rxny",
								"csny", "kh" };
						for (int i = 0; i < colName.length; i++) {
							if (null != outVal[i]) {
								map.put(colName[i], outVal[i]);
							} else {
								map.put(colName[i], "");
							}
						}
					}
				} else {

					int len1 = outString.length;
					int len2 = outValue.length;
					int max = 0;
					if (len1 >= len2) {
						max = len2;
					} else {
						max = len1;
					}
					for (int i = 0; i < max; i++) {
						if (null != outValue[i]) {
							map.put(outString[i], outValue[i]);
						} else {
							map.put(outString[i], "");
						}
					}
				}
			}
			String zxjje = dao.getOneRs("select je from xnzxjdmb where dm=?",
					new String[] { xmdm }, "je");
			String xmmc = dao.getOneRs("select mc from xnzxjdmb where dm=?",
					new String[] { xmdm }, "mc");
			xh = DealString.toGBK(request.getParameter("xh"));
			nd = DealString.toGBK(request.getParameter("nd"));
			String zmclmc = DealString.toGBK(request.getParameter("zmclmc"));
			String xm = DealString.toGBK(request.getParameter("xm"));
			String xb = DealString.toGBK(request.getParameter("xb"));
			String nj = DealString.toGBK(request.getParameter("nj"));
			String xymc = DealString.toGBK(request.getParameter("xymc"));
			String zymc = DealString.toGBK(request.getParameter("zymc"));
			String bjmc = DealString.toGBK(request.getParameter("bjmc"));
			String bz = DealString.toGBK(request.getParameter("bz"));
			String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
			String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));
			String zmcldm = DealString.toGBK(request.getParameter("zmcldm"));

			outValue = new String[] { xh, nd, xmmc, zxjje, zmclmc, xmdm,
					zmcldm, xm, xb, nj, xymc, zymc, bjmc, bz, xyshyj, xxshyj };
			outString = new String[] { "xh", "nd", "xmmc", "zxjje", "zmclmc",
					"xmdm", "zmcldm", "xm", "xb", "nj", "xymc", "zymc", "bjmc",
					"bz", "xyshyj", "xxshyj" };
			for (int i = 0; i < outValue.length; i++) {
				if (outValue[i] != null) {
					map.put(outString[i], outValue[i]);
				} else
					map.put(outString[i], "");
			}
		} else {
			xmdm = DealString.toGBK(request.getParameter("xmdm"));
			if((null != pkT) && (!"".equalsIgnoreCase(pkT))){
				xmdm = pkT;
			}
			sql = "select xh,xmdm,xmmc,zxjje,nd,xm,xb,nj,xydm,xymc,zydm,zymc,bjdm,bjmc,"
				+ "zmcldm,zmclmc,bz,sqsj,xysh,xxsh,xyshyj,xxshyj,kh from "
				+ "view_szxx_xnzxjsqb where xh=? and nd=? and xmdm=?";
			outString = new String[] { "xh", "xmdm", "xmmc", "zxjje", "nd",
					"xm", "xb", "nj", "xydm", "xymc", "zydm", "zymc", "bjdm",
					"bjmc", "zmcldm", "zmclmc", "bz", "sqsj", "xysh", "xxsh",
					"xyshyj", "xxshyj", "kh" };
			outValue = dao.getOneRs(sql, new String[] { xh, nd, xmdm },
					outString);

			if (null == outValue) {
				if (null != xh) {
					sql = "select a.*,(select b.kh from view_xsxxb b where a.xh=b.xh group by b.xh,b.kh) kh "
						+ "from (select v.xh,v.xm,v.xb,v.bjmc,v.xymc,"
						+ "v.nj,q.mzmc ,v.zymc,x.xxmc,"
						+ "(select j.rxny from bks_xsjbxx j where j.xh=v.xh) rxny,q.csrq csny from "
						+ "view_xsjbxx v,view_stu_details q,xtszb x where "
						+ "v.xh = q.xh and v.xh=?) a ";
					String[] colName = new String[] { "xh", "xm", "xb", "bjmc",
							"xymc", "nj", "mzmc", "zymc", "xxmc", "rxny",
							"csny", "kh" };
					String[] outVal = dao.getOneRs(sql, new String[] { xh },
							colName);
					if (outVal == null) {

					} else {
						colName = new String[] { "xh", "xm", "xb", "bjmc",
								"xymc", "nj", "mzmc", "zymc", "xxmc", "rxny",
								"csny", "kh" };
						for (int i = 0; i < colName.length; i++) {
							if (null != outVal[i]) {
								map.put(colName[i], outVal[i]);
							} else {
								map.put(colName[i], "");
							}
						}
					}
				}
			} else {

				map.put("xxmc", xxmc);
				int len1 = outString.length;
				int len2 = outValue.length;
				int max = 0;
				if (len1 >= len2) {
					max = len2;
				} else {
					max = len1;
				}
				for (int i = 0; i < max; i++) {
					if (null != outValue[i]) {
						map.put(outString[i], outValue[i]);
					} else {
						map.put(outString[i], "");
					}
				}
			}
		}

		request.setAttribute("rs", map);
		return mapping.findForward("success");
	}

	private ActionForward szxx_xnzxjsqb(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {

		DAO dao = DAO.getInstance();
		HashMap<String, String> map = new HashMap<String, String>();
		String xh = DealString.toGBK(request.getParameter("xh"));
		String nd = DealString.toGBK(request.getParameter("nd"));
		String xmmc = DealString.toGBK(request.getParameter("xmmc"));
		String zxjje = DealString.toGBK(request.getParameter("zxjje"));
		String zmcldm = DealString.toGBK(request.getParameter("zmcldm"));
		String zmclmc = dao.getOneRs("select mc from zmcldmb where dm=?",
				new String[] { zmcldm }, "mc");
		String xm = DealString.toGBK(request.getParameter("xm"));
		String xb = DealString.toGBK(request.getParameter("xb"));
		String nj = DealString.toGBK(request.getParameter("nj"));
		String xymc = DealString.toGBK(request.getParameter("xymc"));
		String zymc = DealString.toGBK(request.getParameter("zymc"));
		String bjmc = DealString.toGBK(request.getParameter("bjmc"));
		String bz = DealString.toGBK(request.getParameter("bz"));
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));

		String[] outValue = new String[] { xh, nd, xmmc, zxjje, zmclmc, xm,
				xb, nj, xymc, zymc, bjmc, bz, xyshyj, xxshyj };
		String[] outString = new String[] { "xh", "nd", "xmmc", "zxjje",
				"zmclmc", "xm", "xb", "nj", "xymc", "zymc", "bjmc", "bz",
				"xyshyj", "xxshyj" };
		for (int i = 0; i < outValue.length; i++) {
			if (outValue[i] != null) {
				map.put(outString[i], outValue[i]);
			} else
				map.put(outString[i], "");
		}
		String xxmc = ToolClass.getXxmc();
		map.put("xxmc", xxmc);
		request.setAttribute("rs", map);
		return mapping.findForward("success");

	}
	
	private ActionForward xx_plsh(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
	throws Exception {
		DAO dao = DAO.getInstance();
		String doType = request.getParameter("doType");
		String sql = "";
		// String xxmc = StandardOperation.getXxmc();
		// String xxdm=StandardOperation.getXxdm();
		List tempList = null;
		String sUName;

		String logMsg;
		HttpSession session = request.getSession();
		sUName = session.getAttribute("userName").toString();
		String titName = "";

		String[] gnmklj = new String[] { "1", "2", "3", "4", "5" };
		String[] gnmkmc = new String[] { "困难生", "国家奖学金", "国家助学金", "国家助学贷款",
		"国家助学贷款确认书" };
		tempList = dao.arrayToList(gnmklj, gnmkmc);

		request.setAttribute("list", tempList);
		if (null == doType || "".equalsIgnoreCase(doType)) {

		} else {
			if ("xx_plsh".equalsIgnoreCase(doType)) {
				String xn = request.getParameter("xn");
				String nd = request.getParameter("nd");
				String xq = request.getParameter("xq");
				String gnmk = request.getParameter("gnmk");
				if ("1".equalsIgnoreCase(gnmk)) {
					sql = "update knssqb set xxsh='通过' where xn='" + xn
					+ "' and nd='" + nd
					+ "' and xysh <> '未审核' and xysh <> '不通过'";
					titName = "knssqb";
				} else if ("2".equalsIgnoreCase(gnmk)) {
					sql = "update xsjxjzxjsqb set xxsh='通过' where nd='"
						+ nd
						+ "' and xysh <> '未审核' and xysh <> '不通过' and JZXJMC='gjjxj' ";
					titName = "xsjxjzxjsqb";
				} else if ("3".equalsIgnoreCase(gnmk)) {
					sql = "update xsjxjzxjsqb set xxsh='通过' where nd='"
						+ nd
						+ "' and xysh <> '未审核' and xysh <> '不通过' and JZXJMC='gjzxj' ";
					titName = "xsjxjzxjsqb";
				} else if ("4".equalsIgnoreCase(gnmk)) {
					sql = "update zbdx_gjzxdk set xxsh='通过' where nd='" + nd
					+ "' and xysh <> '未审核' and xysh <> '未通过'";
					titName = "zbdx_gjzxdk";
				} else {
					sql = "update zbdx_dkqrs set xxsh='通过' where nd='" + nd
					+ "' and xysh <> '未审核' and xysh <> '未通过'";
					titName = "zbdx_dkqrs";
				}

				if (null == xq || "".equalsIgnoreCase(xq)) {

				} else {
					sql = sql + " and xq=" + xq;
				}

				boolean flag = dao.runUpdate(sql, new String[] {});
				if (true == flag) {
					logMsg = "批量修改" + titName;
					Base.log(request, logMsg, sUName);
					request.setAttribute("message", "update_success");
				} else {
					request.setAttribute("message", "update_fail");
				}
			}
		}
		request.setAttribute("xnndList", Base.getXnndList());
		request.setAttribute("xqList", Base.getXqList());
		return mapping.findForward("index_to_plsh");
	}

	private ActionForward auditing_gjjzxj(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		// 初始化页面，返回查询信息
		XszzForm checkForm = (XszzForm) form;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		List<Object> rs = new ArrayList<Object>();
		List<Object> rsExp = new ArrayList<Object>();
		String sqlExp = "";// sql语句
		String isQuery = request.getParameter("isQuery");
		if((null == isQuery) || ("".equalsIgnoreCase(isQuery))){
			isQuery = "no";
		}
		request.setAttribute("isQuery", isQuery);
		HashMap<String, String> map = new HashMap<String, String>();
		String[] colList = null;
		String[] colListCN = null;
		String sql = "";// sql语句
		StringBuffer querry = new StringBuffer(" where 1=1 ");// sql条件
		StringBuffer querry1 = new StringBuffer("");
		String tableName = "";// 查询信息源（多为视图名）
		String rsNum = "0";// 返回的记录数
		String realTable = "";// 数据源表
		String pk = "";// 数据源表主键（格式为“字段名||字段名||字段名”）
		String writeAble = "yes";// 写权限
		String userDep = session.getAttribute("userDep").toString();
		String userName = session.getAttribute("userName").toString();
		String userType = dao.getUserType(userDep);
		String shxm = DealString.toGBK(request.getParameter("shxm"));
		String xy = checkForm.getXydm();
		String xydm = request.getParameter("xydm");
		String xxdm = StandardOperation.getXxdm();
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);
		
		if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
			sql = "select 'gjzxj' shxmdm,'国家助学金' shxmmc from dual union select 'gjjxj' shxmdm,'国家奖学金' shxmmc from dual union select 'gjlzjxj' shxmdm,'国家励志奖学金' shxmmc from dual";
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY) || xxdm.equalsIgnoreCase(Globals.XXDM_BJLHDX)) {
			sql = "select 'gjjxj' shxmdm,'国家奖学金' shxmmc from dual";
		} else {
			sql = "select 'gjzxj' shxmdm,'国家助学金' shxmmc from dual union select 'gjjxj' shxmdm,'国家奖学金' shxmmc from dual";
		}
		List shxmList = dao.getList(sql, new String[] {},
				new String[] { "shxmdm" , "shxmmc" });
		request.setAttribute("shxmList", shxmList);
		querry1.append(" and lower(JZXJMC)='");
		querry1.append(shxm);
		querry1.append("' ");

		String xh = DealString.toGBK(checkForm.getXh());
		String xm = checkForm.getXm();
		String nj = checkForm.getNj();
		if (xydm != null && xy == null) {
			xy = xydm;
		}
		if (userType.equalsIgnoreCase("xy")
				&& (xy == null || xy.trim().equals(""))) {
			xy = userDep;
		}
		String zy = checkForm.getZydm();
		String bj = checkForm.getBjdm();
		String shlb = checkForm.getShlb();
		realTable = "xsjxjzxjsqb";
		pk = "lower(xh||nd||jzxjmc)";
		tableName = "view_xsjxjzxjsq";
		String nd = "";
//		if(!isQuery.equalsIgnoreCase("is")){
//			nd = Base.currNd;
//		} else {
			nd = request.getParameter("nd");
//		}
		if (isNull(nd)) {
		} else {
			querry.append(" and nd = '");
			querry.append(nd);
			querry.append("' ");
		}
		if (isNull(nj)) {
		} else {
			querry.append(" and nj = '");
			querry.append(nj);
			querry.append("' ");
		}
		if (isNull(xy)) {
		} else {
			querry.append(" and xydm = '");
			querry.append(xy);
			querry.append("' ");
		}
		if (isNull(zy)) {
		} else {
			querry.append(" and zydm = '");
			querry.append(zy);
			querry.append("' ");
		}
		if (isNull(bj)) {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				if (userBj.size() != 0) {
					querry.append("and bjdm in ('###'");
					for (Iterator<String> it = userBj.iterator(); it.hasNext();) {
						querry.append(", '");
						querry.append(it.next());
						querry.append("'");
					}
					querry.append(" ) ");
				}
			}
		} else {
			querry.append(" and bjdm = '");
			querry.append(bj);
			querry.append("' ");
		}
		if (isNull(xh)) {
		} else {
			querry.append(" and xh like '%");
			querry.append(xh);
			querry.append("%' ");
		}
		if (isNull(xm)) {
		} else {
			querry.append(" and xm like '%");
			querry.append(xm);
			querry.append("%' ");
		}
//		============= luojw 2009/8/26 begin =================
		if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
			String jb = DealString.toGBK(checkForm.getJb());
			if (isNull(jb)) {
			} else {
				querry.append(" and jb = '");
				querry.append(jb);
				querry.append("' ");
			}
		}
//		============= luojw 2009/8/26 end =================
		
		querry.append(querry1.toString());
		String tips;
		if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY) || xxdm.equalsIgnoreCase(Globals.XXDM_BJLHDX)) {
			tips = "当前所在位置：学生资助 - 审核 - 国家奖学金审核";
		} else {
			if("gjjxj".equalsIgnoreCase(shxm)){
				tips = "当前所在位置：学生资助 - 审核 - 国家奖学金审核";
			}else if("gjzxj".equalsIgnoreCase(shxm)){
				tips = "当前所在位置：学生资助 - 审核 - 国家助学金审核";
			}else{
				tips = "当前所在位置：学生资助 - 审核 - 国家助学、奖学金审核";
			}
			
		}
		if (isQuery.equalsIgnoreCase("is")){
			if (xxdm.equalsIgnoreCase(Globals.XXDM_ZJJDZYJSXY) || xxdm.equalsIgnoreCase(Globals.XXDM_BJLHDX)) {
				tips = "当前所在位置：学生资助 - 申请 - 申请结果查询 - 国家奖学金";
			} else {
				if("gjjxj".equalsIgnoreCase(shxm)){
					tips = "当前所在位置：学生资助 - 申请 - 申请结果查询 - 国家奖学金";
				}else if("gjzxj".equalsIgnoreCase(shxm)){
					tips = "当前所在位置：学生资助 - 申请 - 申请结果查询 - 国家助学金";
				}else{
					tips = "当前所在位置：学生资助 - 申请 - 申请结果查询 - 国家助学、奖学金";
				}
				
			}
			if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
						"zzdjmc", "zzdjje", "xyshrxm",
						"JZXJzwMC", "sqsj", "xysh", "xxsh" };
			} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
						"JTYZSR", "JTRJSR", "JZXJzwMC", "fdysh", "xysh", "xxsh" };
			} else 	if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
										 "nj", "xy", "xmc", "bjmc", "JTYZSR", 
										 "JTRJSR", "JZXJzwMC", "jbmc", "xysh", "xxsh" };
			} else {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
						"JTYZSR", "JTRJSR", "JZXJzwMC", "xysh", "xxsh" };
			}
			if (userType.equalsIgnoreCase("xx")) {
				sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
					+ " a.* from(select "
					+ pk
					+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " order by xxsh desc) a";
				sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " order by xxsh desc";
				request.setAttribute("isXX", "is");
			} else {
				checkForm.setXydm(userDep);
				sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
					+ "a.* from(select "
					+ pk
					+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xydm='"
					+ userDep
					+ "' order by xxsh desc) a";
				sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xydm='"
					+ userDep
					+ "' order by xxsh desc";
				request.setAttribute("isXX", "no");
			}
		} else {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
						"xb", "bjmc", "zzdjmc", "zzdjje", "xyshrxm",
						"JZXJzwMC", "sqsj", "" };
			} else 	if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
						"xb","nj", "xy", "xmc", "bjmc", "JTYZSR", "JTRJSR", "JZXJzwMC", "jbmc","" };
			}else {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
						"xb", "bjmc", "JTYZSR", "JTRJSR", "JZXJzwMC", "" };
			}
			if (userType.equalsIgnoreCase("xx")) {
				if(StringUtils.isNotNull(shlb)){
					querry.append(" and xxsh='");
					querry.append(shlb);
					querry.append("'");
				}
				sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
					+ " a.* from(select "
					+ pk
					+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xysh='通过' order by xxsh desc) a";
				sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xysh='通过' order by xxsh desc";
				colList[colList.length - 1] = "xxsh";
				request.setAttribute("isXX", "is");
			} else {
				checkForm.setXydm(userDep);
				if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY) || xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)){
					if (userBj.size() == 0) {
						if(StringUtils.isNotNull(shlb)){
							querry.append(" and xysh='");
							querry.append(shlb);
							querry.append("'");
						}
						sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep + "' and fdysh='通过' order by xysh desc) a";
						sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep + "' and fdysh='通过' order by xysh desc";
						colList[colList.length - 1] = "xysh";
					}else{
						if(StringUtils.isNotNull(shlb)){
							querry.append(" and fdysh='");
							querry.append(shlb);
							querry.append("'");
						}
						sql = "select (case when nvl(a.fdysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep + "' order by xysh desc) a";
						sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep + "' order by xysh desc";
						colList[colList.length - 1] = "fdysh";
					}
				} else {
					if(StringUtils.isNotNull(shlb)){
						querry.append(" and xysh='");
						querry.append(shlb);
						querry.append("'");
					}
					sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by xysh desc) a";
					sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xydm='"
						+ userDep
						+ "' order by xysh desc";
					colList[colList.length - 1] = "xysh";
				}
				request.setAttribute("isXX", "no");
			}
		}
		colListCN = dao.getColumnNameCN(colList, tableName);
		List topTr = dao.arrayToList(colList, colListCN);
		String colListS = "xh##OneSpile##xm##OneSpile##nd##OneSpile##csny##OneSpile##rxny##OneSpile##byny##OneSpile##lxdh##OneSpile##jzxjzwmc##OneSpile##sfzh##OneSpile##xb##OneSpile##bjmc##OneSpile##xy##OneSpile##mzmc##OneSpile##jtcy1_xm##OneSpile##jtcy1_nl##OneSpile##jtcy1_gx##OneSpile##jtcy1_gzdz##OneSpile##jtcy2_xm##OneSpile##jtcy2_nl##OneSpile##jtcy2_gx##OneSpile##jtcy2_gzdz##OneSpile##jtcy3_xm##OneSpile##jtcy3_nl##OneSpile##jtcy3_gx##OneSpile##jtcy3_gzdz##OneSpile##jtcy4_xm##OneSpile##jtcy4_nl##OneSpile##jtcy4_gx##OneSpile##jtcy4_gzdz##OneSpile##jtcy5_xm##OneSpile##jtcy5_nl##OneSpile##jtcy5_gx##OneSpile##jtcy5_gzdz##OneSpile##sfkns##OneSpile##sqsj##OneSpile##jzxjmc##OneSpile##jlxx##OneSpile##hkrs##OneSpile##jtyzsr##OneSpile##jtrjsr##OneSpile##jtsrly##OneSpile##jtzz##OneSpile##sqly##OneSpile##xyshyj##OneSpile##xxshyj##OneSpile##yzbm##OneSpile##radjthk##OneSpile##xmc##OneSpile##xxmc##OneSpile##xysh##OneSpile##xxsh##OneSpile##xydm##OneSpile##zydm##OneSpile##bjdm##OneSpile##nj##OneSpile##gkfs##OneSpile##bygz##OneSpile##kc1_mc##OneSpile##kc1_cj##OneSpile##kc2_mc##OneSpile##kc2_cj##OneSpile##kc3_mc##OneSpile##kc3_cj##OneSpile##kc4_mc##OneSpile##kc4_cj##OneSpile##kc5_mc##OneSpile##kc5_cj##OneSpile##kc6_mc##OneSpile##kc6_cj##OneSpile##kc7_mc##OneSpile##kc7_cj##OneSpile##kc8_mc##OneSpile##kc8_cj##OneSpile##kc9_mc##OneSpile##kc9_cj##OneSpile##kc10_mc##OneSpile##kc10_cj##OneSpile##kc11_mc##OneSpile##kc11_cj##OneSpile##kc12_mc##OneSpile##kc12_cj##OneSpile##kh##OneSpile##zzdjdm##OneSpile##zzdjmc##OneSpile##zzdjje##OneSpile##xyshryhm##OneSpile##xyshrxm##OneSpile##xyzzfzryj##OneSpile##fdysh##OneSpile##fdyshyj";
		StringBuffer rsExpString = new StringBuffer("");
		if ((request.getParameter("go") != null)
				&& request.getParameter("go").equalsIgnoreCase("go")) {
			rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
			rsExp.addAll(dao.rsToVator(sqlExp, new String[] {}, new String[]{"col"}));
			for(Iterator<Object> it = rsExp.iterator(); it.hasNext();){
				String[] isT = (String[])it.next();
				rsExpString.append(isT[0]);
				rsExpString.append("##TwoSpile##");
			}
		}
		request.setAttribute("colListS", colListS);
		request.setAttribute("rsExpString", rsExpString.toString());

		map.put("xydm", xy);
		map.put("zydm", zy);
		map.put("bjdm", bj);
		map.put("nd", nd);
		map.put("shxmdm", shxm);
		xy = xy==null ? "":xy;
		zy = zy==null ? "":zy;
		String bjKey = xy+"!!"+zy+"!!";
		

		// ============= luojw 2009/8/26 begin =================
		if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
			request.setAttribute("xydm", xydm);// 发送学校代码
			request.setAttribute("jbList", dao.getJxjDj());
		}
		// ============= luojw 2009/8/26 end =================
		
		request.setAttribute("tips", tips);
		request.setAttribute("rs1", map);// 发送读写权限
		request.setAttribute("writeAble", writeAble);// 发送读写权限
		request.setAttribute("tableName", tableName);// 发送视图名
		request.setAttribute("realTable", realTable);// 发送数据源表名
		request.setAttribute("pk", pk);// 发送数据源表主键
		request.setAttribute("ndList", Base.getXnndList());
		request.setAttribute("xnList", Base.getXnndList());// 发送学年列表
		request.setAttribute("xyList", Base.getXyList());// 发送学院列表
		request.setAttribute("zyList", Base.getZyMap().get(xy));// 发送专业列表
		request.setAttribute("bjList", Base.getBjMap().get(bjKey));// 发送班级列表
		request.setAttribute("act", "xsjxjzxjsqb");
		request.setAttribute("rs", rs);// 发送数据集
		request.setAttribute("topTr", topTr);// 发送表头
		request.setAttribute("rsNum", rsNum);// 发送记录数
		request.setAttribute("userType", userType);// 发送记录数
		request.setAttribute("checkList", dao.getChkList(3));
		request.setAttribute("form", checkForm);
		request.setAttribute("shxmdm", shxm);
		return mapping.findForward("success");
	}
	
	private ActionForward auditing_gjjzxj_one(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		DAO dao = DAO.getInstance();
		String actDo = request.getParameter("actDo");
		String pkVal = request.getParameter("pkVal");
		String realTable = "";
		HashMap<String, String> hs = new HashMap<String, String>();
		HttpSession session = request.getSession();
		String pk = "";
		String sql = "";
		String[] colList = new String[] {};
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));
		String fdyshyj = DealString.toGBK(request.getParameter("fdyshyj"));
		String zzdjdm = DealString.toGBK(request.getParameter("zzdjdm"));
		String xyzzfzryj = DealString.toGBK(request.getParameter("xyzzfzryj"));
		String userType = dao.getUserType(session.getAttribute("userDep")
				.toString());
		String userName = session.getAttribute("userName").toString();
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);
		String xxdm = StandardOperation.getXxdm();
		String sUName;
		String logMsg;
		sUName = session.getAttribute("userName").toString();
		List xszzDjList = dao.getXszzDjList();
		request.setAttribute("xszzDjList", xszzDjList);
		boolean ok = false;
		if ("del".equalsIgnoreCase(actDo)) {
			String pkDel = request.getParameter("pkDel");
			String[] pkDelT = pkDel.split("!!splitOne!!");
			String[] sqlT = new String[pkDelT.length];
			for (int i = 1; i < pkDelT.length; i++) {
				String pkT = pkDelT[i];
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					if ((xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY) || xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) && (userBj.size() != 0)){
						sqlT[i] = "delete xsjxjzxjsqb where lower(xh||nd||jzxjmc)='"+pkT+"' and xysh<>'通过'";
					} else {
						sqlT[i] = "delete xsjxjzxjsqb where lower(xh||nd||jzxjmc)='"+pkT+"' and xxsh<>'通过'";
					}
				} else {
					sqlT[i] = "delete xsjxjzxjsqb where lower(xh||nd||jzxjmc)='"+pkT+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward("/auditing_gjjzxj.do?go=go", false);
			return newFwd;
		}
		
		if (actDo.equalsIgnoreCase("save")) {
			String yesNo = DealString.toGBK(request.getParameter("yesNo"));
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					ok = StandardOperation.update("xsjxjzxjsqb",
							new String[] { "xysh", "xyshyj", "zzdjdm",
									"xyshryhm", "xyzzfzryj" },
							new String[] { yesNo, xyshyj, zzdjdm, userName,
									xyzzfzryj }, "lower(xh||nd||jzxjmc)", pkVal,
							request);
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY) || xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
					if (userBj.size() == 0) {
						ok = StandardOperation.update("xsjxjzxjsqb", new String[] {
								"xysh", "xyshyj" }, new String[] { yesNo, xyshyj },
								"lower(xh||nd||jzxjmc)", pkVal, request);
					} else {
						if ("未审核".equalsIgnoreCase(yesNo) || "不通过".equalsIgnoreCase(yesNo)){
							ok = StandardOperation.update("xsjxjzxjsqb",
									new String[] { "fdysh", "fdyshyj", "xysh" },
									new String[] { yesNo, fdyshyj, "未审核" },
									"lower(xh||nd||jzxjmc)", pkVal, request);
						} else {
							ok = StandardOperation.update("xsjxjzxjsqb",
									new String[] { "fdysh", "fdyshyj" },
									new String[] { yesNo, fdyshyj },
									"lower(xh||nd||jzxjmc)", pkVal, request);
						}
					}
				} else {
					ok = StandardOperation.update("xsjxjzxjsqb", new String[] {
							"xysh", "xyshyj" }, new String[] { yesNo, xyshyj },
							"lower(xh||nd||jzxjmc)", pkVal, request);
				}
			} else {
				ok = StandardOperation.update("xsjxjzxjsqb", new String[] {
						"xxsh", "xxshyj" }, new String[] { yesNo, xxshyj },
						"lower(xh||nd||jzxjmc)", pkVal, request);
			}
			if(ok){
				logMsg = "修改(审核) xsjxjzxjsqb";
				Base.log(request, logMsg, sUName);
			}
		}
		realTable = "xsjxjzxjsqb";
		pk = "lower(xh||nd||jzxjmc)";
		if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				sql = "select "
						+ pk
						+ " pk,xh,xm,nd,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,kh,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,xxsh,XYSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
			} else {
				sql = "select "
						+ pk
						+ " pk,xh,xm,nd,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,kh,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,xxsh,XXSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
			}
			colList = new String[] { "pk", "xh", "xm", "nd", "csny", "rxny",
					"sfzh", "xb", "bjmc", "xy", "mzmc", "jtcy1_xm", "jtcy1_nl",
					"jtcy1_gx", "jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl",
					"jtcy2_gx", "jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl",
					"jtcy3_gx", "jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl",
					"jtcy4_gx", "jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl",
					"jtcy5_gx", "jtcy5_gzdz", "sfkns", "sqsj", "jzxjmc",
					"jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly", "jtzz",
					"sqly", "xyshyj", "xxshyj", "yzbm", "radjthk", "xmc",
					"xxmc", "kh", "gkfs", "bygz", "kc1_mc", "kc1_cj", "kc2_mc",
					"kc2_cj", "kc3_mc", "kc3_cj", "kc4_mc", "kc4_cj", "kc5_mc",
					"kc5_cj", "kc6_mc", "kc6_cj", "kc7_mc", "kc7_cj", "kc8_mc",
					"kc8_cj", "kc9_mc", "kc9_cj", "kc10_mc", "kc10_cj",
					"kc11_mc", "kc11_cj", "kc12_mc", "kc12_cj", "xxsh", "yesNo" };
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY) || xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				if (userBj.size() == 0) {
					sql = "select "
							+ pk
							+ " pk,xh,xm,nd,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
							+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,xsjbqkjj,zzmmmc,jzxjzwmc,XYSH yesNo from view_xsjxjzxjsq where "
							+ pk + "='" + pkVal + "'";
					request.setAttribute("isXX", "no");
				} else {
					sql = "select "
							+ pk
							+ " pk,xh,xm,nd,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
							+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,xsjbqkjj,zzmmmc,jzxjzwmc,fdysh yesNo from view_xsjxjzxjsq where "
							+ pk + "='" + pkVal + "'";
					request.setAttribute("isXX", "no");
				}
			} else {
				sql = "select "
						+ pk
						+ " pk,xh,xm,nd,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,xsjbqkjj,zzmmmc,jzxjzwmc,XXSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
				request.setAttribute("isXX", "is");
			}
			colList = new String[] { "pk", "xh", "xm", "nd", "csny", "rxny",
					"sfzh", "xb", "bjmc", "xy", "mzmc", "jtcy1_xm", "jtcy1_nl",
					"jtcy1_gx", "jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl",
					"jtcy2_gx", "jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl",
					"jtcy3_gx", "jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl",
					"jtcy4_gx", "jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl",
					"jtcy5_gx", "jtcy5_gzdz", "sfkns", "sqsj", "jzxjmc",
					"jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly", "jtzz",
					"sqly", "xyshyj", "xxshyj", "yzbm", "radjthk", "xmc",
					"xxmc", "gkfs", "bygz", "kc1_mc", "kc1_cj", "kc2_mc",
					"kc2_cj", "kc3_mc", "kc3_cj", "kc4_mc", "kc4_cj", "kc5_mc",
					"kc5_cj", "kc6_mc", "kc6_cj", "kc7_mc", "kc7_cj", "kc8_mc",
					"kc8_cj", "kc9_mc", "kc9_cj", "kc10_mc", "kc10_cj",
					"kc11_mc", "kc11_cj", "kc12_mc", "kc12_cj", "zzdjdm",
					"zzdjmc", "zzdjje", "xyshryhm", "xyshrxm", "xyzzfzryj",
					"fdyshyj", "xxsh", "xsjbqkjj", "zzmmmc", "jzxjzwmc", "yesNo" };
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)){
//			============= luojw 2009/8/26 begin =================
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				sql = "select "
						+ pk
						+ " pk,(select a.mc from ynys_zzdjb a where a.dm = view_xsjxjzxjsq.jb) jb,xh,xm,nd,lxdh,sfzh,zzmmmc,sxncj,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,xxsh,XYSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
				request.setAttribute("isXX", "no");
			} else {
				sql = "select "
						+ pk
						+ " pk,(select a.mc from ynys_zzdjb a where a.dm = view_xsjxjzxjsq.jb) jb,xh,xm,nd,lxdh,sfzh,zzmmmc,sxncj,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,xxsh,XXSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
				request.setAttribute("isXX", "is");
			}
			colList = new String[] { "pk", "jb","xh", "xm", "nd", "lxdh", "sfzh",
					"zzmmmc", "sxncj", "csny", "rxny", "sfzh", "xb", "bjmc",
					"xy", "mzmc", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
					"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
					"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
					"jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
					"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
					"jtcy5_gzdz", "sfkns", "sqsj", "jzxjmc", "jlxx", "hkrs",
					"jtyzsr", "jtrjsr", "jtsrly", "jtzz", "sqly", "xyshyj",
					"xxshyj", "yzbm", "radjthk", "xmc", "xxmc", "gkfs", "bygz",
					"kc1_mc", "kc1_cj", "kc2_mc", "kc2_cj", "kc3_mc", "kc3_cj",
					"kc4_mc", "kc4_cj", "kc5_mc", "kc5_cj", "kc6_mc", "kc6_cj",
					"kc7_mc", "kc7_cj", "kc8_mc", "kc8_cj", "kc9_mc", "kc9_cj",
					"kc10_mc", "kc10_cj", "kc11_mc", "kc11_cj", "kc12_mc",
					"kc12_cj", "zzdjdm", "zzdjmc", "zzdjje", "xyshryhm",
					"xyshrxm", "xyzzfzryj", "xxsh", "yesNo" };
//			============= luojw 2009/8/26 end =================
		} else {
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				sql = "select "
						+ pk
						+ " pk,xh,xm,nd,lxdh,sfzh,zzmmmc,sxncj,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,xxsh,XYSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
				request.setAttribute("isXX", "no");
			} else {
				sql = "select "
						+ pk
						+ " pk,xh,xm,nd,lxdh,sfzh,zzmmmc,sxncj,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,xxsh,XXSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
				request.setAttribute("isXX", "is");
			}
			colList = new String[] { "pk","xh", "xm", "nd", "lxdh", "sfzh",
					"zzmmmc", "sxncj", "csny", "rxny", "sfzh", "xb", "bjmc",
					"xy", "mzmc", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
					"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
					"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
					"jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
					"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
					"jtcy5_gzdz", "sfkns", "sqsj", "jzxjmc", "jlxx", "hkrs",
					"jtyzsr", "jtrjsr", "jtsrly", "jtzz", "sqly", "xyshyj",
					"xxshyj", "yzbm", "radjthk", "xmc", "xxmc", "gkfs", "bygz",
					"kc1_mc", "kc1_cj", "kc2_mc", "kc2_cj", "kc3_mc", "kc3_cj",
					"kc4_mc", "kc4_cj", "kc5_mc", "kc5_cj", "kc6_mc", "kc6_cj",
					"kc7_mc", "kc7_cj", "kc8_mc", "kc8_cj", "kc9_mc", "kc9_cj",
					"kc10_mc", "kc10_cj", "kc11_mc", "kc11_cj", "kc12_mc",
					"kc12_cj", "zzdjdm", "zzdjmc", "zzdjje", "xyshryhm",
					"xyshrxm", "xyzzfzryj", "xxsh", "yesNo" };
		}

		String[] rs = dao.getOneRs(sql, new String[] {}, colList);
		if (rs == null) {
			rs = new String[colList.length];
		}
		for (int i = 0; i < colList.length; i++) {
			rs[i] = ((rs[i] == null) || rs[i].equalsIgnoreCase("")) ? " "
					: rs[i];
			hs.put(colList[i], rs[i]);
		}
		
		if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
			request.setAttribute("xxmc", "isSHGC");
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
			request.setAttribute("xxmc", "isZZSF");
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
			request.setAttribute("xxmc", "isXNMZ");
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
			request.setAttribute("xxmc", "isYNYS");
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_CSMZZYJSXY)) {
			request.setAttribute("xxmc", "isCSMZ");
		} else {
			request.setAttribute("xxmc", "all");
		}
		
		hs.put("zzdjdm", zzdjdm);
		request.setAttribute("rs", hs);
		request.setAttribute("userType", userType);
		request.setAttribute("chkList", dao.getChkList(3));
		request.setAttribute("pk", pkVal);
		request.setAttribute("tName", realTable);
		request.setAttribute("act", "xsjxjzxjsqb");
		return mapping.findForward("success");
	}
	
	private ActionForward auditing_szfjzxj(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		// 初始化页面，返回查询信息
		DAO dao = DAO.getInstance();
		XszzForm checkForm = (XszzForm) form;
		HttpSession session = request.getSession();
		List<Object> rs = new ArrayList<Object>();
		List<Object> rsExp = new ArrayList<Object>();
		String sqlExp = "";// sql语句
		String isQuery = request.getParameter("isQuery");
		if((null == isQuery) || ("".equalsIgnoreCase(isQuery))){
			isQuery = "no";
		}
		request.setAttribute("isQuery", isQuery);
		HashMap<String, String> map = new HashMap<String, String>();
		String[] colList = null;
		String[] colListCN = null;
		String sql = "";// sql语句
		StringBuffer querry = new StringBuffer(" where 1=1 ");// sql条件
		StringBuffer querry1 = new StringBuffer("");
		String tableName = "";// 查询信息源（多为视图名）
		String rsNum = "0";// 返回的记录数
		String realTable = "";// 数据源表
		String pk = "";// 数据源表主键（格式为“字段名||字段名||字段名”）
		String writeAble = "yes";// 写权限
		String userDep = session.getAttribute("userDep").toString();
		String userName = session.getAttribute("userName").toString();
		String userType = dao.getUserType(userDep);
		String shxm = DealString.toGBK(request.getParameter("shxm"));
		String xy = checkForm.getXydm();
		String xydm = request.getParameter("xydm");
		String xxdm = StandardOperation.getXxdm();
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);
		
		sql = "select 'szfzxj' shxmdm,'省政府助学金' shxmmc from dual union select 'szfjxj' shxmdm,'省政府奖学金' shxmmc from dual";
		List shxmList = dao.getList(sql, new String[] {},
				new String[] { "shxmdm" , "shxmmc" });
		request.setAttribute("shxmList", shxmList);
		querry1.append(" and lower(JZXJMC)='");
		querry1.append(shxm);
		querry1.append("' ");

		String xh = DealString.toGBK(checkForm.getXh());
		if (xydm != null && xy == null) {
			xy = xydm;
		}
		if (userType.equalsIgnoreCase("xy")
				&& (xy == null || xy.trim().equals(""))) {
			xy = userDep;
		}
		String zy = checkForm.getZydm();
		String bj = checkForm.getBjdm();
		realTable = "xsjxjzxjsqb";
		pk = "lower(xh||nd||jzxjmc)";
		tableName = "view_xsjxjzxjsq";
		String nd = "";
		
		String nj = DealString.toGBK(request.getParameter("nj"));
		String xm = DealString.toGBK(request.getParameter("xm"));
		String xb = DealString.toGBK(request.getParameter("xb"));
		String sfzh = DealString.toGBK(request.getParameter("sfzh"));
		String jtzz = DealString.toGBK(request.getParameter("jtzz"));
		
		if(!isQuery.equalsIgnoreCase("is")){
			nd = Base.currNd;
		} else {
			nd = request.getParameter("nd");
		}
		if (isNull(nd)) {
		} else {
			querry.append(" and nd = '");
			querry.append(nd);
			querry.append("' ");
		}
		if (isNull(xy)) {
		} else {
			querry.append(" and xydm = '");
			querry.append(xy);
			querry.append("' ");
		}
		if (isNull(zy)) {
		} else {
			querry.append(" and zydm = '");
			querry.append(zy);
			querry.append("' ");
		}
		if (isNull(bj)) {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				if (userBj.size() != 0) {
					querry.append("and bjdm in ('###'");
					for (Iterator<String> it = userBj.iterator(); it.hasNext();) {
						querry.append(", '");
						querry.append(it.next());
						querry.append("'");
					}
					querry.append(" ) ");
				}
			}
		} else {
			querry.append(" and bjdm = '");
			querry.append(bj);
			querry.append("' ");
		}
		if (isNull(xh)) {
		} else {
			querry.append(" and xh = '");
			querry.append(xh);
			querry.append("' ");
		}
		if (isNull(nj)) {
		} else {
			querry.append(" and nj='");
			querry.append(nj);
			querry.append("' ");
		}
		if (isNull(xm)) {
		} else {
			querry.append(" and xm='");
			querry.append(xm);
			querry.append("' ");
		}
		if (isNull(xb)) {
		} else {
			querry.append(" and xb='");
			querry.append(xb);
			querry.append("' ");
		}
		if (isNull(sfzh)) {
		} else {
			querry.append(" and sfzh='");
			querry.append(sfzh);
			querry.append("' ");
		}
		if (isNull(jtzz)) {
		} else {
			querry.append(" and jtzz like '%");
			querry.append(jtzz);
			querry.append("%' ");
		}
		querry.append(querry1.toString());
		String tips = "当前所在位置：学生资助 - 审核 - 省(市)政府助学、奖学金审核";
		if (isQuery.equalsIgnoreCase("is")){
			tips = "当前所在位置：学生资助 - 申请 - 申请结果查询 - 省(市)政府助学、奖学金";
			if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
						"zzdjmc", "zzdjje", "xyshrxm",
						"JZXJzwMC", "sqsj", "xysh", "xxsh" };
			} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
						"JTYZSR", "JTRJSR", "JZXJzwMC", "fdysh", "xysh", "xxsh" };
			} else {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
						"JTYZSR", "JTRJSR", "JZXJzwMC", "xysh", "xxsh" };
			}
			if (userType.equalsIgnoreCase("xx")) {
				sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
					+ " a.* from(select "
					+ pk
					+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " order by xxsh desc) a";
				sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " order by xxsh desc";
				request.setAttribute("isXX", "is");
			} else {
				checkForm.setXydm(userDep);
				sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
					+ "a.* from(select "
					+ pk
					+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xydm='"
					+ userDep
					+ "' order by xxsh desc) a";
				sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xydm='"
					+ userDep
					+ "' order by xxsh desc";
				request.setAttribute("isXX", "no");
			}
		} else {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
						"xb", "bjmc", "zzdjmc", "zzdjje", "xyshrxm",
						"JZXJzwMC", "sqsj", "" };
			} else {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd", "xh", "xm",
						"xb", "bjmc", "JTYZSR", "JTRJSR", "JZXJzwMC", "" };
			}
			if (userType.equalsIgnoreCase("xx")) {
				sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
					+ " a.* from(select "
					+ pk
					+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xysh='通过' order by xxsh desc) a";
				sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xysh='通过' order by xxsh desc";
				colList[colList.length - 1] = "xxsh";
				request.setAttribute("isXX", "is");
			} else {
				checkForm.setXydm(userDep);
				if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)){
					if (userBj.size() == 0) {
						sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep + "' and fdysh='通过' order by xysh desc) a";
						sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep + "' and fdysh='通过' order by xysh desc";
						colList[colList.length - 1] = "xysh";
					}else{
						sql = "select (case when nvl(a.fdysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep + "' order by xysh desc) a";
						sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep + "' order by xysh desc";
						colList[colList.length - 1] = "fdysh";
					}
				} else {
					sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.JZXJMC pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by xysh desc) a";
					sqlExp = "select xh||'##OneSpile##'||xm||'##OneSpile##'||nd||'##OneSpile##'||csny||'##OneSpile##'||rxny||'##OneSpile##'||byny||'##OneSpile##'||lxdh||'##OneSpile##'||jzxjzwmc||'##OneSpile##'||sfzh||'##OneSpile##'||xb||'##OneSpile##'||bjmc||'##OneSpile##'||xy||'##OneSpile##'||mzmc||'##OneSpile##'||jtcy1_xm||'##OneSpile##'||jtcy1_nl||'##OneSpile##'||jtcy1_gx||'##OneSpile##'||jtcy1_gzdz||'##OneSpile##'||jtcy2_xm||'##OneSpile##'||jtcy2_nl||'##OneSpile##'||jtcy2_gx||'##OneSpile##'||jtcy2_gzdz||'##OneSpile##'||jtcy3_xm||'##OneSpile##'||jtcy3_nl||'##OneSpile##'||jtcy3_gx||'##OneSpile##'||jtcy3_gzdz||'##OneSpile##'||jtcy4_xm||'##OneSpile##'||jtcy4_nl||'##OneSpile##'||jtcy4_gx||'##OneSpile##'||jtcy4_gzdz||'##OneSpile##'||jtcy5_xm||'##OneSpile##'||jtcy5_nl||'##OneSpile##'||jtcy5_gx||'##OneSpile##'||jtcy5_gzdz||'##OneSpile##'||sfkns||'##OneSpile##'||sqsj||'##OneSpile##'||jzxjmc||'##OneSpile##'||jlxx||'##OneSpile##'||hkrs||'##OneSpile##'||jtyzsr||'##OneSpile##'||jtrjsr||'##OneSpile##'||jtsrly||'##OneSpile##'||jtzz||'##OneSpile##'||sqly||'##OneSpile##'||xyshyj||'##OneSpile##'||xxshyj||'##OneSpile##'||yzbm||'##OneSpile##'||radjthk||'##OneSpile##'||xmc||'##OneSpile##'||xxmc||'##OneSpile##'||xysh||'##OneSpile##'||xxsh||'##OneSpile##'||xydm||'##OneSpile##'||zydm||'##OneSpile##'||bjdm||'##OneSpile##'||nj||'##OneSpile##'||gkfs||'##OneSpile##'||bygz||'##OneSpile##'||kc1_mc||'##OneSpile##'||kc1_cj||'##OneSpile##'||kc2_mc||'##OneSpile##'||kc2_cj||'##OneSpile##'||kc3_mc||'##OneSpile##'||kc3_cj||'##OneSpile##'||kc4_mc||'##OneSpile##'||kc4_cj||'##OneSpile##'||kc5_mc||'##OneSpile##'||kc5_cj||'##OneSpile##'||kc6_mc||'##OneSpile##'||kc6_cj||'##OneSpile##'||kc7_mc||'##OneSpile##'||kc7_cj||'##OneSpile##'||kc8_mc||'##OneSpile##'||kc8_cj||'##OneSpile##'||kc9_mc||'##OneSpile##'||kc9_cj||'##OneSpile##'||kc10_mc||'##OneSpile##'||kc10_cj||'##OneSpile##'||kc11_mc||'##OneSpile##'||kc11_cj||'##OneSpile##'||kc12_mc||'##OneSpile##'||kc12_cj||'##OneSpile##'||kh||'##OneSpile##'||zzdjdm||'##OneSpile##'||zzdjmc||'##OneSpile##'||zzdjje||'##OneSpile##'||xyshryhm||'##OneSpile##'||xyshrxm||'##OneSpile##'||xyzzfzryj||'##OneSpile##'||fdysh||'##OneSpile##'||fdyshyj col from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xydm='"
						+ userDep
						+ "' order by xysh desc";
					colList[colList.length - 1] = "xysh";
				}
				request.setAttribute("isXX", "no");
			}
		}
		colListCN = dao.getColumnNameCN(colList, tableName);
		List topTr = dao.arrayToList(colList, colListCN);
		String colListS = "xh##OneSpile##xm##OneSpile##nd##OneSpile##csny##OneSpile##rxny##OneSpile##byny##OneSpile##lxdh##OneSpile##jzxjzwmc##OneSpile##sfzh##OneSpile##xb##OneSpile##bjmc##OneSpile##xy##OneSpile##mzmc##OneSpile##jtcy1_xm##OneSpile##jtcy1_nl##OneSpile##jtcy1_gx##OneSpile##jtcy1_gzdz##OneSpile##jtcy2_xm##OneSpile##jtcy2_nl##OneSpile##jtcy2_gx##OneSpile##jtcy2_gzdz##OneSpile##jtcy3_xm##OneSpile##jtcy3_nl##OneSpile##jtcy3_gx##OneSpile##jtcy3_gzdz##OneSpile##jtcy4_xm##OneSpile##jtcy4_nl##OneSpile##jtcy4_gx##OneSpile##jtcy4_gzdz##OneSpile##jtcy5_xm##OneSpile##jtcy5_nl##OneSpile##jtcy5_gx##OneSpile##jtcy5_gzdz##OneSpile##sfkns##OneSpile##sqsj##OneSpile##jzxjmc##OneSpile##jlxx##OneSpile##hkrs##OneSpile##jtyzsr##OneSpile##jtrjsr##OneSpile##jtsrly##OneSpile##jtzz##OneSpile##sqly##OneSpile##xyshyj##OneSpile##xxshyj##OneSpile##yzbm##OneSpile##radjthk##OneSpile##xmc##OneSpile##xxmc##OneSpile##xysh##OneSpile##xxsh##OneSpile##xydm##OneSpile##zydm##OneSpile##bjdm##OneSpile##nj##OneSpile##gkfs##OneSpile##bygz##OneSpile##kc1_mc##OneSpile##kc1_cj##OneSpile##kc2_mc##OneSpile##kc2_cj##OneSpile##kc3_mc##OneSpile##kc3_cj##OneSpile##kc4_mc##OneSpile##kc4_cj##OneSpile##kc5_mc##OneSpile##kc5_cj##OneSpile##kc6_mc##OneSpile##kc6_cj##OneSpile##kc7_mc##OneSpile##kc7_cj##OneSpile##kc8_mc##OneSpile##kc8_cj##OneSpile##kc9_mc##OneSpile##kc9_cj##OneSpile##kc10_mc##OneSpile##kc10_cj##OneSpile##kc11_mc##OneSpile##kc11_cj##OneSpile##kc12_mc##OneSpile##kc12_cj##OneSpile##kh##OneSpile##zzdjdm##OneSpile##zzdjmc##OneSpile##zzdjje##OneSpile##xyshryhm##OneSpile##xyshrxm##OneSpile##xyzzfzryj##OneSpile##fdysh##OneSpile##fdyshyj";
		StringBuffer rsExpString = new StringBuffer("");
		if ((request.getParameter("go") != null)
				&& request.getParameter("go").equalsIgnoreCase("go")) {
			rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
			rsExp.addAll(dao.rsToVator(sqlExp, new String[] {}, new String[]{"col"}));
			for(Iterator<Object> it = rsExp.iterator(); it.hasNext();){
				String[] isT = (String[])it.next();
				rsExpString.append(isT[0]);
				rsExpString.append("##TwoSpile##");
			}
		}
		request.setAttribute("colListS", colListS);
		request.setAttribute("rsExpString", rsExpString.toString());

		map.put("xm", xm);
		map.put("xb", xb);
		map.put("sfzh", sfzh);
		map.put("jtzz", jtzz);
		map.put("nj", nj);
		map.put("xh", xh);
		map.put("xydm", xy);
		map.put("zydm", zy);
		map.put("bjdm", bj);
		map.put("nd", nd);
		map.put("shxmdm", shxm);
		xy = xy==null ? "":xy;
		zy = zy==null ? "":zy;
		nj = nj==null ? "":nj;
		String bjKey = xy+"!!"+zy+"!!"+nj;
		request.setAttribute("tips", tips);
		request.setAttribute("rs1", map);// 发送读写权限
		request.setAttribute("writeAble", writeAble);// 发送读写权限
		request.setAttribute("tableName", tableName);// 发送视图名
		request.setAttribute("realTable", realTable);// 发送数据源表名
		request.setAttribute("pk", pk);// 发送数据源表主键
		request.setAttribute("njList", Base.getNjList());// 发送年级列表
		request.setAttribute("ndList", Base.getXnndList());
		request.setAttribute("xyList", Base.getXyList());// 发送学院列表
		request.setAttribute("zyList", Base.getZyMap().get(xy));// 发送专业列表
		request.setAttribute("bjList", Base.getBjMap().get(bjKey));// 发送班级列表
		request.setAttribute("act", "xsjxjzxjsqb");
		request.setAttribute("rs", rs);// 发送数据集
		request.setAttribute("topTr", topTr);// 发送表头
		request.setAttribute("rsNum", rsNum);// 发送记录数
		request.setAttribute("userType", userType);// 发送记录数
		return mapping.findForward("success");
	}
	
	private ActionForward auditing_szfjzxj_one(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		DAO dao = DAO.getInstance();
		String actDo = request.getParameter("actDo");
		String pkVal = request.getParameter("pkVal");
		String realTable = "";
		HashMap<String, String> hs = new HashMap<String, String>();
		HttpSession session = request.getSession();
		String pk = "";
		String sql = "";
		String[] colList = new String[] {};
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));
		String fdyshyj = DealString.toGBK(request.getParameter("fdyshyj"));
		String zzdjdm = DealString.toGBK(request.getParameter("zzdjdm"));
		String xyzzfzryj = DealString.toGBK(request.getParameter("xyzzfzryj"));
		String userType = dao.getUserType(session.getAttribute("userDep")
				.toString());
		String userName = session.getAttribute("userName").toString();
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);
		String xxdm = StandardOperation.getXxdm();
		String sUName;
		String logMsg;
		sUName = session.getAttribute("userName").toString();
		List xszzDjList = dao.getXszzDjList();
		request.setAttribute("xszzDjList", xszzDjList);
		boolean ok = false;
		if ("del".equalsIgnoreCase(actDo)) {
			String pkDel = request.getParameter("pkDel");
			String[] pkDelT = pkDel.split("!!splitOne!!");
			String[] sqlT = new String[pkDelT.length];
			for (int i = 1; i < pkDelT.length; i++) {
				String pkT = pkDelT[i];
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					if ((xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) && (userBj.size() != 0)){
						sqlT[i] = "delete xsjxjzxjsqb where lower(xh||nd||jzxjmc)='"+pkT+"' and xysh<>'通过'";
					} else {
						sqlT[i] = "delete xsjxjzxjsqb where lower(xh||nd||jzxjmc)='"+pkT+"' and xxsh<>'通过'";
					}
				} else {
					sqlT[i] = "delete xsjxjzxjsqb where lower(xh||nd||jzxjmc)='"+pkT+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward("/auditing_szfjzxj.do?go=go", false);
			return newFwd;
		}
		if ("plsh".equalsIgnoreCase(actDo)) {
			String pkDel = request.getParameter("pkDel");
			String[] pkDelT = pkDel.split("!!splitOne!!");
			String jg = request.getParameter("jg");
			if ("tg".equalsIgnoreCase(jg)){
				jg = "通过";
			} else if ("btg".equalsIgnoreCase(jg)){
				jg = "不通过";
			} else {
				jg = "未审核";
			}
			String[] sqlT = new String[pkDelT.length];
			for (int i = 1; i < pkDelT.length; i++) {
				String pkT = pkDelT[i];
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					if ((xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) && (userBj.size() != 0)){
						sqlT[i] = "update xsjxjzxjsqb set fdysh='"+jg+"' where lower(xh||nd||jzxjmc)='"+pkT+"' and xysh<>'通过'";
					} else {
						sqlT[i] = "update xsjxjzxjsqb set xysh='"+jg+"' where lower(xh||nd||jzxjmc)='"+pkT+"' and xxsh<>'通过'";
					}
				} else {
					sqlT[i] = "update xsjxjzxjsqb set xxsh='"+jg+"' where lower(xh||nd||jzxjmc)='"+pkT+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward("/auditing_szfjzxj.do?go=go", false);
			return newFwd;
		}
		
		if (actDo.equalsIgnoreCase("save")) {
			String yesNo = DealString.toGBK(request.getParameter("yesNo"));
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					ok = StandardOperation.update("xsjxjzxjsqb",
							new String[] { "xysh", "xyshyj", "zzdjdm",
									"xyshryhm", "xyzzfzryj" },
							new String[] { yesNo, xyshyj, zzdjdm, userName,
									xyzzfzryj }, "lower(xh||nd||jzxjmc)", pkVal,
							request);
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					if (userBj.size() == 0) {
						ok = StandardOperation.update("xsjxjzxjsqb", new String[] {
								"xysh", "xyshyj" }, new String[] { yesNo, xyshyj },
								"lower(xh||nd||jzxjmc)", pkVal, request);
					} else {
						if ("未审核".equalsIgnoreCase(yesNo) || "不通过".equalsIgnoreCase(yesNo)){
							ok = StandardOperation.update("xsjxjzxjsqb",
									new String[] { "fdysh", "fdyshyj", "xysh" },
									new String[] { yesNo, fdyshyj, "未审核" },
									"lower(xh||nd||jzxjmc)", pkVal, request);
						} else {
							ok = StandardOperation.update("xsjxjzxjsqb",
									new String[] { "fdysh", "fdyshyj" },
									new String[] { yesNo, fdyshyj },
									"lower(xh||nd||jzxjmc)", pkVal, request);
						}
					}
				} else {
					ok = StandardOperation.update("xsjxjzxjsqb", new String[] {
							"xysh", "xyshyj" }, new String[] { yesNo, xyshyj },
							"lower(xh||nd||jzxjmc)", pkVal, request);
				}
			} else {
				ok = StandardOperation.update("xsjxjzxjsqb", new String[] {
						"xxsh", "xxshyj" }, new String[] { yesNo, xxshyj },
						"lower(xh||nd||jzxjmc)", pkVal, request);
			}
			if(ok){
				logMsg = "修改(审核) xsjxjzxjsqb";
				Base.log(request, logMsg, sUName);
			}
		}
		realTable = "xsjxjzxjsqb";
		pk = "lower(xh||nd||jzxjmc)";
		if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				sql = "select "
						+ pk
						+ " pk,xh,xm,nd,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,kh,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,xxsh,XYSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
			} else {
				sql = "select "
						+ pk
						+ " pk,xh,xm,nd,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,kh,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,xxsh,XXSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
			}
			colList = new String[] { "pk", "xh", "xm", "nd", "csny", "rxny",
					"sfzh", "xb", "bjmc", "xy", "mzmc", "jtcy1_xm", "jtcy1_nl",
					"jtcy1_gx", "jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl",
					"jtcy2_gx", "jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl",
					"jtcy3_gx", "jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl",
					"jtcy4_gx", "jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl",
					"jtcy5_gx", "jtcy5_gzdz", "sfkns", "sqsj", "jzxjmc",
					"jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly", "jtzz",
					"sqly", "xyshyj", "xxshyj", "yzbm", "radjthk", "xmc",
					"xxmc", "kh", "gkfs", "bygz", "kc1_mc", "kc1_cj", "kc2_mc",
					"kc2_cj", "kc3_mc", "kc3_cj", "kc4_mc", "kc4_cj", "kc5_mc",
					"kc5_cj", "kc6_mc", "kc6_cj", "kc7_mc", "kc7_cj", "kc8_mc",
					"kc8_cj", "kc9_mc", "kc9_cj", "kc10_mc", "kc10_cj",
					"kc11_mc", "kc11_cj", "kc12_mc", "kc12_cj", "xxsh", "yesNo" };
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				if (userBj.size() == 0) {
					sql = "select "
							+ pk
							+ " pk,xh,xm,nd,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
							+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,XYSH yesNo from view_xsjxjzxjsq where "
							+ pk + "='" + pkVal + "'";
					request.setAttribute("isXX", "no");
				} else {
					sql = "select "
							+ pk
							+ " pk,xh,xm,nd,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
							+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,fdysh yesNo from view_xsjxjzxjsq where "
							+ pk + "='" + pkVal + "'";
					request.setAttribute("isXX", "no");
				}
			} else {
				sql = "select "
						+ pk
						+ " pk,xh,xm,nd,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,XXSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
				request.setAttribute("isXX", "is");
			}
			colList = new String[] { "pk", "xh", "xm", "nd", "csny", "rxny",
					"sfzh", "xb", "bjmc", "xy", "mzmc", "jtcy1_xm", "jtcy1_nl",
					"jtcy1_gx", "jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl",
					"jtcy2_gx", "jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl",
					"jtcy3_gx", "jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl",
					"jtcy4_gx", "jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl",
					"jtcy5_gx", "jtcy5_gzdz", "sfkns", "sqsj", "jzxjmc",
					"jlxx", "hkrs", "jtyzsr", "jtrjsr", "jtsrly", "jtzz",
					"sqly", "xyshyj", "xxshyj", "yzbm", "radjthk", "xmc",
					"xxmc", "gkfs", "bygz", "kc1_mc", "kc1_cj", "kc2_mc",
					"kc2_cj", "kc3_mc", "kc3_cj", "kc4_mc", "kc4_cj", "kc5_mc",
					"kc5_cj", "kc6_mc", "kc6_cj", "kc7_mc", "kc7_cj", "kc8_mc",
					"kc8_cj", "kc9_mc", "kc9_cj", "kc10_mc", "kc10_cj",
					"kc11_mc", "kc11_cj", "kc12_mc", "kc12_cj", "zzdjdm",
					"zzdjmc", "zzdjje", "xyshryhm", "xyshrxm", "xyzzfzryj",
					"fdyshyj", "xxsh", "yesNo" };
		} else {
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				sql = "select "
						+ pk
						+ " pk,xh,xm,nd,sfzh,lxdh,zzmmmc,sxncj,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,xxsh,XYSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
				request.setAttribute("isXX", "no");
			} else {
				sql = "select "
						+ pk
						+ " pk,xh,xm,nd,sfzh,lxdh,zzmmmc,sxncj,csny,rxny,sfzh,xb,bjmc,xy,mzmc,jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdz,jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdz,jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdz,jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdz,jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdz,sfkns,sqsj,jzxjmc,jlxx,hkrs,jtyzsr,jtrjsr,jtsrly,"
						+ "jtzz,sqly,xyshyj,xxshyj,yzbm,radjthk,xmc,xxmc,gkfs,bygz,kc1_mc,kc1_cj,kc2_mc,kc2_cj,kc3_mc,kc3_cj,kc4_mc,kc4_cj,kc5_mc,kc5_cj,kc6_mc,kc6_cj,kc7_mc,kc7_cj,kc8_mc,kc8_cj,kc9_mc,kc9_cj,kc10_mc,kc10_cj,kc11_mc,kc11_cj,kc12_mc,kc12_cj,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,xxsh,XXSH yesNo from view_xsjxjzxjsq where "
						+ pk + "='" + pkVal + "'";
				request.setAttribute("isXX", "is");
			}
			colList = new String[] { "pk", "xh", "xm", "nd", "sfzh", "lxdh",
					"zzmmmc", "sxncj", "csny", "rxny", "sfzh", "xb", "bjmc",
					"xy", "mzmc", "jtcy1_xm", "jtcy1_nl", "jtcy1_gx",
					"jtcy1_gzdz", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx",
					"jtcy2_gzdz", "jtcy3_xm", "jtcy3_nl", "jtcy3_gx",
					"jtcy3_gzdz", "jtcy4_xm", "jtcy4_nl", "jtcy4_gx",
					"jtcy4_gzdz", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx",
					"jtcy5_gzdz", "sfkns", "sqsj", "jzxjmc", "jlxx", "hkrs",
					"jtyzsr", "jtrjsr", "jtsrly", "jtzz", "sqly", "xyshyj",
					"xxshyj", "yzbm", "radjthk", "xmc", "xxmc", "gkfs", "bygz",
					"kc1_mc", "kc1_cj", "kc2_mc", "kc2_cj", "kc3_mc", "kc3_cj",
					"kc4_mc", "kc4_cj", "kc5_mc", "kc5_cj", "kc6_mc", "kc6_cj",
					"kc7_mc", "kc7_cj", "kc8_mc", "kc8_cj", "kc9_mc", "kc9_cj",
					"kc10_mc", "kc10_cj", "kc11_mc", "kc11_cj", "kc12_mc",
					"kc12_cj", "zzdjdm", "zzdjmc", "zzdjje", "xyshryhm",
					"xyshrxm", "xyzzfzryj", "xxsh", "yesNo" };
		}

		String[] rs = dao.getOneRs(sql, new String[] {}, colList);
		if (rs == null) {
			rs = new String[colList.length];
		}
		for (int i = 0; i < colList.length; i++) {
			rs[i] = ((rs[i] == null) || rs[i].equalsIgnoreCase("")) ? " "
					: rs[i];
			hs.put(colList[i], rs[i]);
		}
		
		if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
			request.setAttribute("xxmc", "isSHGC");
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
			request.setAttribute("xxmc", "isZZSF");
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
			request.setAttribute("xxmc", "isXNMZ");
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
			request.setAttribute("xxmc", "isYNYS");
		} else {
			request.setAttribute("xxmc", "all");
		}
		
		hs.put("zzdjdm", zzdjdm);
		request.setAttribute("rs", hs);
		request.setAttribute("userType", userType);
		request.setAttribute("chkList", dao.getChkList(3));
		request.setAttribute("pk", pkVal);
		request.setAttribute("tName", realTable);
		request.setAttribute("act", "xsjxjzxjsqb");
		return mapping.findForward("success");
	}
	
	private ActionForward auditing_kns(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		// 初始化页面，返回查询信息
		XszzYnysService xszzYnysService = XszzYnysService.getInstance(); 
		DAO dao = DAO.getInstance();
		XszzForm checkForm = (XszzForm) form;
		HttpSession session = request.getSession();
		List<Object> rs = new ArrayList<Object>();
		List<Object> rsExp = new ArrayList<Object>();
		String sqlExp = "";// sql语句
		String isQuery = request.getParameter("isQuery");
		if((null == isQuery) || ("".equalsIgnoreCase(isQuery))){
			isQuery = "no";
		}
		request.setAttribute("isQuery", isQuery);
		HashMap<String, String> map = new HashMap<String, String>();
		String[] colList = null;
		String[] colListCN = null;
		String sql = "";// sql语句
		StringBuffer querry = new StringBuffer(" where 1=1 ");// sql条件
		StringBuffer querry1 = new StringBuffer("");
		String tableName = "";// 查询信息源（多为视图名）
		String rsNum = "0";// 返回的记录数
		String realTable = "";// 数据源表
		String pk = "";// 数据源表主键（格式为“字段名||字段名||字段名”）
		String writeAble = "yes";// 写权限
		String userDep = session.getAttribute("userDep").toString();
		String userType = dao.getUserType(userDep);
		String xy = checkForm.getXydm();
		String xydm = request.getParameter("xydm");
		String xxdm = StandardOperation.getXxdm();
		
		String xh = DealString.toGBK(checkForm.getXh());
		String xm = checkForm.getXm();
		if (xydm != null && xy == null) {
			xy = xydm;
		}
		if (userType.equalsIgnoreCase("xy")
				&& (xy == null || xy.trim().equals(""))) {
			xy = userDep;
		}
		String zy = checkForm.getZydm();
		String bj = checkForm.getBjdm();
		String nj = checkForm.getNj();
		realTable = "knssqb";
		pk = "xn||xh";
		tableName = "view_knsxx";
		String xn = "";
		if(!isQuery.equalsIgnoreCase("is")){
			xn = Base.currXn;
		} else {
			xn = request.getParameter("xn");
		}
		if (isNull(xn)) {
		} else {
			querry.append(" and xn = '");
			querry.append(xn);
			querry.append("' ");
		}
		if (isNull(xy)) {
		} else {
			querry.append(" and xydm = '");
			querry.append(xy);
			querry.append("' ");
		}
		if (isNull(zy)) {
		} else {
			querry.append(" and zydm = '");
			querry.append(zy);
			querry.append("' ");
		}
		if (isNull(bj)) {
		} else {
			querry.append(" and bjdm = '");
			querry.append(bj);
			querry.append("' ");
		}
		if (StringUtils.isNotNull(nj)) {
			querry.append(" and nj = '");
			querry.append(nj);
			querry.append("' ");
		}
		if (isNull(xh)) {
		} else {
			querry.append(" and xh like '%");
			querry.append(xh);
			querry.append("%' ");
		}
		if(StringUtils.isNotNull(checkForm.getKncddm())){
			querry.append(" and kncddm = '");
			querry.append(checkForm.getKncddm());
			querry.append("' ");
		}
		if(StringUtils.isNotNull(xm)){
			querry.append(" and xm like '%");
			querry.append(xm);
			querry.append("%' ");
		}
		querry.append(querry1.toString());
		
		String tips = "当前所在位置：学生资助 - 审核 - 困难生审核";
		if (isQuery.equalsIgnoreCase("is")){
			tips = "当前所在位置：学生资助 - 申请 - 申请结果查询 - 困难生";
			colList = new String[] { "bgcolor", "主键", "pk2", "xn", "xq",
					"xh", "xm", "xb", "bjmc", "sqsj", "xysh", "xxsh" };
			if(Globals.XXDM_YNYS.equalsIgnoreCase(xxdm)){
				//云南艺术
				colList = new String[] { "bgcolor", "主键", "pk2", "xn", "xq",
										 "xh", "xm", "xb", "bjmc", "sqsj", 
										 "kncdmc", "xysh", "xxsh" };
			}
			if (userType.equalsIgnoreCase("xx")) {
				sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
					+ " a.* from(select "
					+ pk
					+ " 主键,a.xh pk2,a.* from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " order by xxsh desc) a";
				sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.nj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zydm||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.nd||'##OneSpile##'||a.xn||'##OneSpile##'||a.xq||'##OneSpile##'||a.sqyy||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.shsj||'##OneSpile##'||a.yjfsbj||'##OneSpile##'||a.bz||'##OneSpile##'||a.knslb||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.cxsj||'##OneSpile##'||a.jtfk||'##OneSpile##'||a.jtfkrs||'##OneSpile##'||a.jtyzsr||'##OneSpile##'||a.jtrjsr||'##OneSpile##'||a.jtsrly||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtzz||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.kncddm||'##OneSpile##'||a.kncdmc||'##OneSpile##'||a.cjqgzugws||'##OneSpile##'||a.zmcldm||'##OneSpile##'||a.zmclmc||'##OneSpile##'||a.kh||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj col from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " order by xxsh desc";
				request.setAttribute("isXX", "is");
			} else {
				checkForm.setXydm(userDep);
				sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
					+ "a.* from(select "
					+ pk
					+ " 主键,a.xh pk2,a.* from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xydm='"
					+ userDep
					+ "' order by xxsh desc) a";
				sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.nj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zydm||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.nd||'##OneSpile##'||a.xn||'##OneSpile##'||a.xq||'##OneSpile##'||a.sqyy||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.shsj||'##OneSpile##'||a.yjfsbj||'##OneSpile##'||a.bz||'##OneSpile##'||a.knslb||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.cxsj||'##OneSpile##'||a.jtfk||'##OneSpile##'||a.jtfkrs||'##OneSpile##'||a.jtyzsr||'##OneSpile##'||a.jtrjsr||'##OneSpile##'||a.jtsrly||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtzz||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.kncddm||'##OneSpile##'||a.kncdmc||'##OneSpile##'||a.cjqgzugws||'##OneSpile##'||a.zmcldm||'##OneSpile##'||a.zmclmc||'##OneSpile##'||a.kh||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj col from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xydm='"
					+ userDep
					+ "' order by xxsh desc";
				request.setAttribute("isXX", "no");
			}
		} else {
			colList = new String[] { "bgcolor", "主键", "pk2", "xn", "xq",
					"xh", "xm", "xb", "bjmc", "sqsj"};
			if(Globals.XXDM_YNYS.equalsIgnoreCase(xxdm)){
				//云南艺术
				colList = new String[] { "bgcolor", "主键", "pk2", "xn", "xq",
						"xh", "xm", "xb", "bjmc", "sqsj", "kncdmc"};
			}
			String[] shzd = {};//审核字段
			if (userType.equalsIgnoreCase("xx")) {
				shzd = new String[] {"xysh", "" };
			} else {
				shzd = new String[] { "" };
			}
			colList = StringUtils.joinStrArr(colList,shzd);
			
			if (userType.equalsIgnoreCase("xx")) {
				sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
					+ " a.* from(select "
					+ pk
					+ " 主键,a.xh pk2,a.* from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xysh like '%困%' order by xxsh desc) a";
				sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.nj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zydm||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.nd||'##OneSpile##'||a.xn||'##OneSpile##'||a.xq||'##OneSpile##'||a.sqyy||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.shsj||'##OneSpile##'||a.yjfsbj||'##OneSpile##'||a.bz||'##OneSpile##'||a.knslb||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.cxsj||'##OneSpile##'||a.jtfk||'##OneSpile##'||a.jtfkrs||'##OneSpile##'||a.jtyzsr||'##OneSpile##'||a.jtrjsr||'##OneSpile##'||a.jtsrly||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtzz||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.kncddm||'##OneSpile##'||a.kncdmc||'##OneSpile##'||a.cjqgzugws||'##OneSpile##'||a.zmcldm||'##OneSpile##'||a.zmclmc||'##OneSpile##'||a.kh||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj col from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xysh like '%困%' order by xxsh desc";
				if(xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)){
					//云南艺术
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
						+ " a.* from(select "
						+ pk
						+ " 主键,a.xh pk2,a.* from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xysh ='通过' order by xxsh desc) a";
					sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.nj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zydm||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.nd||'##OneSpile##'||a.xn||'##OneSpile##'||a.xq||'##OneSpile##'||a.sqyy||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.shsj||'##OneSpile##'||a.yjfsbj||'##OneSpile##'||a.bz||'##OneSpile##'||a.knslb||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.cxsj||'##OneSpile##'||a.jtfk||'##OneSpile##'||a.jtfkrs||'##OneSpile##'||a.jtyzsr||'##OneSpile##'||a.jtrjsr||'##OneSpile##'||a.jtsrly||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtzz||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.kncddm||'##OneSpile##'||a.kncdmc||'##OneSpile##'||a.cjqgzugws||'##OneSpile##'||a.zmcldm||'##OneSpile##'||a.zmclmc||'##OneSpile##'||a.kh||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj col from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xysh ='通过' order by xxsh desc";
				}
				colList[colList.length - 1] = "xxsh";
				request.setAttribute("isXX", "is");
			} else {
				checkForm.setXydm(userDep);
				sql = "select (case when nvl(a.xysh,'未审核') like '%困%' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
					+ "a.* from(select "
					+ pk
					+ " 主键,a.xh pk2,a.* from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xydm='"
					+ userDep
					+ "' order by xysh desc) a";
				sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.nj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zydm||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.nd||'##OneSpile##'||a.xn||'##OneSpile##'||a.xq||'##OneSpile##'||a.sqyy||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.shsj||'##OneSpile##'||a.yjfsbj||'##OneSpile##'||a.bz||'##OneSpile##'||a.knslb||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.cxsj||'##OneSpile##'||a.jtfk||'##OneSpile##'||a.jtfkrs||'##OneSpile##'||a.jtyzsr||'##OneSpile##'||a.jtrjsr||'##OneSpile##'||a.jtsrly||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtzz||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.kncddm||'##OneSpile##'||a.kncdmc||'##OneSpile##'||a.cjqgzugws||'##OneSpile##'||a.zmcldm||'##OneSpile##'||a.zmclmc||'##OneSpile##'||a.kh||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj col from "
					+ tableName
					+ " a"
					+ querry.toString()
					+ " and xydm='"
					+ userDep
					+ "' order by xysh desc";
				colList[colList.length - 1] = "xysh";
				request.setAttribute("isXX", "no");
			}
		}
		colListCN = dao.getColumnNameCN(colList, tableName);
		List topTr = dao.arrayToList(colList, colListCN);
		String colListS = "xh##OneSpile##xm##OneSpile##xb##OneSpile##nj##OneSpile##xydm##OneSpile##xymc##OneSpile##zydm##OneSpile##zymc##OneSpile##bjdm##OneSpile##bjmc##OneSpile##nd##OneSpile##xn##OneSpile##xq##OneSpile##sqyy##OneSpile##sqsj##OneSpile##shsj##OneSpile##yjfsbj##OneSpile##bz##OneSpile##knslb##OneSpile##lxdh##OneSpile##xysh##OneSpile##xxsh##OneSpile##cxsj##OneSpile##jtfk##OneSpile##jtfkrs##OneSpile##jtyzsr##OneSpile##jtrjsr##OneSpile##jtsrly##OneSpile##yzbm##OneSpile##jtzz##OneSpile##jtcy1_xm##OneSpile##jtcy1_gx##OneSpile##jtcy1_nl##OneSpile##jtcy1_ysr##OneSpile##jtcy1_gzdw##OneSpile##jtcy2_xm##OneSpile##jtcy2_gx##OneSpile##jtcy2_nl##OneSpile##jtcy2_ysr##OneSpile##jtcy2_gzdw##OneSpile##jtcy3_xm##OneSpile##jtcy3_gx##OneSpile##jtcy3_nl##OneSpile##jtcy3_ysr##OneSpile##jtcy3_gzdw##OneSpile##jtcy4_xm##OneSpile##jtcy4_gx##OneSpile##jtcy4_nl##OneSpile##jtcy4_ysr##OneSpile##jtcy4_gzdw##OneSpile##jtcy5_xm##OneSpile##jtcy5_gx##OneSpile##jtcy5_nl##OneSpile##jtcy5_ysr##OneSpile##jtcy5_gzdw##OneSpile##kncddm##OneSpile##kncdmc##OneSpile##cjqgzugws##OneSpile##zmcldm##OneSpile##zmclmc##OneSpile##kh##OneSpile##zzdjdm##OneSpile##zzdjmc##OneSpile##zzdjje##OneSpile##xyshryhm##OneSpile##xyshrxm##OneSpile##xyzzfzryj";
		StringBuffer rsExpString = new StringBuffer("");
		
		if ((request.getParameter("go") != null)
				&& request.getParameter("go").equalsIgnoreCase("go")) {
			rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
			rsExp.addAll(dao.rsToVator(sqlExp, new String[] {}, new String[]{"col"}));
			for(Iterator<Object> it = rsExp.iterator(); it.hasNext();){
				String[] isT = (String[])it.next();
				rsExpString.append(isT[0]);
				rsExpString.append("##TwoSpile##");
			}
		}
		request.setAttribute("colListS", colListS);
		request.setAttribute("rsExpString", rsExpString.toString());

		map.put("xydm", xy);
		map.put("zydm", zy);
		map.put("bjdm", bj);
		map.put("xn", xn);
		xy = xy==null ? "":xy;
		zy = zy==null ? "":zy;
		String bjKey = xy+"!!"+zy+"!!";
		request.setAttribute("tips", tips);
		request.setAttribute("rs1", map);// 发送读写权限
		request.setAttribute("writeAble", writeAble);// 发送读写权限
		request.setAttribute("tableName", tableName);// 发送视图名
		request.setAttribute("realTable", realTable);// 发送数据源表名
		request.setAttribute("pk", pk);// 发送数据源表主键
		request.setAttribute("njList", Base.getNjList());// 发送年级列表
		request.setAttribute("xnList", Base.getXnndList());// 发送学年列表
		request.setAttribute("xyList", Base.getXyList());// 发送学院列表
		request.setAttribute("zyList", Base.getZyMap().get(xy));// 发送专业列表
		request.setAttribute("bjList", Base.getBjMap().get(bjKey));// 发送班级列表
		request.setAttribute("act", "knssqb");
		request.setAttribute("rs", rs);// 发送数据集
		request.setAttribute("topTr", topTr);// 发送表头
		request.setAttribute("rsNum", rsNum);// 发送记录数
		request.setAttribute("userType", userType);// 发送记录数
		request.setAttribute("knsdjList", xszzYnysService.getKnsdjList());//困难生等级
		return mapping.findForward("success");
	}
	
	private ActionForward auditing_kns_one(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		DAO dao = DAO.getInstance();
		String actDo = request.getParameter("actDo");
		String pkVal = request.getParameter("pkVal");
		String realTable = "";
		HashMap<String, String> hs = new HashMap<String, String>();
		HttpSession session = request.getSession();
		String pk = "";
		String sql = "";
		String[] colList = new String[] {};
		String yn = "";
		String userType = dao.getUserType(session.getAttribute("userDep")
				.toString());
		ActionForward myActFwd = null;
		String xxdm = StandardOperation.getXxdm();
		String sUName;
		String logMsg;
		sUName = session.getAttribute("userName").toString();
		boolean ok = false;
		if ("del".equalsIgnoreCase(actDo)) {
			String pkDel = request.getParameter("pkDel");
			String[] pkDelT = pkDel.split("!!splitOne!!");
			String[] sqlT = new String[pkDelT.length];
			for (int i = 1; i < pkDelT.length; i++) {
				String pkT = pkDelT[i];
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					sqlT[i] = "delete knssqb where xn||xh='"+pkT+"' and xxsh<>'通过'";
				} else {
					sqlT[i] = "delete knssqb where xn||xh='"+pkT+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward("/auditing_kns.do?go=go", false);
			return newFwd;
		}
		
		if (actDo.equalsIgnoreCase("save")) {
			String yesNo = DealString.toGBK(request.getParameter("yesNo"));
			String kncddm = request.getParameter("kncddm");
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				ok = StandardOperation.update("knssqb", new String[] {
						"xysh" , "kncddm"}, new String[] { yesNo, kncddm },
						"xn||xh", pkVal, request);
			} else {
				ok = StandardOperation.update("knssqb", new String[] {
						"xxsh", "kncddm" }, new String[] { yesNo, kncddm },
						"xn||xh", pkVal, request);
			}
			if(ok){
				logMsg = "修改(审核) knssqb";
				Base.log(request, logMsg, sUName);
			}
		}
		realTable = "knssqb";
		pk = "xn||xh";
		if (xxdm.equalsIgnoreCase(Globals.XXDM_SHGC)) {
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				sql = "select "
					+ pk
					+ " pk,XH,XM,XB,NJ,XYMC,ZYMC,BJMC,ND,XN,XQ,SQYY,SQSJ,BZ,"
					+ "LXDH,XYSH yesNo,jtfk,jtfkrs,jtyzsr,jtrjsr,jtsrly,yzbm,jtzz,"
					+ "jtcy1_xm,jtcy1_gx,jtcy1_nl,jtcy1_ysr,jtcy1_gzdw,"
					+ "jtcy2_xm,jtcy2_gx,jtcy2_nl,jtcy2_ysr,jtcy2_gzdw,"
					+ "jtcy3_xm,jtcy3_gx,jtcy3_nl,jtcy3_ysr,jtcy3_gzdw,"
					+ "jtcy4_xm,jtcy4_gx,jtcy4_nl,jtcy4_ysr,jtcy4_gzdw,"
					+ "jtcy5_xm,jtcy5_gx,jtcy5_nl,jtcy5_ysr,jtcy5_gzdw,kh,xxsh from view_knsxx where "
					+ pk + "='" + pkVal + "'";

				colList = new String[] { "pk", "ND", "XN", "XQ", "XH",
						"XM", "NJ", "XYMC", "ZYMC", "BJMC", "XB",
						"LXDH", "yesNo", "SQSJ", "SQYY", "BZ", "jtfk" ,
						"jtfkrs" ,"jtyzsr" ,"jtrjsr" ,"jtsrly" ,"yzbm" ,"jtzz" ,
						"jtcy1_xm" ,"jtcy1_gx" ,"jtcy1_nl" ,"jtcy1_ysr" ,"jtcy1_gzdw" ,
						"jtcy2_xm" ,"jtcy2_gx" ,"jtcy2_nl" ,"jtcy2_ysr" ,"jtcy2_gzdw" ,
						"jtcy3_xm" ,"jtcy3_gx" ,"jtcy3_nl" ,"jtcy3_ysr" ,"jtcy3_gzdw" ,
						"jtcy4_xm" ,"jtcy4_gx" ,"jtcy4_nl" ,"jtcy4_ysr" ,"jtcy4_gzdw" ,
						"jtcy5_xm" ,"jtcy5_gx" ,"jtcy5_nl" ,"jtcy5_ysr" ,"jtcy5_gzdw" ,"kh", "xxsh" };
			} else {
				sql = "select "
					+ pk
					+ " pk,XH,XM,XB,NJ,XYMC,ZYMC,BJMC,ND,XN,XQ,SQYY,SQSJ,BZ,LXDH,XYSH,"
					+ "XXSH yesNo,jtfk,jtfkrs,jtyzsr,jtrjsr,jtsrly,yzbm,jtzz,"
					+ "jtcy1_xm,jtcy1_gx,jtcy1_nl,jtcy1_ysr,jtcy1_gzdw,"
					+ "jtcy2_xm,jtcy2_gx,jtcy2_nl,jtcy2_ysr,jtcy2_gzdw,"
					+ "jtcy3_xm,jtcy3_gx,jtcy3_nl,jtcy3_ysr,jtcy3_gzdw,"
					+ "jtcy4_xm,jtcy4_gx,jtcy4_nl,jtcy4_ysr,jtcy4_gzdw,"
					+ "jtcy5_xm,jtcy5_gx,jtcy5_nl,jtcy5_ysr,jtcy5_gzdw,kh,xxsh from view_knsxx where "
					+ pk + "='" + pkVal + "'";
				colList = new String[] { "pk", "ND", "XN", "XQ", "XH",
						"XM", "NJ", "XYMC", "ZYMC", "BJMC", "XB",
						"LXDH", "yesNo", "SQSJ", "SQYY", "BZ", "XYSH", "jtfk" ,
						"jtfkrs" ,"jtyzsr" ,"jtrjsr" ,"jtsrly" ,"yzbm" ,"jtzz" ,
						"jtcy1_xm" ,"jtcy1_gx" ,"jtcy1_nl" ,"jtcy1_ysr" ,"jtcy1_gzdw" ,
						"jtcy2_xm" ,"jtcy2_gx" ,"jtcy2_nl" ,"jtcy2_ysr" ,"jtcy2_gzdw" ,
						"jtcy3_xm" ,"jtcy3_gx" ,"jtcy3_nl" ,"jtcy3_ysr" ,"jtcy3_gzdw" ,
						"jtcy4_xm" ,"jtcy4_gx" ,"jtcy4_nl" ,"jtcy4_ysr" ,"jtcy4_gzdw" ,
						"jtcy5_xm" ,"jtcy5_gx" ,"jtcy5_nl" ,"jtcy5_ysr" ,"jtcy5_gzdw" ,"kh", "xxsh" };
				request.setAttribute("xx", 1);
			}
			myActFwd = new ActionForward("/xszz/common/auditing_kns_one_shgc.jsp",
					false);
		} else if (xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)) {
			XszzYnysService servcie = XszzYnysService.getInstance();
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				sql = "select "
					+ pk
						+ " pk,XH,XM,XB,NJ,XYMC,ZYMC,BJMC,ND,XN,XQ,SQYY,SQSJ,BZ,LXDH,SFZH,MZMC,ZZMMMC,JTRJSR,xxsh,XYSH yesNo ,kncddm from view_ynys_knssqb where "
					+ pk + "='" + pkVal + "'";

				colList = new String[] { "pk", "ND", "XN", "XQ", "XH",
						"XM", "NJ", "XYMC", "ZYMC", "BJMC", "XB",
						"LXDH", "yesNo", "SQSJ", "SQYY", "BZ",
						"SFZH", "MZMC", "ZZMMMC", "JTRJSR", "xxsh", "kncddm" };
				request.setAttribute("isXX", "no");
			} else {
				sql = "select "
					+ pk
						+ " pk,XH,XM,XB,NJ,XYMC,ZYMC,BJMC,ND,XN,XQ,SQYY,SQSJ,BZ,LXDH,XYSH,SFZH,MZMC,ZZMMMC,JTRJSR,xxsh,XXSH yesNo,kncddm from view_ynys_knssqb where "
					+ pk + "='" + pkVal + "'";
				colList = new String[] { "pk", "ND", "XN", "XQ", "XH",
						"XM", "NJ", "XYMC", "ZYMC", "BJMC", "XB",
						"LXDH", "yesNo", "SQSJ", "SQYY", "BZ", "XYSH",
						"SFZH", "MZMC", "ZZMMMC",
						"JTRJSR", "xxsh", "kncddm" };
				request.setAttribute("isXX", "is");
			}
			request.setAttribute("knsdjList", servcie.getKnsdjList());
			myActFwd = new ActionForward("/xszz/common/auditing_kns_one_ynys.jsp",
					false);
		} else {
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				sql = "select "
					+ pk
						+ " pk,XH,XM,XB,NJ,XYMC,ZYMC,BJMC,ND,XN,XQ,SQYY,SQSJ,BZ,LXDH,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,xxsh,XYSH yesNo from view_knsxx where "
					+ pk + "='" + pkVal + "'";

				colList = new String[] { "pk", "ND", "XN", "XQ", "XH",
						"XM", "NJ", "XYMC", "ZYMC", "BJMC", "XB",
						"LXDH", "yesNo", "SQSJ", "SQYY", "BZ",
						"zzdjdm", "zzdjmc", "zzdjje", "xyshryhm",
						"xyshrxm", "xyzzfzryj", "xxsh" };
				request.setAttribute("isXX", "no");
			} else {
				sql = "select "
					+ pk
						+ " pk,XH,XM,XB,NJ,XYMC,ZYMC,BJMC,ND,XN,XQ,SQYY,SQSJ,BZ,LXDH,XYSH,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,xxsh,XXSH yesNo from view_knsxx where "
					+ pk + "='" + pkVal + "'";
				colList = new String[] { "pk", "ND", "XN", "XQ", "XH",
						"XM", "NJ", "XYMC", "ZYMC", "BJMC", "XB",
						"LXDH", "yesNo", "SQSJ", "SQYY", "BZ", "XYSH",
						"zzdjdm", "zzdjmc", "zzdjje", "xyshryhm",
						"xyshrxm", "xyzzfzryj", "xxsh" };
				request.setAttribute("isXX", "is");
			}
		}

		String[] rs = dao.getOneRs(sql, new String[] {}, colList);
		if (rs == null) {
			rs = new String[colList.length];
		}
		for (int i = 0; i < colList.length; i++) {
			rs[i] = ((rs[i] == null) || rs[i].equalsIgnoreCase("")) ? " "
					: rs[i];
			hs.put(colList[i],rs[i]);
			request.setAttribute(colList[i], rs[i]);
		}
		
//		hs.put("yesNo", yn);
		request.setAttribute("rs", hs);
		request.setAttribute("userType", userType);
		if(userType.equalsIgnoreCase("xy")){
			request.setAttribute("chkList", dao.getChkList(5));
		}else {
			request.setAttribute("chkList", dao.getChkList(3));
		}
		if(xxdm.equalsIgnoreCase(Globals.XXDM_YNYS)){
			request.setAttribute("chkList", dao.getChkList(3));
		}
		request.setAttribute("pk", pkVal);
		request.setAttribute("tName", realTable);
		request.setAttribute("act", "knssqb");
		if(myActFwd != null){
			return myActFwd;
		}
		return mapping.findForward("success");
	}
	
	private ActionForward auditing_lstd(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {
		// 初始化页面，返回查询信息
		DAO dao = DAO.getInstance();
		XszzForm checkForm = (XszzForm) form;
		HttpSession session = request.getSession();
		List<Object> rs = new ArrayList<Object>();
		List<Object> rsExp = new ArrayList<Object>();
		String sqlExp = "";// sql语句
		String isQuery = request.getParameter("isQuery");
		if ((null == isQuery) || ("".equalsIgnoreCase(isQuery))) {
			isQuery = "no";
		}
		request.setAttribute("isQuery", isQuery);
		HashMap<String, String> map = new HashMap<String, String>();
		String[] colList = null;
		String[] colListCN = null;
		String sql = "";// sql语句
		StringBuffer querry = new StringBuffer(" where 1=1 ");// sql条件
		StringBuffer querry1 = new StringBuffer("");
		String tableName = "";// 查询信息源（多为视图名）
		String rsNum = "0";// 返回的记录数
		String realTable = "";// 数据源表
		String pk = "";// 数据源表主键（格式为“字段名||字段名||字段名”）
		String writeAble = "yes";// 写权限
		String userDep = session.getAttribute("userDep").toString();
		String userName = session.getAttribute("userName").toString();
		String userType = dao.getUserType(userDep);
		String xy = checkForm.getXydm();
		String xydm = request.getParameter("xydm");
		String xxdm = StandardOperation.getXxdm();
		String tips = "";
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);

		String xh = DealString.toGBK(checkForm.getXh());
		if (xydm != null && xy == null) {
			xy = xydm;
		}
		if (userType.equalsIgnoreCase("xy")
				&& (xy == null || xy.trim().equals(""))) {
			xy = userDep;
		}
		String zy = checkForm.getZydm();
		String bj = checkForm.getBjdm();
		if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
			realTable = "XSJTQKDCB";
			pk = "xh";
			tableName = "view_xsjtqkdcb";
			request.setAttribute("isXNMZ", "is");
		} else {
			request.setAttribute("isXNMZ", "no");
			realTable = "lstdsq";
			pk = "xh||nd";
			tableName = "view_lstdsq";
			String nd = "";
			if(!isQuery.equalsIgnoreCase("is")){
				nd = Base.currNd;
			} else {
				nd = request.getParameter("nd");
			}
			if (isNull(nd)) {
			} else {
				querry.append(" and nd = '");
				querry.append(nd);
				querry.append("' ");
			}
			map.put("nd", nd);
		}
		if (isNull(xy)) {
		} else {
			querry.append(" and xydm = '");
			querry.append(xy);
			querry.append("' ");
		}
		if (isNull(zy)) {
		} else {
			querry.append(" and zydm = '");
			querry.append(zy);
			querry.append("' ");
		}
		if (isNull(bj)) {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				if (userBj.size() != 0) {
					querry.append(" and bjdm in ('###'");
					for (Iterator<String> it = userBj.iterator(); it.hasNext();) {
						querry.append(", '");
						querry.append(it.next());
						querry.append("'");
					}
					querry.append(" ) ");
				}
			}
		} else {
			querry.append(" and bjdm = '");
			querry.append(bj);
			querry.append("' ");
		}
		if (isNull(xh)) {
		} else {
			querry.append(" and xh = '");
			querry.append(xh);
			querry.append("' ");
		}
		querry.append(querry1.toString());
		if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
			tips = "当前所在位置：学生资助 - 审核 - 学生家庭情况调查审核";
			if (isQuery.equalsIgnoreCase("is")) {
				tips = "当前所在位置：学生资助 - 申请 - 申请结果查询 - 学生家庭情况调查";
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "xh", "xm",
						"xymc", "xmc", "bjmc", "fdysh", "xysh", "xxsh" };
				if (userType.equalsIgnoreCase("xx")) {
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ " a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.xh pk3,a.* from "
							+ tableName
							+ " a" + querry.toString() + " order by xxsh desc) a";
					sqlExp = "select a.xh||'##OneSpile##'||a.xxmc||'##OneSpile##'||a.xymc||'##OneSpile##'||a.xmc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.nj||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.csny||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.rxqhk||'##OneSpile##'||a.jtrks||'##OneSpile##'||a.byxx||'##OneSpile##'||a.grtc||'##OneSpile##'||a.sfgc||'##OneSpile##'||a.sfdq||'##OneSpile##'||a.sflszn||'##OneSpile##'||a.jtxxtxdz||'##OneSpile##'||a.jtyzbm||'##OneSpile##'||a.jtlxdh||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_zy||'##OneSpile##'||a.jtcy1_nsr||'##OneSpile##'||a.jtcy1_jkzk||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_zy||'##OneSpile##'||a.jtcy2_nsr||'##OneSpile##'||a.jtcy2_jkzk||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_zy||'##OneSpile##'||a.jtcy3_nsr||'##OneSpile##'||a.jtcy3_jkzk||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_zy||'##OneSpile##'||a.jtcy4_nsr||'##OneSpile##'||a.jtcy4_jkzk||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_zy||'##OneSpile##'||a.jtcy5_nsr||'##OneSpile##'||a.jtcy5_jkzk||'##OneSpile##'||a.jtrjnsr||'##OneSpile##'||a.xsyhhjqk||'##OneSpile##'||a.jtzszrzhqk||'##OneSpile##'||a.jtzstfywsj||'##OneSpile##'||a.jtcyndlrqk||'##OneSpile##'||a.jtcysyqk||'##OneSpile##'||a.jtqzqk||'##OneSpile##'||a.qtqk||'##OneSpile##'||a.mzbmxxtxdz||'##OneSpile##'||a.mzbmyzbm||'##OneSpile##'||a.mzbmlxdh||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xdm col from "
						+ tableName
						+ " a" + querry.toString() + " order by xxsh desc";
					request.setAttribute("isXX", "is");
				} else {
					checkForm.setXydm(userDep);
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.xh pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by xxsh desc) a";
					sqlExp = "select a.xh||'##OneSpile##'||a.xxmc||'##OneSpile##'||a.xymc||'##OneSpile##'||a.xmc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.nj||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.csny||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.rxqhk||'##OneSpile##'||a.jtrks||'##OneSpile##'||a.byxx||'##OneSpile##'||a.grtc||'##OneSpile##'||a.sfgc||'##OneSpile##'||a.sfdq||'##OneSpile##'||a.sflszn||'##OneSpile##'||a.jtxxtxdz||'##OneSpile##'||a.jtyzbm||'##OneSpile##'||a.jtlxdh||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_zy||'##OneSpile##'||a.jtcy1_nsr||'##OneSpile##'||a.jtcy1_jkzk||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_zy||'##OneSpile##'||a.jtcy2_nsr||'##OneSpile##'||a.jtcy2_jkzk||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_zy||'##OneSpile##'||a.jtcy3_nsr||'##OneSpile##'||a.jtcy3_jkzk||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_zy||'##OneSpile##'||a.jtcy4_nsr||'##OneSpile##'||a.jtcy4_jkzk||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_zy||'##OneSpile##'||a.jtcy5_nsr||'##OneSpile##'||a.jtcy5_jkzk||'##OneSpile##'||a.jtrjnsr||'##OneSpile##'||a.xsyhhjqk||'##OneSpile##'||a.jtzszrzhqk||'##OneSpile##'||a.jtzstfywsj||'##OneSpile##'||a.jtcyndlrqk||'##OneSpile##'||a.jtcysyqk||'##OneSpile##'||a.jtqzqk||'##OneSpile##'||a.qtqk||'##OneSpile##'||a.mzbmxxtxdz||'##OneSpile##'||a.mzbmyzbm||'##OneSpile##'||a.mzbmlxdh||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xdm col from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xydm='"
						+ userDep
						+ "' order by xxsh desc";
					request.setAttribute("isXX", "no");
				}
			} else {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "xh", "xm",
						"xb", "sfzh", "xymc", "xmc", "nj", "" };
				if (userType.equalsIgnoreCase("xx")) {
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
						+ "a.* from(select "
						+ pk
						+ " 主键,a.xh pk2,a.xh pk3,a.* from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xydm='"
						+ userDep
						+ "' and xysh='通过' order by xxsh desc) a";
					sqlExp = "select a.xh||'##OneSpile##'||a.xxmc||'##OneSpile##'||a.xymc||'##OneSpile##'||a.xmc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.nj||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.csny||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.rxqhk||'##OneSpile##'||a.jtrks||'##OneSpile##'||a.byxx||'##OneSpile##'||a.grtc||'##OneSpile##'||a.sfgc||'##OneSpile##'||a.sfdq||'##OneSpile##'||a.sflszn||'##OneSpile##'||a.jtxxtxdz||'##OneSpile##'||a.jtyzbm||'##OneSpile##'||a.jtlxdh||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_zy||'##OneSpile##'||a.jtcy1_nsr||'##OneSpile##'||a.jtcy1_jkzk||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_zy||'##OneSpile##'||a.jtcy2_nsr||'##OneSpile##'||a.jtcy2_jkzk||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_zy||'##OneSpile##'||a.jtcy3_nsr||'##OneSpile##'||a.jtcy3_jkzk||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_zy||'##OneSpile##'||a.jtcy4_nsr||'##OneSpile##'||a.jtcy4_jkzk||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_zy||'##OneSpile##'||a.jtcy5_nsr||'##OneSpile##'||a.jtcy5_jkzk||'##OneSpile##'||a.jtrjnsr||'##OneSpile##'||a.xsyhhjqk||'##OneSpile##'||a.jtzszrzhqk||'##OneSpile##'||a.jtzstfywsj||'##OneSpile##'||a.jtcyndlrqk||'##OneSpile##'||a.jtcysyqk||'##OneSpile##'||a.jtqzqk||'##OneSpile##'||a.qtqk||'##OneSpile##'||a.mzbmxxtxdz||'##OneSpile##'||a.mzbmyzbm||'##OneSpile##'||a.mzbmlxdh||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xdm col from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xydm='"
						+ userDep
						+ "' and xysh='通过' order by xxsh desc";
					colList[colList.length - 1] = "xxsh";
					request.setAttribute("isXX", "is");
				} else {
					checkForm.setXydm(userDep);
					if (userBj.size() == 0) {
						sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
								+ "a.* from(select "
								+ pk
								+ " 主键,a.xh pk2,a.xh pk3,a.* from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep
								+ "' and fdysh='通过' order by xysh desc) a";
						sqlExp = "select a.xh||'##OneSpile##'||a.xxmc||'##OneSpile##'||a.xymc||'##OneSpile##'||a.xmc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.nj||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.csny||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.rxqhk||'##OneSpile##'||a.jtrks||'##OneSpile##'||a.byxx||'##OneSpile##'||a.grtc||'##OneSpile##'||a.sfgc||'##OneSpile##'||a.sfdq||'##OneSpile##'||a.sflszn||'##OneSpile##'||a.jtxxtxdz||'##OneSpile##'||a.jtyzbm||'##OneSpile##'||a.jtlxdh||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_zy||'##OneSpile##'||a.jtcy1_nsr||'##OneSpile##'||a.jtcy1_jkzk||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_zy||'##OneSpile##'||a.jtcy2_nsr||'##OneSpile##'||a.jtcy2_jkzk||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_zy||'##OneSpile##'||a.jtcy3_nsr||'##OneSpile##'||a.jtcy3_jkzk||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_zy||'##OneSpile##'||a.jtcy4_nsr||'##OneSpile##'||a.jtcy4_jkzk||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_zy||'##OneSpile##'||a.jtcy5_nsr||'##OneSpile##'||a.jtcy5_jkzk||'##OneSpile##'||a.jtrjnsr||'##OneSpile##'||a.xsyhhjqk||'##OneSpile##'||a.jtzszrzhqk||'##OneSpile##'||a.jtzstfywsj||'##OneSpile##'||a.jtcyndlrqk||'##OneSpile##'||a.jtcysyqk||'##OneSpile##'||a.jtqzqk||'##OneSpile##'||a.qtqk||'##OneSpile##'||a.mzbmxxtxdz||'##OneSpile##'||a.mzbmyzbm||'##OneSpile##'||a.mzbmlxdh||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xdm col from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' and fdysh='通过' order by xysh desc";
						colList[colList.length - 1] = "xysh";
					} else {
						sql = "select (case when nvl(a.fdysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
								+ "a.* from(select "
								+ pk
								+ " 主键,a.xh pk2,a.xh pk3,a.* from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep
								+ "' order by fdysh desc) a";
						sqlExp = "select a.xh||'##OneSpile##'||a.xxmc||'##OneSpile##'||a.xymc||'##OneSpile##'||a.xmc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.nj||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.csny||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.rxqhk||'##OneSpile##'||a.jtrks||'##OneSpile##'||a.byxx||'##OneSpile##'||a.grtc||'##OneSpile##'||a.sfgc||'##OneSpile##'||a.sfdq||'##OneSpile##'||a.sflszn||'##OneSpile##'||a.jtxxtxdz||'##OneSpile##'||a.jtyzbm||'##OneSpile##'||a.jtlxdh||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_zy||'##OneSpile##'||a.jtcy1_nsr||'##OneSpile##'||a.jtcy1_jkzk||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_zy||'##OneSpile##'||a.jtcy2_nsr||'##OneSpile##'||a.jtcy2_jkzk||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_zy||'##OneSpile##'||a.jtcy3_nsr||'##OneSpile##'||a.jtcy3_jkzk||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_zy||'##OneSpile##'||a.jtcy4_nsr||'##OneSpile##'||a.jtcy4_jkzk||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_zy||'##OneSpile##'||a.jtcy5_nsr||'##OneSpile##'||a.jtcy5_jkzk||'##OneSpile##'||a.jtrjnsr||'##OneSpile##'||a.xsyhhjqk||'##OneSpile##'||a.jtzszrzhqk||'##OneSpile##'||a.jtzstfywsj||'##OneSpile##'||a.jtcyndlrqk||'##OneSpile##'||a.jtcysyqk||'##OneSpile##'||a.jtqzqk||'##OneSpile##'||a.qtqk||'##OneSpile##'||a.mzbmxxtxdz||'##OneSpile##'||a.mzbmyzbm||'##OneSpile##'||a.mzbmlxdh||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xdm col from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by fdysh desc";
						colList[colList.length - 1] = "fdysh";
					}
					request.setAttribute("isXX", "no");
				}
			}
		} else {
			tips = "当前所在位置：学生资助 - 审核 - 绿色通道审核";
			if (isQuery.equalsIgnoreCase("is")) {
				tips = "当前所在位置：学生资助 - 申请 - 申请结果查询 - 绿色通道";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd",
							"xh", "xm", "bjmc", "zzdjmc", "zzdjje", "xyshrxm", "xysh", "xxsh",
							"sqsj" };
				} else {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd",
							"xh", "xm", "xb", "bjmc", "sqsj" };
				}
				if (userType.equalsIgnoreCase("xx")) {
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ " a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.nd pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString() + " order by xxsh desc) a";
					sqlExp = "select a.nj||'##OneSpile##'||a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zydm||'##OneSpile##'||a.xmc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.nd||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_gzdz||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_gzdz||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_gzdz||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_gzdz||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_gzdz||'##OneSpile##'||a.sqly||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj col from "
						+ tableName
						+ " a"
						+ querry.toString() + " order by xxsh desc";
					request.setAttribute("isXX", "is");
				} else {
					checkForm.setXydm(userDep);
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.nd pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by xxsh desc) a";
					sqlExp = "select a.nj||'##OneSpile##'||a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zydm||'##OneSpile##'||a.xmc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.nd||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_gzdz||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_gzdz||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_gzdz||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_gzdz||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_gzdz||'##OneSpile##'||a.sqly||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.hjje||'##OneSpile##'||a.hjqx col from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xydm='"
						+ userDep
						+ "' order by xxsh desc";
					request.setAttribute("isXX", "no");
				}
			} else {
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd",
							"xh", "xm", "bjmc", "zzdjmc", "zzdjje", "xyshrxm",
							"sqsj", "" };
				} else {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "nd",
							"xh", "xm", "xb", "bjmc", "sqsj", "" };
				}
				if (userType.equalsIgnoreCase("xx")) {
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ " a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.nd pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString() + " and xysh='通过' order by xxsh desc) a";
					sqlExp = "select a.nj||'##OneSpile##'||a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zydm||'##OneSpile##'||a.xmc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.nd||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_gzdz||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_gzdz||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_gzdz||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_gzdz||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_gzdz||'##OneSpile##'||a.sqly||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj col from "
						+ tableName
						+ " a"
						+ querry.toString() + " and xysh='通过' order by xxsh desc";
					colList[colList.length - 1] = "xxsh";
					request.setAttribute("isXX", "is");
				} else {
					checkForm.setXydm(userDep);
					sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.nd pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by xysh desc) a";
					sqlExp = "select a.nj||'##OneSpile##'||a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.xydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zydm||'##OneSpile##'||a.xmc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.nd||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_gzdz||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_gzdz||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_gzdz||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_gzdz||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_gzdz||'##OneSpile##'||a.sqly||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.hjje||'##OneSpile##'||a.hjqx col from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xydm='"
						+ userDep
						+ "' order by xysh desc";
					colList[colList.length - 1] = "xysh";
				}
				request.setAttribute("isXX", "no");
			}
		}
		colListCN = dao.getColumnNameCN(colList, tableName);
		List topTr = dao.arrayToList(colList, colListCN);
		StringBuffer rsExpString = new StringBuffer("");
		String colListS = "";
		if(xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)){
			colListS = "xh##OneSpile##xxmc##OneSpile##xymc##OneSpile##xmc##OneSpile##bjdm##OneSpile##bjmc##OneSpile##nj##OneSpile##xm##OneSpile##xb##OneSpile##csny##OneSpile##mzmc##OneSpile##sfzh##OneSpile##zzmm##OneSpile##rxqhk##OneSpile##jtrks##OneSpile##byxx##OneSpile##grtc##OneSpile##sfgc##OneSpile##sfdq##OneSpile##sflszn##OneSpile##jtxxtxdz##OneSpile##jtyzbm##OneSpile##jtlxdh##OneSpile##jtcy1_xm##OneSpile##jtcy1_nl##OneSpile##jtcy1_gx##OneSpile##jtcy1_gzdw##OneSpile##jtcy1_zy##OneSpile##jtcy1_nsr##OneSpile##jtcy1_jkzk##OneSpile##jtcy2_xm##OneSpile##jtcy2_nl##OneSpile##jtcy2_gx##OneSpile##jtcy2_gzdw##OneSpile##jtcy2_zy##OneSpile##jtcy2_nsr##OneSpile##jtcy2_jkzk##OneSpile##jtcy3_xm##OneSpile##jtcy3_nl##OneSpile##jtcy3_gx##OneSpile##jtcy3_gzdw##OneSpile##jtcy3_zy##OneSpile##jtcy3_nsr##OneSpile##jtcy3_jkzk##OneSpile##jtcy4_xm##OneSpile##jtcy4_nl##OneSpile##jtcy4_gx##OneSpile##jtcy4_gzdw##OneSpile##jtcy4_zy##OneSpile##jtcy4_nsr##OneSpile##jtcy4_jkzk##OneSpile##jtcy5_xm##OneSpile##jtcy5_nl##OneSpile##jtcy5_gx##OneSpile##jtcy5_gzdw##OneSpile##jtcy5_zy##OneSpile##jtcy5_nsr##OneSpile##jtcy5_jkzk##OneSpile##jtrjnsr##OneSpile##xsyhhjqk##OneSpile##jtzszrzhqk##OneSpile##jtzstfywsj##OneSpile##jtcyndlrqk##OneSpile##jtcysyqk##OneSpile##jtqzqk##OneSpile##qtqk##OneSpile##mzbmxxtxdz##OneSpile##mzbmyzbm##OneSpile##mzbmlxdh##OneSpile##fdysh##OneSpile##fdyshyj##OneSpile##xysh##OneSpile##xyshyj##OneSpile##xxsh##OneSpile##xxshyj##OneSpile##sqsj##OneSpile##xydm##OneSpile##xdm";
		} else {
			colListS = "nj##OneSpile##xh##OneSpile##xm##OneSpile##xb##OneSpile##mzmc##OneSpile##lxdh##OneSpile##xydm##OneSpile##xymc##OneSpile##zydm##OneSpile##xmc##OneSpile##bjmc##OneSpile##bjdm##OneSpile##nd##OneSpile##sqsj##OneSpile##jtcy1_xm##OneSpile##jtcy1_gx##OneSpile##jtcy1_ysr##OneSpile##jtcy1_gzdz##OneSpile##jtcy2_xm##OneSpile##jtcy2_gx##OneSpile##jtcy2_ysr##OneSpile##jtcy2_gzdz##OneSpile##jtcy3_xm##OneSpile##jtcy3_gx##OneSpile##jtcy3_ysr##OneSpile##jtcy3_gzdz##OneSpile##jtcy4_xm##OneSpile##jtcy4_gx##OneSpile##jtcy4_ysr##OneSpile##jtcy4_gzdz##OneSpile##jtcy5_xm##OneSpile##jtcy5_gx##OneSpile##jtcy5_ysr##OneSpile##jtcy5_gzdz##OneSpile##sqly##OneSpile##xyshyj##OneSpile##xxshyj##OneSpile##xysh##OneSpile##xxsh##OneSpile##zzdjdm##OneSpile##zzdjmc##OneSpile##zzdjje##OneSpile##xyshryhm##OneSpile##xyshrxm##OneSpile##xyzzfzryj##OneSpile##hjje##OneSpile##hjqx";
		}
		if ((request.getParameter("go") != null)
				&& request.getParameter("go").equalsIgnoreCase("go")) {
			rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
			rsExp.addAll(dao.rsToVator(sqlExp, new String[] {}, new String[]{"col"}));
			for(Iterator<Object> it = rsExp.iterator(); it.hasNext();){
				String[] isT = (String[])it.next();
				rsExpString.append(isT[0]);
				rsExpString.append("##TwoSpile##");
			}
		}
		request.setAttribute("colListS", colListS);
		request.setAttribute("rsExpString", rsExpString.toString());

		map.put("xydm", xy);
		map.put("zydm", zy);
		map.put("bjdm", bj);
		xy = xy==null ? "":xy;
		zy = zy==null ? "":zy;
		String bjKey = xy+"!!"+zy+"!!";
		request.setAttribute("tips", tips);
		request.setAttribute("rs1", map);// 发送读写权限
		request.setAttribute("writeAble", writeAble);// 发送读写权限
		request.setAttribute("tableName", tableName);// 发送视图名
		request.setAttribute("realTable", realTable);// 发送数据源表名
		request.setAttribute("pk", pk);// 发送数据源表主键
		request.setAttribute("njList", Base.getNjList());// 发送年级列表
		request.setAttribute("ndList", Base.getXnndList());// 发送学年列表
		request.setAttribute("xyList", Base.getXyList());// 发送学院列表
		request.setAttribute("zyList", Base.getZyMap().get(xy));// 发送专业列表
		request.setAttribute("bjList", Base.getBjMap().get(bjKey));// 发送班级列表
		request.setAttribute("act", "xsjxjzxjsqb");
		request.setAttribute("rs", rs);// 发送数据集
		request.setAttribute("topTr", topTr);// 发送表头
		request.setAttribute("rsNum", rsNum);// 发送记录数
		request.setAttribute("userType", userType);// 发送记录数
		return mapping.findForward("success");
	}

	private ActionForward auditing_lstd_one(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		DAO dao = DAO.getInstance();
		String actDo = request.getParameter("actDo");
		String pkVal = request.getParameter("pkVal");
		String realTable = "";
		HashMap<String, String> hs = new HashMap<String, String>();
		HttpSession session = request.getSession();
		String pk = "";
		String sql = "";
		String[] colList = new String[] {};
		String userType = dao.getUserType(session.getAttribute("userDep")
				.toString());
		ActionForward myActFwd = null;
		String xxdm = StandardOperation.getXxdm();
		String sUName;
		String logMsg;
		sUName = session.getAttribute("userName").toString();
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj")); 
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj")); 
		String fdyshyj = DealString.toGBK(request.getParameter("fdyshyj")); 
		String zzdjdm = DealString.toGBK(request.getParameter("zzdjdm"));
		String xyzzfzryj = DealString.toGBK(request.getParameter("xyzzfzryj"));
		
		String userName = session.getAttribute("userName").toString();
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);
		List xszzDjList = dao.getXszzDjList();
		request.setAttribute("xszzDjList", xszzDjList);
		
		boolean ok = false;
		if ("del".equalsIgnoreCase(actDo)) {
			String pkDel = request.getParameter("pkDel");
			String[] pkDelT = pkDel.split("!!splitOne!!");
			String[] sqlT = new String[pkDelT.length];
			if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)){
				for (int i = 1; i < pkDelT.length; i++) {
					String pkT = pkDelT[i];
					if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
						if (userBj.size() == 0) {
							sqlT[i] = "delete xsjtqkdcb where xh='"+pkT+"' and xxsh<>'通过'";
						} else {
							sqlT[i] = "delete xsjtqkdcb where xh='"+pkT+"' and xysh<>'通过'";
						}
					} else {
						sqlT[i] = "delete xsjtqkdcb where xh='"+pkT+"'";
					}
				}
			} else {
				for (int i = 1; i < pkDelT.length; i++) {
					String pkT = pkDelT[i];
					if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
						sqlT[i] = "delete lstdsq where xh||nd='"+pkT+"' and xxsh<>'通过'";
					} else {
						sqlT[i] = "delete lstdsq where xh||nd='"+pkT+"'";
					}
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/auditing_lstd.do?go=go", false);
			return newFwd;
		}
		
		if (actDo.equalsIgnoreCase("save")) {
			String yesNo = DealString.toGBK(request.getParameter("yesNo"));
			if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					if (userBj.size() == 0) {
						ok = StandardOperation.update("xsjtqkdcb",
								new String[] { "xysh", "xyshyj" }, new String[] { yesNo, xyshyj },
								"xh", pkVal, request);
					} else {
						if ("未审核".equalsIgnoreCase(yesNo) || "不通过".equalsIgnoreCase(yesNo)){
							ok = StandardOperation.update("xsjtqkdcb",
									new String[] { "fdysh", "fdyshyj", "xysh" },
									new String[] { yesNo, fdyshyj, "未审核" }, "xh",
									pkVal, request);
						} else {
							ok = StandardOperation.update("xsjtqkdcb",
									new String[] { "fdysh", "fdyshyj" },
									new String[] { yesNo, fdyshyj }, "xh",
									pkVal, request);
						}
					}
				} else {
					ok = StandardOperation.update("xsjtqkdcb",
							new String[] { "xxsh", "xxshyj" }, new String[] { yesNo, xxshyj },
							"xh", pkVal, request);
				}
				if (ok) {
					logMsg = "修改(审核) knssqb";
					Base.log(request, logMsg, sUName);
				}
			} else {
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
						ok = StandardOperation.update("lstdsq",
								new String[] { "xysh", "xyshyj", "zzdjdm", "xyshryhm", "xyzzfzryj" }, 
								new String[] { yesNo, xyshyj, zzdjdm, userName, xyzzfzryj },
								"xh||nd", pkVal, request);
					} else {
						ok = StandardOperation.update("lstdsq",
								new String[] { "xysh", "xyshyj" }, new String[] { yesNo, xyshyj },
								"xh||nd", pkVal, request);
					}
				} else {
					ok = StandardOperation.update("lstdsq",
							new String[] { "xxsh", "xxshyj" }, new String[] { yesNo, xyshyj },
							"xh||nd", pkVal, request);
				}
				if (ok) {
					logMsg = "修改(审核) lstdsq";
					Base.log(request, logMsg, sUName);
				}
			}
		}
		if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
			realTable = "xsjtqkdcb";
			pk = "xh";
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				if (userBj.size() == 0) {
					sql = "select "
						+ pk
						+ " pk,xh,xxmc,xymc,xmc,nj,xm,xb,csny,mzmc,sfzh,zzmm,rxqhk,"
						+ "jtrks,byxx,grtc,sfgc,sfdq,sflszn,jtxxtxdz,jtyzbm,jtlxdh,"
						+ "jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdw,jtcy1_zy,jtcy1_nsr,jtcy1_jkzk,"
						+ "jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdw,jtcy2_zy,jtcy2_nsr,jtcy2_jkzk,"
						+ "jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdw,jtcy3_zy,jtcy3_nsr,jtcy3_jkzk,"
						+ "jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdw,jtcy4_zy,jtcy4_nsr,jtcy4_jkzk,"
						+ "jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdw,jtcy5_zy,jtcy5_nsr,jtcy5_jkzk,"
						+ "jtrjnsr,xsyhhjqk,jtzszrzhqk,jtzstfywsj,jtcyndlrqk,jtcysyqk,jtqzqk,"
						+ "qtqk,mzbmxxtxdz,mzbmyzbm,mzbmlxdh,fdyshyj,xyshyj,xxshyj,sqsj,xydm,xdm,xxsh,xysh yesNo "
						+ "from VIEW_XSJTQKDCB where " + pk + "='"
						+ pkVal + "'";
				} else {
					sql = "select "
						+ pk
						+ " pk,xh,xxmc,xymc,xmc,nj,xm,xb,csny,mzmc,sfzh,zzmm,rxqhk,"
						+ "jtrks,byxx,grtc,sfgc,sfdq,sflszn,jtxxtxdz,jtyzbm,jtlxdh,"
						+ "jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdw,jtcy1_zy,jtcy1_nsr,jtcy1_jkzk,"
						+ "jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdw,jtcy2_zy,jtcy2_nsr,jtcy2_jkzk,"
						+ "jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdw,jtcy3_zy,jtcy3_nsr,jtcy3_jkzk,"
						+ "jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdw,jtcy4_zy,jtcy4_nsr,jtcy4_jkzk,"
						+ "jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdw,jtcy5_zy,jtcy5_nsr,jtcy5_jkzk,"
						+ "jtrjnsr,xsyhhjqk,jtzszrzhqk,jtzstfywsj,jtcyndlrqk,jtcysyqk,jtqzqk,"
						+ "qtqk,mzbmxxtxdz,mzbmyzbm,mzbmlxdh,fdyshyj,xyshyj,xxshyj,sqsj,xydm,xdm,xxsh,fdysh yesNo "
						+ "from VIEW_XSJTQKDCB where " + pk + "='"
						+ pkVal + "'";
				}
				request.setAttribute("isXX", "no");
			} else {
				sql = "select "
					+ pk
					+ " pk,xh,xxmc,xymc,xmc,nj,xm,xb,csny,mzmc,sfzh,zzmm,rxqhk,"
					+ "jtrks,byxx,grtc,sfgc,sfdq,sflszn,jtxxtxdz,jtyzbm,jtlxdh,"
					+ "jtcy1_xm,jtcy1_nl,jtcy1_gx,jtcy1_gzdw,jtcy1_zy,jtcy1_nsr,jtcy1_jkzk,"
					+ "jtcy2_xm,jtcy2_nl,jtcy2_gx,jtcy2_gzdw,jtcy2_zy,jtcy2_nsr,jtcy2_jkzk,"
					+ "jtcy3_xm,jtcy3_nl,jtcy3_gx,jtcy3_gzdw,jtcy3_zy,jtcy3_nsr,jtcy3_jkzk,"
					+ "jtcy4_xm,jtcy4_nl,jtcy4_gx,jtcy4_gzdw,jtcy4_zy,jtcy4_nsr,jtcy4_jkzk,"
					+ "jtcy5_xm,jtcy5_nl,jtcy5_gx,jtcy5_gzdw,jtcy5_zy,jtcy5_nsr,jtcy5_jkzk,"
					+ "jtrjnsr,xsyhhjqk,jtzszrzhqk,jtzstfywsj,jtcyndlrqk,jtcysyqk,jtqzqk,"
					+ "qtqk,mzbmxxtxdz,mzbmyzbm,mzbmlxdh,fdyshyj,xyshyj,xxshyj,sqsj,xydm,xdm,xxsh,xxsh yesNo "
					+ "from VIEW_XSJTQKDCB where " + pk + "='" + pkVal + "'";
				request.setAttribute("isXX", "is");
			}
			colList = new String[] { "pk", "xh", "xxmc", "xymc", "xmc", "nj", "xm", "xb", 
					"csny", "mzmc", "sfzh", "zzmm", "rxqhk", "jtrks", "byxx", "grtc", 
					"sfgc", "sfdq", "sflszn", "jtxxtxdz", "jtyzbm", "jtlxdh", "jtcy1_xm", 
					"jtcy1_nl", "jtcy1_gx", "jtcy1_gzdw", "jtcy1_zy", "jtcy1_nsr", 
					"jtcy1_jkzk", "jtcy2_xm", "jtcy2_nl", "jtcy2_gx", "jtcy2_gzdw", 
					"jtcy2_zy", "jtcy2_nsr", "jtcy2_jkzk", "jtcy3_xm", "jtcy3_nl", 
					"jtcy3_gx", "jtcy3_gzdw", "jtcy3_zy", "jtcy3_nsr", "jtcy3_jkzk", 
					"jtcy4_xm", "jtcy4_nl", "jtcy4_gx", "jtcy4_gzdw", "jtcy4_zy", 
					"jtcy4_nsr", "jtcy4_jkzk", "jtcy5_xm", "jtcy5_nl", "jtcy5_gx", 
					"jtcy5_gzdw", "jtcy5_zy", "jtcy5_nsr", "jtcy5_jkzk", "jtrjnsr", 
					"xsyhhjqk", "jtzszrzhqk", "jtzstfywsj", "jtcyndlrqk", "jtcysyqk", 
					"jtqzqk", "qtqk", "mzbmxxtxdz", "mzbmyzbm", "mzbmlxdh", "fdyshyj",
					"xyshyj", "xxshyj", "sqsj", "xydm", "xdm", "xxsh", "yesNo" };
			myActFwd = new ActionForward("/xszz/common/auditing_lstd_one_xnmz.jsp",
					false);
		} else {
			realTable = "lstdsq";
			pk = "xh||nd";
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				sql = "select "
					+ pk
					+ " pk,xh,xm,xb,mzmc,lxdh,xymc,xmc,bjmc,nd,sqsj,jtcy1_xm,jtcy1_gx,jtcy1_ysr,"
					+ "jtcy1_gzdz,jtcy2_xm,jtcy2_gx,jtcy2_ysr,jtcy2_gzdz,jtcy3_xm,jtcy3_gx,"
					+ "jtcy3_ysr,jtcy3_gzdz,jtcy4_xm,jtcy4_gx,jtcy4_ysr,jtcy4_gzdz,jtcy5_xm,"
					+ "jtcy5_gx,jtcy5_ysr,jtcy5_gzdz,sqly,xyshyj,xxshyj,zzdjdm,zzdjmc,zzdjje,"
					+ "xyshryhm,xyshrxm,xyzzfzryj,xxsh,sfzh,jtlxdh,jtzz,hjje,hjqx,xysh yesNo from view_lstdsq where "
					+ pk + "='" + pkVal + "'";
				request.setAttribute("isXX", "no");
			} else {
				sql = "select "
					+ pk
					+ " pk,xh,xm,xb,mzmc,lxdh,xymc,xmc,bjmc,nd,sqsj,jtcy1_xm,jtcy1_gx,jtcy1_ysr,"
					+ "jtcy1_gzdz,jtcy2_xm,jtcy2_gx,jtcy2_ysr,jtcy2_gzdz,jtcy3_xm,jtcy3_gx,"
					+ "jtcy3_ysr,jtcy3_gzdz,jtcy4_xm,jtcy4_gx,jtcy4_ysr,jtcy4_gzdz,jtcy5_xm,"
					+ "jtcy5_gx,jtcy5_ysr,jtcy5_gzdz,sqly,xyshyj,xxshyj,zzdjdm,zzdjmc,zzdjje,"
					+ "xyshryhm,xyshrxm,xyzzfzryj,xxsh,sfzh,jtlxdh,jtzz,hjje,hjqx,xxsh yesNo from view_lstdsq where "
					+ pk + "='" + pkVal + "'";
				request.setAttribute("isXX", "is");
			}
			colList = new String[] { "pk", "xh", "xm", "xb", "mzmc",
					"lxdh", "xymc", "xmc", "bjmc", "nd", "sqsj",
					"jtcy1_xm", "jtcy1_gx", "jtcy1_ysr", "jtcy1_gzdz",
					"jtcy2_xm", "jtcy2_gx", "jtcy2_ysr", "jtcy2_gzdz",
					"jtcy3_xm", "jtcy3_gx", "jtcy3_ysr", "jtcy3_gzdz",
					"jtcy4_xm", "jtcy4_gx", "jtcy4_ysr", "jtcy4_gzdz",
					"jtcy5_xm", "jtcy5_gx", "jtcy5_ysr", "jtcy5_gzdz",
					"sqly", "xyshyj", "xxshyj", "zzdjdm", "zzdjmc",
					"zzdjje", "xyshryhm", "xyshrxm", "xyzzfzryj", "xxsh",
					"sfzh", "jtlxdh", "jtzz", "hjje", "hjqx", "yesNo" };
		}

		String[] rs = dao.getOneRs(sql, new String[] {}, colList);
		if (rs == null) {
			rs = new String[colList.length];
		}
		for (int i = 0; i < colList.length; i++) {
			rs[i] = ((rs[i] == null) || rs[i].equalsIgnoreCase("")) ? " "
					: rs[i];
			hs.put(colList[i], rs[i]);
		}
		
		if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)){
			request.setAttribute("isZZSF", "is");
		} else {
			request.setAttribute("isZZSF", "no");
		}
		
		hs.put("zzdjdm", zzdjdm);
		request.setAttribute("rs", hs);
		request.setAttribute("userType", userType);
		request.setAttribute("chkList", dao.getChkList(3));
		request.setAttribute("pk", pkVal);
		request.setAttribute("tName", realTable);
		request.setAttribute("titName", "lstdsq");
		request.setAttribute("act", "lstdsq");
		if(myActFwd != null){
			return myActFwd;
		}
		return mapping.findForward("success");
	}

	private ActionForward auditing_wszxj(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {
		// 初始化页面，返回查询信息
		XszzForm checkForm = (XszzForm) form;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		List<Object> rs = new ArrayList<Object>();
		List<Object> rsExp = new ArrayList<Object>();
		String sqlExp = "";// sql语句
		String isQuery = request.getParameter("isQuery");
		if ((null == isQuery) || ("".equalsIgnoreCase(isQuery))) {
			isQuery = "no";
		}
		request.setAttribute("isQuery", isQuery);
		HashMap<String, String> map = new HashMap<String, String>();
		String[] colList = null;
		String[] colListCN = null;
		String sql = "";// sql语句
		StringBuffer querry = new StringBuffer(" where 1=1 ");// sql条件
		StringBuffer querry1 = new StringBuffer("");
		String tableName = "";// 查询信息源（多为视图名）
		String rsNum = "0";// 返回的记录数
		String realTable = "";// 数据源表
		String pk = "";// 数据源表主键（格式为“字段名||字段名||字段名”）
		String writeAble = "yes";// 写权限
		String userDep = session.getAttribute("userDep").toString();
		String userName = session.getAttribute("userName").toString();
		String userType = dao.getUserType(userDep);
		String xy = checkForm.getXydm();
		String xydm = request.getParameter("xydm");
		String shxm = DealString.toGBK(request.getParameter("shxmdm"));
		String xxdm = StandardOperation.getXxdm();
		String tips = "";
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);
		
		List<HashMap<String, String>> shxmList = new ArrayList<HashMap<String,String>>();
		String [] cols = {"shxmdm","shxmmc"};
		shxmList = dao.getList("select zxjdm shxmdm,zxjmc shxmmc from wszxjdmb", new String[]{}, cols);
		if ((shxm == null)||("".equalsIgnoreCase(shxm))) {
		} else {
			querry1.append(" and bzdm='");
			querry1.append(shxm);
			querry1.append("' ");
		}
		request.setAttribute("shxmList", shxmList);

		String xh = DealString.toGBK(checkForm.getXh());
		String xm = DealString.toGBK(checkForm.getXm());
		String nj = checkForm.getNj();
		if (xydm != null && xy == null) {
			xy = xydm;
		}
		if (userType.equalsIgnoreCase("xy")
				&& (xy == null || xy.trim().equals(""))) {
			xy = userDep;
		}
		String zy = checkForm.getZydm();
		String bj = checkForm.getBjdm();
		
		realTable = "wszxjsqb";
		pk = "xh||bzdm||nd";
		tableName = "view_xswszxjsqxx";
		String nd = checkForm.getNd();
		String shlb = checkForm.getShlb();
//		if(!isQuery.equalsIgnoreCase("is")){
//			nd = Base.currNd;
//		} else {
//			nd = request.getParameter("nd");
//		}
		if (isNull(nd)) {
		} else {
			querry.append(" and nd = '");
			querry.append(nd);
			querry.append("' ");
		}
		if (isNull(xy)) {
		} else {
			querry.append(" and xydm = '");
			querry.append(xy);
			querry.append("' ");
		}
		if (isNull(zy)) {
		} else {
			querry.append(" and zydm = '");
			querry.append(zy);
			querry.append("' ");
		}
		if (isNull(bj)) {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				if (userBj.size() != 0) {
					querry.append(" and bjdm in ('###'");
					for (Iterator<String> it = userBj.iterator(); it.hasNext();) {
						querry.append(", '");
						querry.append(it.next());
						querry.append("'");
					}
					querry.append(" ) ");
				}
			}
		} else {
			querry.append(" and bjdm = '");
			querry.append(bj);
			querry.append("' ");
		}
		if(StringUtils.isNotNull(nj)){
			querry.append(" and nj = '");
			querry.append(nj);
			querry.append("' ");
		}
		if (isNull(xh)) {
		} else {
			querry.append(" and xh like '%");
			querry.append(xh);
			querry.append("%' ");
		}
		if (isNull(xm)) {
		} else {
			querry.append(" and xm like '%");
			querry.append(xm);
			querry.append("%' ");
		}
		if(StringUtils.isNotNull(shlb)){//审核类别
			if((xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY))){
				if("xx".equalsIgnoreCase(userType)){
					querry.append(" and xxsh = '");
					querry.append(shlb);
				}else if(userBj.size()>0){
					//辅导员审核
					querry.append(" and fdysh = '");
					querry.append(shlb);
				}else{
					querry.append(" and xysh = '");
					querry.append(shlb);
				}
			}else if("xx".equalsIgnoreCase(userType)){
				querry.append(" and xxsh = '");
				querry.append(shlb);
			}else{
				querry.append(" and xysh = '");
				querry.append(shlb);
			}			
			querry.append("' ");
		}
		querry.append(querry1.toString());
			tips = "当前所在位置：学生资助 - 审核 - 外设助学金审核";
			if (isQuery.equalsIgnoreCase("is")) {
				tips = "当前所在位置：学生资助 - 申请 - 申请结果查询 - 外设助学金";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
				colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "pk4", "nd",
						"xn", "xh", "xm", "bzmc", "zynj", "zxje", "jxje",
						"zzdjmc", "zzdjje", "xyshrxm", "xysh", "xxsh", "sqsj" };
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "pk4", "nd",
							"xn", "xh", "xm", "bzmc", "zynj", "zxje", "jxje", "fdysh",
							"xysh", "xxsh", "sqsj" };
				} else {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "pk4", "nd",
							"xn", "xh", "xm", "bzmc", "zynj", "zxje", "jxje",
							"xysh", "xxsh", "sqsj" };
				}
				if (userType.equalsIgnoreCase("xx")) {
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ " a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.bzdm pk3,a.nd pk4,a.* from "
							+ tableName
							+ " a"
							+ querry.toString() + " order by xxsh desc) a";
					sqlExp = "select a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.bysj||'##OneSpile##'||a.zynj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.xz||'##OneSpile##'||a.brcn||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.jg||'##OneSpile##'||a.csny||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj||'##OneSpile##'||a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.nj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc col from "
						+ tableName
						+ " a"
						+ querry.toString() + " order by xxsh desc";
					request.setAttribute("isXX", "is");
				} else {
					checkForm.setXydm(userDep);
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.bzdm pk3,a.nd pk4,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by xxsh desc) a";
					sqlExp = "select a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.bysj||'##OneSpile##'||a.zynj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.xz||'##OneSpile##'||a.brcn||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.jg||'##OneSpile##'||a.csny||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj||'##OneSpile##'||a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.nj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc col from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xydm='"
						+ userDep
						+ "' order by xxsh desc";
					request.setAttribute("isXX", "no");
				}
			} else {
				if(xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)){
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "pk4", "nd", "xn", "xh", "xm", 
								"bzmc","zynj", "zxje", "jxje", "zzdjmc", "zzdjje", "xyshrxm", "" };
				} else {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "pk4", "nd", "xn", "xh", "xm", 
						"bzmc","zynj", "zxje", "jxje", "" };
				}
				if (userType.equalsIgnoreCase("xx")) {
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ " a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.bzdm pk3,a.nd pk4,a.* from "
							+ tableName
							+ " a"
							+ querry.toString() + " and xysh='通过' order by xxsh desc) a";
					sqlExp = "select a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.bysj||'##OneSpile##'||a.zynj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.xz||'##OneSpile##'||a.brcn||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.jg||'##OneSpile##'||a.csny||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj||'##OneSpile##'||a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.nj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc col from "
						+ tableName
						+ " a"
						+ querry.toString() + " and xysh='通过' order by xxsh desc";
					colList[colList.length - 1] = "xxsh";
					request.setAttribute("isXX", "is");
				} else {
					checkForm.setXydm(userDep);
					if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
						if (userBj.size() == 0) {
							sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
								+ "a.* from(select "
								+ pk
								+ " 主键,a.xh pk2,a.bzdm pk3,a.nd pk4,a.* from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' and fdysh='通过' order by xysh desc) a";
							sqlExp = "select a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.bysj||'##OneSpile##'||a.zynj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.xz||'##OneSpile##'||a.brcn||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.jg||'##OneSpile##'||a.csny||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj||'##OneSpile##'||a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.nj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc col from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' and fdysh='通过' order by xysh desc";
							colList[colList.length - 1] = "xysh";
						}else{
							sql = "select (case when nvl(a.fdysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
								+ "a.* from(select "
								+ pk
								+ " 主键,a.xh pk2,a.bzdm pk3,a.nd pk4,a.* from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' order by fdysh desc) a";
							sqlExp = "select a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.bysj||'##OneSpile##'||a.zynj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.xz||'##OneSpile##'||a.brcn||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.jg||'##OneSpile##'||a.csny||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj||'##OneSpile##'||a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.nj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc col from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' order by fdysh desc";
							colList[colList.length - 1] = "fdysh";
						}
					} else {
						sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
								+ "a.* from(select "
								+ pk
								+ " 主键,a.xh pk2,a.bzdm pk3,a.nd pk4,a.* from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep
								+ "' order by xysh desc) a";
						sqlExp = "select a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.bysj||'##OneSpile##'||a.zynj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.xz||'##OneSpile##'||a.brcn||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.jg||'##OneSpile##'||a.csny||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj||'##OneSpile##'||a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.nj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc col from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by xysh desc";
					}
					colList[colList.length - 1] = "xysh";
				}
				request.setAttribute("isXX", "no");
			}
		colListCN = dao.getColumnNameCN(colList, tableName);
		List topTr = dao.arrayToList(colList, colListCN);
		String colListS = "xn##OneSpile##nd##OneSpile##mzmc##OneSpile##bysj##OneSpile##zynj##OneSpile##jtdz##OneSpile##yzbm##OneSpile##sfzh##OneSpile##jtcy1_xm##OneSpile##jtcy1_gx##OneSpile##jtcy1_gzdw##OneSpile##jtcy1_ysr##OneSpile##jtcy2_xm##OneSpile##jtcy2_gx##OneSpile##jtcy2_gzdw##OneSpile##jtcy2_ysr##OneSpile##jtcy3_xm##OneSpile##jtcy3_gx##OneSpile##jtcy3_gzdw##OneSpile##jtcy3_ysr##OneSpile##jtcy4_xm##OneSpile##jtcy4_gx##OneSpile##jtcy4_gzdw##OneSpile##jtcy4_ysr##OneSpile##jtcy5_xm##OneSpile##jtcy5_gx##OneSpile##jtcy5_gzdw##OneSpile##jtcy5_ysr##OneSpile##jttgje##OneSpile##zxje##OneSpile##jxje##OneSpile##qgzxje##OneSpile##xnwxdkje##OneSpile##qtsrje##OneSpile##zxdkje##OneSpile##zxdksj##OneSpile##yffzxdkje##OneSpile##yffzxdksj##OneSpile##sqzzly##OneSpile##zzff1##OneSpile##zzff1qsje##OneSpile##xz##OneSpile##brcn##OneSpile##drshgzqk##OneSpile##zzff1jsje##OneSpile##xxsh##OneSpile##xysh##OneSpile##xyshyj##OneSpile##xxshyj##OneSpile##sqsj##OneSpile##zzmm##OneSpile##jcqk##OneSpile##jg##OneSpile##csny##OneSpile##jtcy5_nl##OneSpile##jtcy4_nl##OneSpile##jtcy3_nl##OneSpile##jtcy2_nl##OneSpile##jtcy1_nl##OneSpile##bjdm##OneSpile##xydm##OneSpile##zydm##OneSpile##xymc##OneSpile##zymc##OneSpile##bjmc##OneSpile##zzdjdm##OneSpile##zzdjmc##OneSpile##zzdjje##OneSpile##xyshryhm##OneSpile##xyshrxm##OneSpile##xyzzfzryj##OneSpile##fdysh##OneSpile##fdyshyj##OneSpile##xh##OneSpile##xm##OneSpile##xb##OneSpile##nj##OneSpile##qsh##OneSpile##qsdh##OneSpile##lxdzxx##OneSpile##lxdh##OneSpile##sjhm##OneSpile##bz##OneSpile##bzdm##OneSpile##bzmc";
		StringBuffer rsExpString = new StringBuffer("");
		if ((request.getParameter("go") != null)
				&& request.getParameter("go").equalsIgnoreCase("go")) {
			rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
			rsExp.addAll(dao.rsToVator(sqlExp, new String[] {}, new String[]{"col"}));
			for(Iterator<Object> it = rsExp.iterator(); it.hasNext();){
				String[] isT = (String[])it.next();
				rsExpString.append(isT[0]);
				rsExpString.append("##TwoSpile##");
			}
		}
		request.setAttribute("colListS", colListS);
		request.setAttribute("rsExpString", rsExpString.toString());

		map.put("xydm", xy);
		map.put("zydm", zy);
		map.put("bjdm", bj);
		map.put("nd", nd);
		map.put("xh", xh);
		map.put("xm", xm);
		xy = xy==null ? "":xy;
		zy = zy==null ? "":zy;
		String bjKey = xy+"!!"+zy+"!!";
		request.setAttribute("tips", tips);
		request.setAttribute("rs1", map);// 发送读写权限
		request.setAttribute("writeAble", writeAble);// 发送读写权限
		request.setAttribute("tableName", tableName);// 发送视图名
		request.setAttribute("realTable", realTable);// 发送数据源表名
		request.setAttribute("pk", pk);// 发送数据源表主键
		request.setAttribute("njList", Base.getNjList());// 发送年级列表
		request.setAttribute("ndList", Base.getXnndList());// 发送学年列表
		request.setAttribute("xyList", Base.getXyList());// 发送学院列表
		request.setAttribute("zyList", Base.getZyMap().get(xy));// 发送专业列表
		request.setAttribute("bjList", Base.getBjMap().get(bjKey));// 发送班级列表
		request.setAttribute("act", "xsjxjzxjsqb");
		request.setAttribute("rs", rs);// 发送数据集
		request.setAttribute("topTr", topTr);// 发送表头
		request.setAttribute("rsNum", rsNum);// 发送记录数
		request.setAttribute("userType", userType);// 发送记录数
		request.setAttribute("chkList", dao.getChkList(3));//审核状态列表
		return mapping.findForward("success");
	}

	private ActionForward auditing_wszxj_one(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		DAO dao = DAO.getInstance();
		String actDo = request.getParameter("actDo");
		String pkVal = request.getParameter("pkVal");
		String realTable = "";
		HashMap<String, String> hs = new HashMap<String, String>();
		HttpSession session = request.getSession();
		String pk = "";
		String sql = "";
		String[] colList = new String[] {};
		String userType = dao.getUserType(session.getAttribute("userDep")
				.toString());
		String xxdm = StandardOperation.getXxdm();
		String sUName;
		String logMsg;
		sUName = session.getAttribute("userName").toString();
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));
		String fdyshyj = DealString.toGBK(request.getParameter("fdyshyj"));
		String zzdjdm = DealString.toGBK(request.getParameter("zzdjdm"));
		String xyzzfzryj = DealString.toGBK(request.getParameter("xyzzfzryj"));

		String userName = session.getAttribute("userName").toString();
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);
		List xszzDjList = dao.getXszzDjList();
		request.setAttribute("xszzDjList", xszzDjList);

		boolean ok = false;
		if ("del".equalsIgnoreCase(actDo)) {
			String pkDel = request.getParameter("pkDel");
			String[] pkDelT = pkDel.split("!!splitOne!!");
			String[] sqlT = new String[pkDelT.length];
			for (int i = 1; i < pkDelT.length; i++) {
				String pkT = pkDelT[i];
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)){
						if (userBj.size() == 0) {
							sqlT[i] = "delete wszxjsqb where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
						} else {
							sqlT[i] = "delete wszxjsqb where xh||bzdm||nd='"+pkT+"' and xysh<>'通过'";
						}
					} else {
						sqlT[i] = "delete wszxjsqb where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
					}
				} else {
					sqlT[i] = "delete wszxjsqb where xh||bzdm||nd='"+pkT+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/auditing_wszxj.do?go=go", false);
			return newFwd;
		}
		if ("plsh".equalsIgnoreCase(actDo)) {
			String pkDel = request.getParameter("pkDel");
			String[] pkDelT = pkDel.split("!!splitOne!!");
			String jg = request.getParameter("jg");
			if ("tg".equalsIgnoreCase(jg)){
				jg = "通过";
			} else if ("btg".equalsIgnoreCase(jg)){
				jg = "不通过";
			} else {
				jg = "未审核";
			}
			String[] sqlT = new String[pkDelT.length];
			for (int i = 1; i < pkDelT.length; i++) {
				String pkT = pkDelT[i];
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)){
						if (userBj.size() == 0) {
							sqlT[i] = "update wszxjsqb set xysh='"+jg+"' where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
						} else {
							sqlT[i] = "update wszxjsqb set fdysh='"+jg+"' where xh||bzdm||nd='"+pkT+"' and xysh<>'通过'";
						}
					} else {
						sqlT[i] = "update wszxjsqb set xysh='"+jg+"' where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
					}
				} else {
					sqlT[i] = "update wszxjsqb set xxsh='"+jg+"' where xh||bzdm||nd='"+pkT+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/auditing_wszxj.do?go=go", false);
			return newFwd;
		}

		if (actDo.equalsIgnoreCase("save")) {
			String yesNo = DealString.toGBK(request.getParameter("yesNo"));
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					ok = StandardOperation
							.update("wszxjsqb",
									new String[] { "xysh", "xyshyj", "zzdjdm",
											"xyshryhm", "xyzzfzryj" },
									new String[] { yesNo, xyshyj, zzdjdm,
											userName, xyzzfzryj },
									"xh||bzdm||nd", pkVal, request);
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					if (userBj.size() == 0) {
						ok = StandardOperation.update("wszxjsqb", new String[] {
								"xysh", "xyshyj" }, new String[] { yesNo,
								xyshyj }, "xh||bzdm||nd", pkVal, request);
					} else {
						if ("未审核".equalsIgnoreCase(yesNo) || "不通过".equalsIgnoreCase(yesNo)){
							ok = StandardOperation.update("wszxjsqb",
									new String[] { "fdysh", "fdyshyj", "xysh" },
									new String[] { yesNo, fdyshyj, "未审核" },
									"xh||bzdm||nd", pkVal, request);
						} else {
							ok = StandardOperation.update("wszxjsqb",
									new String[] { "fdysh", "fdyshyj" },
									new String[] { yesNo, fdyshyj },
									"xh||bzdm||nd", pkVal, request);
						}
					}
				} else {
					ok = StandardOperation.update("wszxjsqb", new String[] {
							"xysh", "xyshyj" }, new String[] { yesNo, xyshyj },
							"xh||bzdm||nd", pkVal, request);
				}
			} else {
				ok = StandardOperation.update("wszxjsqb", new String[] {
						"xxsh", "xxshyj" }, new String[] { yesNo, xxshyj },
						"xh||bzdm||nd", pkVal, request);
			}
			if (ok) {
				logMsg = "修改(审核) lstdsq";
				Base.log(request, logMsg, sUName);
			}
		}
		realTable = "wszxjsqb";
		pk = "xh||bzdm||nd";
		if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				if (userBj.size() == 0) {
					sql = "select "
							+ pk
							+ " pk,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,yffzxdksj,sqzzly,zzff1,zzff1qsje,xz,brcn,drshgzqk,zzff1jsje,xxsh,xysh,xyshyj,xxshyj,sqsj,zzmm,jcqk,jg,csny,jtcy5_nl,jtcy4_nl,jtcy3_nl,jtcy2_nl,jtcy1_nl,bjdm,xydm,zydm,xymc,zymc,bjmc,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,XYSH yesNo from view_xswszxjsqxx where "
							+ pk + "='" + pkVal + "'";
				} else {
					sql = "select "
							+ pk
							+ " pk,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,yffzxdksj,sqzzly,zzff1,zzff1qsje,xz,brcn,drshgzqk,zzff1jsje,xxsh,xysh,xyshyj,xxshyj,sqsj,zzmm,jcqk,jg,csny,jtcy5_nl,jtcy4_nl,jtcy3_nl,jtcy2_nl,jtcy1_nl,bjdm,xydm,zydm,xymc,zymc,bjmc,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,fdySH yesNo from view_xswszxjsqxx where "
							+ pk + "='" + pkVal + "'";
				}
			} else {
				sql = "select "
						+ pk
						+ " pk,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,yffzxdksj,sqzzly,zzff1,zzff1qsje,xz,brcn,drshgzqk,zzff1jsje,xxsh,xysh,xyshyj,xxshyj,sqsj,zzmm,jcqk,jg,csny,jtcy5_nl,jtcy4_nl,jtcy3_nl,jtcy2_nl,jtcy1_nl,bjdm,xydm,zydm,xymc,zymc,bjmc,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,XYSH yesNo from view_xswszxjsqxx where "
						+ pk + "='" + pkVal + "'";
			}
			request.setAttribute("isXX", "no");
		} else {
			sql = "select "
					+ pk
					+ " pk,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,yffzxdksj,sqzzly,zzff1,zzff1qsje,xz,brcn,drshgzqk,zzff1jsje,xxsh,xysh,xyshyj,xxshyj,sqsj,zzmm,jcqk,jg,csny,jtcy5_nl,jtcy4_nl,jtcy3_nl,jtcy2_nl,jtcy1_nl,bjdm,xydm,zydm,xymc,zymc,bjmc,zzdjdm,zzdjmc,zzdjje,xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,XYSH yesNo from view_xswszxjsqxx where "
					+ pk + "='" + pkVal + "'";
			request.setAttribute("isXX", "is");
		}
		colList = new String[] { "pk", "xh", "xm", "xb", "nj", "qsh", "qsdh",
				"lxdzxx", "lxdh", "sjhm", "bz", "bzdm", "bzmc", "xn", "nd",
				"mzmc", "bysj", "zynj", "jtdz", "yzbm", "sfzh", "jtcy1_xm",
				"jtcy1_gx", "jtcy1_gzdw", "jtcy1_ysr", "jtcy2_xm", "jtcy2_gx",
				"jtcy2_gzdw", "jtcy2_ysr", "jtcy3_xm", "jtcy3_gx",
				"jtcy3_gzdw", "jtcy3_ysr", "jtcy4_xm", "jtcy4_gx",
				"jtcy4_gzdw", "jtcy4_ysr", "jtcy5_xm", "jtcy5_gx",
				"jtcy5_gzdw", "jtcy5_ysr", "jttgje", "zxje", "jxje", "qgzxje",
				"xnwxdkje", "qtsrje", "zxdkje", "zxdksj", "yffzxdkje",
				"yffzxdksj", "sqzzly", "zzff1", "zzff1qsje", "xz", "brcn",
				"drshgzqk", "zzff1jsje", "xxsh", "xysh", "xyshyj", "xxshyj",
				"sqsj", "zzmm", "jcqk", "jg", "csny", "jtcy5_nl", "jtcy4_nl",
				"jtcy3_nl", "jtcy2_nl", "jtcy1_nl", "bjdm", "xydm", "zydm",
				"xymc", "zymc", "bjmc", "zzdjdm", "zzdjmc", "zzdjje",
				"xyshryhm", "xyshrxm", "xyzzfzryj", "fdyshyj", "xxsh", "yesNo" };

		String[] rs = dao.getOneRs(sql, new String[] {}, colList);
		if (rs == null) {
			rs = new String[colList.length];
		}
		for (int i = 0; i < colList.length; i++) {
			rs[i] = ((rs[i] == null) || rs[i].equalsIgnoreCase("")) ? " "
					: rs[i];
			hs.put(colList[i], rs[i]);
		}

		if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
			request.setAttribute("isZZSF", "is");
		} else {
			request.setAttribute("isZZSF", "no");
		}
		if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
			request.setAttribute("isXNMZ", "is");
		} else {
			request.setAttribute("isXNMZ", "no");
		}

		hs.put("zzdjdm", zzdjdm);
		request.setAttribute("rs", hs);
		request.setAttribute("userType", userType);
		request.setAttribute("chkList", dao.getChkList(3));
		request.setAttribute("pk", pkVal);
		request.setAttribute("tName", realTable);
		request.setAttribute("act", "lstdsq");
		return mapping.findForward("success");
	}

	private ActionForward auditing_xndxj(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {
		// 初始化页面，返回查询信息
		DAO dao = DAO.getInstance();
		XszzForm checkForm = (XszzForm) form;
		HttpSession session = request.getSession();
		List<Object> rs = new ArrayList<Object>();
		List<Object> rsExp = new ArrayList<Object>();
		String sqlExp = "";// sql语句
		String isQuery = request.getParameter("isQuery");
		if ((null == isQuery) || ("".equalsIgnoreCase(isQuery))) {
			isQuery = "no";
		}
		request.setAttribute("isQuery", isQuery);
		HashMap<String, String> map = new HashMap<String, String>();
		String[] colList = null;
		String[] colListCN = null;
		String sql = "";// sql语句
		StringBuffer querry = new StringBuffer(" where 1=1 ");// sql条件
		StringBuffer querry1 = new StringBuffer("");
		String tableName = "";// 查询信息源（多为视图名）
		String rsNum = "0";// 返回的记录数
		String realTable = "";// 数据源表
		String pk = "";// 数据源表主键（格式为“字段名||字段名||字段名”）
		String writeAble = "yes";// 写权限
		String userDep = session.getAttribute("userDep").toString();
		String userName = session.getAttribute("userName").toString();
		String userType = dao.getUserType(userDep);
		String xy = checkForm.getXydm();
		String xydm = request.getParameter("xydm");
		String xxdm = StandardOperation.getXxdm();
		String tips = "";
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);

		String xh = DealString.toGBK(checkForm.getXh());
		String xm = DealString.toGBK(checkForm.getXm());
		String shlb = checkForm.getShlb();
		if (xydm != null && xy == null) {
			xy = xydm;
		}
		if (userType.equalsIgnoreCase("xy")
				&& (xy == null || xy.trim().equals(""))) {
			xy = userDep;
		}
		String zy = checkForm.getZydm();
		String bj = checkForm.getBjdm();
		String nj = checkForm.getNj();
		realTable = "xsbzb";
		pk = "xh||bzdm||nd";
		tableName = "view_xsbzxx";
		String nd = checkForm.getNd();
//		if(!isQuery.equalsIgnoreCase("is")){
//			nd = Base.currNd;
//		} else {
//			nd = request.getParameter("nd");
//		}
		if (isNull(nd)) {
		} else {
			querry.append(" and nd = '");
			querry.append(nd);
			querry.append("' ");
		}
		if (isNull(xy)) {
		} else {
			querry.append(" and xydm = '");
			querry.append(xy);
			querry.append("' ");
		}
		if (isNull(zy)) {
		} else {
			querry.append(" and zydm = '");
			querry.append(zy);
			querry.append("' ");
		}
		if (isNull(bj)) {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				if (userBj.size() != 0) {
					querry.append(" and bjdm in ('###'");
					for (Iterator<String> it = userBj.iterator(); it.hasNext();) {
						querry.append(", '");
						querry.append(it.next());
						querry.append("'");
					}
					querry.append(" ) ");
				}
			}
		} else {
			querry.append(" and bjdm = '");
			querry.append(bj);
			querry.append("' ");
		}
		if(StringUtils.isNotNull(nj)){
			querry.append(" and nj = '");
			querry.append(nj);
			querry.append("' ");
		}
		if (isNull(xh)) {
		} else {
			querry.append(" and xh like '%");
			querry.append(xh);
			querry.append("%' ");
		}
		if (isNull(xm)) {
		} else {
			querry.append(" and xm like '%");
			querry.append(xm);
			querry.append("%' ");
		}
		if(StringUtils.isNotNull(shlb)){//审核类别
			if((xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY))){
				if("xx".equalsIgnoreCase(userType)){
					querry.append(" and xxsh = '");
					querry.append(shlb);
				}else if(userBj.size()>0){
					//辅导员审核
					querry.append(" and fdysh = '");
					querry.append(shlb);
				}else{
					querry.append(" and xysh = '");
					querry.append(shlb);
				}
			}else if("xx".equalsIgnoreCase(userType)){
				querry.append(" and xxsh = '");
				querry.append(shlb);
			}else{
				querry.append(" and xysh = '");
				querry.append(shlb);
			}			
			querry.append("' ");
		}
		querry1.append(" and BZDM='0000000005' ");
		querry.append(querry1.toString());
			tips = "当前所在位置：学生资助 - 审核 - 校内贷学金审核";
			if (isQuery.equalsIgnoreCase("is")) {
				tips = "当前所在位置：学生资助 - 申请 - 申请结果查询 - 校内贷学金";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "ND", "XN", "XH", "XM", 
							"BZMC","ZYNJ", "ZXJE", "JXJE", "zzdjmc", "zzdjje", "xyshrxm", "xysh", "xxsh", "sqsj" };
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "ND", "XN", "XH", "XM", 
							"BZMC","ZYNJ", "ZXJE", "JXJE", "fdysh", "xysh", "xxsh", "sqsj" };
				} else {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "ND", "XN", "XH", "XM", 
							"BZMC","ZYNJ", "ZXJE", "JXJE", "xysh", "xxsh", "sqsj" };
				}
				if (userType.equalsIgnoreCase("xx")) {
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ " a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString() + " order by xxsh desc) a";
					sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
						+ tableName
						+ " a"
						+ querry.toString() + " order by xxsh desc";
					request.setAttribute("isXX", "is");
				} else {
					checkForm.setXydm(userDep);
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by xxsh desc) a";
					sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xydm='"
						+ userDep
						+ "' order by xxsh desc";
					request.setAttribute("isXX", "no");
				}
			} else {
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "ND", "XN", "XH", "XM", 
								"BZMC","ZYNJ", "ZXJE", "JXJE", "zzdjmc", "zzdjje", "xyshrxm", ""  };
				} else {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "ND", "XN", "XH", "XM", 
								"BZMC","ZYNJ", "ZXJE", "JXJE", ""  };
				}
				if (userType.equalsIgnoreCase("xx")) {
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ " a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString() + " and xysh='通过' order by xxsh desc) a";
					sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
						+ tableName
						+ " a"
						+ querry.toString() + " and xysh='通过' order by xxsh desc";
					colList[colList.length - 1] = "xxsh";
					request.setAttribute("isXX", "is");
				} else {
					checkForm.setXydm(userDep);
					if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
						if (userBj.size() == 0) {
							sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
								+ "a.* from(select "
								+ pk
								+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' and fdysh='通过' order by xysh desc) a";
							sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' and fdysh='通过' order by xysh desc";
							colList[colList.length - 1] = "xysh";
						}else{
							sql = "select (case when nvl(a.fdysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
								+ "a.* from(select "
								+ pk
								+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' order by fdysh desc) a";
							sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' order by fdysh desc";
							colList[colList.length - 1] = "fdysh";
						}
					} else {
						sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
								+ "a.* from(select "
								+ pk
								+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep
								+ "' order by xysh desc) a";
						sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by xysh desc";
					}
					colList[colList.length - 1] = "xysh";
				}
				request.setAttribute("isXX", "no");
			}
		colListCN = dao.getColumnNameCN(colList, tableName);
		List topTr = dao.arrayToList(colList, colListCN);
		String colListS = "xh##OneSpile##xm##OneSpile##xb##OneSpile##mzmc##OneSpile##zynj##OneSpile##qsh##OneSpile##qsdh##OneSpile##sfzh##OneSpile##nj##OneSpile##lxdzxx##OneSpile##lxdh##OneSpile##sjhm##OneSpile##bz##OneSpile##bzdm##OneSpile##bzmc##OneSpile##xn##OneSpile##nd##OneSpile##bysj##OneSpile##jtdz##OneSpile##yzbm##OneSpile##jtcy1_xm##OneSpile##jtcy1_gx##OneSpile##jtcy1_gzdw##OneSpile##jtcy1_ysr##OneSpile##jtcy1_nl##OneSpile##jtcy2_xm##OneSpile##jtcy2_gx##OneSpile##jtcy2_gzdw##OneSpile##jtcy2_ysr##OneSpile##jtcy2_nl##OneSpile##jtcy3_xm##OneSpile##jtcy3_gx##OneSpile##jtcy3_gzdw##OneSpile##jtcy3_ysr##OneSpile##jtcy3_nl##OneSpile##jtcy4_xm##OneSpile##jtcy4_gx##OneSpile##jtcy4_gzdw##OneSpile##jtcy4_ysr##OneSpile##jtcy4_nl##OneSpile##jtcy5_xm##OneSpile##jtcy5_gx##OneSpile##jtcy5_gzdw##OneSpile##jtcy5_ysr##OneSpile##jtcy5_nl##OneSpile##jttgje##OneSpile##zxje##OneSpile##jxje##OneSpile##qgzxje##OneSpile##xnwxdkje##OneSpile##qtsrje##OneSpile##zxdkje##OneSpile##zxdksj##OneSpile##yffzxdkje##OneSpile##yffzxdksj##OneSpile##sqzzly##OneSpile##zzff1##OneSpile##zzff1qsje##OneSpile##zzff1jsje##OneSpile##csny##OneSpile##jg##OneSpile##jcqk##OneSpile##zzmm##OneSpile##drshgzqk##OneSpile##brcn##OneSpile##xyshyj##OneSpile##xxshyj##OneSpile##xz##OneSpile##xxsh##OneSpile##xysh##OneSpile##sqsj##OneSpile##xydm##OneSpile##zydm##OneSpile##bjdm##OneSpile##xymc##OneSpile##zymc##OneSpile##bjmc##OneSpile##zzdjdm##OneSpile##zzdjmc##OneSpile##zzdjje##OneSpile##xyshryhm##OneSpile##xyshrxm##OneSpile##xyzzfzryj##OneSpile##fdysh##OneSpile##fdyshyj";
		StringBuffer rsExpString = new StringBuffer("");
		if ((request.getParameter("go") != null)
				&& request.getParameter("go").equalsIgnoreCase("go")) {
			rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
			rsExp.addAll(dao.rsToVator(sqlExp, new String[] {}, new String[]{"col"}));
			for(Iterator<Object> it = rsExp.iterator(); it.hasNext();){
				String[] isT = (String[])it.next();
				rsExpString.append(isT[0]);
				rsExpString.append("##TwoSpile##");
			}
		}
		request.setAttribute("colListS", colListS);
		request.setAttribute("rsExpString", rsExpString.toString());

		map.put("xydm", xy);
		map.put("zydm", zy);
		map.put("bjdm", bj);
		map.put("nd", nd);
		map.put("xh", xh);
		map.put("xm", xm);
		xy = xy==null ? "":xy;
		zy = zy==null ? "":zy;
		String bjKey = xy+"!!"+zy+"!!";
		request.setAttribute("tips", tips);
		request.setAttribute("rs1", map);// 发送读写权限
		request.setAttribute("writeAble", writeAble);// 发送读写权限
		request.setAttribute("tableName", tableName);// 发送视图名
		request.setAttribute("realTable", realTable);// 发送数据源表名
		request.setAttribute("pk", pk);// 发送数据源表主键
		request.setAttribute("njList", Base.getNjList());// 发送年级列表
		request.setAttribute("ndList", Base.getXnndList());// 发送学年列表
		request.setAttribute("xyList", Base.getXyList());// 发送学院列表
		request.setAttribute("zyList", Base.getZyMap().get(xy));// 发送专业列表
		request.setAttribute("bjList", Base.getBjMap().get(bjKey));// 发送班级列表
		request.setAttribute("act", "xsbzb");
		request.setAttribute("rs", rs);// 发送数据集
		request.setAttribute("topTr", topTr);// 发送表头
		request.setAttribute("rsNum", rsNum);// 发送记录数
		request.setAttribute("userType", userType);// 发送记录数
		request.setAttribute("chkList", dao.getChkList(3));
		return mapping.findForward("success");
	}

	private ActionForward auditing_xndxj_one(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		DAO dao = DAO.getInstance();
		String actDo = request.getParameter("actDo");
		String pkVal = request.getParameter("pkVal");
		String realTable = "";
		HashMap<String, String> hs = new HashMap<String, String>();
		HttpSession session = request.getSession();
		String pk = "";
		String sql = "";
		String[] colList = new String[] {};
		String userType = dao.getUserType(session.getAttribute("userDep")
				.toString());
		String xxdm = StandardOperation.getXxdm();
		String sUName;
		String logMsg;
		sUName = session.getAttribute("userName").toString();
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));
		String fdyshyj = DealString.toGBK(request.getParameter("fdyshyj"));
		String zzdjdm = DealString.toGBK(request.getParameter("zzdjdm"));
		String xyzzfzryj = DealString.toGBK(request.getParameter("xyzzfzryj"));

		String userName = session.getAttribute("userName").toString();
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);
		List xszzDjList = dao.getXszzDjList();
		request.setAttribute("xszzDjList", xszzDjList);

		boolean ok = false;
		if ("del".equalsIgnoreCase(actDo)) {
			String pkDel = request.getParameter("pkDel");
			String[] pkDelT = pkDel.split("!!splitOne!!");
			String[] sqlT = new String[pkDelT.length];
			for (int i = 1; i < pkDelT.length; i++) {
				String pkT = pkDelT[i];
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)){
						if (userBj.size() == 0) {
							sqlT[i] = "delete xsbzb where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
						} else {
							sqlT[i] = "delete xsbzb where xh||bzdm||nd='"+pkT+"' and xysh<>'通过'";
						}
					} else {
						sqlT[i] = "delete xsbzb where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
					}
				} else {
					sqlT[i] = "delete xsbzb where xh||bzdm||nd='"+pkT+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/auditing_xndxj.do?go=go", false);
			return newFwd;
		}
		
		if ("plsh".equalsIgnoreCase(actDo)) {
			String pkDel = request.getParameter("pkDel");
			String[] pkDelT = pkDel.split("!!splitOne!!");
			String jg = request.getParameter("jg");
			if ("tg".equalsIgnoreCase(jg)){
				jg = "通过";
			} else if ("btg".equalsIgnoreCase(jg)){
				jg = "不通过";
			} else {
				jg = "未审核";
			}
			String[] sqlT = new String[pkDelT.length];
			for (int i = 1; i < pkDelT.length; i++) {
				String pkT = pkDelT[i];
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)){
						if (userBj.size() == 0) {
							sqlT[i] = "update xsbzb set xysh='"+jg+"' where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
						} else {
							sqlT[i] = "update xsbzb set fdysh='"+jg+"' where xh||bzdm||nd='"+pkT+"' and xysh<>'通过'";
						}
					} else {
						sqlT[i] = "update xsbzb set xysh='"+jg+"' where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
					}
				} else {
					sqlT[i] = "update xsbzb set xxsh='"+jg+"' where xh||bzdm||nd='"+pkT+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/auditing_xndxj.do?go=go", false);
			return newFwd;
		}

		if (actDo.equalsIgnoreCase("save")) {
			String yesNo = DealString.toGBK(request.getParameter("yesNo"));
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					ok = StandardOperation
							.update("xsbzb",
									new String[] { "xysh", "xyshyj", "zzdjdm",
											"xyshryhm", "xyzzfzryj" },
									new String[] { yesNo, xyshyj, zzdjdm,
											userName, xyzzfzryj },
									"xh||bzdm||nd", pkVal, request);
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					if (userBj.size() == 0) {
						ok = StandardOperation.update("xsbzb", new String[] {
								"xysh", "xyshyj" }, new String[] { yesNo,
								xyshyj }, "xh||bzdm||nd", pkVal, request);
					} else {
						if ("未审核".equalsIgnoreCase(yesNo) || "不通过".equalsIgnoreCase(yesNo)){
							ok = StandardOperation.update("xsbzb",
									new String[] { "fdysh", "fdyshyj", "xysh" },
									new String[] { yesNo, fdyshyj, "未审核" },
									"xh||bzdm||nd", pkVal, request);
						} else {
							ok = StandardOperation.update("xsbzb",
									new String[] { "fdysh", "fdyshyj" },
									new String[] { yesNo, fdyshyj },
									"xh||bzdm||nd", pkVal, request);
						}
					}
				} else {
					ok = StandardOperation.update("xsbzb", new String[] {
							"xysh", "xyshyj" }, new String[] { yesNo, xyshyj },
							"xh||bzdm||nd", pkVal, request);
				}
			} else {
				ok = StandardOperation.update("xsbzb", new String[] {
						"xxsh", "xxshyj" }, new String[] { yesNo, xxshyj },
						"xh||bzdm||nd", pkVal, request);
			}
			if (ok) {
				logMsg = "修改(审核) xsbzb";
				Base.log(request, logMsg, sUName);
			}
		}
		realTable = "xsbzb";
		pk = "xh||bzdm||nd";
		if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				if (userBj.size() == 0) {
					sql = "select "
						+ pk
						+ " pk,yffzxdksj,sqzzly,zzff1,zzff1qsje,zzff1jsje,xxsh,xysh,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,"
						+ "jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,xyshyj,xxshyj,zzdjdm,zzdjmc,zzdjje,"
						+ "xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,XYSH yesNo from view_xsbzxx where "
						+ pk + "='" + pkVal + "'";
				} else {
					sql = "select "
						+ pk
						+ " pk,yffzxdksj,sqzzly,zzff1,zzff1qsje,zzff1jsje,xxsh,xysh,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,"
						+ "jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,xyshyj,xxshyj,zzdjdm,zzdjmc,zzdjje,"
						+ "xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,fdysh yesNo from view_xsbzxx where "
						+ pk + "='" + pkVal + "'";
				}
			} else {
				sql = "select "
					+ pk
					+ " pk,yffzxdksj,sqzzly,zzff1,zzff1qsje,zzff1jsje,xxsh,xysh,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,"
					+ "jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,xyshyj,xxshyj,zzdjdm,zzdjmc,zzdjje,"
					+ "xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,XYSH yesNo from view_xsbzxx where "
					+ pk + "='" + pkVal + "'";
			}
			request.setAttribute("isXX", "no");
		} else {
			sql = "select "
				+ pk
				+ " pk,yffzxdksj,sqzzly,zzff1,zzff1qsje,zzff1jsje,xxsh,xysh,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,"
				+ "jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,xyshyj,xxshyj,zzdjdm,zzdjmc,zzdjje,"
				+ "xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,XYSH yesNo from view_xsbzxx where "
				+ pk + "='" + pkVal + "'";
			request.setAttribute("isXX", "is");
		}
		colList = new String[] { "pk", "yffzxdksj", "sqzzly",
				"zzff1", "zzff1qsje", "zzff1jsje", "xxsh", "xysh",
				"xh", "xm", "xb", "nj", "qsh", "qsdh", "lxdzxx",
				"lxdh", "sjhm", "bz", "bzdm", "bzmc", "xn", "nd",
				"mzmc", "bysj", "zynj", "jtdz", "yzbm", "sfzh",
				"jtcy1_xm", "jtcy1_gx", "jtcy1_gzdw", "jtcy1_ysr",
				"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw", "jtcy2_ysr",
				"jtcy3_xm", "jtcy3_gx", "jtcy3_gzdw", "jtcy3_ysr",
				"jtcy4_xm", "jtcy4_gx", "jtcy4_gzdw", "jtcy4_ysr",
				"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw", "jtcy5_ysr",
				"jttgje", "zxje", "jxje", "qgzxje", "xnwxdkje",
				"qtsrje", "zxdkje", "zxdksj", "yffzxdkje",
				"xyshyj", "xxshyj", "zzdjdm", "zzdjmc", "zzdjje",
				"xyshryhm", "xyshrxm", "xyzzfzryj", "fdyshyj", "xxsh", "yesNo" };

		String[] rs = dao.getOneRs(sql, new String[] {}, colList);
		if (rs == null) {
			rs = new String[colList.length];
		}
		for (int i = 0; i < colList.length; i++) {
			rs[i] = ((rs[i] == null) || rs[i].equalsIgnoreCase("")) ? " "
					: rs[i];
			hs.put(colList[i], rs[i]);
		}

		if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
			request.setAttribute("isZZSF", "is");
		} else {
			request.setAttribute("isZZSF", "no");
		}
		if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
			request.setAttribute("isXNMZ", "is");
		} else {
			request.setAttribute("isXNMZ", "no");
		}

		hs.put("zzdjdm", zzdjdm);
		request.setAttribute("rs", hs);
		request.setAttribute("userType", userType);
		request.setAttribute("chkList", dao.getChkList(3));
		request.setAttribute("pk", pkVal);
		request.setAttribute("tName", realTable);
		request.setAttribute("act", "xsbzb");
		return mapping.findForward("success");
	}
	
	private ActionForward auditing_xfbz(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {
		// 初始化页面，返回查询信息
		XszzForm checkForm = (XszzForm) form;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		List<Object> rs = new ArrayList<Object>();
		List<Object> rsExp = new ArrayList<Object>();
		String sqlExp = "";// sql语句
		String isQuery = request.getParameter("isQuery");
		if ((null == isQuery) || ("".equalsIgnoreCase(isQuery))) {
			isQuery = "no";
		}
		request.setAttribute("isQuery", isQuery);
		HashMap<String, String> map = new HashMap<String, String>();
		String[] colList = null;
		String[] colListCN = null;
		String sql = "";// sql语句
		StringBuffer querry = new StringBuffer(" where 1=1 ");// sql条件
		StringBuffer querry1 = new StringBuffer("");
		String tableName = "";// 查询信息源（多为视图名）
		String rsNum = "0";// 返回的记录数
		String realTable = "";// 数据源表
		String pk = "";// 数据源表主键（格式为“字段名||字段名||字段名”）
		String writeAble = "yes";// 写权限
		String userDep = session.getAttribute("userDep").toString();
		String userName = session.getAttribute("userName").toString();
		String userType = dao.getUserType(userDep);
		String xy = checkForm.getXydm();
		String xydm = request.getParameter("xydm");
		String xxdm = StandardOperation.getXxdm();
		
		String tips = "";
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);

		String xh = DealString.toGBK(checkForm.getXh());
		if (xydm != null && xy == null) {
			xy = xydm;
		}
		if (userType.equalsIgnoreCase("xy")
				&& (xy == null || xy.trim().equals(""))) {
			xy = userDep;
		}
		String zy = checkForm.getZydm();
		String bj = checkForm.getBjdm();
		String nj = DealString.toGBK(request.getParameter("nj"));
		
		String xm = DealString.toGBK(request.getParameter("xm"));
		String xb = DealString.toGBK(request.getParameter("xb"));
		String sfzh = DealString.toGBK(request.getParameter("sfzh"));
		String xxsh = DealString.toGBK(request.getParameter("xxsh"));
		String xysh = DealString.toGBK(request.getParameter("xysh"));
		
		realTable = "xsbzb";
		pk = "xh||bzdm||nd";
		tableName = "view_xsbzxx";
		String nd = "";
		if(!isQuery.equalsIgnoreCase("is")){
			nd = Base.currNd;
		} else {
			nd = request.getParameter("nd");
		}
		if (isNull(nd)) {
		} else {
			querry.append(" and nd='");
			querry.append(nd);
			querry.append("' ");
		}
		if (isNull(xy)) {
		} else {
			querry.append(" and xydm='");
			querry.append(xy);
			querry.append("' ");
		}
		if (isNull(zy)) {
		} else {
			querry.append(" and zydm='");
			querry.append(zy);
			querry.append("' ");
		}
		if (isNull(bj)) {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				if (userBj.size() != 0) {
					querry.append(" and bjdm in ('###'");
					for (Iterator<String> it = userBj.iterator(); it.hasNext();) {
						querry.append(", '");
						querry.append(it.next());
						querry.append("'");
					}
					querry.append(" ) ");
				}
			}
		} else {
			querry.append(" and bjdm='");
			querry.append(bj);
			querry.append("' ");
		}
		if (isNull(xh)) {
		} else {
			querry.append(" and xh like '%");
			querry.append(xh);
			querry.append("%' ");
		}
		if (isNull(nj)) {
		} else {
			querry.append(" and nj='");
			querry.append(nj);
			querry.append("' ");
		}
		if (isNull(xm)) {
		} else {
			querry.append(" and xm like '%");
			querry.append(xm);
			querry.append("%' ");
		}
		if (isNull(xb)) {
		} else {
			querry.append(" and xb='");
			querry.append(xb);
			querry.append("' ");
		}
		if (isNull(sfzh)) {
		} else {
			querry.append(" and sfzh='");
			querry.append(sfzh);
			querry.append("' ");
		}
		if (isNull(xxsh)) {
		} else {
			querry.append(" and xxsh='");
			querry.append(xxsh);
			querry.append("' ");
		}
		if (isNull(xysh)) {
		} else {
			querry.append(" and xysh='");
			querry.append(xysh);
			querry.append("' ");
		}
		querry1.append(" and BZDM='0000000001' ");
		querry.append(querry1.toString());
			tips = "当前所在位置：学生资助 - 审核 - 学费补助审核";
			if (isQuery.equalsIgnoreCase("is")) {
				tips = "当前所在位置：学生资助 - 申请 - 申请结果查询 - 学费补助";
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "ND", "XN", "XH", "XM", 
							"BZMC","ZYNJ", "ZXJE", "JXJE", "zzdjmc", "zzdjje", "xyshrxm", "xysh", "xxsh", "sqsj" };
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "ND", "XN", "XH", "XM", 
							"BZMC","ZYNJ", "ZXJE", "JXJE", "fdysh", "xysh", "xxsh", "sqsj" };
				} else {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "ND", "XN", "XH", "XM", 
							"BZMC","ZYNJ", "ZXJE", "JXJE", "xysh", "xxsh", "sqsj" };
				}
				if (userType.equalsIgnoreCase("xx")) {
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ " a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString() + " order by xxsh desc) a";
					sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
						+ tableName
						+ " a"
						+ querry.toString() + " order by xxsh desc";
					request.setAttribute("isXX", "is");
				} else {
					checkForm.setXydm(userDep);
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ "a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by xxsh desc) a";
					sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
						+ tableName
						+ " a"
						+ querry.toString()
						+ " and xydm='"
						+ userDep
						+ "' order by xxsh desc";
					request.setAttribute("isXX", "no");
				}
			} else {
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "ND", "XN", "XH", "XM", 
								"BZMC","ZYNJ", "ZXJE", "JXJE", "zzdjmc", "zzdjje", "xyshrxm", ""  };
				} else {
					colList = new String[] { "bgcolor", "主键", "pk2", "pk3", "ND", "XN", "XH", "XM", 
								"BZMC","ZYNJ", "ZXJE", "JXJE", ""  };
				}
				if (userType.equalsIgnoreCase("xx")) {
					sql = "select (case when nvl(a.xxsh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
							+ " a.* from(select "
							+ pk
							+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
							+ tableName
							+ " a"
							+ querry.toString() + " and xysh='通过' order by xxsh desc) a";
					sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
						+ tableName
						+ " a"
						+ querry.toString() + " and xysh='通过' order by xxsh desc";
					colList[colList.length - 1] = "xxsh";
					request.setAttribute("isXX", "is");
				} else {
					checkForm.setXydm(userDep);
					if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
						if (userBj.size() == 0) {
							sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
								+ "a.* from(select "
								+ pk
								+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' and fdysh='通过' order by xysh desc) a";
							sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' and fdysh='通过' order by xysh desc";
							colList[colList.length - 1] = "xysh";
						}else{
							sql = "select (case when nvl(a.fdysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
								+ "a.* from(select "
								+ pk
								+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' order by fdysh desc) a";
							sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep + "' order by fdysh desc";
							colList[colList.length - 1] = "fdysh";
						}
					} else {
						sql = "select (case when nvl(a.xysh,'未审核')='通过' then '#FFFFFF' else '#CCCCCC' end) bgcolor,"
								+ "a.* from(select "
								+ pk
								+ " 主键,a.xh pk2,a.bzdm pk3,a.* from "
								+ tableName
								+ " a"
								+ querry.toString()
								+ " and xydm='"
								+ userDep
								+ "' order by xysh desc) a";
						sqlExp = "select a.xh||'##OneSpile##'||a.xm||'##OneSpile##'||a.xb||'##OneSpile##'||a.mzmc||'##OneSpile##'||a.zynj||'##OneSpile##'||a.qsh||'##OneSpile##'||a.qsdh||'##OneSpile##'||a.sfzh||'##OneSpile##'||a.nj||'##OneSpile##'||a.lxdzxx||'##OneSpile##'||a.lxdh||'##OneSpile##'||a.sjhm||'##OneSpile##'||a.bz||'##OneSpile##'||a.bzdm||'##OneSpile##'||a.bzmc||'##OneSpile##'||a.xn||'##OneSpile##'||a.nd||'##OneSpile##'||a.bysj||'##OneSpile##'||a.jtdz||'##OneSpile##'||a.yzbm||'##OneSpile##'||a.jtcy1_xm||'##OneSpile##'||a.jtcy1_gx||'##OneSpile##'||a.jtcy1_gzdw||'##OneSpile##'||a.jtcy1_ysr||'##OneSpile##'||a.jtcy1_nl||'##OneSpile##'||a.jtcy2_xm||'##OneSpile##'||a.jtcy2_gx||'##OneSpile##'||a.jtcy2_gzdw||'##OneSpile##'||a.jtcy2_ysr||'##OneSpile##'||a.jtcy2_nl||'##OneSpile##'||a.jtcy3_xm||'##OneSpile##'||a.jtcy3_gx||'##OneSpile##'||a.jtcy3_gzdw||'##OneSpile##'||a.jtcy3_ysr||'##OneSpile##'||a.jtcy3_nl||'##OneSpile##'||a.jtcy4_xm||'##OneSpile##'||a.jtcy4_gx||'##OneSpile##'||a.jtcy4_gzdw||'##OneSpile##'||a.jtcy4_ysr||'##OneSpile##'||a.jtcy4_nl||'##OneSpile##'||a.jtcy5_xm||'##OneSpile##'||a.jtcy5_gx||'##OneSpile##'||a.jtcy5_gzdw||'##OneSpile##'||a.jtcy5_ysr||'##OneSpile##'||a.jtcy5_nl||'##OneSpile##'||a.jttgje||'##OneSpile##'||a.zxje||'##OneSpile##'||a.jxje||'##OneSpile##'||a.qgzxje||'##OneSpile##'||a.xnwxdkje||'##OneSpile##'||a.qtsrje||'##OneSpile##'||a.zxdkje||'##OneSpile##'||a.zxdksj||'##OneSpile##'||a.yffzxdkje||'##OneSpile##'||a.yffzxdksj||'##OneSpile##'||a.sqzzly||'##OneSpile##'||a.zzff1||'##OneSpile##'||a.zzff1qsje||'##OneSpile##'||a.zzff1jsje||'##OneSpile##'||a.csny||'##OneSpile##'||a.jg||'##OneSpile##'||a.jcqk||'##OneSpile##'||a.zzmm||'##OneSpile##'||a.drshgzqk||'##OneSpile##'||a.brcn||'##OneSpile##'||a.xyshyj||'##OneSpile##'||a.xxshyj||'##OneSpile##'||a.xz||'##OneSpile##'||a.xxsh||'##OneSpile##'||a.xysh||'##OneSpile##'||a.sqsj||'##OneSpile##'||a.xydm||'##OneSpile##'||a.zydm||'##OneSpile##'||a.bjdm||'##OneSpile##'||a.xymc||'##OneSpile##'||a.zymc||'##OneSpile##'||a.bjmc||'##OneSpile##'||a.zzdjdm||'##OneSpile##'||a.zzdjmc||'##OneSpile##'||a.zzdjje||'##OneSpile##'||a.xyshryhm||'##OneSpile##'||a.xyshrxm||'##OneSpile##'||a.xyzzfzryj||'##OneSpile##'||a.fdysh||'##OneSpile##'||a.fdyshyj col from "
							+ tableName
							+ " a"
							+ querry.toString()
							+ " and xydm='"
							+ userDep
							+ "' order by xysh desc";
					}
					colList[colList.length - 1] = "xysh";
				}
				request.setAttribute("isXX", "no");
			}
		colListCN = dao.getColumnNameCN(colList, tableName);
		List topTr = dao.arrayToList(colList, colListCN);
		String colListS = "xh##OneSpile##xm##OneSpile##xb##OneSpile##mzmc##OneSpile##zynj##OneSpile##qsh##OneSpile##qsdh##OneSpile##sfzh##OneSpile##nj##OneSpile##lxdzxx##OneSpile##lxdh##OneSpile##sjhm##OneSpile##bz##OneSpile##bzdm##OneSpile##bzmc##OneSpile##xn##OneSpile##nd##OneSpile##bysj##OneSpile##jtdz##OneSpile##yzbm##OneSpile##jtcy1_xm##OneSpile##jtcy1_gx##OneSpile##jtcy1_gzdw##OneSpile##jtcy1_ysr##OneSpile##jtcy1_nl##OneSpile##jtcy2_xm##OneSpile##jtcy2_gx##OneSpile##jtcy2_gzdw##OneSpile##jtcy2_ysr##OneSpile##jtcy2_nl##OneSpile##jtcy3_xm##OneSpile##jtcy3_gx##OneSpile##jtcy3_gzdw##OneSpile##jtcy3_ysr##OneSpile##jtcy3_nl##OneSpile##jtcy4_xm##OneSpile##jtcy4_gx##OneSpile##jtcy4_gzdw##OneSpile##jtcy4_ysr##OneSpile##jtcy4_nl##OneSpile##jtcy5_xm##OneSpile##jtcy5_gx##OneSpile##jtcy5_gzdw##OneSpile##jtcy5_ysr##OneSpile##jtcy5_nl##OneSpile##jttgje##OneSpile##zxje##OneSpile##jxje##OneSpile##qgzxje##OneSpile##xnwxdkje##OneSpile##qtsrje##OneSpile##zxdkje##OneSpile##zxdksj##OneSpile##yffzxdkje##OneSpile##yffzxdksj##OneSpile##sqzzly##OneSpile##zzff1##OneSpile##zzff1qsje##OneSpile##zzff1jsje##OneSpile##csny##OneSpile##jg##OneSpile##jcqk##OneSpile##zzmm##OneSpile##drshgzqk##OneSpile##brcn##OneSpile##xyshyj##OneSpile##xxshyj##OneSpile##xz##OneSpile##xxsh##OneSpile##xysh##OneSpile##sqsj##OneSpile##xydm##OneSpile##zydm##OneSpile##bjdm##OneSpile##xymc##OneSpile##zymc##OneSpile##bjmc##OneSpile##zzdjdm##OneSpile##zzdjmc##OneSpile##zzdjje##OneSpile##xyshryhm##OneSpile##xyshrxm##OneSpile##xyzzfzryj##OneSpile##fdysh##OneSpile##fdyshyj";
		StringBuffer rsExpString = new StringBuffer("");
		if ((request.getParameter("go") != null)
				&& request.getParameter("go").equalsIgnoreCase("go")) {
			rs.addAll(dao.rsToVator(sql, new String[] {}, colList));
			if (rs == null) {
				rsNum = "0";
			} else {
				rsNum = String.valueOf(rs.size());
			}
			rsExp.addAll(dao.rsToVator(sqlExp, new String[] {}, new String[]{"col"}));
			for(Iterator<Object> it = rsExp.iterator(); it.hasNext();){
				String[] isT = (String[])it.next();
				rsExpString.append(isT[0]);
				rsExpString.append("##TwoSpile##");
			}
		}
		request.setAttribute("colListS", colListS);
		request.setAttribute("rsExpString", rsExpString.toString());

		map.put("xm", xm);
		map.put("xb", xb);
		map.put("sfzh", sfzh);
		map.put("xxsh", xxsh);
		map.put("nj", nj);
		map.put("xh", xh);
		map.put("xysh", xysh);
		map.put("xydm", xy);
		map.put("zydm", zy);
		map.put("bjdm", bj);
		map.put("nd", nd);
		xy = xy==null ? "":xy;
		zy = zy==null ? "":zy;
		nj = nj==null ? "":nj;
		String bjKey = xy+"!!"+zy+"!!"+nj;
		request.setAttribute("tips", tips);
		request.setAttribute("rs1", map);// 发送读写权限
		request.setAttribute("writeAble", writeAble);// 发送读写权限
		request.setAttribute("tableName", tableName);// 发送视图名
		request.setAttribute("realTable", realTable);// 发送数据源表名
		request.setAttribute("pk", pk);// 发送数据源表主键
		request.setAttribute("njList", Base.getNjList());// 发送年级列表
		request.setAttribute("ndList", Base.getXnndList());// 发送学年列表
		request.setAttribute("xyList", Base.getXyList());// 发送学院列表
		request.setAttribute("zyList", Base.getZyMap().get(xy));// 发送专业列表
		request.setAttribute("bjList", Base.getBjMap().get(bjKey));// 发送班级列表
		request.setAttribute("act", "xsbzb");
		request.setAttribute("rs", rs);// 发送数据集
		request.setAttribute("topTr", topTr);// 发送表头
		request.setAttribute("rsNum", rsNum);// 发送记录数
		request.setAttribute("userType", userType);// 发送记录数
		return mapping.findForward("success");
	}

	private ActionForward auditing_xfbz_one(ActionMapping mapping,
			ActionForm form, HttpServletRequest request,
			HttpServletResponse response) throws Exception {
		DAO dao = DAO.getInstance();
		String actDo = request.getParameter("actDo");
		String pkVal = request.getParameter("pkVal");
		String realTable = "";
		HashMap<String, String> hs = new HashMap<String, String>();
		HttpSession session = request.getSession();
		String pk = "";
		String sql = "";
		String[] colList = new String[] {};
		String userType = dao.getUserType(session.getAttribute("userDep")
				.toString());
		String xxdm = StandardOperation.getXxdm();
		String sUName;
		String logMsg;
		sUName = session.getAttribute("userName").toString();
		String xyshyj = DealString.toGBK(request.getParameter("xyshyj"));
		String xxshyj = DealString.toGBK(request.getParameter("xxshyj"));
		String fdyshyj = DealString.toGBK(request.getParameter("fdyshyj"));
		String zzdjdm = DealString.toGBK(request.getParameter("zzdjdm"));
		String xyzzfzryj = DealString.toGBK(request.getParameter("xyzzfzryj"));

		String userName = session.getAttribute("userName").toString();
		ArrayList<String> userBj = new ArrayList<String>();
		userBj = dao.getUserBj(userName);
		List xszzDjList = dao.getXszzDjList();
		request.setAttribute("xszzDjList", xszzDjList);

		boolean ok = false;
		if ("del".equalsIgnoreCase(actDo)) {
			String pkDel = request.getParameter("pkDel");
			String[] pkDelT = pkDel.split("!!splitOne!!");
			String[] sqlT = new String[pkDelT.length];
			for (int i = 1; i < pkDelT.length; i++) {
				String pkT = pkDelT[i];
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)){
						if (userBj.size() == 0) {
							sqlT[i] = "delete xsbzb where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
						} else {
							sqlT[i] = "delete xsbzb where xh||bzdm||nd='"+pkT+"' and xysh<>'通过'";
						}
					} else {
						sqlT[i] = "delete xsbzb where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
					}
				} else {
					sqlT[i] = "delete xsbzb where xh||bzdm||nd='"+pkT+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/auditing_xndxj.do?go=go", false);
			return newFwd;
		}
		
		if ("plsh".equalsIgnoreCase(actDo)) {
			String pkDel = request.getParameter("pkDel");
			String[] pkDelT = pkDel.split("!!splitOne!!");
			String jg = request.getParameter("jg");
			if ("tg".equalsIgnoreCase(jg)){
				jg = "通过";
			} else if ("btg".equalsIgnoreCase(jg)){
				jg = "不通过";
			} else {
				jg = "未审核";
			}
			String[] sqlT = new String[pkDelT.length];
			for (int i = 1; i < pkDelT.length; i++) {
				String pkT = pkDelT[i];
				if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
					if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)){
						if (userBj.size() == 0) {
							sqlT[i] = "update xsbzb set xysh='"+jg+"' where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
						} else {
							sqlT[i] = "update xsbzb set fdysh='"+jg+"' where xh||bzdm||nd='"+pkT+"' and xysh<>'通过'";
						}
					} else {
						sqlT[i] = "update xsbzb set xysh='"+jg+"' where xh||bzdm||nd='"+pkT+"' and xxsh<>'通过'";
					}
				} else {
					sqlT[i] = "update xsbzb set xxsh='"+jg+"' where xh||bzdm||nd='"+pkT+"'";
				}
			}
			dao.runBatch(sqlT);
			ActionForward newFwd = new ActionForward(
					"/auditing_xfbz.do?go=go", false);
			return newFwd;
		}

		if (actDo.equalsIgnoreCase("save")) {
			String yesNo = DealString.toGBK(request.getParameter("yesNo"));
			if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
				if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
					ok = StandardOperation
							.update("xsbzb",
									new String[] { "xysh", "xyshyj", "zzdjdm",
											"xyshryhm", "xyzzfzryj" },
									new String[] { yesNo, xyshyj, zzdjdm,
											userName, xyzzfzryj },
									"xh||bzdm||nd", pkVal, request);
				} else if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
					if (userBj.size() == 0) {
						ok = StandardOperation.update("xsbzb", new String[] {
								"xysh", "xyshyj" }, new String[] { yesNo,
								xyshyj }, "xh||bzdm||nd", pkVal, request);
					} else {
						if ("未审核".equalsIgnoreCase(yesNo) || "不通过".equalsIgnoreCase(yesNo)){
							ok = StandardOperation.update("xsbzb",
									new String[] { "fdysh", "fdyshyj", "xysh" },
									new String[] { yesNo, fdyshyj, "未审核" },
									"xh||bzdm||nd", pkVal, request);
						} else {
							ok = StandardOperation.update("xsbzb",
									new String[] { "fdysh", "fdyshyj" },
									new String[] { yesNo, fdyshyj },
									"xh||bzdm||nd", pkVal, request);
						}
					}
				} else {
					ok = StandardOperation.update("xsbzb", new String[] {
							"xysh", "xyshyj" }, new String[] { yesNo, xyshyj },
							"xh||bzdm||nd", pkVal, request);
				}
			} else {
				ok = StandardOperation.update("xsbzb", new String[] {
						"xxsh", "xxshyj" }, new String[] { yesNo, xxshyj },
						"xh||bzdm||nd", pkVal, request);
			}
			if (ok) {
				logMsg = "修改(审核) xsbzb";
				Base.log(request, logMsg, sUName);
			}
		}
		realTable = "xsbzb";
		pk = "xh||bzdm||nd";
		if ((userType == null) || !userType.equalsIgnoreCase("xx")) {
			if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
				if (userBj.size() == 0) {
					sql = "select "
						+ pk
						+ " pk,yffzxdksj,sqzzly,zzff1,zzff1qsje,zzff1jsje,xxsh,xysh,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,"
						+ "jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,xyshyj,xxshyj,zzdjdm,zzdjmc,zzdjje,"
						+ "xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,XYSH yesNo from view_xsbzxx where "
						+ pk + "='" + pkVal + "'";
				} else {
					sql = "select "
						+ pk
						+ " pk,yffzxdksj,sqzzly,zzff1,zzff1qsje,zzff1jsje,xxsh,xysh,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,"
						+ "jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,xyshyj,xxshyj,zzdjdm,zzdjmc,zzdjje,"
						+ "xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,fdysh yesNo from view_xsbzxx where "
						+ pk + "='" + pkVal + "'";
				}
			} else {
				sql = "select "
					+ pk
					+ " pk,yffzxdksj,sqzzly,zzff1,zzff1qsje,zzff1jsje,xxsh,xysh,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,"
					+ "jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,xyshyj,xxshyj,zzdjdm,zzdjmc,zzdjje,"
					+ "xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,XYSH yesNo from view_xsbzxx where "
					+ pk + "='" + pkVal + "'";
			}
			request.setAttribute("isXX", "no");
		} else {
			sql = "select "
				+ pk
				+ " pk,yffzxdksj,sqzzly,zzff1,zzff1qsje,zzff1jsje,xxsh,xysh,xh,xm,xb,nj,qsh,qsdh,lxdzxx,lxdh,sjhm,bz,bzdm,bzmc,xn,nd,mzmc,bysj,zynj,jtdz,yzbm,sfzh,jtcy1_xm,jtcy1_gx,jtcy1_gzdw,jtcy1_ysr,jtcy2_xm,jtcy2_gx,jtcy2_gzdw,jtcy2_ysr,jtcy3_xm,jtcy3_gx,jtcy3_gzdw,jtcy3_ysr,jtcy4_xm,jtcy4_gx,jtcy4_gzdw,jtcy4_ysr,jtcy5_xm,jtcy5_gx,jtcy5_gzdw,"
				+ "jtcy5_ysr,jttgje,zxje,jxje,qgzxje,xnwxdkje,qtsrje,zxdkje,zxdksj,yffzxdkje,xyshyj,xxshyj,zzdjdm,zzdjmc,zzdjje,"
				+ "xyshryhm,xyshrxm,xyzzfzryj,fdyshyj,xxsh,XYSH yesNo from view_xsbzxx where "
				+ pk + "='" + pkVal + "'";
			request.setAttribute("isXX", "is");
		}
		colList = new String[] { "pk", "yffzxdksj", "sqzzly",
				"zzff1", "zzff1qsje", "zzff1jsje", "xxsh", "xysh",
				"xh", "xm", "xb", "nj", "qsh", "qsdh", "lxdzxx",
				"lxdh", "sjhm", "bz", "bzdm", "bzmc", "xn", "nd",
				"mzmc", "bysj", "zynj", "jtdz", "yzbm", "sfzh",
				"jtcy1_xm", "jtcy1_gx", "jtcy1_gzdw", "jtcy1_ysr",
				"jtcy2_xm", "jtcy2_gx", "jtcy2_gzdw", "jtcy2_ysr",
				"jtcy3_xm", "jtcy3_gx", "jtcy3_gzdw", "jtcy3_ysr",
				"jtcy4_xm", "jtcy4_gx", "jtcy4_gzdw", "jtcy4_ysr",
				"jtcy5_xm", "jtcy5_gx", "jtcy5_gzdw", "jtcy5_ysr",
				"jttgje", "zxje", "jxje", "qgzxje", "xnwxdkje",
				"qtsrje", "zxdkje", "zxdksj", "yffzxdkje",
				"xyshyj", "xxshyj", "zzdjdm", "zzdjmc", "zzdjje",
				"xyshryhm", "xyshrxm", "xyzzfzryj", "fdyshyj", "xxsh", "yesNo" };

		String[] rs = dao.getOneRs(sql, new String[] {}, colList);
		if (rs == null) {
			rs = new String[colList.length];
		}
		for (int i = 0; i < colList.length; i++) {
			rs[i] = ((rs[i] == null) || rs[i].equalsIgnoreCase("")) ? " "
					: rs[i];
			hs.put(colList[i], rs[i]);
		}

		if (xxdm.equalsIgnoreCase(Globals.XXDM_ZZSF)) {
			request.setAttribute("isZZSF", "is");
		} else {
			request.setAttribute("isZZSF", "no");
		}
		if (xxdm.equalsIgnoreCase(Globals.XXDM_XNMZ) || xxdm.equalsIgnoreCase(Globals.XXDM_SCJZZYJSXY)) {
			request.setAttribute("isXNMZ", "is");
		} else {
			request.setAttribute("isXNMZ", "no");
		}

		hs.put("zzdjdm", zzdjdm);
		request.setAttribute("rs", hs);
		request.setAttribute("userType", userType);
		request.setAttribute("chkList", dao.getChkList(3));
		request.setAttribute("pk", pkVal);
		request.setAttribute("tName", realTable);
		request.setAttribute("act", "xsbzb");
		return mapping.findForward("success");
	}
	
	private ActionForward xszzhz(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {
		DAO dao = DAO.getInstance();
		XszzDao xszzDao = new XszzDao();
		HttpSession session = request.getSession();
		HashMap<String, String> hs = new HashMap<String, String>();
		String tips = "当前所在位置：学生资助 － 审核 － 资助汇总";
		String userType = session.getAttribute("userType").toString();
		XszzForm myForm = (XszzForm) form;
		String selTab = request.getParameter("hzxmb");
		String xxdm = StandardOperation.getXxdm();
		//  对于学院用户，主要是辅导员，按照辅导员所对应的班级给出班级列表，如果是管理员，则可以根据学院等条件查询所有的班级
		// 同时提供管理员的全部汇总功能
		// if("xx".equalsIgnoreCase(userType)){
		// request.setAttribute("", arg1)
		// } else
		if ("xy".equalsIgnoreCase(userType)) {
			request.setAttribute("disable", "yes");
		}
		if (selTab == null || "".equals(selTab))
			selTab = "view_knsxx";
		String sql = "select * from " + selTab + " where 1=2";
		String[] colList = dao.getColumnName(sql);
		String[] colListCn = dao.getColumnNameCN(colList, selTab);
		ArrayList<HashMap<String, String>> srcTabColsList = new ArrayList<HashMap<String, String>>();
		generateList(srcTabColsList, colList, colListCn);
		String nj = myForm.getNj();
		String xydm = myForm.getXydm();
		String zydm = myForm.getZydm();
		
		if (selTab.equalsIgnoreCase("VIEW_KNSXX")
				|| selTab.equalsIgnoreCase("VIEW_CQKJXY_LSTD")
				|| selTab.equalsIgnoreCase("VIEW_XSZZ_COM_KNSRDB1")
				|| selTab.equalsIgnoreCase("VIEW_XSZZ_COM_GJJXJ1")
				|| selTab.equalsIgnoreCase("VIEW_XSZZ_COM_GJLZJXJ1")
				|| selTab.equalsIgnoreCase("VIEW_XSZZ_COM_GJLZJXJ2")
				|| selTab.equalsIgnoreCase("VIEW_XSZZ_COM_GJZXJ1")
				|| selTab.equalsIgnoreCase("VIEW_XSZZ_COM_GJZXJ2")
				|| selTab.equalsIgnoreCase("VIEW_XSZZ_COM_GJZXJ3")
				|| selTab.equalsIgnoreCase("VIEW_XSZZ_COM_KNSLSBZ1")
				|| selTab.equalsIgnoreCase("VIEW_XSZZ_COM_XFHJ1")
				|| selTab.equalsIgnoreCase("VIEW_XSZZ_COM_XFJM1")
		) {
			request.setAttribute("xnnd", "xn");
		} else if(selTab.equalsIgnoreCase("VIEW_GDNZZYJSXY_KNSXX")
						|| selTab.equalsIgnoreCase("VIEW_HZZY_JTQKDCB")
						|| selTab.equalsIgnoreCase("VIEW_JSXX_SBKNBZSQB")
						|| selTab.equalsIgnoreCase("VIEW_ZXDK_HKXY")
						|| selTab.equalsIgnoreCase("VIEW_XSJTQKDCB")) {
			request.setAttribute("xnnd", "null");
		} else {
			request.setAttribute("xnnd", "xn");
		}
		
		hs.put("hzxmb", selTab);
		hs.put("en", "");
		xydm = xydm==null ? "":xydm;
		zydm = zydm==null ? "":zydm;
		nj = nj==null ? "":nj;
		String bjKey = xydm+"!!"+zydm+"!!"+nj;
		request.setAttribute("rs", hs);
		request.setAttribute("tips", tips);
		request.setAttribute("userType", userType);
		request.setAttribute("srcTabColsList", srcTabColsList);
		request.setAttribute("tableName", selTab);
		request.setAttribute("zzxmList", xszzDao.getZzxmList(xxdm));
		request.setAttribute("njList", Base.getNjList());
		request.setAttribute("xnList", Base.getXnndList());
		request.setAttribute("ndList", Base.getXnndList());
		request.setAttribute("xqList", Base.getXqList());
		request.setAttribute("xyList", Base.getXyList());
		request.setAttribute("zyList", Base.getZyMap().get(xydm));// 发送专业列表
		request.setAttribute("bjList", Base.getBjMap().get(bjKey));// 发送班级列表
		return mapping.findForward("success");
	}

	private ActionForward xszzhz_output(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response) {
//		XszzForm myForm = (XszzForm) form;
		DAO dao = DAO.getInstance();
		HttpSession session = request.getSession();
		String nj = request.getParameter("nj");
		String xn = request.getParameter("xn");
		String nd = request.getParameter("nd");
		String xh = request.getParameter("xh");
		String xydm = request.getParameter("xydm");
		String zydm = request.getParameter("zydm");
		String bjdm = request.getParameter("bjdm");
		String tableName = request.getParameter("tableName");
		StringBuffer condi = new StringBuffer(" where 1=1 ");
		// String[] queryCondiArr = {nj,xn,xh,xydm,zydm,bjdm};
		String queryStr = request.getParameter("queryStr");
		String[] queryColsArr = queryStr.split("!!");
		String[] queryColsArrCn = dao.getColumnNameCN(queryColsArr,
				tableName);
		String userDep = session.getAttribute("userDep").toString();
		String userType = dao.getUserType(userDep);
		if (userType.equalsIgnoreCase("xy")
				&& (xydm == null || xydm.equals(""))) {
			xydm = userDep;
		}
		StringBuffer sql = new StringBuffer("select ");
		for (int i = 0; i < queryColsArr.length; i++) {
			sql.append(queryColsArr[i]);
			sql.append(i != queryColsArr.length - 1 ? "," : "");
		}
		sql.append(" from ");
		sql.append(tableName);
		// 以下生成条件
		if (nj != null && !(nj.equalsIgnoreCase(""))) {
			condi.append(" and nj='");
			condi.append(nj);
			condi.append("' ");
		}
		if (nd != null && !(nd.equalsIgnoreCase(""))
				&& (tableName.equalsIgnoreCase("VIEW_GDNZZYJSXY_KNSXX")
						|| tableName.equalsIgnoreCase("VIEW_HZZY_JTQKDCB")
						|| tableName.equalsIgnoreCase("VIEW_JSXX_SBKNBZSQB")
						|| tableName.equalsIgnoreCase("VIEW_ZXDK_HKXY")
						|| tableName.equalsIgnoreCase("VIEW_XSJTQKDCB"))) {
			condi.append(" and nd='");
			condi.append(nd);
			condi.append("' ");
		}
		if (xn != null && !(xn.equalsIgnoreCase(""))) {
			if(tableName.equalsIgnoreCase("VIEW_CQKJXY_LSTD")){
				condi.append(" and ZCXNXQ in ('");
				condi.append(xn + "-1,");
				condi.append(xn + "-2,");
				condi.append(xn + "-3) ");
			} else {
				condi.append(" and xn='");
				condi.append(xn);
				condi.append("' ");
			}
		}
		if (xh != null && !(xh.trim().equalsIgnoreCase(""))) {
			condi.append(" and xh='");
			condi.append(xh);
			condi.append("' ");
		}
		if (xydm != null && !(xydm.trim().equalsIgnoreCase(""))) {
			condi.append(" and xydm='");
			condi.append(xydm);
			condi.append("' ");
		}
		if (zydm != null && !(zydm.trim().equalsIgnoreCase(""))) {
			condi.append(" and zydm='");
			condi.append(zydm);
			condi.append("' ");
		}
		if (bjdm != null && !(bjdm.trim().equalsIgnoreCase(""))) {
			condi.append(" and bjdm='");
			condi.append(bjdm);
			condi.append("' ");
		}
		
		// ----------------2010/7/5 edit by luojw------------------------
		if (tableName.equalsIgnoreCase("VIEW_SHNL_KNSXX")) {
			condi.append(" and shjg in ('困难','特别困难') ");
		} else if (!tableName.equalsIgnoreCase("VIEW_XG_ZZ_KNSDJB")
				&& !"VIEW_XSZZ_GZDX_XSDKXXB".equalsIgnoreCase(tableName)) {
			condi.append(" and xxsh in ('通过','特困','一般困难','特别困难','比较困难','困难','特殊困难','已审核') ");
		}
		// ----------------end------------------------
		sql.append(condi.toString());
		Vector<Object> rs = new Vector<Object>();
		rs.addAll(dao.rsToVator(sql.toString(), new String[] {},
				queryColsArr));
		try {
			response.reset();
			OutputStream output = response.getOutputStream();
			response.setContentType("application/vnd.ms-excel");
			Excel2Oracle.exportDataFor(rs, queryColsArrCn, output);
		} catch (Exception e) {
			e.printStackTrace();
		}
		return mapping.findForward("success");
	}
	
	private void generateList(ArrayList<HashMap<String, String>> list,String[] col,String[] colCn){
		for(int i=0;i<col.length;i++){
			HashMap<String, String> map = new HashMap<String, String>();
			map.put("en",col[i]);
			map.put("cn", colCn[i]);
			list.add(map);
		}
	}
}
