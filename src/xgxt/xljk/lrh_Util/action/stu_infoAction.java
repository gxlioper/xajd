/*
 * Generated by MyEclipse Struts
 * Template path: templates/java/JavaClass.vtl
 */
package xgxt.xljk.lrh_Util.action;

import java.util.List;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.struts.action.Action;
import org.apache.struts.action.ActionForm;
import org.apache.struts.action.ActionForward;
import org.apache.struts.action.ActionMapping;

import xgxt.DAO.DAO;
import xgxt.action.Base;
import xgxt.base.DealString;
import xgxt.xljk.lrh_Util.util.lrh_commen_util;
import xgxt.xljk.lrh_Util.util.stu_info_util;
import xgxt.xljk.xlxh.Form.xljk_xlxhhy_from;

/** 
 * MyEclipse Struts
 * Creation date: 07-27-2007
 * 
 * XDoclet definition:
 * @struts.action path="/stu_info" name="xljk_xlxhhy_form" scope="request" validate="true"
 */
public class stu_infoAction extends Action {

	public ActionForward execute(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {
		xljk_xlxhhy_from xljk_xlxhhy_form = (xljk_xlxhhy_from) form;// TODO Auto-generated method stub
		try {
			int i = Base.chkTimeOut(request.getSession());
			if (i <= 2) {
				xljk_xlxhhy_form.setErrMsg("登陆超时，请重新登陆！");
				return new ActionForward("/login.jsp", false);
			}
			HttpSession session = request.getSession();
			if (session == null) {
				request.setAttribute("errMsg", "sadfsdf");
				return mapping.findForward("false");
			}
			ActionForward myActFwd = null;
			String act = request.getParameter("act");
			String doType = request.getParameter("doType");

			if (act.equals("stu_util")) {
				if (doType != null && !doType.equalsIgnoreCase("")) {
					if (doType.equals("stu_info")) {
						myActFwd = stu_info(mapping, form, request, response);
					}
				} else {
					myActFwd = index_to_jsp(mapping, form, request, response);
				}
			}
			return myActFwd;
		} catch (Exception e) {
			e.printStackTrace();
			xljk_xlxhhy_form.setErrMsg("数据连接中断，请重新登陆！");
			return new ActionForward("/login.jsp", false);
		}
	}

	private ActionForward index_to_jsp(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {
		//			xljk_xlxhhy_from xljk_xlxhhy_form = (xljk_xlxhhy_from) form;

		return null;
	}

	private ActionForward stu_info(ActionMapping mapping, ActionForm form,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {
		//			xljk_xlxhhy_from xljk_xlxhhy_form = (xljk_xlxhhy_from) form;
		String url = request.getParameter("url");
		HttpSession session = request.getSession();
		String userDep = session.getAttribute("userDep").toString();
		String userName = session.getAttribute("userName").toString();
		String isFdy = session.getAttribute("isFdy").toString();
		lrh_commen_util commen_util = new lrh_commen_util();
		if (url != null && !url.equalsIgnoreCase("")) {

		} else {
			Object a = request.getAttribute("url");
			url = a.toString();
		}
		DAO dao = DAO.getInstance();
		xljk_xlxhhy_from sif = (xljk_xlxhhy_from) form;
		String xh = DealString.toGBK(sif.getXh());
		String xm = DealString.toGBK(sif.getXm());
		String nj = sif.getNj();
		String xydm = sif.getXydm();
		String userType = dao.getUserType(userDep);
		if ("xx".equalsIgnoreCase(userType)) {
			xydm = sif.getXydm();
		} else {
			xydm = userDep;
			sif.setXydm(xydm);
		}

		String zydm = sif.getZydm();
		//			String bjdm = sif.getBjdm();
		sif.setXm(xm);
		sif.setXh(xh);
		sif.setIsFdy(isFdy);
		sif.setUserName(userName);
		String go = request.getParameter("go");
		stu_info_util stu_util = new stu_info_util();
		if ("go".equalsIgnoreCase(go)) {
			List li = stu_util.stus_find_by(sif);
			request.setAttribute("rs", li);
			if (li != null) {
				int rsNum = li.size();
				request.setAttribute("rsNum", rsNum);
			}
		}

		String[] zdm = { "xh", "xm", "xymc", "zymc", "bjmc" };
		List toptr = stu_util.Get_Table_Title("VIEW_XSJBXX", zdm);
		request.setAttribute("userType", userType);
		request.setAttribute("topTr", toptr);
		request.setAttribute("njList", commen_util.get_njList());
		request.setAttribute("xyList", commen_util.get_xyList());
		request.setAttribute("zyList", commen_util.get_zyList(xydm));
		request.setAttribute("bjList", commen_util.get_bjList2(xydm, zydm, nj));
		request.setAttribute("url", url);
		request.setAttribute("userDep", userDep);
		request.setAttribute("userType", userType);
		return mapping.findForward("stu_info");
	}

}